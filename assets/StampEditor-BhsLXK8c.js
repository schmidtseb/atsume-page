import{r as o,j as e,b as ye,X as ee,l as je,Q as we,w as te,V as Se,J as Ne,W as Z,Y as ke,H as Ce,Z as Pe,$ as _e,a0 as Te,K as De}from"./react-vendor-CFcoa3xO.js";import{u as Ee,I as Ie}from"./InteractiveCanvasView-DEPM7sXZ.js";import{u as _,T as ze,S as h,s as M,h as se,b as Re,a as L,D as Le,i as Ge,j as Fe,k as Oe,l as Ue,m as B,p as q,d as Ae,c as $e,g as Be}from"./index-BDiqkb2Y.js";import{l as qe}from"./vendor-DF1CirjX.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-BAWLRfpT.js";function E({title:s,icon:a,children:t,defaultOpen:n=!1}){const[i,r]=o.useState(n);return e.jsxs("div",{className:"bg-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>r(!i),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-600 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:a}),e.jsx("span",{className:"font-medium text-white",children:s})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&e.jsx("div",{className:"flex flex-col px-4 pb-4 border-t border-gray-600",children:t})]})}function Me({settings:s,handleSettingChange:a}){const{t}=_();return e.jsxs(e.Fragment,{children:[e.jsxs(E,{title:t("settingsSections.posterization.title"),icon:"🎨",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center pt-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"num_colors",className:`text-sm font-medium ${s.num_colors==="auto"?"text-gray-500":"text-gray-300"}`,children:t("settingsSections.posterization.colors")}),e.jsx(ze,{text:t("settingsSections.posterization.colorsTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"auto_color_toggle",className:"text-sm font-medium text-gray-300 cursor-pointer",children:t("settingsSections.posterization.auto")}),e.jsx("input",{id:"auto_color_toggle",type:"checkbox",className:"form-checkbox h-5 w-5 rounded bg-gray-600 border-gray-500 text-blue-600 focus:ring-blue-500 cursor-pointer",checked:s.num_colors==="auto",onChange:n=>{const i={target:{name:"num_colors",value:n.target.checked?"auto":"5",type:"text"}};a(i)}})]})]}),e.jsx(h,{name:"num_colors",value:typeof s.num_colors=="number"?s.num_colors:5,min:1,max:15,step:1,disabled:s.num_colors==="auto",onChange:a})]}),e.jsx(h,{label:t("settingsSections.posterization.backgroundThreshold"),name:"background_threshold",value:s.background_threshold,min:0,max:254,step:1,onChange:a,tooltip:t("settingsSections.posterization.backgroundThresholdTooltip")}),e.jsx(h,{label:t("settingsSections.posterization.shapeShrink"),name:"color_shape_shrink",value:s.color_shape_shrink,min:0,max:10,step:1,unit:"px",onChange:a,tooltip:t("settingsSections.posterization.shapeShrinkTooltip")})]}),e.jsxs(E,{title:t("settingsSections.registration.title"),icon:"📐",children:[e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.registration.shift")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(h,{label:t("settingsSections.registration.amount"),name:"shift.0",value:s.shift[0],min:0,max:10,step:.1,unit:"px",onChange:a,tooltip:t("settingsSections.registration.shiftAmountTooltip")}),e.jsx(h,{label:t("settingsSections.registration.variation"),name:"shift.1",value:s.shift[1],min:0,max:5,step:.1,onChange:a,tooltip:t("settingsSections.registration.variationTooltip")})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.registration.rotation")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(h,{label:t("settingsSections.registration.amount"),name:"rotation.0",value:s.rotation[0],min:-5,max:5,step:.1,unit:"°",onChange:a,tooltip:t("settingsSections.registration.rotationAmountTooltip")}),e.jsx(h,{label:t("settingsSections.registration.variation"),name:"rotation.1",value:s.rotation[1],min:0,max:3,step:.1,onChange:a,tooltip:t("settingsSections.registration.variationTooltip")})]})]}),e.jsxs(E,{title:t("settingsSections.edge.title"),icon:"✨",children:[e.jsx(h,{label:t("settingsSections.edge.width"),name:"edge_width",value:s.edge_width,min:0,max:20,step:1,unit:"px",onChange:a,tooltip:t("settingsSections.edge.widthTooltip")}),e.jsx(h,{label:t("settingsSections.edge.boost"),name:"edge_boost",value:s.edge_boost,min:0,max:10,step:.1,onChange:a,tooltip:t("settingsSections.edge.boostTooltip")})]}),e.jsxs(E,{title:t("settingsSections.wear.title"),icon:"🔧",children:[e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.intensity")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(h,{label:t("settingsSections.registration.amount"),name:"wear_intensity.0",value:s.wear_intensity[0],min:0,max:1,step:.05,onChange:a}),e.jsx(h,{label:t("settingsSections.registration.variation"),name:"wear_intensity.1",value:s.wear_intensity[1],min:0,max:1,step:.05,onChange:a})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.noiseScale")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(h,{label:t("settingsSections.registration.amount"),name:"noise_scale.0",value:s.noise_scale[0],min:1,max:200,step:1,onChange:a}),e.jsx(h,{label:t("settingsSections.registration.variation"),name:"noise_scale.1",value:s.noise_scale[1],min:1,max:10,step:.1,onChange:a})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.inkDepletion")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(h,{label:t("settingsSections.registration.amount"),name:"ink_depletion_intensity.0",value:s.ink_depletion_intensity[0],min:0,max:1,step:.05,onChange:a,tooltip:t("settingsSections.wear.inkDepletionAmountTooltip")}),e.jsx(h,{label:t("settingsSections.registration.variation"),name:"ink_depletion_intensity.1",value:s.ink_depletion_intensity[1],min:0,max:.2,step:.01,onChange:a})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.numPatches")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(h,{label:t("settingsSections.registration.amount"),name:"num_patches.0",value:s.num_patches[0],min:0,max:15,step:1,onChange:a,tooltip:t("settingsSections.wear.numPatchesAmountTooltip")}),e.jsx(h,{label:t("settingsSections.registration.variation"),name:"num_patches.1",value:s.num_patches[1],min:0,max:5,step:1,onChange:a})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.patchSize")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(h,{label:t("settingsSections.wear.min"),name:"patch_size_range.0",value:s.patch_size_range[0],min:1,max:200,step:1,unit:"px",onChange:a}),e.jsx(h,{label:t("settingsSections.wear.max"),name:"patch_size_range.1",value:s.patch_size_range[1],min:1,max:500,step:1,unit:"px",onChange:a})]})]}),e.jsxs(E,{title:t("settingsSections.splats.title"),icon:"💧",defaultOpen:!0,children:[e.jsx(h,{label:t("settingsSections.splats.density"),name:"splat_density",value:s.splat_density,min:.005,max:2,step:.005,onChange:a,tooltip:t("settingsSections.splats.densityTooltip")}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.splats.size")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(h,{label:t("settingsSections.wear.min"),name:"splat_size_range.0",value:s.splat_size_range[0],min:1,max:5,step:.1,onChange:a}),e.jsx(h,{label:t("settingsSections.wear.max"),name:"splat_size_range.1",value:s.splat_size_range[1],min:.1,max:10,step:.1,onChange:a})]}),e.jsx(h,{label:t("settingsSections.splats.bleeding"),name:"bleeding_factor",value:s.bleeding_factor,min:0,max:1,step:.05,onChange:a,tooltip:t("settingsSections.splats.bleedingTooltip")})]})]})}const V=async s=>{const{data:a,error:t}=await M.from("user_presets").select("name, settings").eq("user_id",s);return t?(console.error("Failed to load custom presets from Supabase:",t),[]):a.map(n=>({name:n.name,settings:n.settings}))},Ve=async(s,a,t)=>{const{error:n}=await M.from("user_presets").insert({user_id:s,name:a,settings:t});if(n)throw console.error("Failed to add custom preset to Supabase:",n),n;return V(s)},He=async(s,a)=>{const{error:t}=await M.from("user_presets").delete().eq("user_id",s).eq("name",a);if(t)throw console.error("Failed to delete custom preset from Supabase:",t),t;return V(s)},We=qe("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-gray-900 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-gray-50 text-gray-900 hover:bg-gray-50/90",destructive:"bg-red-500 text-gray-50 hover:bg-red-500/90",outline:"border border-gray-800 bg-gray-950 hover:bg-gray-800 hover:text-gray-50",secondary:"bg-gray-700 text-gray-50 hover:bg-gray-600/80",ghost:"hover:bg-gray-800 hover:text-gray-50",link:"text-gray-50 underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),P=o.forwardRef(({className:s,variant:a,size:t,asChild:n=!1,...i},r)=>{const u=n?ye:"button";return e.jsx(u,{className:se(We({variant:a,size:t,className:s})),ref:r,...i})});P.displayName="Button";const ae=o.forwardRef(({className:s,type:a,...t},n)=>e.jsx("input",{type:a,className:se("flex h-10 w-full rounded-md border border-gray-800 bg-gray-950 px-3 py-2 text-sm ring-offset-gray-900 file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:n,...t}));ae.displayName="Input";const Ke=({staticPresets:s,activePreset:a,currentSettings:t,onSelectPreset:n})=>{const{t:i}=_(),{user:r}=Re(),{addToast:u}=L(),[j,f]=o.useState([]),[g,p]=o.useState(""),[S,b]=o.useState(!1);o.useEffect(()=>{(async()=>{if(r!=null&&r.id){const w=await V(r.id);f(w)}else f([])})()},[r]);const l=[...s,...j],x=async()=>{if(g.trim()===""||!(r!=null&&r.id)){u(i("presetSelector.savePresetError"),"error");return}try{const v=await Ve(r.id,g,t);f(v),p(""),u(i("presetSelector.savePresetSuccess",{name:g}),"success")}catch(v){console.error("Failed to save preset:",v),u(i("presetSelector.savePresetError"),"error")}},d=async v=>{if(!(r!=null&&r.id)){u(i("presetSelector.deletePresetError"),"error");return}try{const w=await He(r.id,v);f(w),u(i("presetSelector.deletePresetSuccess",{name:v}),"success")}catch(w){console.error("Failed to delete preset:",w),u(i("presetSelector.deletePresetError"),"error")}};return e.jsxs(Le,{open:S,onOpenChange:b,children:[e.jsx(Ge,{asChild:!0,children:e.jsx(P,{variant:"secondary",className:"w-full justify-start text-left",children:i("presetSelector.managePresets")})}),e.jsxs(Fe,{className:"sm:max-w-[425px]",children:[e.jsx(Oe,{children:e.jsx(Ue,{children:i("presetSelector.managePresets")})}),e.jsx("div",{className:"grid gap-2 py-4 max-h-60 overflow-y-auto",children:l.map(v=>e.jsxs("div",{className:"relative flex items-center group",children:[e.jsx("button",{onClick:()=>{n(v),b(!1)},className:`flex-grow text-left text-sm font-medium py-2 px-3 rounded-md transition-colors duration-200
                  ${a===v.name?"bg-blue-600 text-white shadow-md":"bg-gray-700 text-gray-300 hover:bg-gray-600"}
                `,children:v.name}),j.some(w=>w.name===v.name)&&e.jsx(P,{variant:"ghost",size:"sm",className:"absolute right-0 p-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",onClick:w=>{w.stopPropagation(),d(v.name)},children:"✕"})]},v.name))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:i("presetSelector.savePresetLabel")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{type:"text",placeholder:i("presetSelector.newPresetNamePlaceholder"),value:g,onChange:v=>p(v.target.value),className:"flex-grow"}),e.jsx(P,{onClick:x,disabled:g.trim()==="",children:i("presetSelector.saveButton")})]})]})]})]})};function Je(){const[s,a]=o.useState(null),[t,n]=o.useState(!1),i=o.useRef(null),{addToast:r}=L(),{t:u}=_(),j=o.useCallback((l,x)=>{const d=new Image;d.onload=()=>{a(d),x&&r(x,"success")},d.onerror=()=>{r(u("imageLoader.loadUrlErrorToast"),"error")},d.src=l},[r,u]),f=o.useCallback(l=>{if(!l)return;if(!l.type.startsWith("image/")){r(u("imageLoader.invalidFileToast"),"error");return}const x=URL.createObjectURL(l);j(x,u("imageLoader.loadedToast"))},[r,j,u]),g=o.useCallback(l=>{var x;f(((x=l.target.files)==null?void 0:x[0])||null),l.target&&(l.target.value="")},[f]);return{sourceImage:s,isDragging:t,fileInputRef:i,handleDragOver:l=>{l.preventDefault(),l.stopPropagation(),n(!0)},handleDragLeave:l=>{l.preventDefault(),l.stopPropagation(),n(!1)},handleDrop:l=>{var x;l.preventDefault(),l.stopPropagation(),n(!1),f(((x=l.dataTransfer.files)==null?void 0:x[0])||null)},handleImageUpload:g,onUploadClick:()=>{var l;return(l=i.current)==null?void 0:l.click()},setSourceImageFromUrl:j}}function Qe(){const[s,a]=o.useState(B),[t,n]=o.useState("Default"),{addToast:i}=L(),{t:r}=_(),u=o.useCallback(g=>{const{name:p,value:S,type:b}=g.target;let l;if(S==="auto")l="auto";else{const x=parseFloat(S);b==="range"||S.trim()!==""&&!isNaN(x)?l=x:l=S}a(x=>{const d=p.split(".");if(d.length>1){const v={...x};let w=v;for(let m=0;m<d.length-1;m++){const y=d[m];w[y]=[...w[y]],w=w[y]}return w[d[d.length-1]]=l,v}else return{...x,[p]:l}}),n("Custom")},[]),j=o.useCallback(()=>{a(B),n("Default"),i(r("stampSettings.resetToast"),"info")},[i,r]),f=o.useCallback(g=>{a({...B,...g.settings}),n(g.name),i(r("stampSettings.loadedPresetToast",{name:g.name}),"info")},[i,r]);return{settings:s,activePreset:t,staticPresets:q,handleSettingChange:u,handleResetSettings:j,handleSelectPreset:f}}const ne=o.createContext(void 0),Xe=({children:s})=>{const{addToast:a}=L(),{t}=_(),{sourceImage:n,isDragging:i,fileInputRef:r,handleImageUpload:u,onUploadClick:j,setSourceImageFromUrl:f,...g}=Je(),{settings:p,activePreset:S,staticPresets:b,handleSettingChange:l,handleResetSettings:x,handleSelectPreset:d}=Qe(),{stamps:v,addStampToGallery:w,deleteStampFromGallery:m,renameStampInGallery:y}=Ae(),[re,F]=o.useState(!1),[I,O]=o.useState(null),[U,H]=o.useState(null),[W,oe]=o.useState(!1),[ie,le]=o.useState(!1),[ce,de]=o.useState(!0),[A,K]=o.useState(!1),z=o.useRef(null);o.useEffect(()=>{const c=new Audio("/atsume-page/stamp-sound.mp3");c.load(),z.current=c},[]),o.useEffect(()=>{const c=C=>{C.touches[0]&&"force"in C.touches[0]&&C.touches[0].force>0&&(oe(!0),a(t("stampEditor.pressureToast"),"info")),window.removeEventListener("touchstart",c)};return window.addEventListener("touchstart",c,{once:!0}),()=>window.removeEventListener("touchstart",c)},[a,t]);const R=o.useRef(null),me=o.useCallback((c,C,D)=>{var T;(T=R.current)==null||T.call(R,c,C,D)},[]),N=Ee({onPlaceRequest:me,isPlacementDisabled:!n||A}),J=o.useCallback(async(c,C,D)=>{if(!(!n||A)){K(!0);try{const T=$e(n,p.stamp_size),Q=T.getContext("2d",{willReadFrequently:!0});if(!Q)throw new Error("Could not get context from resized canvas");const ve=Q.getImageData(0,0,T.width,T.height),X={...p},Y=await Be(ve,X),$=await createImageBitmap(Y);if(N.canvasNode){const k=N.canvasNode.getContext("2d");k==null||k.save(),k==null||k.translate(c,C),k==null||k.rotate(D*Math.PI/180),k==null||k.drawImage($,-$.width/2,-$.height/2),k==null||k.restore()}z.current&&(z.current.currentTime=0,z.current.play().catch(console.warn)),H({imageData:Y,settings:X}),N.forceCanvasUpdate()}catch(T){console.error("Error generating stamp:",T),a(t("stampEditor.stampingErrorToast"),"error")}finally{K(!1)}}},[n,p,W,a,t,N.canvasNode,N.forceCanvasUpdate]);o.useEffect(()=>{R.current=J},[J]);const ue=o.useCallback(()=>{if(N.canvasNode){const c=N.canvasNode.getContext("2d");c==null||c.clearRect(0,0,N.canvasNode.width,N.canvasNode.height),N.forceCanvasUpdate(),a(t("stampEditor.canvasClearedToast"),"info")}},[a,N.canvasNode,N.forceCanvasUpdate,t]),ge=o.useCallback(()=>{if(!N.canvasNode){a(t("stampEditor.downloadErrorToast"),"info");return}const c=document.createElement("a");c.download="stamped-creation.png",c.href=N.canvasNode.toDataURL("image/png"),c.click()},[a,N.canvasNode,t]),pe=()=>{if(!U||!n)return;const c=`Stamp #${v.length+1}`;w(n,U.settings,c),H(null)},xe=c=>{const C={name:c.name,settings:c.settings};d(C),f(c.sourceImageURL,t("stampEditor.loadedStampToast",{name:c.name})),O(c),F(!1)},he=()=>{const c=q.find(C=>C.name==="Default");c&&d(c),O(null),F(!1),a(t("stampEditor.newStampToast"),"info"),j()},fe=c=>{if((I==null?void 0:I.id)===c){const C=q.find(D=>D.name==="Default");C&&d(C),O(null)}m(c)},be={sourceImage:n,isDragging:i,fileInputRef:r,onUploadClick:j,imageLoaderProps:{handleDragOver:g.handleDragOver,handleDragLeave:g.handleDragLeave,handleDrop:g.handleDrop,handleImageUpload:u},settings:p,activePreset:S,staticPresets:b,handleSettingChange:l,handleResetSettings:x,handleSelectPreset:d,stamps:v,renameStampInGallery:y,isProcessing:A,isPanMode:N.isPanMode,lastGeneratedStamp:U,interactiveCanvas:N,isGalleryOpen:re,setIsGalleryOpen:F,isSettingsOpen:ie,setIsSettingsOpen:le,isToolbarOpen:ce,setIsToolbarOpen:de,supportsForce:W,handleClearCanvas:ue,handleDownloadImage:ge,handleAddToGallery:pe,handleSelectStamp:xe,handleCreateNew:he,handleDeleteStamp:fe,selectedGalleryStamp:I};return e.jsx(ne.Provider,{value:be,children:s})},G=()=>{const s=o.useContext(ne);if(s===void 0)throw new Error("useStampEditorContext must be used within a StampEditorProvider");return s};function Ye({isOpen:s,onClose:a}){const{t}=_(),{settings:n,sourceImage:i,isProcessing:r,staticPresets:u,activePreset:j,handleSettingChange:f,onUploadClick:g,handleResetSettings:p,handleSelectPreset:S,handleClearCanvas:b,handleDownloadImage:l,lastGeneratedStamp:x,handleAddToGallery:d}=G();return e.jsx("aside",{className:`fixed top-0 right-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-l-2 border-gray-700 shadow-2xl ${s?"translate-x-0":"translate-x-full"}`,"aria-hidden":!s,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsx("h1",{className:"text-xl font-bold",children:t("rightSidebar.title")}),e.jsx(P,{variant:"ghost",size:"icon",onClick:a,className:"rounded-full","aria-label":t("rightSidebar.close"),children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 no-scrollbar",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 bg-gray-900/50 p-4 rounded-xl border border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:t("rightSidebar.canvasControls")}),e.jsxs(P,{onClick:g,className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),t(i?"rightSidebar.changeImage":"rightSidebar.uploadImage")]}),e.jsxs(P,{onClick:d,disabled:!x||r,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",title:t("rightSidebar.addToGalleryTooltip"),children:[e.jsx(we,{className:"w-5 h-5"}),t("rightSidebar.addToGallery")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(P,{onClick:b,disabled:r,variant:"destructive",className:"w-full disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"})," ",t("rightSidebar.clear")]}),e.jsxs(P,{onClick:l,disabled:r,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"})," ",t("rightSidebar.download")]})]})]}),e.jsx(Ke,{staticPresets:u,activePreset:j,currentSettings:n,onSelectPreset:S}),e.jsxs(P,{onClick:()=>p(),disabled:r,className:"w-full bg-gray-700 hover:bg-gray-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-gray-300 font-medium py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),t("rightSidebar.resetParameters")]}),e.jsx(Me,{settings:n,handleSettingChange:f})]})})]})})}const Ze=({isOpen:s,onClose:a})=>{const{stamps:t,selectedGalleryStamp:n,handleSelectStamp:i,handleDeleteStamp:r,renameStampInGallery:u,handleCreateNew:j}=G(),[f,g]=o.useState(null),[p,S]=o.useState(null),[b,l]=o.useState(""),x=o.useRef(null),{t:d}=_(),v=(m,y)=>{y.stopPropagation(),g(null),S(m.id),l(m.name)},w=()=>{if(p&&b.trim()){const m=t.find(y=>y.id===p);m&&m.name!==b.trim()&&u(p,b.trim())}S(null)};return o.useEffect(()=>{p&&x.current&&(x.current.focus(),x.current.select())},[p]),o.useEffect(()=>{s&&(g(null),S(null))},[s]),e.jsx("aside",{className:`fixed top-0 left-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-r-2 border-gray-700 shadow-2xl ${s?"translate-x-0":"-translate-x-full"}`,"aria-hidden":!s,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsx("h1",{className:"text-xl font-bold",children:d("stampGallery.title")}),e.jsx("button",{onClick:a,className:"p-2 rounded-full hover:bg-gray-700","aria-label":d("stampGallery.close"),children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-4 no-scrollbar",children:[e.jsxs("button",{onClick:j,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2 mb-4",children:[e.jsx(Z,{className:"w-5 h-5"}),d("stampGallery.createNew")]}),t.length===0?e.jsxs("div",{className:"text-center text-gray-400 mt-8",children:[e.jsx("p",{children:d("stampGallery.empty")}),e.jsx("p",{className:"text-sm mt-1",children:d("stampGallery.emptySubtext")})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.map(m=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>{f!==m.id&&p!==m.id&&i(m)},className:`w-full aspect-square rounded-lg overflow-hidden transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${(n==null?void 0:n.id)===m.id&&!p?"ring-2 ring-blue-500":"ring-1 ring-gray-700 hover:ring-blue-500"}`,children:[e.jsx("img",{src:m.thumbnail,alt:m.name,className:"w-full h-full object-contain bg-gray-900/50 p-1"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 text-white text-xs text-center p-1 truncate",children:p===m.id?e.jsx("input",{ref:x,type:"text",value:b,className:"w-full bg-gray-900 text-white text-center text-xs p-0 border-none outline-none ring-1 ring-blue-500 rounded-sm",onChange:y=>l(y.target.value),onBlur:w,onKeyDown:y=>{y.key==="Enter"&&w(),y.key==="Escape"&&S(null)},onClick:y=>y.stopPropagation()}):m.name})]}),e.jsx("div",{className:"absolute top-1 right-1 z-10",children:f===m.id?e.jsxs("div",{className:"flex items-center gap-1.5 p-1 bg-gray-900/80 rounded-lg backdrop-blur-sm",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),r(m.id),g(null)},className:"text-xs font-bold text-red-400 hover:text-red-300 px-1","aria-label":d("stampGallery.confirmDelete",{name:m.name}),children:d("common.confirm")}),e.jsx("button",{onClick:y=>{y.stopPropagation(),g(null)},className:"text-xs text-gray-300 hover:text-white px-1","aria-label":d("stampGallery.cancelDelete"),children:d("common.cancel")})]}):p!==m.id?e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:y=>v(m,y),className:"bg-blue-600/80 text-white p-1 rounded-full hover:bg-blue-500","aria-label":d("stampGallery.rename",{name:m.name}),children:e.jsx(Z,{className:"w-3 h-3"})}),e.jsx("button",{onClick:y=>{y.stopPropagation(),S(null),g(m.id)},className:"bg-red-600/80 text-white p-1 rounded-full hover:bg-red-500","aria-label":d("common.delete"),children:e.jsx(te,{className:"w-3 h-3"})})]}):null})]},m.id))})]})]})})},et=({isOpen:s,onClose:a})=>{const{t}=_(),{settings:n,handleSettingChange:i,supportsForce:r,sourceImage:u,isProcessing:j}=G(),f=!u||j;return e.jsx("div",{className:`absolute bottom-4 left-1/2 -translate-x-1/2 z-20 w-11/12 max-w-lg transition-all duration-300 ease-in-out ${s?"opacity-100 translate-y-0":"opacity-0 translate-y-full pointer-events-none"}`,"aria-label":t("stampToolbar.title"),"aria-hidden":!s,children:e.jsx("div",{className:`transition-opacity duration-300 ${f?"opacity-70":"opacity-100"}`,children:e.jsxs("div",{className:"relative flex flex-col sm:flex-row items-center justify-center gap-4 rounded-xl bg-gray-900/90 backdrop-blur-sm p-3 shadow-lg ring-1 ring-white/10",children:[e.jsx("button",{onClick:a,"aria-label":t("stampToolbar.hide"),className:"absolute top-1 right-1 z-10 p-1 text-gray-400 rounded-full hover:bg-white/10 hover:text-white transition-colors",children:e.jsx(ke,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(h,{label:t("stampToolbar.size"),name:"stamp_size",value:n.stamp_size,min:500,max:1500,step:1,unit:"px",onChange:i,tooltip:t("stampToolbar.sizeTooltip"),disabled:f})}),!r&&e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(h,{label:t("stampToolbar.intensity"),name:"splat_density",value:n.splat_density,min:.1,max:2,step:.05,onChange:i,tooltip:t("stampToolbar.intensityTooltip"),disabled:f})}),r&&e.jsx("div",{className:"text-center text-sm text-gray-300 p-2 whitespace-nowrap",children:t("stampToolbar.pressureMessage")})]})})})},tt=()=>{const{imageLoaderProps:s,fileInputRef:a,interactiveCanvas:t,isGalleryOpen:n,setIsGalleryOpen:i,isSettingsOpen:r,setIsSettingsOpen:u,isToolbarOpen:j,setIsToolbarOpen:f,isProcessing:g,isPanMode:p,sourceImage:S}=G(),{t:b}=_(),l=p?"cursor-grab":S?"cursor-crosshair":"cursor-default";return e.jsxs("div",{className:"relative w-full h-full bg-gray-700",onDragOver:s.handleDragOver,onDragLeave:s.handleDragLeave,onDrop:s.handleDrop,children:[e.jsx("input",{type:"file",ref:a,accept:"image/*",onChange:s.handleImageUpload,className:"hidden","aria-hidden":"true"}),e.jsx(Ie,{canvasRef:t.canvasRef,containerRef:t.containerRef,canvasNode:t.canvasNode,containerProps:t.containerProps,viewTransform:t.viewTransform,viewTransformRef:t.viewTransformRef,viewportSize:t.viewportSize,isPanning:t.isPanning,isPanMode:p,stampPreview:t.stampPreview,cursorClass:l,ariaLabel:b("stampEditor.stampingArea")}),e.jsx(Ze,{isOpen:n,onClose:()=>i(!1)}),e.jsx(et,{isOpen:j,onClose:()=>f(!1)}),e.jsx(Ye,{isOpen:r,onClose:()=>u(!1)}),g&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-lg z-50 pointer-events-none","aria-live":"polite",children:[e.jsx(Ce,{className:"w-6 h-6 mr-3 animate-pulse"}),b("stampEditor.generatingToast")]}),e.jsxs(e.Fragment,{children:[!n&&e.jsx("button",{onClick:()=>i(!0),className:"fixed top-1/2 -translate-y-1/2 left-0 z-30 py-4 px-1 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-r-lg shadow-lg transition-colors","aria-label":b("stampEditor.galleryToggle"),title:b("stampEditor.galleryToggle"),children:e.jsx(Pe,{className:"w-5 h-5"})}),!r&&e.jsx("button",{onClick:()=>u(!0),className:"fixed top-1/2 -translate-y-1/2 right-0 z-30 py-4 px-1 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-l-lg shadow-lg transition-colors","aria-label":b("stampEditor.settingsToggle"),title:b("stampEditor.settingsToggle"),children:e.jsx(_e,{className:"w-5 h-5"})}),!j&&e.jsx("button",{onClick:()=>f(!0),className:"fixed bottom-0 left-1/2 -translate-x-1/2 z-30 p-1 px-4 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-t-lg shadow-lg transition-colors","aria-label":b("stampEditor.toolbarToggle"),title:b("stampEditor.toolbarToggle"),children:e.jsx(Te,{className:"w-5 h-5"})}),p&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-30 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(De,{className:"w-4 h-4"})," ",b("stampEditor.panMode")]})]})]})};function lt(){return e.jsx(Xe,{children:e.jsx(tt,{})})}export{lt as default};
