import{r as o,j as e,X,k as pe,O as xe,v as Y,Q as he,H as fe,V as Q,W as be,F as ve,Y as je,Z as ye,$ as we,J as Se}from"./react-vendor-Duv3WysG.js";import{u as Ne,I as ke}from"./InteractiveCanvasView-a7SZ1cr0.js";import{b as C,T as Ce,S as g,a as M,m as A,j as _e,f as Te,h as Pe,n as $}from"./index-BgGc5YWf.js";import"./vendor-CFJUWez9.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-BpK5hd46.js";function E({title:s,icon:a,children:t,defaultOpen:r=!1}){const[l,m]=o.useState(r);return e.jsxs("div",{className:"bg-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>m(!l),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-600 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:a}),e.jsx("span",{className:"font-medium text-white",children:s})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${l?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&e.jsx("div",{className:"flex flex-col px-4 pb-4 border-t border-gray-600",children:t})]})}function Ee({settings:s,handleSettingChange:a}){const{t}=C();return e.jsxs(e.Fragment,{children:[e.jsxs(E,{title:t("settingsSections.posterization.title"),icon:"🎨",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center pt-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"num_colors",className:`text-sm font-medium ${s.num_colors==="auto"?"text-gray-500":"text-gray-300"}`,children:t("settingsSections.posterization.colors")}),e.jsx(Ce,{text:t("settingsSections.posterization.colorsTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"auto_color_toggle",className:"text-sm font-medium text-gray-300 cursor-pointer",children:t("settingsSections.posterization.auto")}),e.jsx("input",{id:"auto_color_toggle",type:"checkbox",className:"form-checkbox h-5 w-5 rounded bg-gray-600 border-gray-500 text-blue-600 focus:ring-blue-500 cursor-pointer",checked:s.num_colors==="auto",onChange:r=>{const l={target:{name:"num_colors",value:r.target.checked?"auto":"5",type:"text"}};a(l)}})]})]}),e.jsx(g,{name:"num_colors",value:typeof s.num_colors=="number"?s.num_colors:5,min:1,max:15,step:1,disabled:s.num_colors==="auto",onChange:a})]}),e.jsx(g,{label:t("settingsSections.posterization.backgroundThreshold"),name:"background_threshold",value:s.background_threshold,min:0,max:254,step:1,onChange:a,tooltip:t("settingsSections.posterization.backgroundThresholdTooltip")}),e.jsx(g,{label:t("settingsSections.posterization.shapeShrink"),name:"color_shape_shrink",value:s.color_shape_shrink,min:0,max:10,step:1,unit:"px",onChange:a,tooltip:t("settingsSections.posterization.shapeShrinkTooltip")})]}),e.jsxs(E,{title:t("settingsSections.registration.title"),icon:"📐",children:[e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.registration.shift")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"shift.0",value:s.shift[0],min:0,max:10,step:.1,unit:"px",onChange:a,tooltip:t("settingsSections.registration.shiftAmountTooltip")}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"shift.1",value:s.shift[1],min:0,max:5,step:.1,onChange:a,tooltip:t("settingsSections.registration.variationTooltip")})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.registration.rotation")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"rotation.0",value:s.rotation[0],min:-5,max:5,step:.1,unit:"°",onChange:a,tooltip:t("settingsSections.registration.rotationAmountTooltip")}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"rotation.1",value:s.rotation[1],min:0,max:3,step:.1,onChange:a,tooltip:t("settingsSections.registration.variationTooltip")})]})]}),e.jsxs(E,{title:t("settingsSections.edge.title"),icon:"✨",children:[e.jsx(g,{label:t("settingsSections.edge.width"),name:"edge_width",value:s.edge_width,min:0,max:20,step:1,unit:"px",onChange:a,tooltip:t("settingsSections.edge.widthTooltip")}),e.jsx(g,{label:t("settingsSections.edge.boost"),name:"edge_boost",value:s.edge_boost,min:0,max:10,step:.1,onChange:a,tooltip:t("settingsSections.edge.boostTooltip")})]}),e.jsxs(E,{title:t("settingsSections.wear.title"),icon:"🔧",children:[e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.intensity")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"wear_intensity.0",value:s.wear_intensity[0],min:0,max:1,step:.05,onChange:a}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"wear_intensity.1",value:s.wear_intensity[1],min:0,max:1,step:.05,onChange:a})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.noiseScale")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"noise_scale.0",value:s.noise_scale[0],min:1,max:200,step:1,onChange:a}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"noise_scale.1",value:s.noise_scale[1],min:1,max:10,step:.1,onChange:a})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.inkDepletion")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"ink_depletion_intensity.0",value:s.ink_depletion_intensity[0],min:0,max:1,step:.05,onChange:a,tooltip:t("settingsSections.wear.inkDepletionAmountTooltip")}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"ink_depletion_intensity.1",value:s.ink_depletion_intensity[1],min:0,max:.2,step:.01,onChange:a})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.numPatches")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"num_patches.0",value:s.num_patches[0],min:0,max:15,step:1,onChange:a,tooltip:t("settingsSections.wear.numPatchesAmountTooltip")}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"num_patches.1",value:s.num_patches[1],min:0,max:5,step:1,onChange:a})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.patchSize")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.wear.min"),name:"patch_size_range.0",value:s.patch_size_range[0],min:1,max:200,step:1,unit:"px",onChange:a}),e.jsx(g,{label:t("settingsSections.wear.max"),name:"patch_size_range.1",value:s.patch_size_range[1],min:1,max:500,step:1,unit:"px",onChange:a})]})]}),e.jsxs(E,{title:t("settingsSections.splats.title"),icon:"💧",defaultOpen:!0,children:[e.jsx(g,{label:t("settingsSections.splats.density"),name:"splat_density",value:s.splat_density,min:.005,max:2,step:.005,onChange:a,tooltip:t("settingsSections.splats.densityTooltip")}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.splats.size")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.wear.min"),name:"splat_size_range.0",value:s.splat_size_range[0],min:1,max:5,step:.1,onChange:a}),e.jsx(g,{label:t("settingsSections.wear.max"),name:"splat_size_range.1",value:s.splat_size_range[1],min:.1,max:10,step:.1,onChange:a})]}),e.jsx(g,{label:t("settingsSections.splats.bleeding"),name:"bleeding_factor",value:s.bleeding_factor,min:0,max:1,step:.05,onChange:a,tooltip:t("settingsSections.splats.bleedingTooltip")})]})]})}const De=({presets:s,activePreset:a,onSelectPreset:t})=>{const{t:r}=C();return e.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:r("presetSelector.label")}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.map(l=>e.jsx("button",{onClick:()=>t(l),className:`w-full text-center text-sm font-medium py-2 px-3 rounded-lg transition-colors duration-200 ${a===l.name?"bg-blue-600 text-white shadow-md":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:l.name},l.name))})]})};function Ie(){const[s,a]=o.useState(null),[t,r]=o.useState(!1),l=o.useRef(null),{addToast:m}=M(),{t:v}=C(),j=o.useCallback((n,c)=>{const u=new Image;u.onload=()=>{a(u),c&&m(c,"success")},u.onerror=()=>{m(v("imageLoader.loadUrlErrorToast"),"error")},u.src=n},[m,v]),b=o.useCallback(n=>{if(!n)return;if(!n.type.startsWith("image/")){m(v("imageLoader.invalidFileToast"),"error");return}const c=URL.createObjectURL(n);j(c,v("imageLoader.loadedToast"))},[m,j,v]),h=o.useCallback(n=>{var c;b(((c=n.target.files)==null?void 0:c[0])||null),n.target&&(n.target.value="")},[b]);return{sourceImage:s,isDragging:t,fileInputRef:l,handleDragOver:n=>{n.preventDefault(),n.stopPropagation(),r(!0)},handleDragLeave:n=>{n.preventDefault(),n.stopPropagation(),r(!1)},handleDrop:n=>{var c;n.preventDefault(),n.stopPropagation(),r(!1),b(((c=n.dataTransfer.files)==null?void 0:c[0])||null)},handleImageUpload:h,onUploadClick:()=>{var n;return(n=l.current)==null?void 0:n.click()},setSourceImageFromUrl:j}}function ze(){const[s,a]=o.useState(A),[t,r]=o.useState("Default"),{addToast:l}=M(),{t:m}=C(),v=o.useCallback(h=>{const{name:p,value:y,type:f}=h.target;let n;if(y==="auto")n="auto";else{const c=parseFloat(y);f==="range"||y.trim()!==""&&!isNaN(c)?n=c:n=y}a(c=>{const u=p.split(".");if(u.length>1){const T={...c};let k=T;for(let d=0;d<u.length-1;d++){const x=u[d];k[x]=[...k[x]],k=k[x]}return k[u[u.length-1]]=n,T}else return{...c,[p]:n}}),r("Custom")},[]),j=o.useCallback(()=>{a(A),r("Default"),l(m("stampSettings.resetToast"),"info")},[l,m]),b=o.useCallback(h=>{a({...A,...h.settings}),r(h.name),l(m("stampSettings.loadedPresetToast",{name:h.name}),"info")},[l,m]);return{settings:s,activePreset:t,handleSettingChange:v,handleResetSettings:j,handleSelectPreset:b}}const Z=o.createContext(void 0),Re=({children:s})=>{const{addToast:a}=M(),{t}=C(),{sourceImage:r,isDragging:l,fileInputRef:m,handleImageUpload:v,onUploadClick:j,setSourceImageFromUrl:b,...h}=Ie(),{settings:p,activePreset:y,handleSettingChange:f,handleResetSettings:n,handleSelectPreset:c}=ze(),{stamps:u,addStampToGallery:T,deleteStampFromGallery:k,renameStampInGallery:d}=_e(),[x,G]=o.useState(!1),[D,O]=o.useState(null),[U,B]=o.useState(null),[q,ee]=o.useState(!1),[te,se]=o.useState(!1),[ae,ne]=o.useState(!0),[I,V]=o.useState(!1),z=o.useRef(null);o.useEffect(()=>{const i=new Audio("/atsume-page/stamp-sound.mp3");i.load(),z.current=i},[]),o.useEffect(()=>{const i=N=>{N.touches[0]&&"force"in N.touches[0]&&N.touches[0].force>0&&(ee(!0),a(t("stampEditor.pressureToast"),"info")),window.removeEventListener("touchstart",i)};return window.addEventListener("touchstart",i,{once:!0}),()=>window.removeEventListener("touchstart",i)},[a,t]);const R=o.useRef(null),oe=o.useCallback((i,N,P)=>{var _;(_=R.current)==null||_.call(R,i,N,P)},[]),w=Ne({onPlaceRequest:oe,isPlacementDisabled:!r||I}),W=o.useCallback(async(i,N,P)=>{if(!(!r||I)){V(!0);try{const _=Te(r,p.stamp_size),H=_.getContext("2d",{willReadFrequently:!0});if(!H)throw new Error("Could not get context from resized canvas");const ge=H.getImageData(0,0,_.width,_.height),J={...p},K=await Pe(ge,J),F=await createImageBitmap(K);if(w.canvasNode){const S=w.canvasNode.getContext("2d");S==null||S.save(),S==null||S.translate(i,N),S==null||S.rotate(P*Math.PI/180),S==null||S.drawImage(F,-F.width/2,-F.height/2),S==null||S.restore()}z.current&&(z.current.currentTime=0,z.current.play().catch(console.warn)),B({imageData:K,settings:J}),w.forceCanvasUpdate()}catch(_){console.error("Error generating stamp:",_),a(t("stampEditor.stampingErrorToast"),"error")}finally{V(!1)}}},[r,I,p,q,a,t,w.canvasNode,w.forceCanvasUpdate]);o.useEffect(()=>{R.current=W},[W]);const re=o.useCallback(()=>{if(w.canvasNode){const i=w.canvasNode.getContext("2d");i==null||i.clearRect(0,0,w.canvasNode.width,w.canvasNode.height),w.forceCanvasUpdate(),a(t("stampEditor.canvasClearedToast"),"info")}},[a,w.canvasNode,w.forceCanvasUpdate,t]),ie=o.useCallback(()=>{if(!w.canvasNode){a(t("stampEditor.downloadErrorToast"),"info");return}const i=document.createElement("a");i.download="stamped-creation.png",i.href=w.canvasNode.toDataURL("image/png"),i.click()},[a,w.canvasNode,t]),le=()=>{if(!U||!r)return;const i=`Stamp #${u.length+1}`;T(r,U.settings,i),B(null)},ce=i=>{const N={name:i.name,settings:i.settings};c(N),b(i.sourceImageURL,t("stampEditor.loadedStampToast",{name:i.name})),O(i),G(!1)},de=()=>{const i=$.find(N=>N.name==="Default");i&&c(i),O(null),G(!1),a(t("stampEditor.newStampToast"),"info"),j()},me=i=>{if((D==null?void 0:D.id)===i){const N=$.find(P=>P.name==="Default");N&&c(N),O(null)}k(i)},ue={sourceImage:r,isDragging:l,fileInputRef:m,onUploadClick:j,imageLoaderProps:{handleDragOver:h.handleDragOver,handleDragLeave:h.handleDragLeave,handleDrop:h.handleDrop,handleImageUpload:v},settings:p,activePreset:y,presets:$,handleSettingChange:f,handleResetSettings:n,handleSelectPreset:c,stamps:u,renameStampInGallery:d,isProcessing:I,isPanMode:w.isPanMode,lastGeneratedStamp:U,interactiveCanvas:w,isGalleryOpen:x,setIsGalleryOpen:G,isSettingsOpen:te,setIsSettingsOpen:se,isToolbarOpen:ae,setIsToolbarOpen:ne,supportsForce:q,handleClearCanvas:re,handleDownloadImage:ie,handleAddToGallery:le,handleSelectStamp:ce,handleCreateNew:de,handleDeleteStamp:me,selectedGalleryStamp:D};return e.jsx(Z.Provider,{value:ue,children:s})},L=()=>{const s=o.useContext(Z);if(s===void 0)throw new Error("useStampEditorContext must be used within a StampEditorProvider");return s};function Le({isOpen:s,onClose:a}){const{t}=C(),{settings:r,sourceImage:l,isProcessing:m,presets:v,activePreset:j,handleSettingChange:b,onUploadClick:h,handleResetSettings:p,handleSelectPreset:y,handleClearCanvas:f,handleDownloadImage:n,lastGeneratedStamp:c,handleAddToGallery:u}=L();return e.jsx("aside",{className:`fixed top-0 right-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-l-2 border-gray-700 shadow-2xl ${s?"translate-x-0":"translate-x-full"}`,"aria-hidden":!s,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsx("h1",{className:"text-xl font-bold",children:t("rightSidebar.title")}),e.jsx("button",{onClick:a,className:"p-2 rounded-full hover:bg-gray-700","aria-label":t("rightSidebar.close"),children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 no-scrollbar",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 bg-gray-900/50 p-4 rounded-xl border border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:t("rightSidebar.canvasControls")}),e.jsxs("button",{onClick:h,className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),t(l?"rightSidebar.changeImage":"rightSidebar.uploadImage")]}),e.jsxs("button",{onClick:u,disabled:!c||m,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",title:t("rightSidebar.addToGalleryTooltip"),children:[e.jsx(xe,{className:"w-5 h-5"}),t("rightSidebar.addToGallery")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:f,disabled:m,className:"w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"})," ",t("rightSidebar.clear")]}),e.jsxs("button",{onClick:n,disabled:m,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"})," ",t("rightSidebar.download")]})]})]}),e.jsx(De,{presets:v,activePreset:j,onSelectPreset:y}),e.jsxs("button",{onClick:()=>p(),disabled:m,className:"w-full bg-gray-700 hover:bg-gray-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-gray-300 font-medium py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),t("rightSidebar.resetParameters")]}),e.jsx(Ee,{settings:r,handleSettingChange:b})]})})]})})}const Ge=({isOpen:s,onClose:a})=>{const{stamps:t,selectedGalleryStamp:r,handleSelectStamp:l,handleDeleteStamp:m,renameStampInGallery:v,handleCreateNew:j}=L(),[b,h]=o.useState(null),[p,y]=o.useState(null),[f,n]=o.useState(""),c=o.useRef(null),{t:u}=C(),T=(d,x)=>{x.stopPropagation(),h(null),y(d.id),n(d.name)},k=()=>{if(p&&f.trim()){const d=t.find(x=>x.id===p);d&&d.name!==f.trim()&&v(p,f.trim())}y(null)};return o.useEffect(()=>{p&&c.current&&(c.current.focus(),c.current.select())},[p]),o.useEffect(()=>{s&&(h(null),y(null))},[s]),e.jsx("aside",{className:`fixed top-0 left-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-r-2 border-gray-700 shadow-2xl ${s?"translate-x-0":"-translate-x-full"}`,"aria-hidden":!s,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsx("h1",{className:"text-xl font-bold",children:u("stampGallery.title")}),e.jsx("button",{onClick:a,className:"p-2 rounded-full hover:bg-gray-700","aria-label":u("stampGallery.close"),children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-4 no-scrollbar",children:[e.jsxs("button",{onClick:j,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2 mb-4",children:[e.jsx(Q,{className:"w-5 h-5"}),u("stampGallery.createNew")]}),t.length===0?e.jsxs("div",{className:"text-center text-gray-400 mt-8",children:[e.jsx("p",{children:u("stampGallery.empty")}),e.jsx("p",{className:"text-sm mt-1",children:u("stampGallery.emptySubtext")})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.map(d=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>{b!==d.id&&p!==d.id&&l(d)},className:`w-full aspect-square rounded-lg overflow-hidden transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${(r==null?void 0:r.id)===d.id&&!p?"ring-2 ring-blue-500":"ring-1 ring-gray-700 hover:ring-blue-500"}`,children:[e.jsx("img",{src:d.thumbnail,alt:d.name,className:"w-full h-full object-contain bg-gray-900/50 p-1"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 text-white text-xs text-center p-1 truncate",children:p===d.id?e.jsx("input",{ref:c,type:"text",value:f,className:"w-full bg-gray-900 text-white text-center text-xs p-0 border-none outline-none ring-1 ring-blue-500 rounded-sm",onChange:x=>n(x.target.value),onBlur:k,onKeyDown:x=>{x.key==="Enter"&&k(),x.key==="Escape"&&y(null)},onClick:x=>x.stopPropagation()}):d.name})]}),e.jsx("div",{className:"absolute top-1 right-1 z-10",children:b===d.id?e.jsxs("div",{className:"flex items-center gap-1.5 p-1 bg-gray-900/80 rounded-lg backdrop-blur-sm",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),m(d.id),h(null)},className:"text-xs font-bold text-red-400 hover:text-red-300 px-1","aria-label":u("stampGallery.confirmDelete",{name:d.name}),children:u("common.confirm")}),e.jsx("button",{onClick:x=>{x.stopPropagation(),h(null)},className:"text-xs text-gray-300 hover:text-white px-1","aria-label":u("stampGallery.cancelDelete"),children:u("common.cancel")})]}):p!==d.id?e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:x=>T(d,x),className:"bg-blue-600/80 text-white p-1 rounded-full hover:bg-blue-500","aria-label":u("stampGallery.rename",{name:d.name}),children:e.jsx(Q,{className:"w-3 h-3"})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),y(null),h(d.id)},className:"bg-red-600/80 text-white p-1 rounded-full hover:bg-red-500","aria-label":u("common.delete"),children:e.jsx(Y,{className:"w-3 h-3"})})]}):null})]},d.id))})]})]})})},Oe=({isOpen:s,onClose:a})=>{const{t}=C(),{settings:r,handleSettingChange:l,supportsForce:m,sourceImage:v,isProcessing:j}=L(),b=!v||j;return e.jsx("div",{className:`absolute bottom-4 left-1/2 -translate-x-1/2 z-20 w-11/12 max-w-lg transition-all duration-300 ease-in-out ${s?"opacity-100 translate-y-0":"opacity-0 translate-y-full pointer-events-none"}`,"aria-label":t("stampToolbar.title"),"aria-hidden":!s,children:e.jsx("div",{className:`transition-opacity duration-300 ${b?"opacity-50":"opacity-100"}`,children:e.jsxs("div",{className:"relative flex flex-col sm:flex-row items-center justify-center gap-4 rounded-xl bg-gray-900/90 backdrop-blur-sm p-3 shadow-lg ring-1 ring-white/10",children:[e.jsx("button",{onClick:a,"aria-label":t("stampToolbar.hide"),className:"absolute top-1 right-1 z-10 p-1 text-gray-400 rounded-full hover:bg-white/10 hover:text-white transition-colors",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(g,{label:t("stampToolbar.size"),name:"stamp_size",value:r.stamp_size,min:500,max:1500,step:1,unit:"px",onChange:l,tooltip:t("stampToolbar.sizeTooltip"),disabled:b})}),!m&&e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(g,{label:t("stampToolbar.intensity"),name:"splat_density",value:r.splat_density,min:.1,max:2,step:.05,onChange:l,tooltip:t("stampToolbar.intensityTooltip"),disabled:b})}),m&&e.jsx("div",{className:"text-center text-sm text-gray-300 p-2 whitespace-nowrap",children:t("stampToolbar.pressureMessage")})]})})})},Ue=()=>{const{imageLoaderProps:s,fileInputRef:a,interactiveCanvas:t,isGalleryOpen:r,setIsGalleryOpen:l,isSettingsOpen:m,setIsSettingsOpen:v,isToolbarOpen:j,setIsToolbarOpen:b,isProcessing:h,isPanMode:p,sourceImage:y}=L(),{t:f}=C(),n=p?"cursor-grab":y?"cursor-crosshair":"cursor-default";return e.jsxs("div",{className:"relative w-full h-full bg-gray-700",onDragOver:s.handleDragOver,onDragLeave:s.handleDragLeave,onDrop:s.handleDrop,children:[e.jsx("input",{type:"file",ref:a,accept:"image/*",onChange:s.handleImageUpload,className:"hidden","aria-hidden":"true"}),e.jsx(ke,{canvasRef:t.canvasRef,containerRef:t.containerRef,canvasNode:t.canvasNode,containerProps:t.containerProps,viewTransform:t.viewTransform,viewTransformRef:t.viewTransformRef,viewportSize:t.viewportSize,isPanning:t.isPanning,isPanMode:p,stampPreview:t.stampPreview,cursorClass:n,ariaLabel:f("stampEditor.stampingArea")}),e.jsx(Ge,{isOpen:r,onClose:()=>l(!1)}),e.jsx(Oe,{isOpen:j,onClose:()=>b(!1)}),e.jsx(Le,{isOpen:m,onClose:()=>v(!1)}),h&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-lg z-50 pointer-events-none","aria-live":"polite",children:[e.jsx(ve,{className:"w-6 h-6 mr-3 animate-pulse"}),f("stampEditor.generatingToast")]}),e.jsxs(e.Fragment,{children:[!r&&e.jsx("button",{onClick:()=>l(!0),className:"fixed top-1/2 -translate-y-1/2 left-0 z-30 py-4 px-1 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-r-lg shadow-lg transition-colors","aria-label":f("stampEditor.galleryToggle"),title:f("stampEditor.galleryToggle"),children:e.jsx(je,{className:"w-5 h-5"})}),!m&&e.jsx("button",{onClick:()=>v(!0),className:"fixed top-1/2 -translate-y-1/2 right-0 z-30 py-4 px-1 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-l-lg shadow-lg transition-colors","aria-label":f("stampEditor.settingsToggle"),title:f("stampEditor.settingsToggle"),children:e.jsx(ye,{className:"w-5 h-5"})}),!j&&e.jsx("button",{onClick:()=>b(!0),className:"fixed bottom-0 left-1/2 -translate-x-1/2 z-30 p-1 px-4 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-t-lg shadow-lg transition-colors","aria-label":f("stampEditor.toolbarToggle"),title:f("stampEditor.toolbarToggle"),children:e.jsx(we,{className:"w-5 h-5"})}),p&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-30 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Se,{className:"w-4 h-4"})," ",f("stampEditor.panMode")]})]})]})};function Ve(){return e.jsx(Re,{children:e.jsx(Ue,{})})}export{Ve as default};
