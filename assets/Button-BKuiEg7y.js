import{r,j as f,b as rt}from"./react-vendor-XTfPaM14.js";import{l as st}from"./vendor-DoV0xLrY.js";import{c as ot}from"./index-M2HUoeYB.js";const E=4e3,S=3e3,it=.1,B=2,K=5,F=200;function xt({onPlaceRequest:u,isPlacementDisabled:d=!1,isPanOnly:h=!1}){const[s,l]=r.useState({x:0,y:0,scale:1}),[a,M]=r.useState({width:0,height:0}),[g,x]=r.useState("idle"),[y,w]=r.useState(!1),[i,C]=r.useState(null),[Y,T]=r.useState(null),[p,H]=r.useState(null),k=r.useRef(s),m=r.useRef({clientX:0,clientY:0,viewX:0,viewY:0}),L=r.useRef({dist:0,midX:0,midY:0,initialTransform:{x:0,y:0,scale:1}}),z=r.useRef(0),N=r.useRef(!1),G=r.useRef(!1);r.useEffect(()=>{k.current=s},[s]);const X=r.useCallback(t=>{const{width:e,height:n}=a,c=Math.max(it,Math.min(B,t.scale)),o=e>E*c?(e-E*c)/2:Math.max(e-E*c-F,Math.min(F,t.x)),v=n>S*c?(n-S*c)/2:Math.max(n-S*c-F,Math.min(F,t.y));return{x:o,y:v,scale:c}},[a]),R=r.useCallback((t,e)=>{const{x:n,y:c,scale:o}=k.current;return{x:(t-n)/o,y:(e-c)/o}},[]);r.useEffect(()=>{if(p&&(p.width=E,p.height=S,!N.current&&a.width>0&&a.height>0)){const t=Math.min(a.width/E,a.height/S,.8),e=X({scale:t,x:(a.width-E*t)/2,y:(a.height-S*t)/2});l(e),N.current=!0}},[a,p,X]),r.useEffect(()=>{N.current&&a.width>0&&a.height>0&&l(t=>X(t))},[a,X]),r.useEffect(()=>{if(!Y)return;const t=new ResizeObserver(e=>{for(const n of e){const{width:c,height:o}=n.contentRect;M({width:c,height:o})}});return t.observe(Y),()=>t.disconnect()},[Y]);const O=r.useCallback(t=>{t.preventDefault(),t.stopPropagation();const{deltaY:e}=t,{x:n,y:c,scale:o}=k.current,v=1.05;let b=e>0?o/v:o*v;if(o>=B&&b>B&&(b=B,o===B))return;const A=t.clientX,I=t.clientY,V=t.currentTarget.getBoundingClientRect(),$=A-V.left,_=I-V.top,D=$-($-n)*(b/o),U=_-(_-c)*(b/o);l(X({x:D,y:U,scale:b}))},[X]);r.useEffect(()=>{if(Y)return Y.addEventListener("wheel",O,{passive:!1}),()=>Y.removeEventListener("wheel",O)},[Y,O]),r.useEffect(()=>{const t=n=>{var c,o;n.code==="Space"&&!n.repeat&&((c=document.activeElement)==null?void 0:c.tagName)!=="INPUT"&&((o=document.activeElement)==null?void 0:o.tagName)!=="TEXTAREA"&&(n.preventDefault(),w(!0))},e=n=>{n.code==="Space"&&(n.preventDefault(),w(!1),g==="panning"&&x("idle"))};return document.addEventListener("keydown",t),document.addEventListener("keyup",e),()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",e)}},[g]);const Z=r.useCallback(t=>{if(G.current){G.current=!1;return}if(t.button!==0&&t.button!==1)return;if(y||h||t.button===1||d)x("panning"),m.current={clientX:t.clientX,clientY:t.clientY,viewX:s.x,viewY:s.y};else{x("stamping");const n=t.currentTarget.getBoundingClientRect(),c=R(t.clientX-n.left,t.clientY-n.top);C({start:c,current:c}),m.current={clientX:t.clientX,clientY:t.clientY,viewX:0,viewY:0}}},[y,h,d,s,R]),q=r.useCallback((t,e,n,c)=>{const o=Math.hypot(t-n,e-c);let v=0;if(o>=K){const b=t-n,A=e-c;v=Math.atan2(A,b)*180/Math.PI}return{dist:o,angle:v}},[]),J=r.useCallback(t=>{if(g==="panning"){const e=t.clientX-m.current.clientX,n=t.clientY-m.current.clientY,c={x:m.current.viewX,y:m.current.viewY,scale:s.scale},o=X({...c,x:c.x+e,y:c.y+n});l(o)}else if(g==="stamping"&&i){const e=t.currentTarget.getBoundingClientRect(),n=R(t.clientX-e.left,t.clientY-e.top);C({...i,current:n})}},[g,s.scale,X,i,R,p]),W=r.useCallback(()=>{if(g==="stamping"&&i){const{angle:t}=q(i.current.x,i.current.y,i.start.x,i.start.y);u(i.start.x,i.start.y,t)}x("idle"),C(null)},[g,i,u]),Q=r.useCallback(t=>{if(t.preventDefault(),t.touches.length>=2){x("pinching");const e=t.touches[0],n=t.touches[1],c=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY);L.current={dist:c,midX:(e.clientX+n.clientX)/2,midY:(e.clientY+n.clientY)/2,initialTransform:{...s}};return}if(t.touches.length===1){const e=t.touches[0];if(y||h||d){x("panning"),m.current={clientX:e.clientX,clientY:e.clientY,viewX:s.x,viewY:s.y};return}x("stamping");const c=t.currentTarget.getBoundingClientRect(),o=R(e.clientX-c.left,e.clientY-c.top);C({start:o,current:o}),m.current={clientX:e.clientX,clientY:e.clientY,viewX:0,viewY:0},"force"in e&&(z.current=e.force)}},[y,h,d,s,R]),P=r.useCallback(t=>{if(g==="pinching"&&t.touches.length>=2&&p){const e=t.touches[0],n=t.touches[1],c=(e.clientX+n.clientX)/2,o=(e.clientY+n.clientY)/2,v=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY),{initialTransform:b,dist:A}=L.current,I=t.currentTarget.getBoundingClientRect(),V=(L.current.midX-I.left-b.x)/b.scale,$=(L.current.midY-I.top-b.y)/b.scale,_=v/A,D=b.scale*_,U=c-I.left-V*D,nt=o-I.top-$*D,ct=X({x:U,y:nt,scale:D});l(ct)}else if(g==="stamping"&&t.touches.length===1&&i){const e=t.touches[0],n=t.currentTarget.getBoundingClientRect(),c=R(e.clientX-n.left,e.clientY-n.top);C({...i,current:c}),"force"in e&&(z.current=e.force)}else if(g==="panning"&&t.touches.length===1){const e=t.touches[0],n=e.clientX-m.current.clientX,c=e.clientY-m.current.clientY,o={x:m.current.viewX,y:m.current.viewY,scale:s.scale},v=X({...o,x:o.x+n,y:o.y+c});l(v)}},[g,s.scale,X,i,R,p]),tt=r.useCallback(t=>{if(g==="stamping"&&t.changedTouches.length===1&&i){const e=t.changedTouches[0],n=Math.hypot(e.clientX-m.current.clientX,e.clientY-m.current.clientY);let c=0;if(n>=K){const o=i.current.x-i.start.x,v=i.current.y-i.start.y;c=Math.atan2(v,o)*180/Math.PI}u(i.start.x,i.start.y,c),z.current=0}t.touches.length<2&&(x("idle"),C(null),setTimeout(()=>{G.current=!1},500))},[g,i,u]),et=r.useCallback(()=>{l(t=>({...t}))},[]);return r.useEffect(()=>{p&&(p.style.transform=`translate(${s.x}px, ${s.y}px) scale(${s.scale})`)},[s,p]),r.useEffect(()=>()=>{N.current=!1},[]),{viewTransform:s,viewTransformRef:k,viewportSize:a,isPanning:g==="panning"||g==="pinching",isPanMode:y||h,stampPreview:i,containerProps:{onMouseDown:Z,onMouseMove:J,onMouseUp:W,onMouseLeave:W,onTouchStart:Q,onTouchMove:P,onTouchEnd:tt},forceCanvasUpdate:et,containerRef:T,canvasRef:H,canvasNode:p,isInitialized:N.current}}const j=160,at=({mainCanvas:u,viewTransformRef:d,viewportSize:h,canvasWidth:s,canvasHeight:l})=>{const a=r.useRef(null),M=r.useRef(null),g=s/l,x=j/g;return r.useEffect(()=>{if(!u||!a.current)return;const y=a.current.getContext("2d",{alpha:!1});if(!y)return;const w=()=>{if(!h.width||!h.height){M.current=requestAnimationFrame(w);return}y.fillStyle="#f7f3e9",y.fillRect(0,0,j,x),y.drawImage(u,0,0,j,x);const i=d.current;if(!i){M.current=requestAnimationFrame(w);return}const{x:C,y:Y,scale:T}=i,p=-C/T*(j/s),H=-Y/T*(x/l),k=h.width/T*(j/s),m=h.height/T*(x/l);y.strokeStyle="rgba(0, 150, 255, 1)",y.lineWidth=1.5,y.strokeRect(p,H,k,m),M.current=requestAnimationFrame(w)};return M.current=requestAnimationFrame(w),()=>{M.current&&cancelAnimationFrame(M.current)}},[u,d,h,s,l,x]),f.jsx("div",{className:"absolute bottom-4 right-4 z-20 bg-gray-900/70 backdrop-blur-sm p-1 rounded-lg shadow-lg border border-gray-700 pointer-events-none","aria-hidden":"true",children:f.jsx("canvas",{ref:a,width:j,height:x,className:"rounded-md"})})},lt=({stampPreview:u,viewTransform:d})=>{if(!(u!=null&&u.start)||!u.current)return null;const h=u.start.x*d.scale+d.x,s=u.start.y*d.scale+d.y,l=u.current.x*d.scale+d.x,a=u.current.y*d.scale+d.y;return Math.hypot(l-h,a-s)<5?null:f.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-50","aria-hidden":"true",children:[f.jsx("defs",{children:f.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[f.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),f.jsxs("feMerge",{children:[f.jsx("feMergeNode",{in:"coloredBlur"}),f.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),f.jsxs("g",{style:{filter:"url(#glow)"},children:[f.jsx("circle",{cx:h,cy:s,r:"8",stroke:"rgba(0, 0, 0, 0.5)",strokeWidth:"2",fill:"rgba(255, 255, 255, 0.8)"}),f.jsx("line",{x1:h,y1:s,x2:l,y2:a,stroke:"rgba(255, 255, 255, 0.8)",strokeWidth:"2",strokeDasharray:"4,4"}),f.jsx("circle",{cx:l,cy:a,r:"4",fill:"rgba(255, 255, 255, 0.8)"})]})]})},mt=({canvasRef:u,containerRef:d,canvasNode:h,containerProps:s,viewTransform:l,viewTransformRef:a,viewportSize:M,isPanning:g,stampPreview:x,cursorClass:y,ariaLabel:w,className:i})=>f.jsxs(f.Fragment,{children:[f.jsxs("div",{ref:d,className:`relative w-full h-full bg-paper-texture overflow-hidden touch-none ${y} ${g?"cursor-grabbing":""} ${i}`,...s,children:[f.jsx("canvas",{ref:u,className:"bg-white shadow-xl","aria-label":w,style:{position:"absolute",top:0,left:0,height:S,width:E,transform:`translate(${l.x}px, ${l.y}px) scale(${l.scale})`,transformOrigin:"0 0",willChange:"transform"}}),f.jsx(at,{mainCanvas:h,viewTransformRef:a,viewportSize:M,canvasWidth:E,canvasHeight:S})]}),f.jsx(lt,{stampPreview:x,viewTransform:l})]}),ut=st("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-gray-900 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-gray-50 text-gray-900 hover:bg-gray-50/90",destructive:"bg-red-500 text-gray-50 hover:bg-red-500/90",outline:"border border-gray-800 bg-gray-950 hover:bg-gray-800 hover:text-gray-50",secondary:"bg-gray-700 text-gray-50 hover:bg-gray-600/80",ghost:"hover:bg-gray-800 hover:text-gray-50",link:"text-gray-50 underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),dt=r.forwardRef(({className:u,variant:d,size:h,asChild:s=!1,...l},a)=>{const M=s?rt:"button";return f.jsx(M,{className:ot(ut({variant:d,size:h,className:u})),ref:a,...l})});dt.displayName="Button";export{dt as B,mt as I,xt as u};
