import{r as i,j as e,X as Y,J as xe,K as he,t as Z,N as fe,z as be,O as X,Q as ve,y as je,V as ye,W as we,Y as Se,B as Ne}from"./react-vendor-B6On5FFh.js";import{u as _e,I as ke}from"./InteractiveCanvasView-CrxQ-Z_z.js";import{T as Ce,S as g}from"./SliderControl-CydUJGbD.js";import{u as k,a as V}from"./index-CASFG7ec.js";import{d as B,u as Te,c as Pe,g as De}from"./useGallery-B_aWOwEn.js";import"./vendor-Gjd468CK.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-D-xZ5m-d.js";function D({title:a,icon:s,children:t,defaultOpen:o=!1}){const[l,m]=i.useState(o);return e.jsxs("div",{className:"bg-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>m(!l),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-600 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:s}),e.jsx("span",{className:"font-medium text-white",children:a})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${l?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&e.jsx("div",{className:"flex flex-col px-4 pb-4 border-t border-gray-600",children:t})]})}function Ee({settings:a,handleSettingChange:s}){const{t}=k();return e.jsxs(e.Fragment,{children:[e.jsxs(D,{title:t("settingsSections.posterization.title"),icon:"🎨",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center pt-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"num_colors",className:`text-sm font-medium ${a.num_colors==="auto"?"text-gray-500":"text-gray-300"}`,children:t("settingsSections.posterization.colors")}),e.jsx(Ce,{text:t("settingsSections.posterization.colorsTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"auto_color_toggle",className:"text-sm font-medium text-gray-300 cursor-pointer",children:t("settingsSections.posterization.auto")}),e.jsx("input",{id:"auto_color_toggle",type:"checkbox",className:"form-checkbox h-5 w-5 rounded bg-gray-600 border-gray-500 text-blue-600 focus:ring-blue-500 cursor-pointer",checked:a.num_colors==="auto",onChange:o=>{const l={target:{name:"num_colors",value:o.target.checked?"auto":"5",type:"text"}};s(l)}})]})]}),e.jsx(g,{name:"num_colors",value:typeof a.num_colors=="number"?a.num_colors:5,min:1,max:15,step:1,disabled:a.num_colors==="auto",onChange:s})]}),e.jsx(g,{label:t("settingsSections.posterization.backgroundThreshold"),name:"background_threshold",value:a.background_threshold,min:0,max:254,step:1,onChange:s,tooltip:t("settingsSections.posterization.backgroundThresholdTooltip")}),e.jsx(g,{label:t("settingsSections.posterization.shapeShrink"),name:"color_shape_shrink",value:a.color_shape_shrink,min:0,max:10,step:1,unit:"px",onChange:s,tooltip:t("settingsSections.posterization.shapeShrinkTooltip")})]}),e.jsxs(D,{title:t("settingsSections.registration.title"),icon:"📐",children:[e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.registration.shift")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"shift.0",value:a.shift[0],min:0,max:10,step:.1,unit:"px",onChange:s,tooltip:t("settingsSections.registration.shiftAmountTooltip")}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"shift.1",value:a.shift[1],min:0,max:5,step:.1,onChange:s,tooltip:t("settingsSections.registration.variationTooltip")})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.registration.rotation")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"rotation.0",value:a.rotation[0],min:-5,max:5,step:.1,unit:"°",onChange:s,tooltip:t("settingsSections.registration.rotationAmountTooltip")}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"rotation.1",value:a.rotation[1],min:0,max:3,step:.1,onChange:s,tooltip:t("settingsSections.registration.variationTooltip")})]})]}),e.jsxs(D,{title:t("settingsSections.edge.title"),icon:"✨",children:[e.jsx(g,{label:t("settingsSections.edge.width"),name:"edge_width",value:a.edge_width,min:0,max:20,step:1,unit:"px",onChange:s,tooltip:t("settingsSections.edge.widthTooltip")}),e.jsx(g,{label:t("settingsSections.edge.boost"),name:"edge_boost",value:a.edge_boost,min:0,max:10,step:.1,onChange:s,tooltip:t("settingsSections.edge.boostTooltip")})]}),e.jsxs(D,{title:t("settingsSections.wear.title"),icon:"🔧",children:[e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.intensity")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"wear_intensity.0",value:a.wear_intensity[0],min:0,max:1,step:.05,onChange:s}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"wear_intensity.1",value:a.wear_intensity[1],min:0,max:1,step:.05,onChange:s})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.noiseScale")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"noise_scale.0",value:a.noise_scale[0],min:1,max:200,step:1,onChange:s}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"noise_scale.1",value:a.noise_scale[1],min:1,max:10,step:.1,onChange:s})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.inkDepletion")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"ink_depletion_intensity.0",value:a.ink_depletion_intensity[0],min:0,max:1,step:.05,onChange:s,tooltip:t("settingsSections.wear.inkDepletionAmountTooltip")}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"ink_depletion_intensity.1",value:a.ink_depletion_intensity[1],min:0,max:.2,step:.01,onChange:s})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.numPatches")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.registration.amount"),name:"num_patches.0",value:a.num_patches[0],min:0,max:15,step:1,onChange:s,tooltip:t("settingsSections.wear.numPatchesAmountTooltip")}),e.jsx(g,{label:t("settingsSections.registration.variation"),name:"num_patches.1",value:a.num_patches[1],min:0,max:5,step:1,onChange:s})]}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.wear.patchSize")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.wear.min"),name:"patch_size_range.0",value:a.patch_size_range[0],min:1,max:200,step:1,unit:"px",onChange:s}),e.jsx(g,{label:t("settingsSections.wear.max"),name:"patch_size_range.1",value:a.patch_size_range[1],min:1,max:500,step:1,unit:"px",onChange:s})]})]}),e.jsxs(D,{title:t("settingsSections.splats.title"),icon:"💧",defaultOpen:!0,children:[e.jsx(g,{label:t("settingsSections.splats.density"),name:"splat_density",value:a.splat_density,min:.005,max:2,step:.005,onChange:s,tooltip:t("settingsSections.splats.densityTooltip")}),e.jsx("span",{className:"text-sm pt-2",children:t("settingsSections.splats.size")}),e.jsxs("div",{className:"flex gap-x-4 justify-between",children:[e.jsx(g,{label:t("settingsSections.wear.min"),name:"splat_size_range.0",value:a.splat_size_range[0],min:1,max:5,step:.1,onChange:s}),e.jsx(g,{label:t("settingsSections.wear.max"),name:"splat_size_range.1",value:a.splat_size_range[1],min:.1,max:10,step:.1,onChange:s})]}),e.jsx(g,{label:t("settingsSections.splats.bleeding"),name:"bleeding_factor",value:a.bleeding_factor,min:0,max:1,step:.05,onChange:s,tooltip:t("settingsSections.splats.bleedingTooltip")})]})]})}const Ie=({presets:a,activePreset:s,onSelectPreset:t})=>{const{t:o}=k();return e.jsxs("div",{className:"bg-gray-800 rounded-xl p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:o("presetSelector.label")}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.map(l=>e.jsx("button",{onClick:()=>t(l),className:`w-full text-center text-sm font-medium py-2 px-3 rounded-lg transition-colors duration-200 ${s===l.name?"bg-blue-600 text-white shadow-md":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:l.name},l.name))})]})};function ze(){const[a,s]=i.useState(null),[t,o]=i.useState(!1),l=i.useRef(null),{addToast:m}=V(),{t:v}=k(),j=i.useCallback((n,c)=>{const u=new Image;u.onload=()=>{s(u),c&&m(c,"success")},u.onerror=()=>{m(v("imageLoader.loadUrlErrorToast"),"error")},u.src=n},[m,v]),f=i.useCallback(n=>{if(!n)return;if(!n.type.startsWith("image/")){m(v("imageLoader.invalidFileToast"),"error");return}const c=URL.createObjectURL(n);j(c,v("imageLoader.loadedToast"))},[m,j,v]),x=i.useCallback(n=>{var c;f(((c=n.target.files)==null?void 0:c[0])||null),n.target&&(n.target.value="")},[f]);return{sourceImage:a,isDragging:t,fileInputRef:l,handleDragOver:n=>{n.preventDefault(),n.stopPropagation(),o(!0)},handleDragLeave:n=>{n.preventDefault(),n.stopPropagation(),o(!1)},handleDrop:n=>{var c;n.preventDefault(),n.stopPropagation(),o(!1),f(((c=n.dataTransfer.files)==null?void 0:c[0])||null)},handleImageUpload:x,onUploadClick:()=>{var n;return(n=l.current)==null?void 0:n.click()},setSourceImageFromUrl:j}}function Re(){const[a,s]=i.useState(B),[t,o]=i.useState("Default"),{addToast:l}=V(),{t:m}=k(),v=i.useCallback(x=>{const{name:h,value:b,type:N}=x.target;let n;if(b==="auto")n="auto";else{const c=parseFloat(b);N==="range"||b.trim()!==""&&!isNaN(c)?n=c:n=b}s(c=>{const u=h.split(".");if(u.length>1){const T={...c};let _=T;for(let d=0;d<u.length-1;d++){const p=u[d];_[p]=[..._[p]],_=_[p]}return _[u[u.length-1]]=n,T}else return{...c,[h]:n}}),o("Custom")},[]),j=i.useCallback(()=>{s(B),o("Default"),l(m("stampSettings.resetToast"),"info")},[l,m]),f=i.useCallback(x=>{s({...B,...x.settings}),o(x.name),l(m("stampSettings.loadedPresetToast",{name:x.name}),"info")},[l,m]);return{settings:a,activePreset:t,handleSettingChange:v,handleResetSettings:j,handleSelectPreset:f}}const q=[{name:"Default",settings:{}},{name:"Gritty",settings:{edge_boost:5,wear_intensity:[.4,.2],noise_scale:[30,10],ink_depletion_intensity:[.5,.1],splat_density:.9}},{name:"Faded",settings:{edge_boost:1,wear_intensity:[.7,.1],noise_scale:[100,5],ink_depletion_intensity:[.8,.05],splat_density:.5,bleeding_factor:.2}},{name:"Clean",settings:{color_shape_shrink:1,shift:[.5,.2],rotation:[.2,.1],edge_width:2,edge_boost:1,wear_intensity:[.05,.01],ink_depletion_intensity:[.1,.01],splat_density:1.2,bleeding_factor:.05}}],ee=i.createContext(void 0),Ge=({children:a})=>{const{addToast:s}=V(),{t}=k(),{sourceImage:o,isDragging:l,fileInputRef:m,handleImageUpload:v,onUploadClick:j,setSourceImageFromUrl:f,...x}=ze(),{settings:h,activePreset:b,handleSettingChange:N,handleResetSettings:n,handleSelectPreset:c}=Re(),{stamps:u,addStampToGallery:T,deleteStampFromGallery:_,renameStampInGallery:d}=Te(),[p,L]=i.useState(!1),[E,O]=i.useState(null),[U,W]=i.useState(null),[F,te]=i.useState(!1),[se,ae]=i.useState(!1),[ne,oe]=i.useState(!0),[I,K]=i.useState(!1),z=i.useRef(null);i.useEffect(()=>{const r=new Audio("/stamp-sound.mp3");r.load(),z.current=r},[]),i.useEffect(()=>{const r=S=>{S.touches[0]&&"force"in S.touches[0]&&S.touches[0].force>0&&(te(!0),s(t("stampEditor.pressureToast"),"info")),window.removeEventListener("touchstart",r)};return window.addEventListener("touchstart",r,{once:!0}),()=>window.removeEventListener("touchstart",r)},[s,t]);const R=i.useRef(null),ie=i.useCallback((r,S,P,A)=>{var C;(C=R.current)==null||C.call(R,r,S,P,A)},[]),y=_e({onPlaceRequest:ie,isPlacementDisabled:!o||I}),H=i.useCallback(async(r,S,P,A)=>{if(!(!o||I)){K(!0);try{const C=Pe(o,h.stamp_size),J=C.getContext("2d",{willReadFrequently:!0});if(!J)throw new Error("Could not get context from resized canvas");const pe=J.getImageData(0,0,C.width,C.height),$={...h};F&&P>0&&($.splat_density=.2+Math.min(P,1)*1.3);const Q=await De(pe,$),M=await createImageBitmap(Q);if(y.canvasNode){const w=y.canvasNode.getContext("2d");w==null||w.save(),w==null||w.translate(r,S),w==null||w.rotate(A*Math.PI/180),w==null||w.drawImage(M,-M.width/2,-M.height/2),w==null||w.restore()}z.current&&(z.current.currentTime=0,z.current.play().catch(console.warn)),W({imageData:Q,settings:$}),y.forceCanvasUpdate()}catch(C){console.error("Error generating stamp:",C),s(t("stampEditor.stampingErrorToast"),"error")}finally{K(!1)}}},[o,I,h,F,s,t,y.canvasNode,y.forceCanvasUpdate]);i.useEffect(()=>{R.current=H},[H]);const re=i.useCallback(()=>{if(y.canvasNode){const r=y.canvasNode.getContext("2d");r==null||r.clearRect(0,0,y.canvasNode.width,y.canvasNode.height),y.forceCanvasUpdate(),s(t("stampEditor.canvasClearedToast"),"info")}},[s,y.canvasNode,y.forceCanvasUpdate,t]),le=i.useCallback(()=>{if(!y.canvasNode){s(t("stampEditor.downloadErrorToast"),"info");return}const r=document.createElement("a");r.download="stamped-creation.png",r.href=y.canvasNode.toDataURL("image/png"),r.click()},[s,y.canvasNode,t]),ce=()=>{if(!U||!o)return;const r=`Stamp #${u.length+1}`;T(o,U.settings,r),W(null)},de=r=>{const S={name:r.name,settings:r.settings};c(S),f(r.sourceImageURL,t("stampEditor.loadedStampToast",{name:r.name})),O(r),L(!1)},me=()=>{const r=q.find(S=>S.name==="Default");r&&c(r),O(null),L(!1),s(t("stampEditor.newStampToast"),"info"),j()},ue=r=>{if((E==null?void 0:E.id)===r){const S=q.find(P=>P.name==="Default");S&&c(S),O(null)}_(r)},ge={sourceImage:o,isDragging:l,fileInputRef:m,onUploadClick:j,imageLoaderProps:{handleDragOver:x.handleDragOver,handleDragLeave:x.handleDragLeave,handleDrop:x.handleDrop,handleImageUpload:v},settings:h,activePreset:b,presets:q,handleSettingChange:N,handleResetSettings:n,handleSelectPreset:c,stamps:u,renameStampInGallery:d,isProcessing:I,isPanMode:y.isPanMode,lastGeneratedStamp:U,interactiveCanvas:y,isGalleryOpen:p,setIsGalleryOpen:L,isSettingsOpen:se,setIsSettingsOpen:ae,isToolbarOpen:ne,setIsToolbarOpen:oe,supportsForce:F,handleClearCanvas:re,handleDownloadImage:le,handleAddToGallery:ce,handleSelectStamp:de,handleCreateNew:me,handleDeleteStamp:ue,selectedGalleryStamp:E};return e.jsx(ee.Provider,{value:ge,children:a})},G=()=>{const a=i.useContext(ee);if(a===void 0)throw new Error("useStampEditorContext must be used within a StampEditorProvider");return a};function Le({isOpen:a,onClose:s}){const{t}=k(),{settings:o,sourceImage:l,isProcessing:m,presets:v,activePreset:j,handleSettingChange:f,onUploadClick:x,handleResetSettings:h,handleSelectPreset:b,handleClearCanvas:N,handleDownloadImage:n,lastGeneratedStamp:c,handleAddToGallery:u}=G();return e.jsx("aside",{className:`fixed top-0 right-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-l-2 border-gray-700 shadow-2xl ${a?"translate-x-0":"translate-x-full"}`,"aria-hidden":!a,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsx("h1",{className:"text-xl font-bold",children:t("rightSidebar.title")}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-700","aria-label":t("rightSidebar.close"),children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 no-scrollbar",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 bg-gray-900/50 p-4 rounded-xl border border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:t("rightSidebar.canvasControls")}),e.jsxs("button",{onClick:x,className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),t(l?"rightSidebar.changeImage":"rightSidebar.uploadImage")]}),e.jsxs("button",{onClick:u,disabled:!c||m,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",title:t("rightSidebar.addToGalleryTooltip"),children:[e.jsx(he,{className:"w-5 h-5"}),t("rightSidebar.addToGallery")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:N,disabled:m,className:"w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"})," ",t("rightSidebar.clear")]}),e.jsxs("button",{onClick:n,disabled:m,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"})," ",t("rightSidebar.download")]})]})]}),e.jsx(Ie,{presets:v,activePreset:j,onSelectPreset:b}),e.jsxs("button",{onClick:()=>h(),disabled:m,className:"w-full bg-gray-700 hover:bg-gray-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-gray-300 font-medium py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),t("rightSidebar.resetParameters")]}),e.jsx(Ee,{settings:o,handleSettingChange:f})]})})]})})}const Oe=({isOpen:a,onClose:s})=>{const{stamps:t,selectedGalleryStamp:o,handleSelectStamp:l,handleDeleteStamp:m,renameStampInGallery:v,handleCreateNew:j}=G(),[f,x]=i.useState(null),[h,b]=i.useState(null),[N,n]=i.useState(""),c=i.useRef(null),{t:u}=k(),T=(d,p)=>{p.stopPropagation(),x(null),b(d.id),n(d.name)},_=()=>{if(h&&N.trim()){const d=t.find(p=>p.id===h);d&&d.name!==N.trim()&&v(h,N.trim())}b(null)};return i.useEffect(()=>{h&&c.current&&(c.current.focus(),c.current.select())},[h]),i.useEffect(()=>{a&&(x(null),b(null))},[a]),e.jsx("aside",{className:`fixed top-0 left-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-r-2 border-gray-700 shadow-2xl ${a?"translate-x-0":"-translate-x-full"}`,"aria-hidden":!a,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsx("h1",{className:"text-xl font-bold",children:u("stampGallery.title")}),e.jsx("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-700","aria-label":u("stampGallery.close"),children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-4 no-scrollbar",children:[e.jsxs("button",{onClick:j,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2 mb-4",children:[e.jsx(X,{className:"w-5 h-5"}),u("stampGallery.createNew")]}),t.length===0?e.jsxs("div",{className:"text-center text-gray-400 mt-8",children:[e.jsx("p",{children:u("stampGallery.empty")}),e.jsx("p",{className:"text-sm mt-1",children:u("stampGallery.emptySubtext")})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.map(d=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>{f!==d.id&&h!==d.id&&l(d)},className:`w-full aspect-square rounded-lg overflow-hidden transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${(o==null?void 0:o.id)===d.id&&!h?"ring-2 ring-blue-500":"ring-1 ring-gray-700 hover:ring-blue-500"}`,children:[e.jsx("img",{src:d.thumbnail,alt:d.name,className:"w-full h-full object-contain bg-gray-900/50 p-1"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 text-white text-xs text-center p-1 truncate",children:h===d.id?e.jsx("input",{ref:c,type:"text",value:N,className:"w-full bg-gray-900 text-white text-center text-xs p-0 border-none outline-none ring-1 ring-blue-500 rounded-sm",onChange:p=>n(p.target.value),onBlur:_,onKeyDown:p=>{p.key==="Enter"&&_(),p.key==="Escape"&&b(null)},onClick:p=>p.stopPropagation()}):d.name})]}),e.jsx("div",{className:"absolute top-1 right-1 z-10",children:f===d.id?e.jsxs("div",{className:"flex items-center gap-1.5 p-1 bg-gray-900/80 rounded-lg backdrop-blur-sm",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),m(d.id),x(null)},className:"text-xs font-bold text-red-400 hover:text-red-300 px-1","aria-label":u("stampGallery.confirmDelete",{name:d.name}),children:u("common.confirm")}),e.jsx("button",{onClick:p=>{p.stopPropagation(),x(null)},className:"text-xs text-gray-300 hover:text-white px-1","aria-label":u("stampGallery.cancelDelete"),children:u("common.cancel")})]}):h!==d.id?e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:p=>T(d,p),className:"bg-blue-600/80 text-white p-1 rounded-full hover:bg-blue-500","aria-label":u("stampGallery.rename",{name:d.name}),children:e.jsx(X,{className:"w-3 h-3"})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),b(null),x(d.id)},className:"bg-red-600/80 text-white p-1 rounded-full hover:bg-red-500","aria-label":u("common.delete"),children:e.jsx(Z,{className:"w-3 h-3"})})]}):null})]},d.id))})]})]})})},Ue=({isOpen:a,onClose:s})=>{const{t}=k(),{settings:o,handleSettingChange:l,supportsForce:m,sourceImage:v,isProcessing:j}=G(),f=!v||j;return e.jsx("div",{className:`absolute bottom-4 left-1/2 -translate-x-1/2 z-20 w-11/12 max-w-lg transition-all duration-300 ease-in-out ${a?"opacity-100 translate-y-0":"opacity-0 translate-y-full pointer-events-none"}`,"aria-label":t("stampToolbar.title"),"aria-hidden":!a,children:e.jsx("div",{className:`transition-opacity duration-300 ${f?"opacity-50":"opacity-100"}`,children:e.jsxs("div",{className:"relative flex flex-col sm:flex-row items-center justify-center gap-4 rounded-xl bg-gray-900/90 backdrop-blur-sm p-3 shadow-lg ring-1 ring-white/10",children:[e.jsx("button",{onClick:s,"aria-label":t("stampToolbar.hide"),className:"absolute top-1 right-1 z-10 p-1 text-gray-400 rounded-full hover:bg-white/10 hover:text-white transition-colors",children:e.jsx(ve,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(g,{label:t("stampToolbar.size"),name:"stamp_size",value:o.stamp_size,min:500,max:1500,step:1,unit:"px",onChange:l,tooltip:t("stampToolbar.sizeTooltip"),disabled:f})}),!m&&e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(g,{label:t("stampToolbar.intensity"),name:"splat_density",value:o.splat_density,min:.1,max:2,step:.05,onChange:l,tooltip:t("stampToolbar.intensityTooltip"),disabled:f})}),m&&e.jsx("div",{className:"text-center text-sm text-gray-300 p-2 whitespace-nowrap",children:t("stampToolbar.pressureMessage")})]})})})},Fe=()=>{const{isDragging:a,imageLoaderProps:s,fileInputRef:t,interactiveCanvas:o,isGalleryOpen:l,setIsGalleryOpen:m,isSettingsOpen:v,setIsSettingsOpen:j,isToolbarOpen:f,setIsToolbarOpen:x,isProcessing:h,isPanMode:b,sourceImage:N}=G(),{t:n}=k(),c=b?"cursor-grab":N?"cursor-crosshair":"cursor-default";return e.jsxs("div",{className:"relative w-full h-full bg-gray-700",onDragOver:s.handleDragOver,onDragLeave:s.handleDragLeave,onDrop:s.handleDrop,children:[e.jsx("input",{type:"file",ref:t,accept:"image/*",onChange:s.handleImageUpload,className:"hidden","aria-hidden":"true"}),e.jsx(ke,{canvasRef:o.canvasRef,containerRef:o.containerRef,canvasNode:o.canvasNode,containerProps:o.containerProps,viewTransform:o.viewTransform,viewTransformRef:o.viewTransformRef,viewportSize:o.viewportSize,isPanning:o.isPanning,isPanMode:b,stampPreview:o.stampPreview,cursorClass:c,ariaLabel:n("stampEditor.stampingArea")}),e.jsx(Oe,{isOpen:l,onClose:()=>m(!1)}),e.jsx(Ue,{isOpen:f,onClose:()=>x(!1)}),e.jsx(Le,{isOpen:v,onClose:()=>j(!1)}),h&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-lg z-50 pointer-events-none","aria-live":"polite",children:[e.jsx(je,{className:"w-6 h-6 mr-3 animate-pulse"}),n("stampEditor.generatingToast")]}),e.jsxs(e.Fragment,{children:[!l&&e.jsx("button",{onClick:()=>m(!0),className:"fixed top-1/2 -translate-y-1/2 left-0 z-30 py-4 px-1 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-r-lg shadow-lg transition-colors","aria-label":n("stampEditor.galleryToggle"),title:n("stampEditor.galleryToggle"),children:e.jsx(ye,{className:"w-5 h-5"})}),!v&&e.jsx("button",{onClick:()=>j(!0),className:"fixed top-1/2 -translate-y-1/2 right-0 z-30 py-4 px-1 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-l-lg shadow-lg transition-colors","aria-label":n("stampEditor.settingsToggle"),title:n("stampEditor.settingsToggle"),children:e.jsx(we,{className:"w-5 h-5"})}),!f&&e.jsx("button",{onClick:()=>x(!0),className:"fixed bottom-0 left-1/2 -translate-x-1/2 z-30 p-1 px-4 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-t-lg shadow-lg transition-colors","aria-label":n("stampEditor.toolbarToggle"),title:n("stampEditor.toolbarToggle"),children:e.jsx(Se,{className:"w-5 h-5"})}),b&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-30 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Ne,{className:"w-4 h-4"})," ",n("stampEditor.panMode")]})]})]})};function He(){return e.jsx(Ge,{children:e.jsx(Fe,{})})}export{He as default};
