import{r as l,j as e,X as ge,C as ke,l as ie,w as je,I as Ce,x as ve,y as _e,z as Ne,B as Se,D as Me,o as Te,p as he,q as Ie,c as De,E as Re}from"./react-vendor-CzGlubEb.js";import{b as be,a as fe,u as ae,g as Pe,c as ze,d as pe}from"./index-BTQ1ARHp.js";import{u as Ee,g as me,c as Le,B as Ae}from"./BaseMap-DjNzxcBB.js";import{c as Be,g as Fe,u as Ge}from"./useGallery-QQyr94Wn.js";import{u as Ue,I as Xe}from"./InteractiveCanvasView-DaAZxHk4.js";import"./vendor-CFJUWez9.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-nm1o5ZKg.js";function Ye(n){const{user:h}=be(),[b,g]=l.useState([]),[u,D]=l.useState(!0),{addToast:y}=fe(),{t:p}=ae();l.useEffect(()=>{h!=null&&h.id&&n?(D(!0),Pe(n).then(g).catch(j=>{console.error("Failed to load collections from DB",j),y(p("collections.loadErrorToast"),"error")}).finally(()=>D(!1))):(g([]),D(!1))},[h==null?void 0:h.id,n,y,p]);const G=l.useCallback(j=>b.some(d=>d.geolocation_id===j),[b]),E=l.useCallback(async j=>{if(!h||!n)return y(p("collections.loginToast"),"info"),null;const d=b.find(v=>v.geolocation_id===j);if(d)return d;const m={id:`coll_${h.id.substring(0,4)}_${Date.now()}`,user_id:h.id,rally_id:n,geolocation_id:j,collected_at:new Date().toISOString(),logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null};g(v=>[...v,m]);try{return await ze({id:m.id,user_id:h.id,rally_id:n,geolocation_id:j}),y(p("collections.addSuccessToast"),"success"),m}catch(v){return console.error("Failed to save collection:",v),y(p("collections.addErrorToast"),"error"),g(T=>T.filter(N=>N.id!==m.id)),null}},[h,n,y,b,p]),J=l.useCallback(async(j,d,m)=>{const v=[...b],T={logbook_x:d.x,logbook_y:d.y,logbook_rotation:d.rotation,stamp_image_data:m};g(N=>N.map(A=>A.id===j?{...A,...T}:A));try{await pe(j,T),y(p("collections.updateSuccessToast"),"success")}catch(N){console.error("Failed to update collection placement:",N),y(p("collections.updateErrorToast"),"error"),g(v)}},[b,y,p]),L=l.useCallback(async j=>{const d=[...b],m={logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null};g(v=>v.map(T=>T.id===j?{...T,...m}:T));try{await pe(j,m),y(p("collections.removePlacementSuccessToast"),"info")}catch(v){console.error("Failed to remove collection placement:",v),y(p("collections.removePlacementErrorToast"),"error"),g(d)}},[b,y,p]);return{collections:b,loading:u,isCollected:G,collectStamp:E,updateCollectionPlacement:J,removeCollectionPlacement:L}}const $e=({location:n,onClose:h})=>{var g;const{t:b}=ae();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:h,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:u=>u.stopPropagation(),children:[e.jsx("button",{onClick:h,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":b("common.close"),children:e.jsx(ge,{className:"w-5 h-5"})}),n.stamp?e.jsx("img",{src:n.stamp.thumbnail,alt:n.stamp.name||"",className:"w-full h-40 object-contain bg-gray-900/50 rounded-t-2xl"}):e.jsx("div",{className:"w-full h-40 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:b("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400 mb-4",children:[e.jsx(ke,{className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold",children:b("stampDetailModal.collected")})]}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:n.name}),e.jsx("p",{className:"text-gray-400 mb-2 text-sm",children:(g=n.stamp)==null?void 0:g.name}),n.description&&e.jsx("p",{className:"text-gray-300 text-sm mt-4",children:n.description})]})]})})},Oe=({stamp:n,onClose:h,onGoToLocation:b})=>{const{t:g,locale:u}=ae(),D=new Date(n.collected_at).toLocaleDateString(u,{year:"numeric",month:"long",day:"numeric"});return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:h,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:y=>y.stopPropagation(),children:[e.jsx("button",{onClick:h,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":g("common.close"),children:e.jsx(ge,{className:"w-5 h-5"})}),n.stamp_image_data?e.jsx("div",{className:"w-full h-48 bg-white rounded-t-2xl flex items-center justify-center p-2",children:e.jsx("img",{src:n.stamp_image_data,alt:n.stamp.name||"",className:"max-w-full max-h-full object-contain"})}):e.jsx("div",{className:"w-full h-48 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:g("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:n.stamp.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:g("collectionDetailModal.stampDesign")})]}),e.jsx("div",{className:"border-t border-gray-700 -mx-6"}),e.jsxs("button",{onClick:()=>b(n.geolocation),className:"text-left flex flex-col gap-3 p-3 -m-3 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer group",title:g("collectionDetailModal.goToLocation",{name:n.geolocation.name}),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-white flex items-center gap-1.5",children:[n.geolocation.name,e.jsx(je,{className:"w-4 h-4 text-gray-500 group-hover:text-white transition-colors"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:g("collectionDetailModal.location")})]})]}),n.geolocation.description&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-gray-300",children:n.geolocation.description})})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:D}),e.jsx("p",{className:"text-sm text-gray-400",children:g("collectionDetailModal.dateCollected")})]})]})]})]})]})})},qe=({isOpen:n,onClose:h,collections:b,geolocationsWithStamps:g,pendingPlacement:u,onPlace:D,onRemovePlacement:y,stampImageCache:p,onGoToLocation:G})=>{const[E,J]=l.useState(!1),[L,j]=l.useState(!1),[d,m]=l.useState(null),[v,T]=l.useState(null),[N,A]=l.useState(null),{addToast:U}=fe(),{t:_}=ae(),[I,q]=l.useState(null),B=l.useRef(null),W=l.useRef(null),F=l.useRef(null),te=5,S=l.useMemo(()=>b.filter(t=>t.logbook_x!==null&&t.logbook_y!==null&&t.logbook_rotation!==null).map(t=>{const c=g.find(r=>r.id===t.geolocation_id);return!c||!c.stamp?null:{...t,stamp:c.stamp,geolocation:c}}).filter(t=>t!==null),[b,g]),se=l.useCallback((t,c,r,s)=>{var i;(i=W.current)==null||i.call(W,t,c,r,s)},[]),{viewTransform:w,viewTransformRef:ce,viewportSize:Z,isPanMode:Q,isPanning:O,containerProps:M,stampPreview:k,containerRef:de,canvasRef:a,canvasNode:o}=Ue({onPlaceRequest:se,isPlacementDisabled:!u||L||!I}),f=l.useCallback((t,c)=>({x:(t-w.x)/w.scale,y:(c-w.y)/w.scale}),[w]),C=l.useCallback((t,c)=>{for(let r=S.length-1;r>=0;r--){const s=S[r],i=p.get(s.id);if(!i||!s.logbook_x||!s.logbook_y)continue;const{width:x,height:Y}=i,{logbook_x:K,logbook_y:ee,logbook_rotation:z}=s,$=t-K,V=c-ee,oe=-(z||0)*(Math.PI/180),le=Math.cos(oe),ne=Math.sin(oe),re=$*le-V*ne,xe=$*ne+V*le;if(re>=-x/2&&re<=x/2&&xe>=-Y/2&&xe<=Y/2)return s}return null},[S,p]),X=l.useCallback((t,c)=>{t.clearRect(0,0,c.width,c.height);const r={x:(0-w.x)/w.scale,y:(0-w.y)/w.scale,width:Z.width/w.scale,height:Z.height/w.scale};for(const s of S){const i=p.get(s.id);if(i&&s.logbook_x!=null&&s.logbook_y!=null){const{width:x,height:Y}=i,{logbook_x:K,logbook_y:ee}=s,z=Math.hypot(x,Y)/2,$={left:K-z,right:K+z,top:ee-z,bottom:ee+z};if($.right<r.x||$.left>r.x+r.width||$.bottom<r.y||$.top>r.y+r.height)continue;t.save(),t.translate(s.logbook_x,s.logbook_y),t.rotate((s.logbook_rotation||0)*(Math.PI/180)),t.drawImage(i,-i.width/2,-i.height/2),t.restore()}}},[S,p,w,Z]),R=l.useCallback((t,c)=>{if(X(t,c),k&&I){const r=Math.atan2(k.current.y-k.start.y,k.current.x-k.start.x)*180/Math.PI,s=Math.hypot(k.current.y-k.start.y,k.current.x-k.start.x),{bitmap:i}=I;t.save(),t.globalAlpha=.7,t.translate(k.start.x,k.start.y),s>5&&t.rotate(r*Math.PI/180),t.drawImage(i,-i.width/2,-i.height/2),t.restore()}if(d&&!O&&!k){const r=S.find(i=>i.id===d),s=r?p.get(r.id):null;r&&s&&r.logbook_x&&r.logbook_y&&(t.save(),t.translate(r.logbook_x,r.logbook_y),t.rotate((r.logbook_rotation||0)*(Math.PI/180)),t.strokeStyle="rgba(59, 130, 246, 0.9)",t.lineWidth=4/w.scale,t.setLineDash([8/w.scale,4/w.scale]),t.strokeRect(-s.width/2,-s.height/2,s.width,s.height),t.restore())}},[X,k,I,d,S,p,w.scale,O]),P=l.useCallback(async(t,c,r,s)=>{if(!(!u||!I))try{if(B.current&&(B.current.currentTime=0,B.current.play().catch(console.warn)),o){const i=o.getContext("2d");if(i){const{bitmap:x}=I;i.save(),i.translate(t,c),i.rotate((s||0)*Math.PI/180),i.drawImage(x,-x.width/2,-x.height/2),i.restore()}}D(u.collection.id,{x:t,y:c,rotation:s},I.dataUrl),A({collectionId:u.collection.id,name:u.stamp.name}),q(null)}catch(i){console.error("Error placing stamp:",i),U(_("logbook.placeErrorToast"),"error")}},[u,I,D,U,o,_]);l.useEffect(()=>{W.current=P},[P]),l.useEffect(()=>{if(!B.current){const t=new Audio("/stamp-sound.mp3");t.preload="auto",B.current=t}},[]),l.useEffect(()=>{if(u&&n){A(null);let t=!1;return(async()=>{j(!0),q(null);try{const{stamp:s}=u,i={...s.settings,stamp_size:Math.min(s.settings.stamp_size,500)},x=new Image;x.crossOrigin="anonymous",x.src=s.sourceImageURL,await new Promise((ne,re)=>{x.onload=()=>ne(),x.onerror=()=>re()});const Y=Be(x,i.stamp_size),K=Y.getContext("2d",{willReadFrequently:!0});if(!K)throw new Error("No context");const ee=K.getImageData(0,0,Y.width,Y.height),z=await Fe(ee,i),$=await createImageBitmap(z),V=document.createElement("canvas");V.width=z.width,V.height=z.height;const oe=V.getContext("2d");if(!oe)throw new Error("No context for data URL");oe.putImageData(z,0,0);const le=V.toDataURL("image/png");t||q({bitmap:$,dataUrl:le})}catch(r){console.error("Failed to generate pending stamp",r),t||U(_("logbook.prepareErrorToast"),"error")}finally{t||j(!1)}})(),()=>{t=!0}}else n||q(null)},[u,n,U,_]),l.useEffect(()=>{if(!o||!n)return;const t=o.getContext("2d");if(!t)return;const c=requestAnimationFrame(()=>{R(t,o)});return()=>cancelAnimationFrame(c)},[o,n,R,w.scale]),l.useEffect(()=>{if(!n)return;const t=setTimeout(()=>{if(o){const c=o.getContext("2d");c&&R(c,o)}},50);return()=>clearTimeout(t)},[n,o,R]);const H=l.useCallback(()=>{J(!0),setTimeout(()=>{h(),J(!1),A(null)},300)},[h]),ue=()=>{N&&(y(N.collectionId),A(null))},ye={...M,onMouseDown:t=>{var i,x;if(O||k||L||u){(i=M.onMouseDown)==null||i.call(M,t);return}const c=t.currentTarget.getBoundingClientRect(),r=f(t.clientX-c.left,t.clientY-c.top),s=C(r.x,r.y);F.current={clientX:t.clientX,clientY:t.clientY,isPotentialClick:!!s},(x=M.onMouseDown)==null||x.call(M,t)},onMouseMove:t=>{var i,x;if((i=F.current)!=null&&i.isPotentialClick&&Math.hypot(t.clientX-F.current.clientX,t.clientY-F.current.clientY)>te&&(F.current.isPotentialClick=!1),(x=M.onMouseMove)==null||x.call(M,t),O||k||L||u){d&&m(null);return}const c=t.currentTarget.getBoundingClientRect(),r=f(t.clientX-c.left,t.clientY-c.top),s=C(r.x,r.y);(s==null?void 0:s.id)!==d&&m(s?s.id:null)},onMouseUp:t=>{var c,r;if((c=F.current)!=null&&c.isPotentialClick){const s=t.currentTarget.getBoundingClientRect(),i=f(t.clientX-s.left,t.clientY-s.top),x=C(i.x,i.y);x&&T(x)}(r=M.onMouseUp)==null||r.call(M,t),F.current=null}};if(!n&&!E)return null;const we=Q?"cursor-grab":u?"cursor-crosshair":d&&!O&&!k?"cursor-pointer":"cursor-default";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed inset-0 z-40 bg-gray-900/50 backdrop-blur-sm transition-opacity duration-300 ${n&&!E?"opacity-100":"opacity-0"}`,children:[e.jsx(Xe,{canvasRef:a,containerRef:de,canvasNode:o,containerProps:ye,viewTransform:w,viewTransformRef:ce,viewportSize:Z,isPanning:O,isPanMode:Q,stampPreview:k,cursorClass:we,ariaLabel:_("logbook.stampingArea")}),e.jsx("button",{onClick:H,className:"absolute top-4 right-4 z-50 p-2 text-white bg-gray-900/50 rounded-full hover:bg-gray-700 transition-colors","aria-label":_("logbook.close"),children:e.jsx(ge,{className:"w-6 h-6"})}),(L||u&&!I)&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-lg z-50 pointer-events-none",children:[e.jsx(_e,{className:"w-6 h-6 mr-3 animate-pulse"}),_("logbook.preparingStamp")]}),u&&!L&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 pointer-events-none text-center",children:e.jsxs("div",{children:[_("logbook.pendingPlacement")," ",e.jsx("strong",{children:u.stamp.name}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-300",children:_("logbook.pendingPlacementSubtext")})]})}),N&&!u&&!L&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-4 shadow-lg animate-fade-in",children:[e.jsx("span",{className:"text-gray-300",children:_("logbook.placedToast",{name:N.name})}),e.jsxs("button",{onClick:ue,className:"flex items-center gap-1.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 px-3 rounded-full transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),_("logbook.redo")]})]}),Q&&!u&&!N&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Se,{className:"w-4 h-4"})," ",_("logbook.panMode")]}),d&&!Q&&!u&&!N&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Me,{className:"w-4 h-4"})," ",_("logbook.clickToView")]})]}),v&&e.jsx(Oe,{stamp:v,onClose:()=>T(null),onGoToLocation:G})]})},st=({adminTestingRallyId:n=null,isVisible:h=!0})=>{const{addToast:b}=fe(),{activeRallyId:g,role:u}=be(),D=u==="admin"?n:g,{geolocations:y}=Ee(D),{stamps:p}=Ge(),{collections:G,isCollected:E,collectStamp:J,updateCollectionPlacement:L,removeCollectionPlacement:j}=Ye(D),{t:d}=ae(),[m,v]=l.useState(null),[T,N]=l.useState(null),[A,U]=l.useState(!1),[_,I]=l.useState(!1),[q,B]=l.useState(null),[W,F]=l.useState(new Map),te=l.useRef(null),S=l.useMemo(()=>y.map(a=>({...a,stamp:p.find(o=>o.id===a.stamp_id)||null})),[y,p]),se=l.useMemo(()=>m?S.some(a=>E(a.id)?!1:me(m.latitude,m.longitude,a.latitude,a.longitude)<=a.radius):!1,[m,S,E]),w=l.useMemo(()=>({type:"FeatureCollection",features:S.map(o=>{const f=E(o.id);let C=!1;!f&&m&&(C=me(m.latitude,m.longitude,o.latitude,o.longitude)<=o.radius);const X=f?"collected":C?"collectable":"locked",R=Le([o.longitude,o.latitude],o.radius);return R.properties={id:o.id,state:X},R})}),[S,E,m]);l.useEffect(()=>{const a=G.filter(C=>C.logbook_x!=null&&C.stamp_image_data);let o=!1;const f=async()=>{const C=a.map(async P=>{try{const H=new Image;H.src=P.stamp_image_data,await H.decode();const ue=await createImageBitmap(H);return[P.id,ue]}catch(H){return console.error(`Failed to preload image for collection ${P.id}`,H),null}}),X=await Promise.all(C);if(o)return;const R=new Map;for(const P of X)P&&R.set(P[0],P[1]);F(R)};return a.length>0?f():F(new Map),()=>{o=!0}},[G]);const ce=async a=>{if(!(_||!a.stamp)){I(!0);try{const o=await J(a.id);o&&(B({collection:o,stamp:a.stamp}),U(!0))}finally{I(!1)}}},Z=(a,o,f)=>{L(a,o,f),B(null)},Q=a=>{j(a);const o=G.find(f=>f.id===a);if(o){const f=S.find(C=>C.id===o.geolocation_id);f&&f.stamp&&B({collection:o,stamp:f.stamp})}},O=a=>{U(!1),te.current&&(te.current.flyTo({center:[a.longitude,a.latitude],zoom:15,speed:1.2}),b(d("rally.flyingToast",{name:a.name}),"info"))},M=a=>{v(a)},k=G.filter(a=>a.geolocation_id).length,de=y.length;return e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{isVisible:h,onGeolocate:M,mapRef:te,children:[e.jsxs(Te,{id:"rally-radius-circles",type:"geojson",data:w,children:[e.jsx(he,{id:"rally-radius-fill",type:"fill",paint:{"fill-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#737373"],"fill-opacity":["match",["get","state"],"collectable",.3,"collected",.2,.1]}}),e.jsx(he,{id:"rally-radius-stroke",type:"line",paint:{"line-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#a3a3a3"],"line-width":2,"line-dasharray":[2,2]}})]}),S.map(a=>{const o=E(a.id);let f=!1;!o&&m&&(f=me(m.latitude,m.longitude,a.latitude,a.longitude)<=a.radius);let C="text-gray-500",X="";return o?C="text-yellow-400":f&&(C="text-blue-500",X="animate-pulse-marker"),e.jsx(Ie,{longitude:a.longitude,latitude:a.latitude,style:{zIndex:f?20:o?15:1},children:e.jsx("button",{disabled:!f&&!o||_,onClick:()=>{f?ce(a):o&&N(a)},"aria-label":d("rally.locationStatus",{name:a.name}),className:`${f||o?"cursor-pointer":"cursor-default"}`,children:e.jsx(ie,{className:`${C} ${X} w-8 h-8 drop-shadow-lg`,strokeWidth:1.5})})},a.id)})]}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-10 transition-all duration-500 ease-in-out
          ${se?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(ie,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:d("rally.nearbyStamp")})]})}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-10 transition-all duration-500 ease-in-out
          ${se?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(ie,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:d("rally.nearbyStamp")})]})}),e.jsxs("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-10 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm font-semibold flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:d("rally.progress",{collectedCount:k,totalCount:de})})]}),e.jsxs("button",{onClick:()=>U(!0),className:"fixed top-1/2 -translate-y-1/2 right-0 z-30 py-4 px-2 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-l-lg shadow-lg transition-colors logbook-toggle-button","aria-label":d("rally.logbookToggle"),title:d("rally.logbookToggle"),children:[e.jsx(Re,{className:"w-5 h-5"}),d("rally.logbookToggle")]}),T&&e.jsx($e,{location:T,onClose:()=>N(null)}),e.jsx(qe,{isOpen:A,onClose:()=>{U(!1),q&&(b(d("collections.placementCancelledToast"),"info"),B(null))},collections:G,geolocationsWithStamps:S,pendingPlacement:q,onPlace:Z,onRemovePlacement:Q,stampImageCache:W,onGoToLocation:O})]})};export{st as default};
