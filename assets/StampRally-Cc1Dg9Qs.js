import{j as e,X as ge,C as Ne,g as se,E as Ce,I as Se,F as Me,r as o,H as Ie,J as _e,K as Re,N as Le,q as De,s as ke,t as Te,f as ze,O as Pe,n as Ee}from"./react-vendor-CFcoa3xO.js";import{u as le,a as ve,c as Fe,g as Ae,b as Ue,d as Be,e as we,f as Ge,B as Xe}from"./index-BDiqkb2Y.js";import{u as Oe,I as Ye}from"./InteractiveCanvasView-DEPM7sXZ.js";import"./vendor-DF1CirjX.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-BAWLRfpT.js";const $e=({location:n,onClose:j})=>{var m;const{t:v}=le();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:j,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:c=>c.stopPropagation(),children:[e.jsx("button",{onClick:j,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":v("common.close"),children:e.jsx(ge,{className:"w-5 h-5"})}),n.stamp?e.jsx("img",{src:n.stamp.thumbnail,alt:n.stamp.name||"",className:"w-full h-40 object-contain bg-gray-900/50 rounded-t-2xl"}):e.jsx("div",{className:"w-full h-40 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:v("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400 mb-4",children:[e.jsx(Ne,{className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold",children:v("stampDetailModal.collected")})]}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:n.name}),e.jsx("p",{className:"text-gray-400 mb-2 text-sm",children:(m=n.stamp)==null?void 0:m.name}),n.description&&e.jsx("p",{className:"text-gray-300 text-sm mt-4",children:n.description})]})]})})},qe=({stamp:n,onClose:j,onGoToLocation:v})=>{const{t:m,locale:c}=le(),C=new Date(n.collected_at).toLocaleDateString(c,{year:"numeric",month:"long",day:"numeric"});return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:j,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:S=>S.stopPropagation(),children:[e.jsx("button",{onClick:j,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":m("common.close"),children:e.jsx(ge,{className:"w-5 h-5"})}),n.stamp_image_data?e.jsx("div",{className:"w-full h-48 bg-white rounded-t-2xl flex items-center justify-center p-2",children:e.jsx("img",{src:n.stamp_image_data,alt:n.stamp.name||"",className:"max-w-full max-h-full object-contain"})}):e.jsx("div",{className:"w-full h-48 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:m("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:n.stamp.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:m("collectionDetailModal.stampDesign")})]}),e.jsx("div",{className:"border-t border-gray-700 -mx-6"}),e.jsxs("button",{onClick:()=>v(n.geolocation),className:"text-left flex flex-col gap-3 p-3 -m-3 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer group",title:m("collectionDetailModal.goToLocation",{name:n.geolocation.name}),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(se,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-white flex items-center gap-1.5",children:[n.geolocation.name,e.jsx(Ce,{className:"w-4 h-4 text-gray-500 group-hover:text-white transition-colors"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:m("collectionDetailModal.location")})]})]}),n.geolocation.description&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-gray-300",children:n.geolocation.description})})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Me,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:C}),e.jsx("p",{className:"text-sm text-gray-400",children:m("collectionDetailModal.dateCollected")})]})]})]})]})]})})},He=({isOpen:n,onClose:j,collections:v,geolocationsWithStamps:m,pendingPlacement:c,onPlace:C,onRemovePlacement:S,onCancelPlacement:A,stampImageCache:g,onGoToLocation:R})=>{const[U,I]=o.useState(!1),[B,G]=o.useState(!1),[P,oe]=o.useState(null),[V,W]=o.useState(null),[f,b]=o.useState(null),{addToast:H}=ve(),{t:y}=le(),[M,K]=o.useState(null),L=o.useRef(null),J=o.useRef(null),_=o.useRef(null),ne=5,D=o.useMemo(()=>v.filter(t=>t.logbook_x!==null&&t.logbook_y!==null&&t.logbook_rotation!==null).map(t=>{const i=m.find(l=>l.id===t.geolocation_id);return!i||!i.stamp?null:{...t,stamp:i.stamp,geolocation:i}}).filter(t=>t!==null),[v,m]),xe=o.useCallback((t,i,l)=>{var a;(a=J.current)==null||a.call(J,t,i,l)},[]),{viewTransform:h,viewTransformRef:fe,viewportSize:Q,isPanMode:X,isPanning:k,containerProps:w,stampPreview:x,containerRef:he,canvasRef:pe,canvasNode:T,isInitialized:be}=Oe({onPlaceRequest:xe,isPlacementDisabled:!c||B||!M}),Z=o.useCallback((t,i)=>({x:(t-h.x)/h.scale,y:(i-h.y)/h.scale}),[h]),ee=o.useCallback((t,i)=>{for(let l=D.length-1;l>=0;l--){const a=D[l],d=g.get(a.id);if(!d||!a.logbook_x||!a.logbook_y)continue;const{width:p,height:$}=d,{logbook_x:ce,logbook_y:ye,logbook_rotation:te}=a,ae=t-ce,F=i-ye,q=-(te||0)*(Math.PI/180),de=Math.cos(q),me=Math.sin(q),ue=ae*de-F*me,je=ae*me+F*de;if(ue>=-p/2&&ue<=p/2&&je>=-$/2&&je<=$/2)return a}return null},[D,g]),re=o.useCallback((t,i)=>{t.clearRect(0,0,i.width,i.height);for(const l of D){const a=g.get(l.id);a&&l.logbook_x!=null&&l.logbook_y!=null&&(t.save(),t.translate(l.logbook_x,l.logbook_y),t.rotate((l.logbook_rotation||0)*(Math.PI/180)),t.drawImage(a,-a.width/2,-a.height/2),t.restore())}},[D,g,h,Q]),ie=o.useCallback((t,i)=>{if(re(t,i),x&&M){const l=Math.atan2(x.current.y-x.start.y,x.current.x-x.start.x)*180/Math.PI,a=Math.hypot(x.current.y-x.start.y,x.current.x-x.start.x),{bitmap:d}=M;t.save(),t.globalAlpha=.7,t.translate(x.start.x,x.start.y),a>5&&t.rotate(l*Math.PI/180),t.drawImage(d,-d.width/2,-d.height/2),t.restore()}if(P&&!k&&!x){const l=D.find(d=>d.id===P),a=l?g.get(l.id):null;l&&a&&l.logbook_x&&l.logbook_y&&(t.save(),t.translate(l.logbook_x,l.logbook_y),t.rotate((l.logbook_rotation||0)*(Math.PI/180)),t.strokeStyle="rgba(59, 130, 246, 0.9)",t.lineWidth=4/h.scale,t.setLineDash([8/h.scale,4/h.scale]),t.strokeRect(-a.width/2,-a.height/2,a.width,a.height),t.restore())}},[re,x,M,P,D,g,h.scale,k]),s=o.useCallback(async(t,i,l)=>{if(!(!c||!M))try{if(L.current&&(L.current.currentTime=0,L.current.play().catch(console.warn)),T){const a=T.getContext("2d");if(a){const{bitmap:d}=M;a.save(),a.translate(t,i),a.rotate((l||0)*Math.PI/180),a.drawImage(d,-d.width/2,-d.height/2),a.restore()}}C(c.collection.id,{x:t,y:i,rotation:l},M.dataUrl),b({collectionId:c.collection.id,name:c.stamp.name}),K(null)}catch(a){console.error("Error placing stamp:",a),H(y("logbook.placeErrorToast"),"error")}},[c,M,C,H,T,y]);o.useEffect(()=>{J.current=s},[s]),o.useEffect(()=>{if(!L.current){const t=new Audio("/atsume-page/stamp-sound.mp3");t.preload="auto",L.current=t}},[]),o.useEffect(()=>{if(c&&n){b(null);let t=!1;return(async()=>{G(!0),K(null);try{const{stamp:a}=c,d={...a.settings,stamp_size:Math.min(a.settings.stamp_size,500)},p=new Image;p.crossOrigin="anonymous",p.src=a.sourceImageURL,await new Promise((me,ue)=>{p.onload=()=>me(),p.onerror=()=>ue()});const $=Fe(p,d.stamp_size),ce=$.getContext("2d",{willReadFrequently:!0});if(!ce)throw new Error("No context");const ye=ce.getImageData(0,0,$.width,$.height),te=await Ae(ye,d),ae=await createImageBitmap(te),F=document.createElement("canvas");F.width=te.width,F.height=te.height;const q=F.getContext("2d");if(!q)throw new Error("No context for data URL");q.fillStyle="#FFFFFF",q.fillRect(0,0,F.width,F.height),q.drawImage(ae,0,0);const de=F.toDataURL("image/jpeg",.8);t||K({bitmap:ae,dataUrl:de})}catch(l){console.error("Failed to generate pending stamp",l),t||H(y("logbook.prepareErrorToast"),"error")}finally{t||G(!1)}})(),()=>{t=!0}}else n||K(null)},[c,n,H,y]),o.useEffect(()=>{if(!T||!n)return;const t=T.getContext("2d");if(!t)return;const i=requestAnimationFrame(()=>{ie(t,T)});return()=>cancelAnimationFrame(i)},[T,n,ie,h.scale]);const r=o.useCallback(()=>{I(!0),setTimeout(()=>{j(),I(!1),b(null),c&&A(c.collection.id)},300)},[j,c,A]),u=()=>{f&&(S(f.collectionId),b(null))},z={...w,onMouseDown:t=>{var d,p;if(k||x||B||c){(d=w.onMouseDown)==null||d.call(w,t);return}const i=t.currentTarget.getBoundingClientRect(),l=Z(t.clientX-i.left,t.clientY-i.top),a=ee(l.x,l.y);_.current={clientX:t.clientX,clientY:t.clientY,isPotentialClick:!!a},(p=w.onMouseDown)==null||p.call(w,t)},onMouseMove:t=>{var d,p;if((d=_.current)!=null&&d.isPotentialClick&&Math.hypot(t.clientX-_.current.clientX,t.clientY-_.current.clientY)>ne&&(_.current.isPotentialClick=!1),(p=w.onMouseMove)==null||p.call(w,t),k||x||B||c){P&&oe(null);return}const i=t.currentTarget.getBoundingClientRect(),l=Z(t.clientX-i.left,t.clientY-i.top),a=ee(l.x,l.y);(a==null?void 0:a.id)!==P&&oe(a?a.id:null)},onMouseUp:t=>{var i,l;if((i=_.current)!=null&&i.isPotentialClick){const a=t.currentTarget.getBoundingClientRect(),d=Z(t.clientX-a.left,t.clientY-a.top),p=ee(d.x,d.y);p&&W(p)}(l=w.onMouseUp)==null||l.call(w,t),_.current=null}};if(!n&&!U)return null;const Y=X?"cursor-grab":c?"cursor-crosshair":P&&!k&&!x?"cursor-pointer":"cursor-default";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed inset-0 z-40 bg-gray-900/50 backdrop-blur-sm transition-opacity duration-300 ${n&&!U?"opacity-100":"opacity-0"}`,children:[e.jsx(Ye,{canvasRef:pe,containerRef:he,canvasNode:T,containerProps:z,viewTransform:h,viewTransformRef:fe,viewportSize:Q,isPanning:k,isPanMode:X,stampPreview:x,cursorClass:Y,ariaLabel:y("logbook.stampingArea"),className:`transition-opacity duration-300 ${be?"opacity-100":"opacity-0"}`}),e.jsx("button",{onClick:r,className:"absolute top-4 right-4 z-50 p-2 text-white bg-gray-900/50 rounded-full hover:bg-gray-700 transition-colors","aria-label":y("logbook.close"),children:e.jsx(ge,{className:"w-6 h-6"})}),(B||c&&!M)&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-lg z-50 pointer-events-none",children:[e.jsx(Ie,{className:"w-6 h-6 mr-3 animate-pulse"}),y("logbook.preparingStamp")]}),c&&!B&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 pointer-events-none text-center",children:e.jsxs("div",{children:[y("logbook.pendingPlacement")," ",e.jsx("strong",{children:c.stamp.name}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-300",children:y("logbook.pendingPlacementSubtext")})]})}),f&&!c&&!B&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-4 shadow-lg animate-fade-in",children:[e.jsx("span",{className:"text-gray-300",children:y("logbook.placedToast",{name:f.name})}),e.jsxs("button",{onClick:u,className:"flex items-center gap-1.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 px-3 rounded-full transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),y("logbook.redo")]})]}),X&&!c&&!f&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Re,{className:"w-4 h-4"})," ",y("logbook.panMode")]}),P&&!X&&!c&&!f&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Le,{className:"w-4 h-4"})," ",y("logbook.clickToView")]})]}),V&&e.jsx(qe,{stamp:V,onClose:()=>W(null),onGoToLocation:R})]})},Ke=({isOpen:n,onClose:j,collections:v,geolocationsWithStamps:m,onSelectLocation:c})=>{const{t:C}=le(),S=o.useMemo(()=>v.filter(R=>R.logbook_x!=null&&R.stamp_image_data).map(R=>{const U=m.find(I=>I.id===R.geolocation_id);return U?{...U,collectionId:R.id}:null}).filter(Boolean),[v,m]),A=g=>{c(g),j()};return e.jsx("aside",{className:`fixed top-0 left-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-r-2 border-gray-700 shadow-2xl ${n?"translate-x-0":"-translate-x-full"} pt-safe-top`,"aria-hidden":!n,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsx("h1",{className:"text-xl font-bold",children:C("collectedStampsList.title")}),e.jsx("button",{onClick:j,className:"p-2 rounded-full hover:bg-gray-700","aria-label":C("common.close"),children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-2 no-scrollbar",children:S.length===0?e.jsxs("div",{className:"text-center text-gray-400 mt-8 px-4",children:[e.jsx("p",{children:C("collectedStampsList.empty")}),e.jsx("p",{className:"text-sm mt-1",children:C("collectedStampsList.emptySubtext")})]}):e.jsx("ul",{className:"flex flex-col gap-2",children:S.map(g=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>A(g),className:"w-full flex items-center gap-3 text-left p-2 rounded-lg transition-colors duration-200 text-gray-200 hover:bg-gray-700","aria-label":C("collectedStampsList.selectStamp",{name:g.name}),children:[e.jsx("div",{className:"w-10 h-10 flex-shrink-0 bg-gray-900/50 rounded-md flex items-center justify-center",children:g.stamp?e.jsx("img",{src:g.stamp.thumbnail,alt:g.stamp.name,className:"w-full h-full object-contain"}):e.jsx(se,{className:"w-6 h-6 text-gray-500"})}),e.jsx("span",{className:"flex-grow font-medium truncate",children:g.name})]})},g.collectionId))})})]})})},tt=({adminTestingRallyId:n=null,isVisible:j=!0})=>{const{addToast:v}=ve(),{user:m,activeRallyId:c,role:C}=Ue(),S=C==="admin"?n:c,{geolocations:A,geolocationsLoading:g,refreshGeolocations:R,stamps:U,collections:I,collectionsLoading:B,isCollected:G,collectStamp:P,updateCollectionPlacement:oe,revertCollectionPlacement:V,refreshCollections:W}=Be();o.useEffect(()=>{j&&S&&(R(S),m!=null&&m.id&&W(m.id,S))},[j,S,R,W,m==null?void 0:m.id]);const{t:f}=le(),[b,H]=o.useState(null),[y,M]=o.useState(null),[K,L]=o.useState(!1),[J,_]=o.useState(!1),[ne,D]=o.useState(!1),[xe,h]=o.useState(null),[fe,Q]=o.useState(new Map),X=o.useRef(null),k=o.useMemo(()=>A.map(s=>({...s,stamp:U.find(r=>r.id===s.stamp_id)||null})),[A,U]),w=o.useMemo(()=>b?k.some(s=>G(s.id)?!1:we(b.latitude,b.longitude,s.latitude,s.longitude)<=s.radius):!1,[b,k,G]),x=o.useMemo(()=>({type:"FeatureCollection",features:k.map(r=>{const u=G(r.id);let N=!1;!u&&b&&(N=we(b.latitude,b.longitude,r.latitude,r.longitude)<=r.radius);const O=u?"collected":N?"collectable":"locked",E=Ge([r.longitude,r.latitude],r.radius);return E.properties={id:r.id,state:O},E})}),[k,G,b]);o.useEffect(()=>{const s=I.filter(N=>N.logbook_x!=null&&N.stamp_image_data);let r=!1;const u=async()=>{const N=s.map(async z=>{try{const Y=new Image;Y.src=z.stamp_image_data,await Y.decode();const t=await createImageBitmap(Y);return[z.id,t]}catch(Y){return console.error(`Failed to preload image for collection ${z.id}`,Y),null}}),O=await Promise.all(N);if(r)return;const E=new Map;for(const z of O)z&&E.set(z[0],z[1]);Q(E)};return s.length>0?u():Q(new Map),()=>{r=!0}},[I]);const he=async s=>{if(!(ne||!s.stamp)){D(!0);try{const r=await P(s.id,S);r&&(h({collection:r,stamp:s.stamp}),L(!0))}finally{D(!1)}}},pe=(s,r,u)=>{oe(s,r,u),h(null)},T=async s=>{await V(s);const r=I.find(u=>u.id===s);if(r){const u=k.find(N=>N.id===r.geolocation_id);u&&u.stamp&&h({collection:r,stamp:u.stamp})}},be=async s=>{await V(s),h(null),v(f("collections.placementCancelledToast"),"info")},Z=s=>{L(!1),_(!1),X.current&&(X.current.flyTo({center:[s.longitude,s.latitude],zoom:15,speed:1.2}),v(f("rally.flyingToast",{name:s.name}),"info"))},ee=s=>{H(s)},re=I.filter(s=>s.geolocation_id).length,ie=A.length;return e.jsxs(e.Fragment,{children:[e.jsxs(Xe,{isVisible:j,onGeolocate:ee,mapRef:X,children:[e.jsxs(De,{id:"rally-radius-circles",type:"geojson",data:x,children:[e.jsx(ke,{id:"rally-radius-fill",type:"fill",paint:{"fill-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#737373"],"fill-opacity":["match",["get","state"],"collectable",.3,"collected",.2,.1]}}),e.jsx(ke,{id:"rally-radius-stroke",type:"line",paint:{"line-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#a3a3a3"],"line-width":2,"line-dasharray":[2,2]}})]}),k.map(s=>{const r=G(s.id);let u=!1;!r&&b&&(u=we(b.latitude,b.longitude,s.latitude,s.longitude)<=s.radius);let N="text-gray-500",O="";return r?N="text-yellow-400":u&&(N="text-blue-500",O="animate-pulse-marker"),e.jsx(Te,{longitude:s.longitude,latitude:s.latitude,style:{zIndex:20},children:e.jsx("button",{disabled:!u&&!r||ne,onClick:E=>{E.stopPropagation(),u?he(s):r&&M(s)},"aria-label":f("rally.locationStatus",{name:s.name}),className:`${u||r?"cursor-pointer":"cursor-default"}`,children:e.jsx(se,{className:`${N} ${O} w-8 h-8 drop-shadow-lg`,strokeWidth:1.5})})},s.id)})]}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-25 transition-all duration-500 ease-in-out
          ${w?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(se,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:f("rally.nearbyStamp")})]})}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-25 transition-all duration-500 ease-in-out
          ${w?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(se,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:f("rally.nearbyStamp")})]})}),!(g||B)&&e.jsxs("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-25 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm font-semibold flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:f("rally.progress",{collectedCount:re,totalCount:ie})})]}),e.jsx("button",{onClick:()=>L(!0),className:"fixed top-1/2 -translate-y-1/2 right-0 z-30 py-4 px-2 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-l-lg shadow-lg transition-colors logbook-toggle-button","aria-label":f("rally.logbookToggle"),title:f("rally.logbookToggle"),children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>_(!0),className:"fixed top-1/2 -translate-y-1/2 left-0 z-30 py-4 px-2 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-r-lg shadow-lg transition-colors collected-stamps-toggle-button","aria-label":f("rally.collectedStampsToggle"),title:f("rally.collectedStampsToggle"),children:e.jsx(Ee,{className:"w-5 h-5"})}),y&&e.jsx($e,{location:y,onClose:()=>M(null)}),e.jsx(He,{isOpen:K,onClose:()=>{L(!1)},collections:I,geolocationsWithStamps:k,pendingPlacement:xe,onPlace:pe,onRemovePlacement:T,onCancelPlacement:be,stampImageCache:fe,onGoToLocation:Z}),e.jsx(Ke,{isOpen:J,onClose:()=>_(!1),collections:I,geolocationsWithStamps:k,onSelectLocation:Z})]})};export{tt as default};
