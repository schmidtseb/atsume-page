import{r as d}from"./react-vendor-DJ-QoGxu.js";import{d as b,a as v,u as C,l as f,b as I,m as L,n as F}from"./index-BuDg_hJO.js";import{c as R}from"./stamp-D6e6GvNL.js";const g=128;async function U(a){const t=document.createElement("canvas"),o=a.width/a.height;t.width=g,t.height=g/o;const u=t.getContext("2d");return u?(u.drawImage(a,0,0,t.width,t.height),t.toDataURL("image/jpeg",.7)):""}function k(){const{user:a}=b(),[t,o]=d.useState([]),[u,y]=d.useState(!0),{addToast:e}=v(),{t:s}=C();d.useEffect(()=>{a!=null&&a.id?(y(!0),f().then(r=>o(r)).catch(r=>{console.error("Failed to load stamps from DB",r),e(s("gallery.loadErrorToast"),"error")}).finally(()=>{y(!1)})):(o([]),y(!1))},[a==null?void 0:a.id,e,s]);const h=d.useCallback(async(r,n,i)=>{if(!a){e(s("gallery.loginToast"),"info");return}try{const l=R(r,n.stamp_size),m=l.toDataURL("image/jpeg",.7),c=await U(l),p={user_id:a.id,name:i,thumbnail:c,settings:n,sourceImageURL:m},w=await I(p);o(E=>[w,...E]),e(s("gallery.addSuccessToast",{name:i}),"success"),await f().then(o)}catch(l){console.error("Failed to add stamp to gallery:",l),e(s("gallery.addErrorToast"),"error"),o(m=>m.filter(c=>c.user_id===a.id))}},[e,a,s]),S=d.useCallback(async r=>{const n=t;o(i=>i.filter(l=>l.id!==r));try{await L(r),e(s("gallery.deleteSuccessToast"),"info")}catch(i){console.error("Failed to delete stamp:",i),e(s("gallery.deleteErrorToast"),"error"),o(n)}},[e,t,s]),T=d.useCallback(async(r,n)=>{const i=[...t],l=t.find(c=>c.id===r);if(!l)return;const m=l.name;o(c=>c.map(p=>p.id===r?{...p,name:n}:p));try{await F(r,n),e(s("gallery.renameSuccessToast",{name:n}),"success")}catch(c){console.error("Failed to rename stamp:",c),e(s("gallery.renameErrorToast",{oldName:m}),"error"),o(i)}},[e,t,s]);return{stamps:t,loading:u,addStampToGallery:h,deleteStampFromGallery:S,renameStampInGallery:T}}export{k as u};
