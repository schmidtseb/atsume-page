import{r as s,j as e,X as xe,C as ve,g as de,D as _e,I as Ne,E as Se,F as Me,H as Te,J as Ie,K as Re,p as De,q as ye,s as Pe,f as ze,N as Ee}from"./react-vendor-Duv3WysG.js";import{u as ke,a as he,b as le,g as Le,p as Fe,c as Ae,d as we,e as Ue,f as Be,h as Ge,i as Xe,j as Ye,k as fe,l as $e,B as Oe}from"./index-BgGc5YWf.js";import{u as qe,I as He}from"./InteractiveCanvasView-a7SZ1cr0.js";import"./vendor-CFJUWez9.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-BpK5hd46.js";function Ke(n){const{user:y}=ke(),[h,m]=s.useState([]),[d,D]=s.useState(!0),{addToast:b}=he(),{t:j}=le();s.useEffect(()=>{y!=null&&y.id&&n?(D(!0),Le(n).then(async x=>{const g=x.filter(u=>u.stamp_image_data).map(u=>u.stamp_image_data);await Promise.all(g.map(Fe)),m(x)}).catch(x=>{console.error("Failed to load collections from DB",x),b(j("collections.loadErrorToast"),"error")}).finally(()=>D(!1))):(m([]),D(!1))},[y==null?void 0:y.id,n,b,j]);const P=s.useCallback(x=>h.some(g=>g.geolocation_id===x&&g.is_collected),[h]),X=s.useCallback(async x=>{if(!y||!n)return b(j("collections.loginToast"),"info"),null;const g=h.find(f=>f.geolocation_id===x&&!f.is_collected);if(g)return g;const u=h.find(f=>f.geolocation_id===x&&f.is_collected);if(u)return u;const p={user_id:y.id,rally_id:n,geolocation_id:x,logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null},S=`temp-${Date.now()}`;m(f=>[...f,{...p,id:S,collected_at:new Date().toISOString(),is_collected:!1}]);try{const f=await Ae({user_id:y.id,rally_id:n,geolocation_id:x,is_collected:!1});return b(j("collections.addSuccessToast"),"success"),m(M=>M.map(z=>z.id===S?f:z)),f}catch(f){return console.error("Failed to save collection:",f),b(j("collections.addErrorToast"),"error"),m(M=>M.filter(z=>z.id!==S)),null}},[y,n,b,h,j]),ee=s.useCallback(async(x,g,u)=>{const p=[...h],S={logbook_x:g.x,logbook_y:g.y,logbook_rotation:g.rotation,stamp_image_data:u,is_collected:!0};m(f=>f.map(M=>M.id===x?{...M,...S}:M));try{await we(x,S),b(j("collections.updateSuccessToast"),"success")}catch(f){console.error("Failed to update collection placement:",f),b(j("collections.updateErrorToast"),"error"),m(p)}},[h,b,j]),L=s.useCallback(async x=>{const g=[...h];m(u=>u.filter(p=>p.id!==x));try{await Ue(x),b(j("collections.removePlacementSuccessToast"),"info")}catch(u){console.error("Failed to remove collection:",u),b(j("collections.removePlacementErrorToast"),"error"),m(g)}},[h,b,j]),F=s.useCallback(async x=>{const g=[...h],u={logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null,is_collected:!1};m(p=>p.map(S=>S.id===x?{...S,...u}:S));try{await we(x,u),b(j("collections.revertPlacementSuccessToast"),"info")}catch(p){console.error("Failed to revert collection placement:",p),b(j("collections.revertPlacementErrorToast"),"error"),m(g)}},[h,b,j]);return{collections:h,loading:d,isCollected:P,collectStamp:X,updateCollectionPlacement:ee,deleteCollection:L,revertCollectionPlacement:F}}const Je=({location:n,onClose:y})=>{var m;const{t:h}=le();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:y,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:d=>d.stopPropagation(),children:[e.jsx("button",{onClick:y,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":h("common.close"),children:e.jsx(xe,{className:"w-5 h-5"})}),n.stamp?e.jsx("img",{src:n.stamp.thumbnail,alt:n.stamp.name||"",className:"w-full h-40 object-contain bg-gray-900/50 rounded-t-2xl"}):e.jsx("div",{className:"w-full h-40 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:h("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400 mb-4",children:[e.jsx(ve,{className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold",children:h("stampDetailModal.collected")})]}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:n.name}),e.jsx("p",{className:"text-gray-400 mb-2 text-sm",children:(m=n.stamp)==null?void 0:m.name}),n.description&&e.jsx("p",{className:"text-gray-300 text-sm mt-4",children:n.description})]})]})})},Ve=({stamp:n,onClose:y,onGoToLocation:h})=>{const{t:m,locale:d}=le(),D=new Date(n.collected_at).toLocaleDateString(d,{year:"numeric",month:"long",day:"numeric"});return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:y,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:b=>b.stopPropagation(),children:[e.jsx("button",{onClick:y,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":m("common.close"),children:e.jsx(xe,{className:"w-5 h-5"})}),n.stamp_image_data?e.jsx("div",{className:"w-full h-48 bg-white rounded-t-2xl flex items-center justify-center p-2",children:e.jsx("img",{src:n.stamp_image_data,alt:n.stamp.name||"",className:"max-w-full max-h-full object-contain"})}):e.jsx("div",{className:"w-full h-48 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:m("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:n.stamp.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:m("collectionDetailModal.stampDesign")})]}),e.jsx("div",{className:"border-t border-gray-700 -mx-6"}),e.jsxs("button",{onClick:()=>h(n.geolocation),className:"text-left flex flex-col gap-3 p-3 -m-3 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer group",title:m("collectionDetailModal.goToLocation",{name:n.geolocation.name}),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-white flex items-center gap-1.5",children:[n.geolocation.name,e.jsx(_e,{className:"w-4 h-4 text-gray-500 group-hover:text-white transition-colors"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:m("collectionDetailModal.location")})]})]}),n.geolocation.description&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ne,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-gray-300",children:n.geolocation.description})})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:D}),e.jsx("p",{className:"text-sm text-gray-400",children:m("collectionDetailModal.dateCollected")})]})]})]})]})]})})},We=({isOpen:n,onClose:y,collections:h,geolocationsWithStamps:m,pendingPlacement:d,onPlace:D,onRemovePlacement:b,onCancelPlacement:j,stampImageCache:P,onGoToLocation:X})=>{const[ee,L]=s.useState(!1),[F,x]=s.useState(!1),[g,u]=s.useState(null),[p,S]=s.useState(null),[f,M]=s.useState(null),{addToast:z}=he(),{t:_}=le(),[R,V]=s.useState(null),W=s.useRef(null),Y=s.useRef(null),$=s.useRef(null),ne=5,E=s.useMemo(()=>h.filter(t=>t.logbook_x!==null&&t.logbook_y!==null&&t.logbook_rotation!==null).map(t=>{const i=m.find(l=>l.id===t.geolocation_id);return!i||!i.stamp?null:{...t,stamp:i.stamp,geolocation:i}}).filter(t=>t!==null),[h,m]),O=s.useCallback((t,i,l)=>{var o;(o=Y.current)==null||o.call(Y,t,i,l)},[]),{viewTransform:w,viewTransformRef:ue,viewportSize:te,isPanMode:oe,isPanning:J,containerProps:T,stampPreview:C,containerRef:me,canvasRef:ge,canvasNode:I}=qe({onPlaceRequest:O,isPlacementDisabled:!d||F||!R}),a=s.useCallback((t,i)=>({x:(t-w.x)/w.scale,y:(i-w.y)/w.scale}),[w]),r=s.useCallback((t,i)=>{for(let l=E.length-1;l>=0;l--){const o=E[l],c=P.get(o.id);if(!c||!o.logbook_x||!o.logbook_y)continue;const{width:v,height:H}=c,{logbook_x:Z,logbook_y:se,logbook_rotation:B}=o,G=t-Z,K=i-se,Q=-(B||0)*(Math.PI/180),re=Math.cos(Q),ie=Math.sin(Q),ce=G*re-K*ie,be=G*ie+K*re;if(ce>=-v/2&&ce<=v/2&&be>=-H/2&&be<=H/2)return o}return null},[E,P]),k=s.useCallback((t,i)=>{t.clearRect(0,0,i.width,i.height);const l={x:(0-w.x)/w.scale,y:(0-w.y)/w.scale,width:te.width/w.scale,height:te.height/w.scale};for(const o of E){const c=P.get(o.id);if(c&&o.logbook_x!=null&&o.logbook_y!=null){const{width:v,height:H}=c,{logbook_x:Z,logbook_y:se}=o,B=Math.hypot(v,H)/2,G={left:Z-B,right:Z+B,top:se-B,bottom:se+B};if(G.right<l.x||G.left>l.x+l.width||G.bottom<l.y||G.top>l.y+l.height)continue;t.save(),t.translate(o.logbook_x,o.logbook_y),t.rotate((o.logbook_rotation||0)*(Math.PI/180)),t.drawImage(c,-c.width/2,-c.height/2),t.restore()}}},[E,P,w,te]),N=s.useCallback((t,i)=>{if(k(t,i),C&&R){const l=Math.atan2(C.current.y-C.start.y,C.current.x-C.start.x)*180/Math.PI,o=Math.hypot(C.current.y-C.start.y,C.current.x-C.start.x),{bitmap:c}=R;t.save(),t.globalAlpha=.7,t.translate(C.start.x,C.start.y),o>5&&t.rotate(l*Math.PI/180),t.drawImage(c,-c.width/2,-c.height/2),t.restore()}if(g&&!J&&!C){const l=E.find(c=>c.id===g),o=l?P.get(l.id):null;l&&o&&l.logbook_x&&l.logbook_y&&(t.save(),t.translate(l.logbook_x,l.logbook_y),t.rotate((l.logbook_rotation||0)*(Math.PI/180)),t.strokeStyle="rgba(59, 130, 246, 0.9)",t.lineWidth=4/w.scale,t.setLineDash([8/w.scale,4/w.scale]),t.strokeRect(-o.width/2,-o.height/2,o.width,o.height),t.restore())}},[k,C,R,g,E,P,w.scale,J]),q=s.useCallback(async(t,i,l)=>{if(!(!d||!R))try{if(W.current&&(W.current.currentTime=0,W.current.play().catch(console.warn)),I){const o=I.getContext("2d");if(o){const{bitmap:c}=R;o.save(),o.translate(t,i),o.rotate((l||0)*Math.PI/180),o.drawImage(c,-c.width/2,-c.height/2),o.restore()}}D(d.collection.id,{x:t,y:i,rotation:l},R.dataUrl),M({collectionId:d.collection.id,name:d.stamp.name}),V(null)}catch(o){console.error("Error placing stamp:",o),z(_("logbook.placeErrorToast"),"error")}},[d,R,D,z,I,_]);s.useEffect(()=>{Y.current=q},[q]),s.useEffect(()=>{if(!W.current){const t=new Audio("/atsume-page/stamp-sound.mp3");t.preload="auto",W.current=t}},[]),s.useEffect(()=>{if(d&&n){M(null);let t=!1;return(async()=>{x(!0),V(null);try{const{stamp:o}=d,c={...o.settings,stamp_size:Math.min(o.settings.stamp_size,500)},v=new Image;v.crossOrigin="anonymous",v.src=o.sourceImageURL,await new Promise((ie,ce)=>{v.onload=()=>ie(),v.onerror=()=>ce()});const H=Be(v,c.stamp_size),Z=H.getContext("2d",{willReadFrequently:!0});if(!Z)throw new Error("No context");const se=Z.getImageData(0,0,H.width,H.height),B=await Ge(se,c),G=await createImageBitmap(B),K=document.createElement("canvas");K.width=B.width,K.height=B.height;const Q=K.getContext("2d");if(!Q)throw new Error("No context for data URL");Q.fillStyle="#FFFFFF",Q.fillRect(0,0,K.width,K.height),Q.drawImage(G,0,0);const re=K.toDataURL("image/jpeg",.8);t||V({bitmap:G,dataUrl:re})}catch(l){console.error("Failed to generate pending stamp",l),t||z(_("logbook.prepareErrorToast"),"error")}finally{t||x(!1)}})(),()=>{t=!0}}else n||V(null)},[d,n,z,_]),s.useEffect(()=>{if(!I||!n)return;const t=I.getContext("2d");if(!t)return;const i=requestAnimationFrame(()=>{N(t,I)});return()=>cancelAnimationFrame(i)},[I,n,N,w.scale]),s.useEffect(()=>{if(!n)return;const t=setTimeout(()=>{if(I){const i=I.getContext("2d");i&&N(i,I)}},50);return()=>clearTimeout(t)},[n,I,N]);const A=s.useCallback(()=>{L(!0),setTimeout(()=>{y(),L(!1),M(null),d&&j(d.collection.id)},300)},[y,d,j]),U=()=>{f&&(b(f.collectionId),M(null))},je={...T,onMouseDown:t=>{var c,v;if(J||C||F||d){(c=T.onMouseDown)==null||c.call(T,t);return}const i=t.currentTarget.getBoundingClientRect(),l=a(t.clientX-i.left,t.clientY-i.top),o=r(l.x,l.y);$.current={clientX:t.clientX,clientY:t.clientY,isPotentialClick:!!o},(v=T.onMouseDown)==null||v.call(T,t)},onMouseMove:t=>{var c,v;if((c=$.current)!=null&&c.isPotentialClick&&Math.hypot(t.clientX-$.current.clientX,t.clientY-$.current.clientY)>ne&&($.current.isPotentialClick=!1),(v=T.onMouseMove)==null||v.call(T,t),J||C||F||d){g&&u(null);return}const i=t.currentTarget.getBoundingClientRect(),l=a(t.clientX-i.left,t.clientY-i.top),o=r(l.x,l.y);(o==null?void 0:o.id)!==g&&u(o?o.id:null)},onMouseUp:t=>{var i,l;if((i=$.current)!=null&&i.isPotentialClick){const o=t.currentTarget.getBoundingClientRect(),c=a(t.clientX-o.left,t.clientY-o.top),v=r(c.x,c.y);v&&S(v)}(l=T.onMouseUp)==null||l.call(T,t),$.current=null}};if(!n&&!ee)return null;const Ce=oe?"cursor-grab":d?"cursor-crosshair":g&&!J&&!C?"cursor-pointer":"cursor-default";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed inset-0 z-40 bg-gray-900/50 backdrop-blur-sm transition-opacity duration-300 ${n&&!ee?"opacity-100":"opacity-0"}`,children:[e.jsx(He,{canvasRef:ge,containerRef:me,canvasNode:I,containerProps:je,viewTransform:w,viewTransformRef:ue,viewportSize:te,isPanning:J,isPanMode:oe,stampPreview:C,cursorClass:Ce,ariaLabel:_("logbook.stampingArea")}),e.jsx("button",{onClick:A,className:"absolute top-4 right-4 z-50 p-2 text-white bg-gray-900/50 rounded-full hover:bg-gray-700 transition-colors","aria-label":_("logbook.close"),children:e.jsx(xe,{className:"w-6 h-6"})}),(F||d&&!R)&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-lg z-50 pointer-events-none",children:[e.jsx(Me,{className:"w-6 h-6 mr-3 animate-pulse"}),_("logbook.preparingStamp")]}),d&&!F&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 pointer-events-none text-center",children:e.jsxs("div",{children:[_("logbook.pendingPlacement")," ",e.jsx("strong",{children:d.stamp.name}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-300",children:_("logbook.pendingPlacementSubtext")})]})}),f&&!d&&!F&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-4 shadow-lg animate-fade-in",children:[e.jsx("span",{className:"text-gray-300",children:_("logbook.placedToast",{name:f.name})}),e.jsxs("button",{onClick:U,className:"flex items-center gap-1.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 px-3 rounded-full transition-colors",children:[e.jsx(Te,{className:"w-4 h-4"}),_("logbook.redo")]})]}),oe&&!d&&!f&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Ie,{className:"w-4 h-4"})," ",_("logbook.panMode")]}),g&&!oe&&!d&&!f&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Re,{className:"w-4 h-4"})," ",_("logbook.clickToView")]})]}),p&&e.jsx(Ve,{stamp:p,onClose:()=>S(null),onGoToLocation:X})]})},lt=({adminTestingRallyId:n=null,isVisible:y=!0})=>{const{addToast:h}=he(),{activeRallyId:m,role:d}=ke(),D=d==="admin"?n:m,{geolocations:b,loading:j}=Xe(D),{stamps:P}=Ye(),{collections:X,loading:ee,isCollected:L,collectStamp:F,updateCollectionPlacement:x,revertCollectionPlacement:g}=Ke(D),{t:u}=le(),[p,S]=s.useState(null),[f,M]=s.useState(null),[z,_]=s.useState(!1),[R,V]=s.useState(!1),[W,Y]=s.useState(null),[$,ne]=s.useState(new Map),E=s.useRef(null),O=s.useMemo(()=>b.map(a=>({...a,stamp:P.find(r=>r.id===a.stamp_id)||null})),[b,P]),w=s.useMemo(()=>p?O.some(a=>L(a.id)?!1:fe(p.latitude,p.longitude,a.latitude,a.longitude)<=a.radius):!1,[p,O,L]),ue=s.useMemo(()=>({type:"FeatureCollection",features:O.map(r=>{const k=L(r.id);let N=!1;!k&&p&&(N=fe(p.latitude,p.longitude,r.latitude,r.longitude)<=r.radius);const q=k?"collected":N?"collectable":"locked",A=$e([r.longitude,r.latitude],r.radius);return A.properties={id:r.id,state:q},A})}),[O,L,p]);s.useEffect(()=>{const a=X.filter(N=>N.logbook_x!=null&&N.stamp_image_data);let r=!1;const k=async()=>{const N=a.map(async U=>{try{const ae=new Image;ae.src=U.stamp_image_data,await ae.decode();const pe=await createImageBitmap(ae);return[U.id,pe]}catch(ae){return console.error(`Failed to preload image for collection ${U.id}`,ae),null}}),q=await Promise.all(N);if(r)return;const A=new Map;for(const U of q)U&&A.set(U[0],U[1]);ne(A)};return a.length>0?k():ne(new Map),()=>{r=!0}},[X]);const te=async a=>{if(!(R||!a.stamp)){V(!0);try{const r=await F(a.id);r&&(Y({collection:r,stamp:a.stamp}),_(!0))}finally{V(!1)}}},oe=(a,r,k)=>{x(a,r,k),Y(null)},J=async a=>{await g(a);const r=X.find(k=>k.id===a);if(r){const k=O.find(N=>N.id===r.geolocation_id);k&&k.stamp&&Y({collection:r,stamp:k.stamp})}},T=async a=>{await g(a),Y(null),h(u("collections.placementCancelledToast"),"info")},C=a=>{_(!1),E.current&&(E.current.flyTo({center:[a.longitude,a.latitude],zoom:15,speed:1.2}),h(u("rally.flyingToast",{name:a.name}),"info"))},me=a=>{S(a)},ge=X.filter(a=>a.geolocation_id).length,I=b.length;return e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{isVisible:y,onGeolocate:me,mapRef:E,children:[e.jsxs(De,{id:"rally-radius-circles",type:"geojson",data:ue,children:[e.jsx(ye,{id:"rally-radius-fill",type:"fill",paint:{"fill-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#737373"],"fill-opacity":["match",["get","state"],"collectable",.3,"collected",.2,.1]}}),e.jsx(ye,{id:"rally-radius-stroke",type:"line",paint:{"line-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#a3a3a3"],"line-width":2,"line-dasharray":[2,2]}})]}),O.map(a=>{const r=L(a.id);let k=!1;!r&&p&&(k=fe(p.latitude,p.longitude,a.latitude,a.longitude)<=a.radius);let N="text-gray-500",q="";return r?N="text-yellow-400":k&&(N="text-blue-500",q="animate-pulse-marker"),e.jsx(Pe,{longitude:a.longitude,latitude:a.latitude,style:{zIndex:20},children:e.jsx("button",{disabled:!k&&!r||R,onClick:A=>{A.stopPropagation(),k?te(a):r&&M(a)},"aria-label":u("rally.locationStatus",{name:a.name}),className:`${k||r?"cursor-pointer":"cursor-default"}`,children:e.jsx(de,{className:`${N} ${q} w-8 h-8 drop-shadow-lg`,strokeWidth:1.5})})},a.id)})]}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-25 transition-all duration-500 ease-in-out
          ${w?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(de,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:u("rally.nearbyStamp")})]})}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-25 transition-all duration-500 ease-in-out
          ${w?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(de,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:u("rally.nearbyStamp")})]})}),!(j||ee)&&e.jsxs("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-25 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm font-semibold flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:u("rally.progress",{collectedCount:ge,totalCount:I})})]}),e.jsxs("button",{onClick:()=>_(!0),className:"fixed top-1/2 -translate-y-1/2 right-0 z-30 py-4 px-2 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-l-lg shadow-lg transition-colors logbook-toggle-button","aria-label":u("rally.logbookToggle"),title:u("rally.logbookToggle"),children:[e.jsx(Ee,{className:"w-5 h-5"}),u("rally.logbookToggle")]}),f&&e.jsx(Je,{location:f,onClose:()=>M(null)}),e.jsx(We,{isOpen:z,onClose:()=>{_(!1)},collections:X,geolocationsWithStamps:O,pendingPlacement:W,onPlace:oe,onRemovePlacement:J,onCancelPlacement:T,stampImageCache:$,onGoToLocation:C})]})};export{lt as default};
