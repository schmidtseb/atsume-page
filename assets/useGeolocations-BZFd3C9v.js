import{r as d}from"./react-vendor-DJ-QoGxu.js";import{d as _,a as E,u as S,i as p,c as k,j as w,k as F}from"./index-DQy-5LOC.js";function L(i){const{user:e}=_(),[u,n]=d.useState([]),[m,g]=d.useState(!0),{addToast:t}=E(),{t:s}=S();d.useEffect(()=>{e!=null&&e.id&&i?(g(!0),p(i).then(o=>n(o)).catch(o=>{console.error("Failed to load geolocations from DB",o),t(s("geolocations.loadErrorToast"),"error")}).finally(()=>g(!1))):(n([]),g(!1))},[e==null?void 0:e.id,i,t,s]);const f=d.useCallback(()=>{e!=null&&e.id&&i&&(g(!0),p(i).then(o=>n(o)).catch(o=>{console.error("Failed to load geolocations from DB",o),t(s("geolocations.loadErrorToast"),"error")}).finally(()=>g(!1)))},[e==null?void 0:e.id,i,t,s]),G=d.useCallback(async o=>{if(!e||!i){t(s("geolocations.loginToast"),"info");return}const l={user_id:e.id,rally_id:i,name:o.name,latitude:o.latitude,longitude:o.longitude,radius:o.radius,description:o.description??null,stamp_id:o.stamp_id??null};n(a=>[...a,{...l,id:"temp-id",created_at:new Date().toISOString()}]);try{const a=await k({user_id:e.id,rally_id:i,name:o.name,latitude:o.latitude,longitude:o.longitude,radius:o.radius,description:o.description??null,stamp_id:o.stamp_id??null});t(s("geolocations.addSuccessToast",{name:a.name}),"success"),n(r=>r.map(c=>c.id==="temp-id"?a:c)),f()}catch(a){console.error("Failed to add geolocation:",a),t(s("geolocations.addErrorToast"),"error"),n(r=>r.filter(c=>c.id!=="temp-id"))}},[e,i,t,s]),T=d.useCallback(async(o,l)=>{const a=[...u];n(r=>r.map(c=>c.id===o?{...c,...l}:c));try{await w(o,l),t(s("geolocations.updateSuccessToast"),"success")}catch(r){console.error("Failed to update geolocation:",r),t(s("geolocations.updateErrorToast"),"error"),n(a)}},[u,t,s]),h=d.useCallback(async o=>{const l=[...u];n(a=>a.filter(r=>r.id!==o));try{await F(o),t(s("geolocations.deleteSuccessToast"),"info")}catch(a){console.error("Failed to delete geolocation:",a),t(s("geolocations.deleteErrorToast"),"error"),n(l)}},[u,t,s]);return{geolocations:u,loading:m,addGeolocation:G,updateGeolocation:T,deleteGeolocation:h}}export{L as u};
