import{r as n,j as I,K as w,N as S}from"./react-vendor-DJ-QoGxu.js";import{b as x}from"./maplibre-gl-vendor-Csyg3Y42.js";import{a as k,u as v}from"./index-DQy-5LOC.js";function L(c,i,o,f){const u=c*Math.PI/180,d=o*Math.PI/180,r=(o-c)*Math.PI/180,a=(f-i)*Math.PI/180,e=Math.sin(r/2)*Math.sin(r/2)+Math.cos(u)*Math.cos(d)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e)))}function N(c,i,o=64){const[f,E]=c,u={latitude:E,longitude:f},d=i/1e3,r=[],a=d/(111.32*Math.cos(u.latitude*Math.PI/180)),e=d/110.574;let h,p,l;for(let m=0;m<o;m++)h=m/o*(2*Math.PI),p=a*Math.cos(h),l=e*Math.sin(h),r.push([u.longitude+p,u.latitude+l]);return r.push(r[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[r]},properties:{}}}const j=({isVisible:c,onMapLoad:i,onGeolocate:o,onMapClick:f,children:E,className:u="",cursor:d="",mapRef:r})=>{const{addToast:a}=k(),{t:e}=v(),[h,p]=n.useState({longitude:-.09,latitude:51.505,zoom:3}),[l,m]=n.useState(!1),P=n.useRef(null),M=r||P,g=n.useRef(null),y=n.useRef(!1),b=t=>{let s=e("mapEditor.locationError.unknown");switch(t.code){case t.PERMISSION_DENIED:s=e("mapEditor.locationError.denied");break;case t.POSITION_UNAVAILABLE:s=e("mapEditor.locationError.unavailable");break;case t.TIMEOUT:s=e("mapEditor.locationError.timeout");break}a(s,"error")},R=n.useCallback(t=>{y.current||(y.current=!0,a(e("mapEditor.centeredToast"),"success")),o==null||o({latitude:t.coords.latitude,longitude:t.coords.longitude})},[a,e,o]),T=n.useCallback(()=>{l||setTimeout(()=>{if(g.current)try{g.current.trigger(),m(!0)}catch(t){console.warn("Failed to trigger geolocation on load:",t)}},500),i==null||i()},[l,i]);return n.useEffect(()=>{if(c&&M.current){const t=setTimeout(()=>{var s;return(s=M.current)==null?void 0:s.getMap().resize()},1);return()=>clearTimeout(t)}},[c,M]),n.useEffect(()=>{if(!l){const t=setTimeout(()=>{if(g.current)try{g.current.trigger(),m(!0)}catch(s){console.warn("Failed to trigger geolocation on mount:",s),(navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad"))&&a(e("mapEditor.iOSLocationPrompt")||"Tap the location button to center on your position","info")}},1e3);return()=>clearTimeout(t)}},[l,a,e]),I.jsx("div",{className:`relative w-full h-full bg-gray-700 ${d} ${u}`,children:I.jsxs(w,{ref:M,mapLib:x,...h,onMove:t=>p(t.viewState),onClick:f,onLoad:T,mapStyle:"https://tiles.openfreemap.org/styles/positron",style:{width:"100%",height:"100%"},children:[I.jsx(S,{ref:g,positionOptions:{enableHighAccuracy:!0,timeout:1e4,maximumAge:0},trackUserLocation:!0,showUserLocation:!0,showAccuracyCircle:!0,fitBoundsOptions:{maxZoom:14},onError:b,onGeolocate:R}),E]})})};export{j as B,N as c,L as g};
