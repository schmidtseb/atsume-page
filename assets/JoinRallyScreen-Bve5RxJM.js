import{j as e,I as N,E as R,y as g,A as j,r as d,R as v,f as C}from"./react-vendor-Duv3WysG.js";import{b as p,u as S,a as k,o as F,q as _}from"./index-DRG4iggM.js";import"./vendor-CFJUWez9.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-BpK5hd46.js";const J=({rally:a,onConfirm:m,onCancel:c,isLoading:t})=>{const{t:r,locale:x}=p(),o=l=>l?new Date(l).toLocaleDateString(x,{year:"numeric",month:"short",day:"numeric"}):r("rallyJoinCard.infinite"),i=`${o(a.start_date)} - ${o(a.end_date)}`;return e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 sm:p-8 border border-gray-700 animate-scale-in text-left",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:a.name}),a.description&&e.jsxs("div",{className:"flex items-start gap-3 mt-4",children:[e.jsx(N,{className:"w-5 h-5 mt-0.5 text-gray-400 flex-shrink-0"}),e.jsx("p",{className:"text-gray-300",children:a.description})]}),(a.start_date||a.end_date)&&e.jsxs("div",{className:"flex items-start gap-3 mt-3",children:[e.jsx(R,{className:"w-5 h-5 mt-0.5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 font-semibold",children:r("rallyJoinCard.duration")}),e.jsx("p",{className:"text-gray-400 text-sm",children:i})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-8",children:[e.jsx("button",{onClick:c,disabled:t,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:r("common.cancel")}),e.jsx("button",{onClick:m,disabled:t,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 text-lg",children:t?e.jsx(g,{className:"w-6 h-6 animate-spin"}):e.jsxs(e.Fragment,{children:[r("joinRally.joinButton")," ",e.jsx(j,{className:"w-5 h-5"})]})})]})]})},U=()=>{const{user:a,setActiveRallyId:m}=S(),{addToast:c}=k(),{t}=p(),[r,x]=d.useState(""),[o,i]=d.useState(!1),[l,u]=d.useState(null),[f,y]=d.useState(null),h=v.useCallback(async s=>{if(s){i(!0),y(null),u(null);try{const n=await F(s);n?u(n):y(t("joinRally.error.notFound"))}catch(n){console.error(n),y(t("joinRally.error.network"))}finally{i(!1)}}},[t]);d.useEffect(()=>{const n=new URLSearchParams(window.location.search).get("join_code");n&&(x(n.toUpperCase()),h(n.toUpperCase()),window.history.replaceState({},document.title,window.location.pathname))},[h]);const b=async()=>{if(!(!a||!l)){i(!0);try{await _({user_id:a.id,rally_id:l.id}),c(t("joinRally.joinSuccess",{name:l.name}),"success"),m(l.id)}catch(s){s.code==="23505"?(c(t("joinRally.error.alreadyJoined"),"info"),m(l.id)):(console.error(s),c(t("joinRally.error.joinFailed"),"error"))}finally{i(!1)}}},w=s=>{s.preventDefault(),h(r)};return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md text-center",children:l?e.jsx(J,{rally:l,onConfirm:b,onCancel:()=>u(null),isLoading:o}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("div",{className:"p-3 bg-yellow-600/20 border-2 border-yellow-500 rounded-full mb-4",children:e.jsx(C,{className:"w-12 h-12 text-yellow-400"})}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:t("joinRally.title")}),e.jsx("p",{className:"text-lg text-gray-300 mt-2",children:t("joinRally.subtitle")})]}),e.jsxs("form",{onSubmit:w,className:"flex flex-col gap-4",children:[e.jsx("input",{type:"text",value:r,onChange:s=>x(s.target.value.toUpperCase()),placeholder:t("joinRally.placeholder"),maxLength:6,className:"w-full bg-gray-800 border border-gray-700 text-white placeholder-gray-500 text-center text-2xl font-mono tracking-[0.5em] px-4 py-3 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:outline-none transition"}),f&&e.jsx("p",{className:"text-red-400 text-sm",children:f}),e.jsx("button",{type:"submit",disabled:o||r.length<6,className:"w-full bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-gray-900 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 text-lg",children:o?e.jsx(g,{className:"w-6 h-6 animate-spin"}):e.jsxs(e.Fragment,{children:[t("joinRally.findButton")," ",e.jsx(j,{className:"w-5 h-5"})]})})]})]})})})};export{U as default};
