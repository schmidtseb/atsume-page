const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-DoV0xLrY.js","assets/react-vendor-XTfPaM14.js","assets/maplibre-gl-vendor-BKez82u8.js","assets/maplibre-gl-vendor-CuCRB34y.css","assets/StampRally-N2-BhTqE.js","assets/Button-BKuiEg7y.js","assets/supabase-vendor-BmfpuRp6.js","assets/StampEditor-CcW1idC1.js","assets/JoinRallyScreen-DOjJ4RUf.js","assets/RallyAdminDashboard-BoVKsT4p.js"])))=>i.map(i=>d[i]);
var At=Object.defineProperty;var Dt=(t,e,a)=>e in t?At(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var Se=(t,e,a)=>Dt(t,typeof e!="symbol"?e+"":e,a);import{j as n,X as Z,I as Pe,T as Lt,C as Ve,r as d,_ as te,S as ve,L as Ft,A as We,G as Ot,a as $t,b as Bt,M as Gt,U as Ut,c as qt,d as Vt,e as Wt,f as De,g as Le,i as ze,k as Jt,l as Je,m as Ke,n as Kt,o as Yt,P as Ht,p as Zt,q as Xt,s as Qt,t as Fe,u as eo,v as to,w as oo,x as ao,R as q,y as no,z as ro,B as Oe,D as so,E as lo}from"./react-vendor-XTfPaM14.js";import{c as io}from"./supabase-vendor-BmfpuRp6.js";import{G as Me,C as _e,i as Te,j as co,k as uo}from"./vendor-DoV0xLrY.js";import{b as mo}from"./maplibre-gl-vendor-BKez82u8.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}})();const go={success:n.jsx(Ve,{className:"w-6 h-6 text-green-400"}),error:n.jsx(Lt,{className:"w-6 h-6 text-red-400"}),info:n.jsx(Pe,{className:"w-6 h-6 text-blue-400"})},ho=({id:t,message:e,type:a,onClose:o})=>n.jsxs("div",{role:"alert",className:"relative w-full max-w-sm mb-4 rounded-lg shadow-2xl bg-gray-800 border border-gray-700 p-4 flex items-start gap-3",children:[n.jsx("div",{className:"flex-shrink-0 mt-0.5",children:go[a]}),n.jsx("div",{className:"flex-1 text-sm font-medium text-gray-200 break-words",children:e}),n.jsx("button",{onClick:()=>o(t),"aria-label":"Close",className:"p-1 -m-1 rounded-full text-gray-500 hover:bg-gray-700 hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 transition-colors",children:n.jsx(Z,{className:"h-4 w-4"})})]}),Ye=d.createContext(void 0),po=({children:t})=>{const[e,a]=d.useState([]),o=d.useCallback(s=>{a(l=>l.filter(i=>i.id!==s))},[]),r=d.useCallback((s,l)=>{a(i=>{const c=i.findIndex(u=>u.message===s&&u.type===l);if(c>-1){const u=[...i],g=u[c];return u.splice(c,1),[...u,{...g,id:Date.now()+Math.random()}]}else return[...i,{id:Date.now()+Math.random(),message:s,type:l}]}),setTimeout(()=>{a(i=>i.filter(c=>!(c.message===s&&c.type===l)))},1500)},[]);return n.jsxs(Ye.Provider,{value:{addToast:r},children:[t,e.length>0&&n.jsx("div",{"aria-live":"assertive",className:"pointer-events-none fixed inset-0 flex items-start justify-end p-4 sm:p-6 z-50",children:n.jsx("div",{className:"w-full max-w-sm",children:e.map(s=>n.jsx("div",{className:"pointer-events-auto",children:n.jsx(ho,{...s,onClose:o})},s.id))})})]})},ge=()=>{const t=d.useContext(Ye);if(t===void 0)throw new Error("useToast must be used within a ToastProvider");return t},He="https://ffwekbhvkurimzfihtwt.supabase.co",Ze="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZmd2VrYmh2a3VyaW16ZmlodHd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzMzY5MzcsImV4cCI6MjA2NzkxMjkzN30.MYqd-BVm8icPGQ0a67vaOe4bbamYa4hhahXGaVdWnEo",U=io(He,Ze);(He.includes("YOUR_SUPABASE_URL")||Ze.includes("YOUR_SUPABASE_ANON_KEY"))&&console.warn("Supabase credentials are not set. Please update YOUR_SUPABASE_URL and YOUR_SUPABASE_ANON_KEY in src/lib/supabaseClient.ts");function Xe(t,e,a,o){const r=o?`Failed to ${e} ${o} in ${a}: ${t.message||"Unknown error"}`:`Failed to ${e} in ${a}: ${t.message||"Unknown error"}`;throw console.error(`Database Error - ${e} ${a}:`,t),new L(r,t,e)}function fo(t){return new Promise(e=>{const a=new Image;a.src=t,a.onload=()=>e(),a.onerror=o=>{console.error("Failed to preload image:",t,o),e()}})}function yo(t,e,a,o){if(t instanceof L)throw t;Xe(t instanceof Error?t:new Error(String(t)),e,a,o)}class he{constructor(e,a){this.supabase=e,this.tableName=a}async _executeDbOperation(e,a,o){try{const{data:r,error:s}=await e;return s&&Xe(s,a,this.tableName,o),r}catch(r){return yo(r,a,this.tableName,o),null}}async create(e,a){const o=this.supabase.from(this.tableName).insert(e).select().single();return await this._executeDbOperation(o,"create",a)}async readById(e,a){const o=this.supabase.from(this.tableName).select().eq("id",e).single(),r=await this._executeDbOperation(o,"readById",a);return r===null?null:r}async readAll(e,a=!0,o,r){let s=this.supabase.from(this.tableName).select("*");if(o)for(const l in o)s=s.eq(l,o[l]);return e&&(s=s.order(e,{ascending:a})),await this._executeDbOperation(s,"readAll",r)}async update(e,a,o,r){let s=this.supabase.from(this.tableName).update(a).eq("id",e).select();if(r)for(const l in r)s=s.eq(l,r[l]);await this._executeDbOperation(s,"update",o)}async delete(e,a,o){let r=this.supabase.from(this.tableName).delete().eq("id",e).select();if(o)for(const s in o)r=r.eq(s,o[s]);await this._executeDbOperation(r,"delete",a)}}function I(t,e){if(t==null||t==="")throw new Error(`${e} is required.`)}function A(t,e){if(!/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(t))throw new Error(`${e} must be a valid UUID.`)}class L extends Error{constructor(e,a,o){super(e),this.originalError=a,this.operation=o,this.name="DatabaseError"}}const pe=new he(U,"stamps"),oe=new he(U,"rallies"),fe=new he(U,"geolocations"),je=new he(U,"collections"),bo=new he(U,"user_rallies");async function ke(t,e,a){const o=await oe.readById(e);if(!o||o.admin_id!==t)throw new L(`Unauthorized to modify this ${a}`)}async function Qe(t,e){return I(t.rally_id,"rally_id"),I(t.name,"name"),A(t.rally_id,"rally_id"),I(e,"adminId"),A(e,"adminId"),await ke(e,t.rally_id,"stamp"),await pe.create(t,"stamp")}async function xo(t){I(t,"rallyId"),A(t,"rallyId");try{return await pe.readAll("created_at",!1,{rally_id:t})}catch(e){throw console.error("getRallyStamps: Error during stampCrud.readAll:",e),e}}async function et(t,e){I(t,"id"),I(e,"adminId"),A(t,"id"),A(e,"adminId");const a=await pe.readById(t);if(!a)throw new L("Stamp not found");return await ke(e,a.rally_id,"stamp"),a}async function wo(t,e){await et(t,e),await pe.delete(t,"stamp")}async function So(t,e,a){I(e,"newName"),await et(t,a),await pe.update(t,{name:e.trim()},"stamp name")}async function vo(t){return I(t.admin_id,"admin_id"),I(t.name,"name"),A(t.admin_id,"admin_id"),await oe.create(t,"rally")}async function tt(t){return I(t,"adminId"),A(t,"adminId"),await oe.readAll("created_at",!1,{admin_id:t})}async function To(t,e,a){I(t,"id"),I(a,"adminId"),A(t,"id"),A(a,"adminId"),await oe.update(t,e,"rally",{admin_id:a})}async function jo(t,e){I(t,"id"),I(e,"adminId"),A(t,"id"),A(e,"adminId"),await oe.delete(t,"rally",{admin_id:e})}async function ko(t){I(t,"accessCode");const e=await oe.readAll("created_at",!1,{access_code:t.trim(),published:!0});return e.length>0?e[0]:null}async function Eo(t){I(t,"userId"),A(t,"userId");try{const{data:e,error:a}=await U.from("user_rallies").select(`
        rally_id,
        rallies (*)
      `).eq("user_id",t);if(a)throw new L(a.message,a,"getUserRallies");return e.map(o=>o.rallies)}catch(e){throw console.error("getUserRallies: Error fetching user rallies:",e),e}}async function Kr(t){var e;I(t.user_id,"user_id"),I(t.rally_id,"rally_id"),A(t.user_id,"user_id"),A(t.rally_id,"rally_id");try{await bo.create(t,"user rally")}catch(a){throw a instanceof L&&((e=a.originalError)==null?void 0:e.code)==="23505"?new L("User is already joined to this rally"):a}}async function ot(t,e){return I(t.rally_id,"rally_id"),I(t.name,"name"),I(e,"adminId"),A(t.rally_id,"rally_id"),A(e,"adminId"),await ke(e,t.rally_id,"geolocation"),await fe.create(t,"geolocation")}async function Co(t){return I(t,"rallyId"),A(t,"rallyId"),await fe.readAll("created_at",!1,{rally_id:t})}async function at(t,e){I(t,"id"),I(e,"adminId"),A(t,"id"),A(e,"adminId");const a=await fe.readById(t);if(!a)throw new L("Geolocation not found");return await ke(e,a.rally_id,"geolocation"),a}async function No(t,e,a){await at(t,a),await fe.update(t,e,"geolocation")}async function Ro(t,e){await at(t,e),await fe.delete(t,"geolocation")}async function Mo(t,e){return I(t,"userId"),I(e,"rallyId"),A(t,"userId"),A(e,"rallyId"),await je.readAll("collected_at",!1,{user_id:t,rally_id:e})}async function $e(t){return I(t.user_id,"user_id"),I(t.rally_id,"rally_id"),I(t.geolocation_id,"geolocation_id"),A(t.user_id,"user_id"),A(t.rally_id,"rally_id"),A(t.geolocation_id,"geolocation_id"),await je.create(t,"collection")}async function Io(t,e,a){I(t,"id"),I(a,"userId"),A(t,"id"),A(a,"userId"),await je.update(t,e,"collection",{user_id:a})}async function _o(t,e){I(t,"id"),I(e,"userId"),A(t,"id"),A(e,"userId"),await je.delete(t,"collection",{user_id:e})}const nt=d.createContext(void 0),Po=({children:t})=>{const[e,a]=d.useState(null),[o,r]=d.useState(null),[s,l]=d.useState(null),[i,c]=d.useState(null),[u,g]=d.useState([]),[h,m]=d.useState(!0),[p,f]=d.useState(null),T=d.useRef(!0),w=d.useCallback(y=>{T.current&&y()},[]),R=d.useCallback(async y=>{try{w(()=>{a(y),f(null)});const S=(y==null?void 0:y.user)??null;if(w(()=>r(S)),S)try{const{data:_,error:z}=await U.from("profiles").select("role").eq("id",S.id).single();if(z&&z.code!=="PGRST116")throw console.error("Error fetching user profile:",z),new Error("Failed to fetch user profile");const M=(_==null?void 0:_.role)||"user";if(w(()=>l(M)),M==="user"){const D=await Eo(S.id);w(()=>{g(D),!i&&D.length>0?c(D[0].id):D.length===0&&c(null)})}else if(S){const D=await tt(S.id);w(()=>{g(D),!i&&D.length>0&&c(D[0].id)})}else w(()=>{g([]),c(null)})}catch(_){console.error("Error processing user profile:",_),w(()=>{l(null),g([]),c(null),f(_ instanceof Error?_.message:"Failed to load user profile")})}else w(()=>{l(null),g([]),c(null)})}catch(S){console.error("Error processing session:",S),w(()=>{f(S instanceof Error?S.message:"Authentication error")})}},[w,i]);d.useEffect(()=>{let y=null;const S=async()=>{try{w(()=>m(!0));const{data:{session:M},error:D}=await U.auth.getSession();if(D){console.error("Error getting session:",D),w(()=>f("Failed to initialize session"));return}await R(M);const{data:{subscription:J}}=U.auth.onAuthStateChange((X,ne)=>{setTimeout(()=>{R(ne)},0)});y=J}catch(M){console.error("Error initializing session:",M),w(()=>{f(M instanceof Error?M.message:"Failed to initialize authentication")})}finally{w(()=>m(!1))}},_=async()=>{if(document.visibilityState==="visible")try{const{data:{session:M},error:D}=await U.auth.getSession();if(D){console.error("Error refreshing session on visibility change:",D),w(()=>f("Failed to refresh session"));return}await R(M)}catch(M){console.error("Caught error during session refresh:",M),w(()=>f(M instanceof Error?M.message:"Failed to refresh session"))}};return(async()=>{const{Capacitor:M}=await te(async()=>{const{Capacitor:D}=await import("./vendor-DoV0xLrY.js").then(J=>J.m);return{Capacitor:D}},__vite__mapDeps([0,1,2,3]));M.isNativePlatform()&&Me.initialize({clientId:"205523053053-htjvp14quvqulhdr835o1r95frgge1eq.apps.googleusercontent.com",scopes:["profile","email"],grantOfflineAccess:!0})})(),S(),document.addEventListener("visibilitychange",_),()=>{T.current=!1,y&&y.unsubscribe(),document.removeEventListener("visibilitychange",_)}},[R,w]);const P=d.useCallback(async()=>{var y;try{w(()=>{f(null),m(!0)});const{Capacitor:S}=await te(async()=>{const{Capacitor:z}=await import("./vendor-DoV0xLrY.js").then(M=>M.m);return{Capacitor:z}},__vite__mapDeps([0,1,2,3]));if(S.isNativePlatform()){const z=await Me.signIn();if((y=z==null?void 0:z.authentication)!=null&&y.idToken){const{error:M}=await U.auth.signInWithIdToken({provider:"google",token:z.authentication.idToken});if(M)throw M}else throw new Error("No ID token received from Google")}else{const{error:z}=await U.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/atsume-page/`,queryParams:{access_type:"offline",prompt:"consent"}}});if(z)throw console.error("Google sign-in error (web):",z),w(()=>f("Failed to sign in with Google (web)")),z}}catch(S){throw console.error("Sign in error:",S),w(()=>{f(S instanceof Error?S.message:"Sign in failed")}),S}finally{w(()=>m(!1))}},[w]),k=d.useCallback(async()=>{try{w(()=>f(null)),_e.isNativePlatform()&&await Me.signOut();const{error:y}=await U.auth.signOut();if(y)throw console.error("Logout error:",y),w(()=>f("Failed to log out")),y}catch(y){throw console.error("Logout error:",y),w(()=>{f(y instanceof Error?y.message:"Logout failed")}),y}},[w]),N={session:e,user:o,role:s,selectedRallyId:i,joinedRallies:u,setSelectedRallyId:c,signInWithGoogle:P,logout:k,loading:h,error:p};return n.jsx(nt.Provider,{value:N,children:t})},ye=()=>{const t=d.useContext(nt);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},zo={save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",add:"Add",close:"Close",confirm:"Confirm",submit:"Submit",submitting:"Submitting...",loading:"Loading...",error:"Error",success:"Success",info:"Info",name:"Name",description:"Description",optional:"optional"},Ao={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Sign In with Google",googleDescription:"Redirects to Google to sign in securely.",signInTitle:"Sign In",createAccountTitle:"Create Account",passwordPlaceholder:"Password",confirmPasswordPlaceholder:"Confirm Password",passwordMismatchError:"Passwords do not match.",signIn:"Sign In",signUp:"Sign Up",toggle:{toSignUp:"Don't have an account? Sign Up",toSignIn:"Already have an account? Sign In"},userMenu:"Open user menu",signedInAs:"Signed in as",logout:"Log Out"},Do={title:"Disclaimer"},Lo={authenticating:"Authenticating...",pleaseWait:"Please wait a moment."},Fo={title:"Atsume",subtitle:"スタンプ集め",tagline:"The interactive stamp pad.",description:"Turn any image into a work of art with a realistic stamp effect.",cta:"Get Started",version:"0.12.0",close:"Close splash screen",impressumTitle:"Imprint",impressumContent:`Responsible according to 5 TMG / 18 MStV: 
Sebastian Schmidt
Private person
Germany
E-Mail: schm.seb@gmail.com`},Oo={stamp:"Stamp Editor",map:"Map Editor",rally:"Stamp Rally",admin:"Admin"},$o={title:"Stamp Parameters",close:"Close parameters panel",canvasControls:"Canvas Controls",changeImage:"Change Image",uploadImage:"Upload Image",addToGallery:"Add to Gallery",addToGalleryTooltip:"Saves the last stamp you made to the gallery",clear:"Clear",download:"Download",resetParameters:"Reset Parameters"},Bo={label:"Presets",savePresetLabel:"Save Current Settings as New Preset",newPresetNamePlaceholder:"New preset name",saveButton:"Save",managePresets:"Manage Presets",savePresetSuccess:'Preset "{{name}}" saved successfully!',savePresetError:"Failed to save preset.",deletePresetSuccess:'Preset "{{name}}" deleted successfully!',deletePresetError:"Failed to delete preset."},Go={posterization:{title:"Posterization & Shape",colors:"Colors",colorsTooltip:"The number of distinct color layers. 'Auto' detects prominent colors automatically.",auto:"Auto",backgroundThreshold:"Background Threshold",backgroundThresholdTooltip:"Pixels brighter than this value are treated as background and ignored.",shapeShrink:"Shape Shrink",shapeShrinkTooltip:"Shrinks each color layer to create gaps and a more distinct layered effect."},registration:{title:"Registration Errors",shift:"Shift",shiftAmountTooltip:"Average amount of horizontal/vertical misalignment between layers.",rotation:"Rotation",rotationAmountTooltip:"Average rotational misalignment between layers.",amount:"Amount",variation:"Variation",variationTooltip:"Randomness in the misalignment amount."},edge:{title:"Edge Effects",width:"Edge Width",widthTooltip:"The thickness of the border area around shapes that can be boosted.",boost:"Edge Boost",boostTooltip:"Increases ink density at the edges of shapes to simulate ink buildup."},wear:{title:"Wear & Tear",intensity:"Wear Intensity",noiseScale:"Noise Scale",inkDepletion:"Ink Depletion",inkDepletionAmountTooltip:"How faded the 'worn out' patches appear.",numPatches:"Num Patches",numPatchesAmountTooltip:"The number of 'worn out' patches.",patchSize:"Patch size",min:"Min",max:"Max"},splats:{title:"Ink Splats",density:"Splat Density",densityTooltip:"Controls the number of ink splats used to draw the image.",size:"Splat size",bleeding:"Bleeding Factor",bleedingTooltip:"Simulates ink bleeding into the paper just outside the stamp's edge."}},Uo={pressureToast:"Pressure sensitivity enabled!",stampingErrorToast:"An error occurred while stamping. See console for details.",canvasClearedToast:"Canvas cleared",downloadErrorToast:"Nothing to download.",loadedStampToast:'Loaded stamp "{{name}}".',newStampToast:"Ready to create a new stamp.",generatingToast:"Generating stamp...",panMode:"Pan Mode Active",galleryToggle:"Open Stamp Gallery",settingsToggle:"Open Parameters Panel",toolbarToggle:"Open Brush Controls",stampingArea:"Stamping area"},qo={title:"Stamp Gallery",close:"Close gallery panel",createNew:"Create New Stamp",empty:"Your gallery is empty.",emptySubtext:"Create a stamp and add it from the parameters panel.",rename:"Rename {{name}}",confirmDelete:"Confirm delete {{name}}",cancelDelete:"Cancel delete"},Vo={title:"Stamp brush controls",hide:"Hide brush controls",size:"Size",sizeTooltip:"Controls the size of the stamp.",intensity:"Intensity",intensityTooltip:"Controls the ink density of the stamp.",pressureMessage:"Intensity is controlled by touch pressure."},Wo={invalidFileToast:"Invalid file type. Please upload an image.",loadedToast:"Image loaded. Click on the paper to stamp!",loadUrlErrorToast:"Failed to load image from URL."},Jo={resetToast:"Settings have been reset to default.",loadedPresetToast:'Loaded settings for "{{name}}".'},Ko={loginToast:"Please log in to save stamps to your gallery.",loadErrorToast:"Could not load your stamp gallery.",addSuccessToast:'"{{name}}" added to your gallery.',addErrorToast:"Could not save stamp.",deleteSuccessToast:"Stamp deleted from gallery.",deleteErrorToast:"Could not delete stamp. Restoring...",renameSuccessToast:'Stamp renamed to "{{name}}".',renameErrorToast:'Could not rename stamp. Reverting to "{{oldName}}".'},Yo={loginToast:"Please log in to save locations.",loadErrorToast:"Could not load your map locations.",addSuccessToast:'Location "{{name}}" saved.',addErrorToast:"Could not save location.",updateSuccessToast:"Location updated.",updateErrorToast:"Could not update location.",deleteSuccessToast:"Location deleted.",deleteErrorToast:"Could not delete location."},Ho={loginToast:"Please log in to collect stamps.",loadErrorToast:"Could not load your collection progress.",addSuccessToast:"Stamp collected! Place it in your log-book.",addErrorToast:"Could not save collection progress.",updateSuccessToast:"Stamp placed in log-book!",updateErrorToast:"Could not save stamp placement.",placementCancelledToast:"Placement was cancelled. Please collect the stamp again.",removePlacementSuccessToast:"Last placement undone. You can place the stamp again.",removePlacementErrorToast:"Could not undo placement."},Zo={addLocation:"Add Location",placeOnMap:"Place on Map",byCoordinates:"By Coordinates",fromOSM:"From OpenStreetMap",batchUpload:"Batch Upload",addLocationToast:"Click on the map to place a new location.",centeredToast:"Map centered on your location.",deleteConfirm:"Are you sure you want to delete this location?",deleteLocationSuccess:"Location deleted successfully!",viewLocation:"View {{name}}",noRallySelectedTitle:"No Rally Selected",noRallySelectedSubtitle:"Please select a rally from the Admin Dashboard to edit its map.",iOSLocationPrompt:"Tap the location button to center on your position",locationError:{denied:"Location access was denied. Please enable it in your browser settings to see your location on the map.",unavailable:"Your location is currently unavailable. Please check your signal and try again.",timeout:"Failed to get your location in time. Please try again.",unknown:"An unknown error occurred while trying to get your location."}},Xo={title:"Batch Upload Locations",dragDrop:"Drag & drop your JSON file here",orClick:"or click to select file",selectedFile:"Selected file",noFileSelected:"No file selected.",invalidFileType:"Invalid file type. Please upload a JSON file.",uploadButton:"Upload",readingFile:"Reading file...",processingItems:"Processing items...",uploadComplete:"Upload complete!",partialSuccess:"{{success}} of {{total}} items uploaded with some errors.",success:"Successfully uploaded {{count}} items.",invalidJson:"Invalid JSON format",uploadFailed:"Upload failed",loginRequired:"Please log in to batch upload locations."},Qo={title:"Enter Coordinates",latitude:"Latitude",longitude:"Longitude",latitudePlaceholder:"e.g., 51.5074",longitudePlaceholder:"e.g., -0.1278",validation:{latRequired:"Latitude is required.",lonRequired:"Longitude is required.",latInvalid:"Latitude must be between -90 and 90.",lonInvalid:"Longitude must be between -180 and 180."},next:"Next"},ea={title:"Import from OpenStreetMap",idLabel:"OpenStreetMap ID",idPlaceholder:"e.g., 236578444 or R146656",helpText:"Enter an ID from OSM. For nodes, you can enter just the number (e.g., `236578444`). For ways/relations, include the prefix (e.g., `R146656`).",import:"Import",importing:"Importing...",error:{invalidId:"Invalid ID. Must be a number, or start with N, W, or R followed by numbers.",notFound:"Location not found for this ID. Please check the ID and try again.",network:"Could not connect to the OpenStreetMap API. Please check your internet connection."}},ta={rallyNotSelectedError:"Error: Rally not selected. Cannot save location.",locationUpdatedSuccess:"Location updated successfully!",locationAddedSuccess:"Location added successfully!",saveLocationError:"Error saving location: {{error}}"},oa={titleAdd:"Add New Location",titleEdit:"Edit Location",namePlaceholder:"Location Name",validationError:"Please enter a name for the location.",radius:"Collection Radius",radiusTooltip:"The distance within which this stamp can be 'collected'.",assignStamp:"Assign a Stamp",noStamp:"No Stamp",loadingStamps:"Loading stamps..."},aa={toggleVisibility:"Toggle Visibility",collected:"Collected",locationStatus:"Status for {{name}}",progress:"{{collectedCount}} / {{totalCount}} Collected",logbookToggle:"Open Log-book",flyingToast:"Flying to {{name}}...",nearbyStamp:"There is a stamp nearby!",iOSLocationPrompt:"Tap the location button to center on your position",collectedStampsToggle:"Open Collected Stamps List",selectRally:"Select Rally",joinAnotherRally:"Join Another Rally",noRallySelected:"No Rally Selected",selectRallyToTestTitle:"Select a Rally to Test",selectRallyToTestSubtitle:"Please go to the Admin Dashboard to choose a rally to test.",outOfReach:"This stamp is out of reach. Move closer to collect it!",locationError:{denied:"Location access was denied. The Stamp Rally requires location to work. Please enable it in your browser settings.",unavailable:"Your location is currently unavailable. Please check your signal and try again.",timeout:"Failed to get your location in time. Please try again.",unknown:"An unknown error occurred while trying to get your location."}},na={title:"Collected Stamps",empty:"You haven't collected any stamps yet.",emptySubtext:"Explore the map to find and collect stamps!",selectStamp:"View {{name}} on map"},ra={close:"Close Log-book",preparingStamp:"Preparing stamp...",pendingPlacement:"Place your newly collected stamp:",pendingPlacementSubtext:"Click to place, or click and drag to rotate.",panMode:"Pan Mode Active",clickToView:"Click to view details",stampingArea:"Log-book Stamping Area",prepareErrorToast:"Could not prepare stamp image.",placeErrorToast:"Failed to place stamp",placedToast:'Placed "{{name}}"',redo:"Redo"},sa={collected:"Stamp Collected!",noImage:"No Stamp Image"},la={stampDesign:"Stamp Design",location:"Location",dateCollected:"Date Collected",goToLocation:"Go to {{name}} on the map"},ia={title:"Locations",toggle:"Toggle Location List",empty:"No locations created yet.",emptySubtext:"Click the '+' button to add your first location.",selectLocation:"View {{name}} on map"},ca={title:"Rally Dashboard",subtitle:"Create and manage your Stamp Rallies.",createButton:"Create New Rally",creating:"Creating...",newRallyName:"New Rally #{{count}}",loadError:"Failed to load rallies.",createSuccess:"New rally created.",createError:"Failed to create rally.",updateSuccess:"Rally updated successfully.",updateError:"Failed to update rally.",deleteConfirm:"Are you sure you want to delete this rally and all its locations? This cannot be undone.",deleteSuccess:"Rally deleted.",deleteError:"Failed to delete rally.",noDescription:"No description provided.",accessCode:"Access Code",status:"Status",published:"Published",draft:"Draft",manageRally:"Manage",backToDashboard:"Back to Dashboard",editing:"Editing",selectRallyPromptTitle:"Select a Rally",selectRallyPromptSubtitle:"Choose a rally from the dashboard to edit its map or test it."},da={title:"Join a Rally",subtitle:"Enter an access code to get started.",placeholder:"ABCDEF",findButton:"Find Rally",joinButton:"Join Rally",joinSuccess:'Successfully joined "{{name}}"!',error:{notFound:"No published rally found with that code.",network:"Could not connect to the server. Please try again.",joinFailed:"Failed to join the rally.",alreadyJoined:"You have already joined this rally."}},ua={duration:"Duration",infinite:"Infinite"},ma={common:zo,auth:Ao,disclaimer:Do,loadingScreen:Lo,splashScreen:Fo,modeToggle:Oo,rightSidebar:$o,presetSelector:Bo,settingsSections:Go,stampEditor:Uo,stampGallery:qo,stampToolbar:Vo,imageLoader:Wo,stampSettings:Jo,gallery:Ko,geolocations:Yo,collections:Ho,mapEditor:Zo,batchUpload:Xo,coordInputModal:Qo,osmImportModal:ea,locationModals:ta,locationEditModal:oa,rally:aa,collectedStampsList:na,logbook:ra,stampDetailModal:sa,collectionDetailModal:la,locationList:ia,rallyAdmin:ca,joinRally:da,rallyJoinCard:ua},ga={save:"保存",cancel:"キャンセル",delete:"削除",edit:"編集",add:"追加",close:"閉じる",confirm:"確認",submit:"送信",submitting:"送信中...",loading:"読み込み中...",error:"エラー",success:"成功",info:"情報",name:"名前",description:"説明",optional:"任意"},ha={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Googleでサインイン",googleDescription:"Googleにリダイレクトして安全にサインインします。",signInTitle:"サインイン",createAccountTitle:"アカウント作成",passwordPlaceholder:"パスワード",confirmPasswordPlaceholder:"パスワード（確認）",passwordMismatchError:"パスワードが一致しません。",signIn:"サインイン",signUp:"サインアップ",toggle:{toSignUp:"アカウントをお持ちでないですか？ サインアップ",toSignIn:"すでにアカウントをお持ちですか？ サインイン"},userMenu:"ユーザーメニューを開く",signedInAs:"サインイン中:",logout:"ログアウト"},pa={title:"免責事項"},fa={authenticating:"認証中...",pleaseWait:"しばらくお待ちください。"},ya={title:"Atsume",subtitle:"スタンプ集め",tagline:"インタラクティブ・スタンプパッド",description:"どんな画像もリアルなスタンプ効果でアート作品に変身させます。",cta:"はじめる",version:"バージョン {{version}}",close:"スプラッシュスクリーンを閉じる",impressumTitle:"インプリント",impressumContent:`責任者（§ 5 TMG / § 18 MStVによる）：
Sebastian Schmidt
個人事業主
ドイツ
Eメール：schm.seb@gmail.com`},ba={stamp:"スタンプエディター",map:"マップエディター",rally:"スタンプラリー",admin:"管理"},xa={title:"スタンプ設定",close:"設定パネルを閉じる",canvasControls:"キャンバス操作",changeImage:"画像を変更",uploadImage:"画像をアップロード",addToGallery:"ギャラリーに追加",addToGalleryTooltip:"最後に作成したスタンプをギャラリーに保存します",clear:"クリア",download:"ダウンロード",resetParameters:"設定をリセット"},wa={label:"プリセット",savePresetLabel:"現在の設定を新しいプリセットとして保存",newPresetNamePlaceholder:"新しいプリセット名",saveButton:"保存",managePresets:"プリセットを管理",savePresetSuccess:"プリセット「{{name}}」が正常に保存されました！",savePresetError:"プリセットの保存に失敗しました。",deletePresetSuccess:"プリセット「{{name}}」が正常に削除されました！",deletePresetError:"プリセットの削除に失敗しました。"},Sa={posterization:{title:"ポスタリゼーションと形状",colors:"色数",colorsTooltip:"個別のカラーレイヤーの数。「自動」は主要な色を自動的に検出します。",auto:"自動",backgroundThreshold:"背景のしきい値",backgroundThresholdTooltip:"この値より明るいピクセルは背景として無視されます。",shapeShrink:"形状の縮小",shapeShrinkTooltip:"各カラーレイヤーを縮小して隙間を作り、より明確なレイヤー効果を生み出します。"},registration:{title:"版ズレ",shift:"ずれ",shiftAmountTooltip:"レイヤー間の水平/垂直方向のずれの平均量。",rotation:"回転",rotationAmountTooltip:"レイヤー間の回転のずれの平均量。",amount:"量",variation:"ばらつき",variationTooltip:"ずれの量のランダム性。"},edge:{title:"エッジ効果",width:"エッジの幅",widthTooltip:"形状の境界線の太さ。この範囲が強調されます。",boost:"エッジの強調",boostTooltip:"形状の端のインク濃度を上げて、インクの溜まりをシミュレートします。"},wear:{title:"かすれ",intensity:"かすれの強さ",noiseScale:"ノイズのスケール",inkDepletion:"インクの枯渇",inkDepletionAmountTooltip:"「使い古された」パッチがどれだけ色褪せて見えるか。",numPatches:"パッチの数",numPatchesAmountTooltip:"「使い古された」パッチの数。",patchSize:"パッチのサイズ",min:"最小",max:"最大"},splats:{title:"インクの飛び散り",density:"インクの密度",densityTooltip:"画像の描画に使用されるインクの点の数を制御します。",size:"インクのサイズ",bleeding:"にじみ",bleedingTooltip:"スタンプの端の外側でインクが紙ににじむのをシミュレートします。"}},va={pressureToast:"筆圧感知が有効になりました！",stampingErrorToast:"スタンプ作成中にエラーが発生しました。詳細はコンソールを確認してください。",canvasClearedToast:"キャンバスをクリアしました",downloadErrorToast:"ダウンロードするものがありません。",loadedStampToast:"スタンプ「{{name}}」を読み込みました。",newStampToast:"新しいスタンプを作成する準備ができました。",generatingToast:"スタンプを生成中...",panMode:"パンモード有効",galleryToggle:"スタンプギャラリーを開く",settingsToggle:"設定パネルを開く",toolbarToggle:"ブラシコントロールを開く",stampingArea:"スタンプエリア"},Ta={title:"スタンプギャラリー",close:"ギャラリーパネルを閉じる",createNew:"新しいスタンプを作成",empty:"ギャラリーは空です。",emptySubtext:"スタンプを作成し、設定パネルから追加してください。",rename:"{{name}}の名前を変更",confirmDelete:"{{name}}の削除を確認",cancelDelete:"削除をキャンセル"},ja={title:"スタンプブラシコントロール",hide:"ブラシコントロールを隠す",size:"サイズ",sizeTooltip:"スタンプのサイズを制御します。",intensity:"インク濃度",intensityTooltip:"スタンプのインク濃度を制御します。",pressureMessage:"インク濃度は筆圧で制御されます。"},ka={invalidFileToast:"無効なファイルタイプです。画像をアップロードしてください。",loadedToast:"画像を読み込みました。紙の上をクリックしてスタンプしてください！",loadUrlErrorToast:"URLからの画像の読み込みに失敗しました。"},Ea={resetToast:"設定をデフォルトにリセットしました。",loadedPresetToast:"「{{name}}」の設定を読み込みました。"},Ca={loginToast:"ギャラリーにスタンプを保存するにはログインしてください。",loadErrorToast:"スタンプギャラリーの読み込みに失敗しました。",addSuccessToast:"「{{name}}」をギャラリーに追加しました。",addErrorToast:"スタンプを保存できませんでした。",deleteSuccessToast:"ギャラリーからスタンプを削除しました。",deleteErrorToast:"スタンプを削除できませんでした。元に戻しています...",renameSuccessToast:"スタンプ名を「{{name}}」に変更しました。",renameErrorToast:"スタンプ名を変更できませんでした。「{{oldName}}」に戻しています。"},Na={loginToast:"場所を保存するにはログインしてください。",loadErrorToast:"マップの場所の読み込みに失敗しました。",addSuccessToast:"場所「{{name}}」を保存しました。",addErrorToast:"場所を保存できませんでした。",updateSuccessToast:"場所を更新しました。",updateErrorToast:"場所を更新できませんでした。",deleteSuccessToast:"場所を削除しました。",deleteErrorToast:"場所を削除できませんでした。"},Ra={loginToast:"スタンプを収集するにはログインしてください。",loadErrorToast:"収集の進捗の読み込みに失敗しました。",addSuccessToast:"スタンプを収集しました！ログブックに配置してください。",addErrorToast:"収集の進捗を保存できませんでした。",updateSuccessToast:"スタンプをログブックに配置しました！",updateErrorToast:"スタンプの配置を保存できませんでした。",placementCancelledToast:"配置がキャンセルされました。スタンプを再度収集してください。",removePlacementSuccessToast:"最後の配置を取り消しました。スタンプを再度配置できます。",removePlacementErrorToast:"配置の取り消しに失敗しました。"},Ma={addLocation:"場所を追加",placeOnMap:"地図上で配置",byCoordinates:"座標で入力",fromOSM:"OpenStreetMapから",batchUpload:"一括アップロード",addLocationToast:"マップをクリックして新しい場所を配置してください。",centeredToast:"あなたの位置にマップを中央揃えしました。",deleteConfirm:"この場所を本当に削除しますか？",deleteLocationSuccess:"場所が正常に削除されました！",viewLocation:"{{name}}を表示",noRallySelectedTitle:"ラリーが選択されていません",noRallySelectedSubtitle:"管理ダッシュボードからラリーを選択して、その地図を編集してください。",iOSLocationPrompt:"位置情報ボタンをタップして現在地に中央揃えしてください",locationError:{denied:"位置情報へのアクセスが拒否されました。マップ上であなたの位置を表示するには、ブラウザの設定で有効にしてください。",unavailable:"現在、あなたの位置は利用できません。電波状況を確認して再試行してください。",timeout:"時間内にあなたの位置を取得できませんでした。再試行してください。",unknown:"位置情報の取得中に不明なエラーが発生しました。"}},Ia={title:"場所の一括アップロード",dragDrop:"JSONファイルをここにドラッグ＆ドロップ",orClick:"またはクリックしてファイルを選択",selectedFile:"選択されたファイル",noFileSelected:"ファイルが選択されていません。",invalidFileType:"無効なファイルタイプです。JSONファイルをアップロードしてください。",uploadButton:"アップロード",readingFile:"ファイルを読み込み中...",processingItems:"アイテムを処理中...",uploadComplete:"アップロード完了！",partialSuccess:"{{total}}件中{{success}}件のアイテムがエラーありでアップロードされました。",success:"{{count}}件のアイテムが正常にアップロードされました。",invalidJson:"無効なJSON形式",uploadFailed:"アップロードに失敗しました",loginRequired:"場所を一括アップロードするにはログインしてください。"},_a={title:"座標を入力",latitude:"緯度",longitude:"経度",latitudePlaceholder:"例: 35.6895",longitudePlaceholder:"例: 139.6917",validation:{latRequired:"緯度は必須です。",lonRequired:"経度は必須です。",latInvalid:"緯度は-90から90の間でなければなりません。",lonInvalid:"経度は-180から180の間でなければなりません。"},next:"次へ"},Pa={title:"OpenStreetMapからインポート",idLabel:"OpenStreetMap ID",idPlaceholder:"例: 236578444 または R146656",helpText:"OSMのIDを入力します。ノードの場合は数字のみ入力できます (例: `236578444`)。ウェイ/リレーションの場合は接頭辞を含めてください (例: `R146656`)。",import:"インポート",importing:"インポート中...",error:{invalidId:"無効なIDです。数字、またはN、W、Rで始まり数字が続く形式で入力してください。",notFound:"このIDの場所が見つかりませんでした。IDを確認して再試行してください。",network:"OpenStreetMap APIに接続できませんでした。インターネット接続を確認してください。"}},za={rallyNotSelectedError:"エラー：ラリーが選択されていません。場所を保存できません。",locationUpdatedSuccess:"場所が正常に更新されました！",locationAddedSuccess:"場所が正常に追加されました！",saveLocationError:"場所の保存中にエラーが発生しました：{{error}}"},Aa={titleAdd:"新しい場所を追加",titleEdit:"場所を編集",namePlaceholder:"場所の名前",validationError:"場所の名前を入力してください。",radius:"収集半径",radiusTooltip:"このスタンプを「収集」できる距離。",assignStamp:"スタンプを割り当て",noStamp:"スタンプなし",loadingStamps:"スタンプを読み込み中..."},Da={toggleVisibility:"表示を切り替える",collected:"収集済み",locationStatus:"{{name}}のステータス",progress:"収集済み {{collectedCount}} / {{totalCount}}",logbookToggle:"ログブックを開く",flyingToast:"{{name}}へ移動中...",nearbyStamp:"近くにスタンプがあります！",iOSLocationPrompt:"位置情報ボタンをタップして現在地に中央揃えしてください",collectedStampsToggle:"収集済みスタンプリストを開く",selectRally:"ラリーを選択",joinAnotherRally:"別のラリーに参加",noRallySelected:"ラリーが選択されていません",selectRallyToTestTitle:"テストするラリーを選択",selectRallyToTestSubtitle:"管理ダッシュボードからテストしたいラリーを選択してください。",outOfReach:"このスタンプは範囲外です。収集するにはもっと近づいてください！",locationError:{denied:"位置情報へのアクセスが拒否されました。スタンプラリーは位置情報が必要です。ブラウザの設定で有効にしてください。",unavailable:"現在、あなたの位置は利用できません。電波状況を確認して再試行してください。",timeout:"時間内にあなたの位置を取得できませんでした。再試行してください。",unknown:"位置情報の取得中に不明なエラーが発生しました。"}},La={close:"ログブックを閉じる",preparingStamp:"スタンプを準備中...",pendingPlacement:"新しく収集したスタンプを配置してください：",pendingPlacementSubtext:"クリックで配置、クリック＆ドラッグで回転します。",panMode:"パンモード有効",clickToView:"クリックして詳細を表示",stampingArea:"ログブックのスタンプエリア",prepareErrorToast:"スタンプ画像を準備できませんでした。",placeErrorToast:"スタンプを配置できませんでした。",placedToast:"「{{name}}」を配置しました",redo:"やり直し"},Fa={collected:"スタンプ収集済み！",noImage:"スタンプ画像なし"},Oa={stampDesign:"スタンプデザイン",location:"場所",dateCollected:"収集日",goToLocation:"マップで{{name}}に移動"},$a={title:"場所リスト",toggle:"場所リストの表示/非表示",empty:"まだ場所が作成されていません。",emptySubtext:"「+」ボタンをクリックして最初の場所を追加してください。",selectLocation:"マップで「{{name}}」を表示"},Ba={title:"ラリー管理ダッシュボード",subtitle:"スタンプラリーを作成・管理します。",createButton:"新しいラリーを作成",creating:"作成中...",newRallyName:"新しいラリー #{{count}}",loadError:"ラリーの読み込みに失敗しました。",createSuccess:"新しいラリーが作成されました。",createError:"ラリーの作成に失敗しました。",updateSuccess:"ラリーを正常に更新しました。",updateError:"ラリーの更新に失敗しました。",deleteConfirm:"このラリーとそのすべての場所を本当に削除しますか？この操作は元に戻せません。",deleteSuccess:"ラリーを削除しました。",deleteError:"ラリーの削除に失敗しました。",noDescription:"説明がありません。",accessCode:"参加コード",status:"ステータス",published:"公開中",draft:"下書き",manageRally:"管理",backToDashboard:"ダッシュボードに戻る",editing:"編集中",selectRallyPromptTitle:"ラリーを選択",selectRallyPromptSubtitle:"ダッシュボードからラリーを選択して、地図を編集したりテストしたりします。"},Ga={title:"ラリーに参加",subtitle:"参加コードを入力して始めましょう。",placeholder:"ABCDEF",findButton:"ラリーを探す",joinButton:"ラリーに参加",joinSuccess:"「{{name}}」に無事参加しました！",error:{notFound:"そのコードの公開ラリーが見つかりませんでした。",network:"サーバーに接続できませんでした。もう一度お試しください。",joinFailed:"ラリーへの参加に失敗しました。",alreadyJoined:"すでにこのラリーに参加しています。"}},Ua={duration:"開催期間",infinite:"無期限"},qa={common:ga,auth:ha,disclaimer:pa,loadingScreen:fa,splashScreen:ya,modeToggle:ba,rightSidebar:xa,presetSelector:wa,settingsSections:Sa,stampEditor:va,stampGallery:Ta,stampToolbar:ja,imageLoader:ka,stampSettings:Ea,gallery:Ca,geolocations:Na,collections:Ra,mapEditor:Ma,batchUpload:Ia,coordInputModal:_a,osmImportModal:Pa,locationModals:za,locationEditModal:Aa,rally:Da,logbook:La,stampDetailModal:Fa,collectionDetailModal:Oa,locationList:$a,rallyAdmin:Ba,joinRally:Ga,rallyJoinCard:Ua},Va={save:"Speichern",cancel:"Abbrechen",delete:"Löschen",edit:"Bearbeiten",add:"Hinzufügen",close:"Schließen",confirm:"Bestätigen",submit:"Senden",submitting:"Wird gesendet...",loading:"Lädt...",error:"Fehler",success:"Erfolg",info:"Info",name:"Name",description:"Beschreibung",optional:"optional"},Wa={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Mit Google anmelden",googleDescription:"Leitet zu Google weiter, um sich sicher anzumelden.",signInTitle:"Anmelden",createAccountTitle:"Konto erstellen",passwordPlaceholder:"Passwort",confirmPasswordPlaceholder:"Passwort bestätigen",passwordMismatchError:"Passwörter stimmen nicht überein.",signIn:"Anmelden",signUp:"Registrieren",toggle:{toSignUp:"Noch kein Konto? Registrieren",toSignIn:"Bereits ein Konto? Anmelden"},userMenu:"Benutzermenü öffnen",signedInAs:"Angemeldet als",logout:"Abmelden"},Ja={title:"Haftungsausschluss"},Ka={authenticating:"Authentifiziere...",pleaseWait:"Bitte warten Sie einen Moment."},Ya={title:"Atsume",subtitle:"スタンプ集め",tagline:"Das interaktive Stempelkissen.",description:"Verwandeln Sie jedes Bild in ein Kunstwerk mit einem realistischen Stempel-Effekt.",cta:"Los geht's",version:"0.12.0",close:"Splash-Screen schließen",impressumTitle:"Impressum",impressumContent:`Verantwortlich gemäß § 5 TMG / § 18 MStV: 
Sebastian Schmidt
Privatperson
Deutschland
E-Mail: schm.seb@gmail.com`},Ha={stamp:"Stempel-Editor",map:"Karten-Editor",rally:"Stempel-Rallye",admin:"Admin"},Za={title:"Stempel-Parameter",close:"Parameter-Panel schließen",canvasControls:"Leinwand-Steuerung",changeImage:"Bild ändern",uploadImage:"Bild hochladen",addToGallery:"Zur Galerie hinzufügen",addToGalleryTooltip:"Speichert den zuletzt erstellten Stempel in der Galerie",clear:"Löschen",download:"Herunterladen",resetParameters:"Parameter zurücksetzen"},Xa={label:"Voreinstellungen",savePresetLabel:"Aktuelle Einstellungen als neue Voreinstellung speichern",newPresetNamePlaceholder:"Name der neuen Voreinstellung",saveButton:"Speichern",managePresets:"Voreinstellungen verwalten",savePresetSuccess:'Voreinstellung "{{name}}" erfolgreich gespeichert!',savePresetError:"Fehler beim Speichern der Voreinstellung.",deletePresetSuccess:'Voreinstellung "{{name}}" erfolgreich gelöscht!',deletePresetError:"Fehler beim Löschen der Voreinstellung."},Qa={posterization:{title:"Posterisierung & Form",colors:"Farben",colorsTooltip:"Die Anzahl der verschiedenen Farbschichten. 'Auto' erkennt prominente Farben automatisch.",auto:"Auto",backgroundThreshold:"Hintergrund-Schwellenwert",backgroundThresholdTooltip:"Pixel, die heller als dieser Wert sind, werden als Hintergrund behandelt und ignoriert.",shapeShrink:"Form verkleinern",shapeShrinkTooltip:"Verkleinert jede Farbschicht, um Lücken und einen deutlicheren Schichteffekt zu erzeugen."},registration:{title:"Registrierungsfehler",shift:"Verschiebung",shiftAmountTooltip:"Durchschnittliche horizontale/vertikale Fehlausrichtung zwischen den Schichten.",rotation:"Rotation",rotationAmountTooltip:"Durchschnittliche rotatorische Fehlausrichtung zwischen den Schichten.",amount:"Betrag",variation:"Variation",variationTooltip:"Zufälligkeit im Fehlausrichtungsbetrag."},edge:{title:"Randeffekte",width:"Randbreite",widthTooltip:"Die Dicke des Randbereichs um Formen, der verstärkt werden kann.",boost:"Randverstärkung",boostTooltip:"Erhöht die Farbdichte an den Rändern von Formen, um Tintenansammlungen zu simulieren."},wear:{title:"Abnutzung",intensity:"Abnutzungsintensität",noiseScale:"Rauschskala",inkDepletion:"Tintenverlust",inkDepletionAmountTooltip:"Wie verblasst die 'abgenutzten' Stellen erscheinen.",numPatches:"Anzahl der Flecken",numPatchesAmountTooltip:"Die Anzahl der 'abgenutzten' Flecken.",patchSize:"Fleckengröße",min:"Min",max:"Max"},splats:{title:"Tintenspritzer",density:"Spritzerdichte",densityTooltip:"Steuert die Anzahl der Tintenkleckse, die zum Zeichnen des Bildes verwendet werden.",size:"Spritzergröße",bleeding:"Ausblutungsfaktor",bleedingTooltip:"Simuliert das Ausbluten von Tinte in das Papier direkt außerhalb des Stempelrandes."}},en={pressureToast:"Druckempfindlichkeit aktiviert!",stampingErrorToast:"Beim Stempeln ist ein Fehler aufgetreten. Details in der Konsole.",canvasClearedToast:"Leinwand geleert",downloadErrorToast:"Nichts zum Herunterladen.",loadedStampToast:'Stempel "{{name}}" geladen.',newStampToast:"Bereit, einen neuen Stempel zu erstellen.",generatingToast:"Stempel wird generiert...",panMode:"Schwenkmodus aktiv",galleryToggle:"Stempelgalerie öffnen",settingsToggle:"Parameter-Panel öffnen",toolbarToggle:"Pinsel-Steuerung öffnen",stampingArea:"Stempelbereich"},tn={title:"Stempelgalerie",close:"Galerie-Panel schließen",createNew:"Neuen Stempel erstellen",empty:"Deine Galerie ist leer.",emptySubtext:"Erstelle einen Stempel und füge ihn über das Parameter-Panel hinzu.",rename:"{{name}} umbenennen",confirmDelete:"{{name}} wirklich löschen?",cancelDelete:"Löschen abbrechen"},on={title:"Stempel-Pinsel-Steuerung",hide:"Pinsel-Steuerung ausblenden",size:"Größe",sizeTooltip:"Steuert die Größe des Stempels.",intensity:"Intensität",intensityTooltip:"Steuert die Farbdichte des Stempels.",pressureMessage:"Intensität wird durch den Druck gesteuert."},an={invalidFileToast:"Ungültiger Dateityp. Bitte lade ein Bild hoch.",loadedToast:"Bild geladen. Klicke auf das Papier, um zu stempeln!",loadUrlErrorToast:"Fehler beim Laden des Bildes von der URL."},nn={resetToast:"Einstellungen wurden auf Standard zurückgesetzt.",loadedPresetToast:'Einstellungen für "{{name}}" geladen.'},rn={loginToast:"Bitte melde dich an, um Stempel in deiner Galerie zu speichern.",loadErrorToast:"Deine Stempelgalerie konnte nicht geladen werden.",addSuccessToast:'"{{name}}" wurde deiner Galerie hinzugefügt.',addErrorToast:"Stempel konnte nicht gespeichert werden.",deleteSuccessToast:"Stempel aus Galerie gelöscht.",deleteErrorToast:"Stempel konnte nicht gelöscht werden. Wiederherstellung...",renameSuccessToast:'Stempel umbenannt zu "{{name}}".',renameErrorToast:'Stempel konnte nicht umbenannt werden. Zurücksetzen auf "{{oldName}}".'},sn={loginToast:"Bitte melde dich an, um Orte zu speichern.",loadErrorToast:"Deine Kartenorte konnten nicht geladen werden.",addSuccessToast:'Ort "{{name}}" gespeichert.',addErrorToast:"Ort konnte nicht gespeichert werden.",updateSuccessToast:"Ort aktualisiert.",updateErrorToast:"Ort konnte nicht aktualisiert werden.",deleteSuccessToast:"Ort gelöscht.",deleteErrorToast:"Ort konnte nicht gelöscht werden."},ln={loginToast:"Bitte melde dich an, um Stempel zu sammeln.",loadErrorToast:"Dein Sammlungsfortschritt konnte nicht geladen werden.",addSuccessToast:"Stempel gesammelt! Platziere ihn in deinem Logbuch.",addErrorToast:"Sammlungsfortschritt konnte nicht gespeichert werden.",updateSuccessToast:"Stempel im Logbuch platziert!",updateErrorToast:"Stempelplatzierung konnte nicht gespeichert werden.",placementCancelledToast:"Platzierung wurde abgebrochen. Bitte sammle den Stempel erneut.",removePlacementSuccessToast:"Letzte Platzierung rückgängig gemacht. Du kannst den Stempel erneut platzieren.",removePlacementErrorToast:"Platzierung konnte nicht rückgängig gemacht werden."},cn={addLocation:"Ort hinzufügen",placeOnMap:"Auf Karte platzieren",byCoordinates:"Nach Koordinaten",fromOSM:"Von OpenStreetMap",batchUpload:"Massen-Upload",addLocationToast:"Klicke auf die Karte, um einen neuen Ort zu platzieren.",centeredToast:"Karte auf deinen Standort zentriert.",deleteConfirm:"Möchtest du diesen Ort wirklich löschen?",deleteLocationSuccess:"Ort erfolgreich gelöscht!",viewLocation:"{{name}} ansehen",noRallySelectedTitle:"Keine Rallye ausgewählt",noRallySelectedSubtitle:"Bitte wähle eine Rallye aus dem Admin-Dashboard, um deren Karte zu bearbeiten.",iOSLocationPrompt:"Tippe auf den Standort-Button, um dich auf deiner Position zu zentrieren",locationError:{denied:"Standortzugriff wurde verweigert. Bitte aktiviere ihn in deinen Browser-Einstellungen, um deinen Standort auf der Karte zu sehen.",unavailable:"Dein Standort ist derzeit nicht verfügbar. Bitte überprüfe dein Signal und versuche es erneut.",timeout:"Dein Standort konnte nicht rechtzeitig ermittelt werden. Bitte versuche es erneut.",unknown:"Ein unbekannter Fehler ist beim Versuch, deinen Standort zu ermitteln, aufgetreten."}},dn={title:"Orte im Stapel hochladen",dragDrop:"JSON-Datei hierher ziehen & ablegen",orClick:"oder klicken, um Datei auszuwählen",selectedFile:"Ausgewählte Datei",noFileSelected:"Keine Datei ausgewählt.",invalidFileType:"Ungültiger Dateityp. Bitte lade eine JSON-Datei hoch.",uploadButton:"Hochladen",readingFile:"Datei wird gelesen...",processingItems:"Elemente werden verarbeitet...",uploadComplete:"Upload abgeschlossen!",partialSuccess:"{{success}} von {{total}} Elementen mit Fehlern hochgeladen.",success:"Erfolgreich {{count}} Elemente hochgeladen.",invalidJson:"Ungültiges JSON-Format",uploadFailed:"Upload fehlgeschlagen",loginRequired:"Bitte melde dich an, um Orte im Stapel hochzuladen."},un={title:"Koordinaten eingeben",latitude:"Breitengrad",longitude:"Längengrad",latitudePlaceholder:"z.B. 51.5074",longitudePlaceholder:"z.B. -0.1278",validation:{latRequired:"Breitengrad ist erforderlich.",lonRequired:"Längengrad ist erforderlich.",latInvalid:"Breitengrad muss zwischen -90 und 90 liegen.",lonInvalid:"Längengrad muss zwischen -180 und 180 liegen."},next:"Weiter"},mn={title:"Aus OpenStreetMap importieren",idLabel:"OpenStreetMap ID",idPlaceholder:"z.B. 236578444 oder R146656",helpText:"Geben Sie eine ID von OSM ein. Für Knoten können Sie nur die Nummer eingeben (z.B. `236578444`). Für Wege/Relationen fügen Sie das Präfix hinzu (z.B. `R146656`).",import:"Importieren",importing:"Importiere...",error:{invalidId:"Ungültige ID. Muss eine Zahl sein oder mit N, W oder R gefolgt von Zahlen beginnen.",notFound:"Ort für diese ID nicht gefunden. Bitte überprüfen Sie die ID und versuchen Sie es erneut.",network:"Verbindung zur OpenStreetMap API konnte nicht hergestellt werden. Bitte überprüfen Sie Ihre Internetverbindung."}},gn={rallyNotSelectedError:"Fehler: Rallye nicht ausgewählt. Ort kann nicht gespeichert werden.",locationUpdatedSuccess:"Ort erfolgreich aktualisiert!",locationAddedSuccess:"Ort erfolgreich hinzugefügt!",saveLocationError:"Fehler beim Speichern des Ortes: {{error}}"},hn={titleAdd:"Neuen Ort hinzufügen",titleEdit:"Ort bearbeiten",namePlaceholder:"Ortsname",validationError:"Bitte geben Sie einen Namen für den Ort ein.",radius:"Sammelradius",radiusTooltip:"Die Entfernung, innerhalb der dieser Stempel 'gesammelt' werden kann.",assignStamp:"Stempel zuweisen",noStamp:"Kein Stempel",loadingStamps:"Stempel werden geladen..."},pn={toggleVisibility:"Sichtbarkeit umschalten",collected:"Gesammelt",locationStatus:"Status für {{name}}",progress:"{{collectedCount}} / {{totalCount}} Gesammelt",logbookToggle:"Logbuch öffnen",flyingToast:"Fliege zu {{name}}...",nearbyStamp:"Ein Stempel ist in der Nähe!",iOSLocationPrompt:"Tippe auf den Standort-Button, um dich auf deiner Position zu zentrieren",collectedStampsToggle:"Gesammelte Stempel-Liste öffnen",selectRally:"Rallye auswählen",joinAnotherRally:"Einer anderen Rallye beitreten",noRallySelected:"Keine Rallye ausgewählt",selectRallyToTestTitle:"Wähle eine Rallye zum Testen",selectRallyToTestSubtitle:"Bitte gehe zum Admin-Dashboard, um eine Rallye zum Testen auszuwählen.",outOfReach:"Dieser Stempel ist außer Reichweite. Näher herangehen, um ihn zu sammeln!",locationError:{denied:"Standortzugriff wurde verweigert. Die Stempel-Rallye benötigt den Standort, um zu funktionieren. Bitte aktiviere ihn in deinen Browser-Einstellungen.",unavailable:"Dein Standort ist derzeit nicht verfügbar. Bitte überprüfe dein Signal und versuche es erneut.",timeout:"Dein Standort konnte nicht rechtzeitig ermittelt werden. Bitte versuche es erneut.",unknown:"Ein unbekannter Fehler ist beim Versuch, deinen Standort zu ermitteln, aufgetreten."}},fn={title:"Gesammelte Stempel",empty:"Du hast noch keine Stempel gesammelt.",emptySubtext:"Erkunde die Karte, um Stempel zu finden und zu sammeln!",selectStamp:"{{name}} auf Karte ansehen"},yn={close:"Logbuch schließen",preparingStamp:"Stempel wird vorbereitet...",pendingPlacement:"Platziere deinen neu gesammelten Stempel:",pendingPlacementSubtext:"Klicken zum Platzieren, oder klicken und ziehen zum Drehen.",panMode:"Schwenkmodus aktiv",clickToView:"Klicken zum Anzeigen der Details",stampingArea:"Logbuch-Stempelbereich",prepareErrorToast:"Stempelbild konnte nicht vorbereitet werden.",placeErrorToast:"Stempel konnte nicht platziert werden",placedToast:'Platziert "{{name}}"',redo:"Wiederholen"},bn={collected:"Stempel gesammelt!",noImage:"Kein Stempelbild"},xn={stampDesign:"Stempeldesign",location:"Ort",dateCollected:"Datum gesammelt",goToLocation:"Gehe zu {{name}} auf der Karte"},wn={title:"Orte",toggle:"Ortsliste umschalten",empty:"Noch keine Orte erstellt.",emptySubtext:"Klicke auf den '+' Button, um deinen ersten Ort hinzuzufügen.",selectLocation:"{{name}} auf Karte ansehen"},Sn={title:"Rallye-Dashboard",subtitle:"Erstelle und verwalte deine Stempel-Rallyes.",createButton:"Neue Rallye erstellen",creating:"Wird erstellt...",newRallyName:"Neue Rallye #{{count}}",loadError:"Rallyes konnten nicht geladen werden.",createSuccess:"Neue Rallye erstellt.",createError:"Rallye konnte nicht erstellt werden.",updateSuccess:"Rallye erfolgreich aktualisiert.",updateError:"Rallye konnte nicht aktualisiert werden.",deleteConfirm:"Möchtest du diese Rallye und alle ihre Orte wirklich löschen? Dies kann nicht rückgängig gemacht werden.",deleteSuccess:"Rallye gelöscht.",deleteError:"Rallye konnte nicht gelöscht werden.",noDescription:"Keine Beschreibung vorhanden.",accessCode:"Zugangscode",status:"Status",published:"Veröffentlicht",draft:"Entwurf",manageRally:"Verwalten",backToDashboard:"Zurück zum Dashboard",editing:"Bearbeiten",selectRallyPromptTitle:"Wähle eine Rallye",selectRallyPromptSubtitle:"Wähle eine Rallye aus dem Dashboard, um deren Karte zu bearbeiten oder sie zu testen."},vn={title:"Einer Rallye beitreten",subtitle:"Geben Sie einen Zugangscode ein, um zu beginnen.",placeholder:"ABCDEF",findButton:"Rallye finden",joinButton:"Rallye beitreten",joinSuccess:'Erfolgreich "{{name}}" beigetreten!',error:{notFound:"Keine veröffentlichte Rallye mit diesem Code gefunden.",network:"Verbindung zum Server konnte nicht hergestellt werden. Bitte versuchen Sie es erneut.",joinFailed:"Beitritt zur Rallye fehlgeschlagen.",alreadyJoined:"Du bist dieser Rallye bereits beigetreten."}},Tn={duration:"Dauer",infinite:"Unendlich"},jn={common:Va,auth:Wa,disclaimer:Ja,loadingScreen:Ka,splashScreen:Ya,modeToggle:Ha,rightSidebar:Za,presetSelector:Xa,settingsSections:Qa,stampEditor:en,stampGallery:tn,stampToolbar:on,imageLoader:an,stampSettings:nn,gallery:rn,geolocations:sn,collections:ln,mapEditor:cn,batchUpload:dn,coordInputModal:un,osmImportModal:mn,locationModals:gn,locationEditModal:hn,rally:pn,collectedStampsList:fn,logbook:yn,stampDetailModal:bn,collectionDetailModal:xn,locationList:wn,rallyAdmin:Sn,joinRally:vn,rallyJoinCard:Tn},kn={en:ma,ja:qa,de:jn},En=(t,e)=>{const a=e.split(".").reduce((o,r)=>{if(o&&typeof o=="object"&&o!==null&&r in o)return o[r]},t);return typeof a=="string"?a:e},rt=d.createContext(void 0),Cn=()=>{if(typeof window<"u"){const t=localStorage.getItem("atsume-locale");if(t==="en"||t==="ja"||t==="de")return t;const e=navigator.language.split(/[-_]/)[0];if(e==="ja")return"ja";if(e==="de")return"de"}return"en"},Nn=({children:t})=>{const[e,a]=d.useState(Cn()),o=s=>{a(s),typeof window<"u"&&localStorage.setItem("atsume-locale",s)},r=d.useCallback((s,l)=>{let i=En(kn[e],s);return l&&Object.keys(l).forEach(c=>{i=i.replace(`{{${c}}}`,String(l[c]))}),i},[e]);return n.jsx(rt.Provider,{value:{locale:e,setLocale:o,t:r},children:t})},O=()=>{const t=d.useContext(rt);if(t===void 0)throw new Error("useLocale must be used within a LocaleProvider");return t},Rn=()=>{const{signInWithGoogle:t}=ye(),{t:e}=O();return n.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"flex flex-col items-center mb-8",children:[n.jsx("div",{className:"p-3 bg-blue-600/20 border-2 border-blue-500 rounded-full mb-4",children:n.jsx(ve,{className:"w-12 h-12 text-blue-400"})}),n.jsx("h1",{className:"text-4xl font-bold text-white",children:e("auth.title")}),n.jsx("h2",{className:"text-lg font-light text-gray-300 tracking-widest",children:e("auth.subtitle")})]}),n.jsx("div",{className:"bg-gray-800 rounded-xl p-6 sm:p-8 border border-gray-700",children:n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("button",{onClick:t,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[n.jsx(Ft,{className:"w-5 h-5"}),e("auth.signInWithGoogle")]}),n.jsx("p",{className:"text-xs text-center text-gray-500 pt-2",children:e("auth.googleDescription")})]})})]})})},ee=()=>{const{t}=O();return n.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),n.jsx("h1",{className:"text-2xl font-semibold text-white mb-2",children:t("loadingScreen.authenticating")}),n.jsx("p",{className:"text-gray-400",children:t("loadingScreen.pleaseWait")})]})})},Mn=({onClose:t})=>{const{t:e}=O();return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",children:n.jsxs("div",{className:"relative w-full max-w-lg m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-8 text-center text-white transform animate-scale-in",children:[n.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":e("splashScreen.close"),children:n.jsx(Z,{className:"w-6 h-6"})}),n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:"p-4 bg-blue-600/20 border-2 border-blue-500 rounded-full mb-6",children:n.jsx(ve,{className:"w-16 h-16 text-blue-400"})}),n.jsx("h1",{className:"text-5xl font-bold mb-1",children:e("splashScreen.title")}),n.jsx("h2",{className:"text-xl font-light text-gray-300 mb-6 tracking-widest",children:e("splashScreen.subtitle")}),n.jsxs("p",{className:"text-gray-400 mb-8",children:[e("splashScreen.tagline"),n.jsx("br",{}),e("splashScreen.description")]}),n.jsxs("button",{onClick:t,className:"w-full max-w-xs bg-blue-600 hover:bg-blue-700 font-bold py-4 px-8 rounded-xl transition-all duration-200 flex items-center justify-center gap-3 text-xl shadow-lg hover:shadow-blue-500/50 transform hover:scale-105",children:[e("splashScreen.cta"),n.jsx(We,{className:"w-6 h-6"})]}),n.jsx("div",{className:"mt-8 text-xs text-gray-500",children:e("splashScreen.version",{version:"0.10.0"})}),n.jsx("div",{className:"mt-4 text-xs text-gray-500 text-center whitespace-pre-line",children:e("splashScreen.impressumContent")})]})]})})},In=({isOpen:t,setIsOpen:e,children:a,className:o,iconClassName:r})=>n.jsxs("button",{onClick:()=>e(!t),className:Te("flex items-center justify-between transition-colors duration-200",o),"aria-haspopup":"true","aria-expanded":t,children:[a,n.jsx("svg",{className:Te("transition-transform duration-200",t?"rotate-180":"",r),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),_n=()=>{const{locale:t,setLocale:e}=O(),[a,o]=d.useState(!1),r=d.useRef(null),s={en:"English",ja:"日本語",de:"Deutsch"};d.useEffect(()=>{const i=c=>{r.current&&!r.current.contains(c.target)&&o(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const l=i=>{e(i),o(!1)};return n.jsxs("div",{ref:r,className:"relative",children:[n.jsxs(In,{isOpen:a,setIsOpen:o,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700 rounded-md transition-colors",iconClassName:"w-4 h-4 text-gray-400",children:[n.jsx(Ot,{className:"w-4 h-4 text-gray-400"}),n.jsx("span",{className:"flex-grow",children:s[t]})]}),a&&n.jsx("div",{className:"absolute right-0 bottom-full mb-2 w-40 bg-gray-800 border border-gray-700 rounded-lg shadow-lg py-1 z-10",role:"menu",children:Object.keys(s).map(i=>n.jsxs("button",{onClick:()=>l(i),className:"w-full flex items-center justify-between px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700",role:"menuitem",children:[s[i],t===i&&n.jsx($t,{className:"w-4 h-4 text-blue-400"})]},i))})]})};function be(...t){return co(Te(t))}const st=d.createContext(void 0),Pn=({children:t,open:e,onOpenChange:a})=>{const[o,r]=d.useState(!1),s=e!==void 0?e:o,l=d.useCallback(c=>{e===void 0&&r(c),a==null||a(c)},[e,a]),i=d.useMemo(()=>({open:s,setOpen:l}),[s,l]);return n.jsx(st.Provider,{value:i,children:t})},Ae=()=>{const t=d.useContext(st);if(t===void 0)throw new Error("useDialog must be used within a DialogProvider");return t},lt=d.forwardRef(({onClick:t,asChild:e,...a},o)=>{const{setOpen:r}=Ae(),s=e?Bt:"button",l=d.useCallback(i=>{r(!0),t==null||t(i)},[r,t]);return n.jsx(s,{ref:o,onClick:l,...a})});lt.displayName="DialogTrigger";const zn=({children:t})=>n.jsx(n.Fragment,{children:t}),it=d.forwardRef(({className:t,...e},a)=>n.jsx("div",{ref:a,className:be("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));it.displayName="DialogOverlay";const ct=d.forwardRef(({className:t,children:e,...a},o)=>{const{open:r,setOpen:s}=Ae();return r?n.jsxs(zn,{children:[n.jsx(it,{}),n.jsxs("div",{ref:o,className:be("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-800 bg-gray-900 p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[e,n.jsxs("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-gray-900 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-800 data-[state=open]:text-gray-400",onClick:()=>s(!1),children:[n.jsx(Z,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]}):null});ct.displayName="DialogContent";const An=d.forwardRef(({onClick:t,...e},a)=>{const{setOpen:o}=Ae(),r=d.useCallback(s=>{o(!1),t==null||t(s)},[o,t]);return n.jsx("button",{ref:a,onClick:r,...e})});An.displayName="DialogClose";const dt=({className:t,...e})=>n.jsx("div",{className:be("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});dt.displayName="DialogHeader";const ut=d.forwardRef(({className:t,...e},a)=>n.jsx("h2",{ref:a,className:be("text-lg font-semibold leading-none tracking-tight text-white",t),...e}));ut.displayName="DialogTitle";const Dn=d.forwardRef(({className:t,...e},a)=>n.jsx("p",{ref:a,className:be("text-sm text-gray-400",t),...e}));Dn.displayName="DialogDescription";const Ln=()=>{const{locale:t}=O(),[e,a]=d.useState("");return d.useEffect(()=>{(async()=>{try{const r=await fetch(`/atsume-page/disclaimers/${t}.md`);if(!r.ok)throw new Error(`Failed to load disclaimer for locale: ${t}`);const s=await r.text();a(s)}catch(r){console.error("Error loading disclaimer markdown:",r),a("Failed to load disclaimer content.")}})()},[t]),n.jsx("div",{className:"p-4 text-gray-200 overflow-y-auto max-h-[70vh]",children:n.jsx(Gt,{className:"prose prose-invert max-w-none",remarkPlugins:[uo],components:{h1:({...o})=>n.jsx("h1",{className:"text-2xl font-bold mb-4",...o}),h2:({...o})=>n.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",...o}),h3:({...o})=>n.jsx("h3",{className:"text-lg font-medium mt-4 mb-2",...o}),p:({...o})=>n.jsx("p",{className:"mb-4",...o}),ul:({...o})=>n.jsx("ul",{className:"list-disc list-inside ml-4 mb-4",...o}),li:({...o})=>n.jsx("li",{className:"mb-2",...o}),hr:({...o})=>n.jsx("hr",{className:"my-6 border-gray-700",...o}),a:({...o})=>n.jsx("a",{className:"text-blue-400 hover:underline",...o})},children:e})})},Fn=({onJoinAnotherRally:t})=>{const{user:e,logout:a,joinedRallies:o}=ye(),{t:r}=O(),[s,l]=d.useState(!1),i=d.useRef(null);return d.useEffect(()=>{const c=u=>{i.current&&!i.current.contains(u.target)&&l(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]),e?n.jsxs("div",{ref:i,className:"relative",children:[n.jsx("button",{onClick:()=>l(!s),className:"flex items-center justify-center w-10 h-10 bg-gray-700/50 hover:bg-gray-700 rounded-full transition-colors","aria-label":r("auth.userMenu"),title:e.email||"",children:n.jsx(Ut,{className:"w-5 h-5 text-white"})}),s&&n.jsxs("div",{className:"absolute bottom-full mb-4 left-0 mt-2 w-64 bg-gray-800 border border-gray-700 rounded-xl shadow-lg z-50 p-2 flex flex-col gap-1",children:[n.jsxs("div",{className:"px-3 py-2 border-b border-gray-700 mb-1",children:[n.jsx("p",{className:"text-sm font-medium text-white truncate",children:r("auth.signedInAs")}),n.jsx("p",{className:"text-xs text-gray-400 truncate",children:e.email})]}),n.jsx(_n,{}),o.length>0&&n.jsxs("button",{onClick:()=>{t(),l(!1)},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700 rounded-md transition-colors",children:[n.jsx(qt,{className:"w-4 h-4"}),r("rally.joinAnotherRally")]}),n.jsxs(Pn,{children:[n.jsxs(lt,{className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700 rounded-md transition-colors",children:[n.jsx(Pe,{className:"w-4 h-4"}),r("disclaimer.title")]}),n.jsxs(ct,{children:[n.jsx(dt,{children:n.jsx(ut,{children:r("disclaimer.title")})}),n.jsx(Ln,{})]})]}),n.jsxs("button",{onClick:a,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-red-400 hover:bg-red-500/10 hover:text-red-300 rounded-md transition-colors",children:[n.jsx(Vt,{className:"w-4 h-4"}),r("auth.logout")]})]})]}):null},On=({mode:t,setMode:e,isAdmin:a,isManaging:o})=>{const{t:r}=O(),s="flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg transition-colors duration-200",l="bg-blue-600 text-white",i="bg-gray-700/50 text-gray-300 hover:bg-gray-700",c=[{name:"admin",icon:Wt,title:r("modeToggle.admin"),disabled:!1},{name:"stamp",icon:ve,title:r("modeToggle.stamp"),disabled:!1},{name:"map",icon:De,title:r("modeToggle.map"),disabled:!0},{name:"rally",icon:Le,title:r("modeToggle.rally"),disabled:!0}],u=[{name:"map",icon:De,title:r("modeToggle.map"),disabled:!1},{name:"rally",icon:Le,title:r("modeToggle.rally"),disabled:!1},{name:"stamp",icon:ve,title:r("modeToggle.stamp"),disabled:!1}],g=o?u:c;return a?n.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 bg-gray-900/70 backdrop-blur-sm p-1 rounded-xl shadow-lg flex items-center gap-1",children:g.map(h=>n.jsx("button",{onClick:()=>e(h.name),className:`${s} ${t===h.name?l:i} ${h.disabled?"text-gray-500 hover:bg-gray-700/50 cursor-not-allowed":""}`,"aria-pressed":t===h.name,title:h.disabled?r("rallyAdmin.selectRallyPromptSubtitle"):h.title,disabled:h.disabled,children:n.jsx(h.icon,{className:"w-4 h-4"})},h.name))}):null},$n=({onSelect:t})=>{const{t:e}=O(),a=[{method:"map",icon:ze,label:e("mapEditor.placeOnMap")},{method:"coords",icon:Jt,label:e("mapEditor.byCoordinates")},{method:"osm",icon:Je,label:e("mapEditor.fromOSM")},{method:"batch",icon:Ke,label:e("mapEditor.batchUpload")}];return n.jsx("div",{className:"flex flex-col items-stretch gap-1 bg-gray-900/80 backdrop-blur-sm p-2 rounded-xl shadow-lg w-48 animate-fade-in",children:a.map(o=>n.jsxs("button",{onClick:()=>t(o.method),className:"flex items-center gap-3 w-full text-left p-2 rounded-lg text-white hover:bg-blue-600 transition-colors",title:o.label,children:[n.jsx(o.icon,{className:"w-5 h-5 flex-shrink-0"}),n.jsx("span",{className:"text-sm font-medium",children:o.label})]},o.method))})},mt=()=>{const[t,e]=d.useState(!1);return d.useEffect(()=>{_e.isNativePlatform()&&_e.getPlatform()==="ios"&&e(!0)},[]),t},Bn=({mode:t,setMode:e,isAdmin:a,isManaging:o,managedRally:r,handleExitManagement:s,isLocationListOpen:l,setIsLocationListOpen:i,addMenuOpen:c,setAddMenuOpen:u,handleSelectAddMethod:g,setIsPlacingOnMap:h,children:m,onJoinAnotherRally:p})=>{const{t:f}=O(),T=mt();return n.jsx("div",{className:"h-screen w-screen bg-gray-900 text-white font-sans overflow-hidden",children:n.jsxs("main",{className:`relative w-full h-full ${T?"pt-safe-top":""}`,children:[n.jsx("div",{className:"absolute bottom-4 left-4 z-30 flex items-center gap-4",children:n.jsx(Fn,{onJoinAnotherRally:p})}),n.jsxs("div",{className:"absolute top-4 left-4 z-30 flex flex-col gap-4",children:[a&&o&&r&&n.jsx(n.Fragment,{children:n.jsx("button",{onClick:s,className:"p-2 rounded-full bg-gray-900/70 backdrop-blur-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors shadow-lg","aria-label":f("rallyAdmin.backToDashboard"),children:n.jsx(Kt,{className:"w-6 h-6"})})}),t==="map"&&!l&&n.jsx("button",{onClick:()=>i(!0),className:"fixed top-1/2 -translate-y-1/2 left-0 z-30 py-4 px-2 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-r-lg shadow-lg transition-colors location-list-toggle-button","aria-label":f("locationList.toggle"),title:f("locationList.toggle"),children:n.jsx(Yt,{className:"w-5 h-5"})})]}),n.jsx(On,{mode:t,setMode:e,isAdmin:a,isManaging:o}),m,t==="map"&&n.jsx("div",{className:"absolute bottom-6 right-6 z-10",children:n.jsxs("div",{className:"relative",children:[c&&n.jsx("div",{className:"absolute bottom-full right-0 mb-3",children:n.jsx($n,{onSelect:g})}),n.jsx("button",{onClick:()=>{u(w=>!w),h(!1)},className:"bg-blue-600 text-white rounded-full p-4 shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800 transition-transform hover:scale-110","aria-label":f("mapEditor.addLocation"),"aria-expanded":c,children:n.jsx(Ht,{className:`w-6 h-6 transition-transform duration-300 ${c?"rotate-45":""}`})})]})})]})})},H=(t=0,e=1)=>{const a=Math.random(),o=Math.random();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o)*e+t};class B{constructor(e,a,o){Se(this,"data");Se(this,"width");Se(this,"height");this.width=a,this.height=e;const r=a*e;if(o instanceof Float32Array){if(o.length!==r)throw new Error("Data array does not match matrix dimensions");this.data=o}else this.data=new Float32Array(r),typeof o=="number"&&this.data.fill(o)}static ones(e,a){return new B(e,a,1)}static zeros(e,a){return new B(e,a,0)}get(e,a){return e<0||e>=this.height||a<0||a>=this.width?0:this.data[e*this.width+a]}set(e,a,o){e>=0&&e<this.height&&a>=0&&a<this.width&&(this.data[e*this.width+a]=o)}clone(){return new B(this.height,this.width,new Float32Array(this.data))}getBilinear(e,a){const o=Math.floor(e),r=Math.floor(a),s=Math.ceil(e),l=Math.ceil(a);if(o<0||s>=this.height||r<0||l>=this.width)return 0;const i=this.get(o,r),c=this.get(o,l),u=this.get(s,r),g=this.get(s,l),h=e-o,m=a-r,p=i*(1-m)+c*m,f=u*(1-m)+g*m;return p*(1-h)+f*h}static from2DArray(e){var s;const a=e.length,o=((s=e[0])==null?void 0:s.length)||0,r=new B(a,o);for(let l=0;l<a;l++)for(let i=0;i<o;i++)r.set(l,i,e[l][i]);return r}to2DArray(){const e=Array(this.height).fill(0).map(()=>Array(this.width).fill(0));for(let a=0;a<this.height;a++)for(let o=0;o<this.width;o++)e[a][o]=this.get(a,o);return e}toUint8ClampedArray(){const e=new Uint8ClampedArray(this.data.length);for(let a=0;a<this.data.length;a++)e[a]=Math.round(this.data[a]*255);return e}}function gt(t,e){const a=B.zeros(t.height,t.width);for(let o=0;o<t.data.length;o++)a.data[o]=t.data[o]*e.data[o];return a}function Gn(t,e,a,o,r){const s=B.zeros(t.height,t.width);for(let l=0;l<t.data.length;l++)s.data[l]=t.data[l]*e+a.data[l]*o+r;return s}function ht(t){const e=t.clone();let a=1/0,o=-1/0;for(let s=0;s<e.data.length;s++)e.data[s]<a&&(a=e.data[s]),e.data[s]>o&&(o=e.data[s]);const r=o-a;if(r>0)for(let s=0;s<e.data.length;s++)e.data[s]=(e.data[s]-a)/r;return e}function Un(t){let e=0;for(let a=0;a<t.data.length;a++)t.data[a]!==0&&e++;return e}const Ie=240,qn=10,Vn=1;function Wn(t,e,a){const o=(t+e+a)/3,r=t>Ie&&e>Ie&&a>Ie;return{brightness:o,isWhite:r}}function pt(t,e,a){const o=t[e],r=t[e+1],s=t[e+2],{brightness:l,isWhite:i}=Wn(o,r,s),c=l>a&&!i;return{r:o,g:r,b:s,brightness:l,isWhite:i,meetsThreshold:c}}function Jn(t,e){const a=[];for(let o=0;o<t.length;o+=3){const{r,g:s,b:l,meetsThreshold:i}=pt(t,o,e);i&&a.push(r,s,l)}return new Float32Array(a)}function Be(t,e){return Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2)}function Kn(t,e){if(t.length===0||e===0)return{colors:[],labels:new Int32Array(0)};const a=t.length/3,o=[];for(let c=0;c<t.length;c+=3)o.push([t[c],t[c+1],t[c+2]]);a<e&&(e=a);let r=[];const s=new Set;for(;r.length<e;){const c=Math.floor(Math.random()*a);s.has(c)||(r.push([...o[c]]),s.add(c))}const l=new Int32Array(a);for(let c=0;c<qn;c++){for(let m=0;m<a;m++){let p=1/0,f=0;for(let T=0;T<r.length;T++){const w=Be(o[m],r[T]);w<p&&(p=w,f=T)}l[m]=f}const u=Array(r.length).fill(0).map(()=>[0,0,0]),g=new Array(r.length).fill(0);for(let m=0;m<a;m++){const p=l[m];u[p][0]+=o[m][0],u[p][1]+=o[m][1],u[p][2]+=o[m][2],g[p]++}let h=!0;for(let m=0;m<r.length;m++){if(g[m]>0)u[m][0]/=g[m],u[m][1]/=g[m],u[m][2]/=g[m];else{const p=Math.floor(Math.random()*a);u[m]=[...o[p]]}Be(u[m],r[m])>Vn&&(h=!1)}if(r=u,h)break}return{colors:r.map(c=>c.map(Math.round)),labels:l}}function Yn(t,e){const a=B.zeros(t.height,t.width),o=Math.floor(e/2);for(let r=0;r<t.height;r++)for(let s=0;s<t.width;s++){let l=255;for(let i=-o;i<=o;i++)for(let c=-o;c<=o;c++)l=Math.min(l,t.get(r+i,s+c));a.set(r,s,l)}return a}function Hn(t,e,a,o,r,s){const l=new Array(o*r).fill(-1);let i=0;for(let u=0;u<t.length;u+=3){const{meetsThreshold:g}=pt(t,u,s.background_threshold);g&&(l[u/3]=a[i],i++)}const c=[];for(let u=0;u<e.length;u++){const g=B.zeros(r,o);for(let h=0;h<r;h++)for(let m=0;m<o;m++)l[h*o+m]===u&&g.set(h,m,255);s.color_shape_shrink>0?c.push(Yn(g,s.color_shape_shrink)):c.push(g)}return c}function Zn(t,e,a){const o=e*Math.PI/180,r=a*Math.cos(o),s=a*Math.sin(o);return[r,s,(1-r)*t.x-s*t.y,-s,r,s*t.x+(1-r)*t.y]}function Xn(t,e,a,o){const r=B.zeros(o,a),[s,l,i,c,u,g]=e,h=s*u-l*c;if(Math.abs(h)<1e-6)return r;const m=1/h,p=u*m,f=-l*m,T=(l*g-u*i)*m,w=-c*m,R=s*m,P=(c*i-s*g)*m;for(let k=0;k<o;k++)for(let N=0;N<a;N++){const y=p*N+f*k+T,S=w*N+R*k+P,_=t.getBilinear(S,y);r.set(k,N,_)}return r}function Qn(t,e,a,o,r){return t.map(s=>{const l=H(...o),i=H(...o),c=H(...r),u=Zn({x:e/2,y:a/2},c,1);return u[2]+=l,u[5]+=i,Xn(s,u,e,a)})}function ft(t){var c;const e=t.length,a=((c=t[0])==null?void 0:c.length)||0,o=Array(e).fill(null).map(()=>Array(a));for(let u=0;u<e;u++)for(let g=0;g<a;g++)o[u][g]=t[u][g]>127;const r=Array(e).fill(null).map(()=>Array(a));for(let u=0;u<e;u++)er(o[u],r[u]);const s=Array(e).fill(null).map(()=>Array(a)),l=Array(e),i=Array(e);for(let u=0;u<a;u++){for(let g=0;g<e;g++)l[g]=r[g][u];tr(l,i);for(let g=0;g<e;g++)s[g][u]=Math.sqrt(i[g])}return s}function er(t,e){const a=t.length;let o=1/0;for(let r=0;r<a;r++)t[r]?o++:o=0,e[r]=o*o;o=1/0;for(let r=a-1;r>=0;r--)t[r]?o++:o=0,e[r]=Math.min(e[r],o*o)}function tr(t,e){const a=t.length;if(a===0)return;const o=Array(a),r=Array(a+1);let s=0;o[0]=0,r[0]=-1/0,r[1]=1/0;for(let l=1;l<a;l++){let i=(t[l]+l*l-(t[o[s]]+o[s]*o[s]))/(2*l-2*o[s]);for(;i<=r[s];)s--,i=(t[l]+l*l-(t[o[s]]+o[s]*o[s]))/(2*l-2*o[s]);s++,o[s]=l,r[s]=i,r[s+1]=1/0}s=0;for(let l=0;l<a;l++){for(;r[s+1]<l;)s++;e[l]=(l-o[s])*(l-o[s])+t[o[s]]}}function or(t,e,a){const o=Array(a).fill(null).map(()=>Array(e));for(let r=0;r<a;r++)for(let s=0;s<e;s++)o[r][s]=t.get(r,s);return ft(o)}function ar(t,e,a,o,r){return t.map(s=>{const l=ft(s.to2DArray()),i=B.ones(a,e);for(let c=0;c<a;c++)for(let u=0;u<e;u++){const g=l[c][u];for(let h=1;h<=o;h++)if(g>h-1&&g<=h){const m=r*(o-h+1)/o;i.set(c,u,m);break}}return i})}function nr(t,e,a){const o=B.zeros(e,t);for(let r=0;r<3;r++){const s=2**r,l=1/s,i=1/s;for(let c=0;c<e;c++)for(let u=0;u<t;u++){const g=i*Math.sin(u*l*2*Math.PI/a)*Math.sin(c*l*2*Math.PI/a),h=o.get(c,u);o.set(c,u,h+g)}}return ht(o)}function rr(t,e,a,o,r){const s=B.ones(e,t);if(r<=0||a<=0)return s;for(let l=0;l<a;l++){const i=Math.random()*(o[1]-o[0])+o[0],c=Math.random()*t,u=Math.random()*e,g=Math.max(0,Math.floor(c-i)),h=Math.min(t,Math.ceil(c+i)),m=Math.max(0,Math.floor(u-i)),p=Math.min(e,Math.ceil(u+i));for(let f=m;f<p;f++)for(let T=g;T<h;T++){const w=Math.sqrt((T-c)**2+(f-u)**2);if(w<i){const P=1-(w/i)**2,k=1-r*P;s.get(f,T)>k&&s.set(f,T,k)}}}return s}function sr(t,e,a,o){const r=[];for(let s=0;s<t;s++){const l=H(...o.noise_scale),i=nr(e,a,l),c=Math.round(H(...o.num_patches)),u=H(...o.ink_depletion_intensity),g=rr(e,a,c,o.patch_size_range,u),h=H(...o.wear_intensity),m=B.ones(a,e);let p=Gn(i,h,m,1-h,0);p=gt(p,g),p=ht(p),r.push(p)}return r}function lr(t,e){const a=[];let o=0;for(let r=0;r<t.length;r++){const s=e>0?t[r].density/e:1/t.length;o+=s,a.push(o)}return a.length>0&&(a[a.length-1]=1),a}function ir(t){const e=Math.random();let a=0,o=t.length-1;if(t.length===0)return-1;if(e<=t[0])return 0;if(e>=t[t.length-1])return t.length-1;for(;a<o;){const r=Math.floor((a+o)/2);t[r]<e?a=r+1:o=r}return a}function cr(t,e,a,o,r,s){const l=gt(e,a);let i=null;s.bleeding_factor>0&&(i=or(t,o,r));const c=[];let u=0;for(let p=0;p<r;p++)for(let f=0;f<o;f++)if(t.get(p,f)>127){const T=l.get(p,f);c.push({x:f,y:p,density:T}),u+=T}if(c.length===0)return[];const g=lr(c,u),h=Math.floor(s.splat_density*c.length),m=[];for(let p=0;p<h;p++){const f=ir(g);if(f<0)continue;const T=c[f],{x:w,y:R,density:P}=T,N=(Math.random()*(s.splat_size_range[1]-s.splat_size_range[0])+s.splat_size_range[0])*(.5+.5*P);let y=0;s.bleeding_factor>0&&i&&i[R][w]<5&&(y=-Math.log(Math.random())*s.bleeding_factor);const S=N+y,_=Math.min(255,Math.floor(100+155*P));m.push({x:w,y:R,size:S,opacity:_})}return m}function dr(t,e,a,o,r,s=!1){const l=document.createElement("canvas");l.width=a,l.height=o;const i=l.getContext("2d");if(!s){const[c,u,g]=r;i.fillStyle=`rgb(${c}, ${u}, ${g})`,i.fillRect(0,0,a,o)}return t.forEach((c,u)=>{const[g,h,m]=e[u],p=c.sort((f,T)=>T.size-f.size);for(const f of p)i.fillStyle=`rgba(${g}, ${h}, ${m}, ${f.opacity/255})`,i.beginPath(),i.ellipse(f.x,f.y,f.size/2,f.size/2,0,0,2*Math.PI),i.fill()}),i.getImageData(0,0,a,o)}function ur(t,e){const{data:a,width:o,height:r}=t,s=new Uint8ClampedArray(o*r*3);for(let y=0,S=0;y<a.length;y+=4,S+=3)s[S]=a[y],s[S+1]=a[y+1],s[S+2]=a[y+2];const l=Jn(s,e.background_threshold),i=e.num_colors==="auto"?15:e.num_colors,{colors:c,labels:u}=Kn(l,i),g=Hn(s,c,u,o,r,e),h=240,m=y=>y[0]>h&&y[1]>h&&y[2]>h,p=g.map((y,S)=>({mask:y,color:c[S],size:Un(y)})).filter(y=>!m(y.color)).sort((y,S)=>S.size-y.size);if(p.length===0){const y=document.createElement("canvas");return y.width=o,y.height=r,y.getContext("2d").getImageData(0,0,o,r)}const f=p.map(y=>y.mask),T=p.map(y=>y.color),w=Qn(f,o,r,e.shift,e.rotation),R=ar(w,o,r,e.edge_width,e.edge_boost),P=sr(T.length,o,r,e),k=[];for(let y=0;y<w.length;y++){const S=cr(w[y],R[y],P[y],o,r,e);k.push(S)}return dr(k,T,o,r,e.background_color,!0)}const mr={stamp_size:512,num_colors:"auto",background_threshold:5,color_shape_shrink:5,shift:[0,1],rotation:[0,1],edge_width:4,edge_boost:3,wear_intensity:[.1,.05],noise_scale:[50,5],rotation_angle:[0,0],ink_depletion_intensity:[.3,.05],num_patches:[2,1],patch_size_range:[20,100],splat_density:.75,splat_size_range:[1,2],bleeding_factor:.1,background_color:[255,255,255]};function gr(t,e){const a=document.createElement("canvas"),o=a.getContext("2d");if(!o)throw new Error("Could not create canvas context");const r=t.width/t.height,s=r>=1?e:e*r,l=r<1?e:e/r;return a.width=Math.ceil(s),a.height=Math.ceil(l),o.drawImage(t,0,0,a.width,a.height),a}async function Yr(t,e){return new Promise((a,o)=>{setTimeout(()=>{try{const r=ur(t,e);a(r)}catch(r){o(r)}},0)})}const Ge=128,hr=3,pr=1e3;async function fr(t){const e=document.createElement("canvas"),a=t.width/t.height;e.width=Ge,e.height=Ge/a;const o=e.getContext("2d");if(!o)throw new Error("Failed to get canvas context for thumbnail creation");return o.drawImage(t,0,0,e.width,e.height),e.toDataURL("image/jpeg",.7)}async function me(t,e=hr,a=pr,o=15e3){let r;for(let s=1;s<=e;s++)try{const l=new Promise((i,c)=>setTimeout(()=>c(new Error("Operation timed out")),o));return await Promise.race([t(),l])}catch(l){if(r=l,s===e)throw r;const i=a*Math.pow(2,s-1);await new Promise(c=>setTimeout(c,i))}throw r}const yt=d.createContext(void 0),yr=({children:t})=>{const{user:e,loading:a,role:o,joinedRallies:r,selectedRallyId:s}=ye(),{addToast:l}=ge(),{t:i}=O(),c=d.useRef(!0),u=d.useRef(!1),g=d.useRef(!1),h=d.useRef(!1),m=d.useRef(!1),[p,f]=d.useState([]),[T,w]=d.useState(!1),[R,P]=d.useState(null),[k,N]=d.useState([]),[y,S]=d.useState(!1),[_,z]=d.useState(null),[M,D]=d.useState([]),[J,X]=d.useState(!1),[ne,re]=d.useState(null),[V,G]=d.useState([]),[Ee,se]=d.useState(!1),[W,le]=d.useState(null),E=d.useCallback(b=>{c.current&&b()},[]),Q=d.useCallback(async(b,v=!1)=>{if(u.current||b.length===0)return;const j=b.every(x=>p.some(C=>C.rally_id===x));if(!(!v&&j&&p.length>0)){u.current=!0,E(()=>{w(!0),P(null),f([])});try{const x=[];for(const C of b){const F=await me(()=>xo(C));x.push(...F)}if(!c.current)return;Promise.all(x.flatMap(C=>[C.sourceImageURL,C.thumbnail]).map(C=>fo(C).catch(()=>{}))),E(()=>{f(x)})}catch(x){console.error("Failed to load stamps:",x),E(()=>{P(x instanceof L?x.message:i("gallery.loadErrorToast")),f([])}),l(i("gallery.loadErrorToast"),"error")}finally{u.current=!1,E(()=>w(!1))}}},[l,i,E,p.length]),K=d.useCallback(async()=>{if(e!=null&&e.id){const b=o==="admin"?s:null,v=r.map(x=>x.id);await Q(b?[b]:v,!0)}},[e==null?void 0:e.id,r,Q,o,s]),xt=d.useCallback(async(b,v,j,x)=>{if(!e||o!=="admin"){l(i("common.adminRequired"),"info");return}if(!j.trim()){l(i("gallery.nameRequiredToast"),"error");return}if(!x){l(i("gallery.rallyRequiredToast"),"error");return}try{const C=gr(b,v.stamp_size),F=C.toDataURL("image/jpeg",.7),$=await fr(C),Y=await Qe({rally_id:x,name:j.trim(),thumbnail:$,sourceImageURL:F,settings:v,user_id:e.id},e.id);E(()=>f(Re=>[Y,...Re])),l(i("gallery.addSuccessToast",{name:j.trim()}),"success")}catch(C){console.error("Failed to add stamp:",C),l(C instanceof L?C.message:i("gallery.addErrorToast"),"error")}},[l,e,i,E,o]),wt=d.useCallback(async(b,v)=>{if(!e||o!=="admin"){l(i("common.adminRequired"),"info");return}if(!p.find(x=>x.id===b)){l(i("gallery.stampNotFoundToast"),"error");return}E(()=>f(x=>x.filter(C=>C.id!==b)));try{await wo(b,v),l(i("gallery.deleteSuccessToast"),"info")}catch(x){console.error("Failed to delete stamp:",x),l(x instanceof L?x.message:i("gallery.deleteErrorToast"),"error"),K()}},[l,e,i,p,K,o,E]),St=d.useCallback(async(b,v,j)=>{if(!e||o!=="admin"){l(i("common.adminRequired"),"info");return}if(!v.trim()){l(i("gallery.nameRequiredToast"),"error");return}const x=p.find(F=>F.id===b);if(!x){l(i("gallery.stampNotFoundToast"),"error");return}const C=v.trim();if(x.name!==C){E(()=>f(F=>F.map($=>$.id===b?{...$,name:C}:$)));try{await So(b,C,j),l(i("gallery.renameSuccessToast",{name:C}),"success")}catch(F){console.error("Failed to rename stamp:",F),l(F instanceof L?F.message:i("gallery.renameErrorToast",{oldName:x.name}),"error"),K()}}},[l,e,p,i,K,E,o]),xe=d.useCallback(async(b,v=!1,j=null)=>{const x=j?[j]:b;if(g.current||x.length===0){E(()=>{N([])});return}const C=x.every(F=>k.some($=>$.rally_id===F));if(!(!v&&C&&k.length>0)){g.current=!0,E(()=>{S(!0),z(null),N([])});try{const F=[];for(const $ of x){const Y=await me(()=>Co($));F.push(...Y)}if(!c.current)return;E(()=>{N(F)})}catch(F){console.error("Failed to load geolocations:",F),E(()=>{z(F instanceof L?F.message:i("mapEditor.loadGeolocationsError")),N([])}),l(i("mapEditor.loadGeolocationsError"),"error")}finally{g.current=!1,E(()=>S(!1))}}},[l,i,E]),ie=d.useCallback(async()=>{if(e!=null&&e.id){const b=o==="admin"?s:null,v=r.map(j=>j.id);await xe(v,!0,b)}},[e==null?void 0:e.id,r,xe,o,s]),vt=d.useCallback(async(b,v)=>{if(!e){l(i("common.loginRequired"),"info");return}try{const j=await ot({...b,rally_id:v,user_id:e.id},e.id);E(()=>N(x=>[...x,j]))}catch(j){console.error("Failed to add geolocation:",j),l(j instanceof L?j.message:i("mapEditor.addLocationError"),"error")}},[l,e,i,E]),Tt=d.useCallback(async(b,v)=>{if(!e){l(i("common.loginRequired"),"info");return}if(!k.find(x=>x.id===b)){l(i("mapEditor.locationNotFound"),"error");return}E(()=>N(x=>x.map(C=>C.id===b?{...C,...v}:C)));try{await No(b,v,e.id)}catch(x){console.error("Failed to update geolocation:",x),l(x instanceof L?x.message:i("mapEditor.updateLocationError"),"error"),ie()}},[l,e,k,i,ie,E]),jt=d.useCallback(async b=>{if(!e){l(i("common.loginRequired"),"info");return}if(!k.find(j=>j.id===b)){l(i("mapEditor.locationNotFound"),"error");return}E(()=>{N(j=>j.filter(C=>C.id!==b))});try{await Ro(b,e.id),l(i("mapEditor.deleteLocationSuccess"),"info")}catch(j){console.error("Failed to delete geolocation:",j),l(j instanceof L?j.message:i("mapEditor.deleteLocationError"),"error"),ie()}},[l,e,k,i,ie,E]),Ce=d.useCallback(async(b=!1)=>{if(!h.current&&!(M.length>0&&!b)){h.current=!0,E(()=>{X(!0),re(null)});try{let v=[];if(e!=null&&e.id&&o==="admin"&&(v=await me(()=>tt(e.id))),!c.current)return;E(()=>D(v))}catch(v){console.error("Failed to load rallies:",v),E(()=>{re(v instanceof L?v.message:i("admin.loadRalliesError")),D([])}),l(i("admin.loadRalliesError"),"error")}finally{h.current=!1,E(()=>X(!1))}}},[l,i,E,M.length,e==null?void 0:e.id,o]),ce=d.useCallback(async()=>{await Ce(!0)},[Ce]),kt=d.useCallback(async b=>{if(!e||o!=="admin"){l(i("common.adminRequired"),"info");return}try{const v=await vo({...b,admin_id:e.id});E(()=>D(j=>[...j,v]))}catch(v){console.error("Failed to add rally:",v),l(v instanceof L?v.message:i("admin.addRallyError"),"error")}},[l,e,o,i,E]),Et=d.useCallback(async(b,v)=>{if(!e||o!=="admin"){l(i("common.adminRequired"),"info");return}if(!M.find(x=>x.id===b)){l(i("admin.rallyNotFound"),"error");return}E(()=>D(x=>x.map(C=>C.id===b?{...C,...v}:C)));try{await To(b,v,e.id)}catch(x){console.error("Failed to update rally:",x),l(x instanceof L?x.message:i("admin.updateRallyError"),"error"),ce()}},[l,e,o,M,i,ce,E]),Ct=d.useCallback(async b=>{if(!e||o!=="admin"){l(i("common.adminRequired"),"info");return}if(!M.find(j=>j.id===b)){l(i("admin.rallyNotFound"),"error");return}E(()=>D(j=>j.filter(x=>x.id!==b)));try{await jo(b,e.id)}catch(j){console.error("Failed to delete rally:",j),l(j instanceof L?j.message:i("admin.deleteRallyError"),"error"),ce()}},[l,e,o,M,i,ce,E]),Nt=d.useCallback(async b=>{try{return await me(()=>ko(b))}catch(v){return console.error("Failed to get rally by code:",v),l(i("joinRally.fetchError"),"error"),null}},[l,i]),we=d.useCallback(async(b,v,j=!1,x=null)=>{const C=x?[x]:v;if(!b||C.length===0){E(()=>{G([])});return}const F=C.every($=>V.some(Y=>Y.rally_id===$));if(!(!j&&F&&V.length>0)){m.current=!0,E(()=>{se(!0),le(null),G([])});try{const $=[];for(const Y of C){const Re=await me(()=>Mo(b,Y));$.push(...Re)}if(!c.current)return;E(()=>{G($)})}catch($){console.error("Failed to load collections:",$),E(()=>{le($ instanceof L?$.message:i("logbook.loadCollectionsError")),G([])}),l(i("logbook.loadCollectionsError"),"error")}finally{m.current=!1,E(()=>se(!1))}}},[l,i,E]),de=d.useCallback(async()=>{if(e!=null&&e.id){const b=o==="admin"?s:null,v=r.map(j=>j.id);await we(e.id,v,!0,b)}},[e==null?void 0:e.id,r,we,o,s]),Ne=d.useCallback((b,v)=>V.some(j=>j.geolocation_id===b&&j.rally_id===v),[V]),Rt=d.useCallback(async(b,v)=>{if(!e)return l(i("common.loginRequired"),"info"),null;if(Ne(b,v))return l(i("collections.alreadyCollected"),"info"),null;const j={user_id:e.id,rally_id:v,geolocation_id:b,is_collected:!0,logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null};try{const x=await $e(j);return E(()=>G(C=>[...C,x])),l(i("collections.collectSuccess"),"success"),x}catch(x){return console.error("DatabaseContext: Failed to collect stamp:",x),l(x instanceof L?x.message:i("collections.collectError"),"error"),null}},[e,l,i,E,Ne]),Mt=d.useCallback(async b=>{if(!e){l(i("common.loginRequired"),"info");return}try{const v=await $e({...b,user_id:e.id});E(()=>G(j=>[...j,v]))}catch(v){console.error("Failed to add collection:",v),l(v instanceof L?v.message:i("logbook.addCollectionError"),"error")}},[l,e,i,E]),ue=d.useCallback(async(b,v,j)=>{if(!e){l(i("common.loginRequired"),"info");return}if(!V.find(C=>C.id===b)){l(i("collections.collectionNotFound"),"error");return}E(()=>G(C=>C.map(F=>F.id===b?{...F,...v}:F)));try{await Io(b,v,j)}catch(C){console.error("Failed to update collection:",C),l(C instanceof L?C.message:i("collections.updateError"),"error"),de()}},[l,e,V,i,de,E]),It=d.useCallback(async(b,v)=>{if(!e){l(i("common.loginRequired"),"info");return}if(!V.find(x=>x.id===b)){l(i("collections.collectionNotFound"),"error");return}E(()=>G(x=>x.filter(C=>C.id!==b)));try{await _o(b,v),l(i("collections.deleteSuccess"),"info")}catch(x){console.error("Failed to delete collection:",x),l(x instanceof L?x.message:i("collections.deleteError"),"error"),de()}},[l,e,V,i,de,E]),_t=d.useCallback(async(b,v,j)=>{if(!(e!=null&&e.id)){l(i("common.loginRequired"),"info");return}try{await ue(b,{logbook_x:v.x,logbook_y:v.y,logbook_rotation:v.rotation,stamp_image_data:j},e.id)}catch(x){console.error("Failed to update collection placement:",x),l(x instanceof L?x.message:i("collections.placementError"),"error")}},[e==null?void 0:e.id,ue,l,i]),Pt=d.useCallback(async b=>{if(!(e!=null&&e.id)){l(i("common.loginRequired"),"info");return}try{await ue(b,{logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null},e.id),l(i("collections.revertSuccess"),"info")}catch(v){console.error("Failed to revert collection placement:",v),l(v instanceof L?v.message:i("collections.revertError"),"error")}},[e==null?void 0:e.id,ue,l,i]);d.useEffect(()=>{a||(e!=null&&e.id?o==="admin"?(Ce(),s?(xe([],!1,s),we(e.id,[],!1,s),Q([s])):(N([]),G([]),f([]))):r.length>0?(xe(r.map(b=>b.id)),we(e.id,r.map(b=>b.id)),Q(r.map(b=>b.id))):(N([]),G([]),f([])):E(()=>{f([]),P(null),w(!1),N([]),z(null),S(!1),D([]),re(null),X(!1),G([]),le(null),se(!1)}))},[l,e,i,E,r,o,s]),d.useEffect(()=>()=>{c.current=!1},[]);const zt={stamps:p,stampsLoading:T||a,stampsError:R,addStampToGallery:xt,deleteStampFromGallery:wt,renameStampInGallery:St,refreshStamps:K,geolocations:k,geolocationsLoading:y||a,geolocationsError:_,addGeolocation:vt,updateGeolocation:Tt,deleteGeolocation:jt,refreshGeolocations:ie,rallies:M,ralliesLoading:J||a,ralliesError:ne,addRally:kt,updateRally:Et,deleteRally:Ct,getRallyByCode:Nt,refreshRallies:ce,collections:V,collectionsLoading:Ee||a,collectionsError:W,addCollection:Mt,updateCollection:ue,deleteCollection:It,isCollected:Ne,collectStamp:Rt,updateCollectionPlacement:_t,revertCollectionPlacement:Pt,refreshCollections:de};return n.jsx(yt.Provider,{value:zt,children:t})},ae=()=>{const t=d.useContext(yt);if(t===void 0)throw new Error("useDatabase must be used within a DatabaseProvider");return t};function Hr(t,e,a,o){const s=t*Math.PI/180,l=a*Math.PI/180,i=(a-t)*Math.PI/180,c=(o-e)*Math.PI/180,u=Math.sin(i/2)*Math.sin(i/2)+Math.cos(s)*Math.cos(l)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}function br(t,e,a=64){const[o,r]=t,s={latitude:r,longitude:o},l=e/1e3,i=[],c=l/(111.32*Math.cos(s.latitude*Math.PI/180)),u=l/110.574;let g,h,m;for(let p=0;p<a;p++)g=p/a*(2*Math.PI),h=c*Math.cos(g),m=u*Math.sin(g),i.push([s.longitude+h,s.latitude+m]);return i.push(i[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[i]},properties:{}}}const xr=({isVisible:t,onMapLoad:e,onGeolocate:a,onMapClick:o,children:r,className:s="",cursor:l="",mapRef:i})=>{const{addToast:c}=ge(),{t:u}=O(),g=mt(),[h,m]=d.useState({longitude:-.09,latitude:51.505,zoom:3}),[p,f]=d.useState(!1),T=d.useRef(null),w=i||T,R=d.useRef(null),P=d.useRef(!1),k=S=>{console.error("BaseMap: Geolocation error",S);let _=u("mapEditor.locationError.unknown");switch(S.code){case S.PERMISSION_DENIED:_=u("mapEditor.locationError.denied");break;case S.POSITION_UNAVAILABLE:_=u("mapEditor.locationError.unavailable");break;case S.TIMEOUT:_=u("mapEditor.locationError.timeout");break}c(_,"error")},N=d.useCallback(S=>{P.current||(P.current=!0,c(u("mapEditor.centeredToast"),"success")),a==null||a({latitude:S.coords.latitude,longitude:S.coords.longitude})},[c,u,a]),y=d.useCallback(()=>{p||setTimeout(()=>{if(R.current)try{R.current.trigger(),f(!0)}catch(S){console.warn("Failed to trigger geolocation on load:",S)}},500),e==null||e()},[p,e]);return d.useEffect(()=>{if(t&&w.current){const S=setTimeout(()=>{var _;return(_=w.current)==null?void 0:_.getMap().resize()},1);return()=>clearTimeout(S)}},[t,w]),d.useEffect(()=>{if(!p){const S=setTimeout(()=>{if(R.current)try{R.current.trigger(),f(!0)}catch(_){console.warn("Failed to trigger geolocation on mount:",_),(navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad"))&&c(u("mapEditor.iOSLocationPrompt")||"Tap the location button to center on your position","info")}},1e3);return()=>clearTimeout(S)}},[p,c,u]),n.jsx("div",{className:`relative w-full h-full bg-gray-700 ${l} ${s} ${g?"pt-safe-top":""}`,children:n.jsxs(Zt,{ref:w,mapLib:mo,...h,onMove:S=>m(S.viewState),onClick:o,onLoad:y,mapStyle:"https://tiles.openfreemap.org/styles/positron",style:{width:"100%",height:"100%"},children:[n.jsx(Xt,{ref:R,positionOptions:{enableHighAccuracy:!0,timeout:1e4,maximumAge:0},trackUserLocation:!0,showUserLocation:!0,showAccuracyCircle:!0,fitBoundsOptions:{maxZoom:15},onError:k,onGeolocate:N}),r]})})},wr=({isVisible:t,selectedLocation:e,setSelectedLocation:a,geolocations:o,setEditingLocation:r,newLocationCoords:s,setNewLocationCoords:l,isPlacingOnMap:i,setIsPlacingOnMap:c,deleteGeolocation:u,onLocationSelectedAndFocus:g,adminTestingRallyId:h})=>{const{stamps:m}=ae(),{t:p}=O(),f=d.useRef(null),T=d.useMemo(()=>h?o.filter(k=>k.rally_id===h):o,[o,h]),w=d.useMemo(()=>({type:"FeatureCollection",features:T.map(k=>{const N=br([k.longitude,k.latitude],k.radius);return N.properties={id:k.id},N})}),[T]),R=k=>{if(i){const{lng:N,lat:y}=k.lngLat;l({latitude:y,longitude:N}),c(!1)}e&&a(null)};d.useEffect(()=>{e&&f.current&&f.current.flyTo({center:[e.longitude,e.latitude],zoom:14,duration:2e3})},[e,g]);const P=d.useMemo(()=>e!=null&&e.stamp_id&&m.find(k=>k.id===e.stamp_id)||null,[e,m]);return d.useEffect(()=>{s&&(r(null),a(null))},[s,a,r]),n.jsx(n.Fragment,{children:n.jsxs(xr,{isVisible:t,onMapClick:R,cursor:i?"cursor-add":"",mapRef:f,children:[n.jsxs(Qt,{id:"radius-circles",type:"geojson",data:w,children:[n.jsx(Fe,{id:"radius-circles-fill",type:"fill",paint:{"fill-color":"#ef4444","fill-opacity":.25}}),n.jsx(Fe,{id:"radius-circles-stroke",type:"line",paint:{"line-color":"#ef4444","line-width":1.5,"line-dasharray":[2,2]}})]}),T.map(k=>n.jsx(eo,{longitude:k.longitude,latitude:k.latitude,style:{zIndex:20},children:n.jsx("button",{onClick:N=>{N.stopPropagation(),a(k)},"aria-label":p("mapEditor.viewLocation",{name:k.name}),children:n.jsx(ze,{className:"text-red-500 w-8 h-8 drop-shadow-lg",strokeWidth:1.5})})},k.id)),e&&n.jsx(to,{longitude:e.longitude,latitude:e.latitude,onClose:()=>a(null),closeOnClick:!1,anchor:"bottom",offset:35,style:{zIndex:20},children:n.jsxs("div",{className:"flex flex-col",children:[P&&n.jsx("img",{src:P.thumbnail,alt:P.name,className:"w-full h-32 object-contain bg-gray-900/50 rounded-t-md"}),n.jsxs("div",{className:"p-3",children:[n.jsx("h3",{className:"font-bold text-lg text-white mb-1",children:e.name}),n.jsx("p",{className:"text-sm text-gray-300 mb-3",children:e.description}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>{r(e),a(null)},className:"flex-1 bg-blue-600 text-white px-2 py-1.5 text-xs rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-1.5",children:[n.jsx(oo,{className:"w-3 h-3"})," ",p("common.edit")]}),n.jsxs("button",{onClick:async()=>{await u(e.id),a(null)},className:"flex-1 bg-red-600 text-white px-2 py-1.5 text-xs rounded-md hover:bg-red-700 transition-colors flex items-center justify-center gap-1.5",children:[n.jsx(ao,{className:"w-3 h-3"})," ",p("common.delete")]})]})]})]})})]})})},Sr=({isOpen:t,onClose:e,title:a,children:o,emptyMessage:r,emptySubtext:s})=>{const{t:l}=O();return n.jsxs(n.Fragment,{children:[t&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 transition-opacity duration-300 ease-in-out",onClick:e,"aria-hidden":"true"}),n.jsx("aside",{className:`fixed top-0 left-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-r-2 border-gray-700 shadow-2xl ${t?"translate-x-0":"-translate-x-full"}`,"aria-hidden":!t,children:n.jsxs("div",{className:"h-full flex flex-col pt-safe-top",children:[n.jsxs("div",{className:"px-4 pb-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[n.jsx("h1",{className:"text-xl font-bold",children:a}),n.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-700","aria-label":l("common.close"),children:n.jsx(Z,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-2 no-scrollbar",children:q.Children.count(o)===0?n.jsxs("div",{className:"text-center text-gray-400 mt-8 px-4",children:[n.jsx("p",{children:r}),n.jsx("p",{className:"text-sm mt-1",children:s})]}):n.jsx("ul",{className:"flex flex-col gap-2",children:o})}),n.jsx("div",{className:"pb-safe-bottom flex-shrink-0"})]})})]})},vr=({name:t,thumbnail:e,thumbnailAlt:a,icon:o,onClick:r,isSelected:s,ariaLabel:l})=>n.jsx("li",{children:n.jsxs("button",{onClick:r,className:Te("w-full flex items-center gap-3 text-left p-2 rounded-lg transition-colors duration-200",s?"bg-blue-600 text-white":"text-gray-200 hover:bg-gray-700"),"aria-label":l,"aria-current":s,children:[n.jsx("div",{className:"w-10 h-10 flex-shrink-0 bg-gray-900/50 rounded-md flex items-center justify-center",children:e?n.jsx("img",{src:e,alt:a,className:"w-full h-full object-contain"}):o}),n.jsx("span",{className:"flex-grow font-medium truncate",children:t})]})},t),Tr=({location:t,onClick:e,isSelected:a,collectionId:o})=>{var s,l;const{t:r}=O();return n.jsx(vr,{name:t.name,thumbnail:(s=t.stamp)==null?void 0:s.thumbnail,thumbnailAlt:(l=t.stamp)==null?void 0:l.name,icon:n.jsx(ze,{className:"w-6 h-6 text-gray-500"}),onClick:()=>e(t),isSelected:a,ariaLabel:r(o?"collectedStampsList.selectStamp":"locationList.selectLocation",{name:t.name})},o||t.id)},jr=({onSelectLocation:t,onClose:e,onLocationSelectedAndFocus:a})=>({handleSelect:d.useCallback(r=>{t(r),a&&a(r),e()},[t,e,a])}),kr=({isOpen:t,onClose:e,locations:a,selectedLocationId:o,onSelectLocation:r,onLocationSelectedAndFocus:s})=>{const{t:l}=O(),{handleSelect:i}=jr({onSelectLocation:r,onClose:e,onLocationSelectedAndFocus:s});return n.jsx(Sr,{isOpen:t,onClose:e,title:l("locationList.title"),emptyMessage:l("locationList.empty"),emptySubtext:l("locationList.emptySubtext"),children:a.map(c=>n.jsx(Tr,{location:c,onClick:i,isSelected:o===c.id},c.id))})},Er=q.memo(({isVisible:t,isPlacingOnMap:e,setIsPlacingOnMap:a,newLocationCoords:o,setNewLocationCoords:r,setEditingLocation:s,isLocationListOpen:l,setIsLocationListOpen:i,geolocations:c,deleteGeolocation:u,adminTestingRallyId:g})=>{const[h,m]=d.useState(null),{addToast:p}=ge(),{stamps:f}=ae(),{t:T}=O();d.useEffect(()=>{e&&p(T("mapEditor.addLocationToast"),"info")},[e,p,T]);const w=d.useMemo(()=>g?c.filter(y=>y.rally_id===g):c,[c,g]),R=d.useMemo(()=>w.map(y=>({...y,stamp:f.find(S=>S.id===y.stamp_id)||null})).sort((y,S)=>y.created_at&&S.created_at?new Date(S.created_at).getTime()-new Date(y.created_at).getTime():0),[w,f]),P=async y=>{window.confirm(T("mapEditor.deleteConfirm"))&&(await u(y),m(null))},k=y=>{m(y)},N=y=>{m(y)};return d.useEffect(()=>{o&&(s(null),m(null))},[o,m,s]),n.jsxs("div",{className:`w-full h-full ${t?"block":"hidden"}`,children:[n.jsx(wr,{isVisible:t,selectedLocation:h,setSelectedLocation:m,geolocations:w,setEditingLocation:s,setNewLocationCoords:r,isPlacingOnMap:e,setIsPlacingOnMap:a,deleteGeolocation:P,newLocationCoords:o,onLocationSelectedAndFocus:N,adminTestingRallyId:g}),n.jsx(kr,{isOpen:l,onClose:()=>i(!1),locations:R,selectedLocationId:(h==null?void 0:h.id)||null,onSelectLocation:k,onLocationSelectedAndFocus:N})]})}),Cr=({text:t})=>n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx(Pe,{className:"w-4 h-4 text-gray-500 cursor-help"}),n.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 w-max max-w-xs p-2 text-xs text-white bg-gray-900 border border-gray-600 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10",children:t})]});function Nr({label:t,name:e,value:a,min:o,max:r,step:s,unit:l="",tooltip:i,disabled:c=!1,onChange:u}){const g=m=>{var p;return s<1?m.toFixed(((p=s.toString().split(".")[1])==null?void 0:p.length)||2):m.toString()},h=(a-o)/(r-o)*100;return n.jsxs("div",{className:"pt-3 flex-1",children:[t&&n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{htmlFor:e,className:`text-sm font-medium ${c?"text-gray-500":"text-gray-300"}`,children:t}),i&&n.jsx(Cr,{text:i})]}),n.jsxs("span",{className:`text-sm font-mono ${c?"text-gray-500":"text-blue-400"}`,children:[g(a),l]})]}),n.jsx("input",{type:"range",id:e,name:e,min:o,max:r,step:s,value:a,onChange:u,disabled:c,className:"w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer slider disabled:cursor-not-allowed",style:{background:c?"#4b5563":`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${h}%, #4b5563 ${h}%, #4b5563 100%)`}})]})}const Rr=({initialData:t,onSave:e,onClose:a})=>{const[o,r]=d.useState(t.name||""),[s,l]=d.useState(t.description||""),[i,c]=d.useState(t.radius||100),[u,g]=d.useState(t.stamp_id||null),{stamps:h,stampsLoading:m}=ae(),{t:p}=O(),f=()=>{if(!o.trim()){alert(p("locationEditModal.validationError"));return}e({...t.id&&{id:t.id},name:o,description:s,radius:i,latitude:t.latitude,longitude:t.longitude,stamp_id:u})};return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:a,children:n.jsxs("div",{className:"relative w-full max-w-lg m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 sm:p-8 text-white transform animate-scale-in flex flex-col gap-6",onClick:T=>T.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h2",{className:"text-2xl font-bold",children:t.id?p("locationEditModal.titleEdit"):p("locationEditModal.titleAdd")}),n.jsx("button",{onClick:a,className:"p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":p("common.close"),children:n.jsx(Z,{className:"w-6 h-6"})})]}),n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsx("input",{type:"text",placeholder:p("locationEditModal.namePlaceholder"),value:o,onChange:T=>r(T.target.value),className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:outline-none transition"}),n.jsx("textarea",{placeholder:`${p("common.description")} (${p("common.optional")})`,value:s||"",onChange:T=>l(T.target.value),rows:3,className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:outline-none transition resize-none"}),n.jsx(Nr,{label:p("locationEditModal.radius"),name:"radius",value:i,min:10,max:1e3,step:10,unit:"m",onChange:T=>c(parseInt(T.target.value,10)),tooltip:p("locationEditModal.radiusTooltip")})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-3",children:p("locationEditModal.assignStamp")}),n.jsx("div",{className:"h-48 bg-gray-900/50 rounded-lg p-3 overflow-y-auto no-scrollbar border border-gray-700",children:m?n.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:p("locationEditModal.loadingStamps")}):n.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-3",children:[n.jsxs("button",{onClick:()=>g(null),className:`w-full aspect-square rounded-lg flex flex-col items-center justify-center text-gray-400 transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${u===null?"ring-2 ring-blue-500 bg-blue-500/10":"ring-1 ring-gray-600 hover:ring-blue-500 bg-gray-700"}`,children:[n.jsx(no,{className:"w-8 h-8"}),n.jsx("span",{className:"text-xs mt-1",children:p("locationEditModal.noStamp")})]}),h.map(T=>n.jsx("button",{onClick:()=>g(T.id),className:`w-full aspect-square rounded-lg overflow-hidden transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${u===T.id?"ring-2 ring-blue-500":"ring-1 ring-gray-700 hover:ring-blue-500"}`,children:n.jsx("img",{src:T.thumbnail,alt:T.name,className:"w-full h-full object-contain bg-gray-900/50"})},T.id))]})})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("button",{onClick:a,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:p("common.cancel")}),n.jsxs("button",{onClick:f,className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[n.jsx(ro,{className:"w-5 h-5"}),p("common.save")]})]})]})})},Mr=({isOpen:t,onClose:e,children:a,className:o})=>{const{t:r}=O();return t?n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:e,children:n.jsxs("div",{className:`relative w-full max-w-md m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in ${o}`,onClick:s=>s.stopPropagation(),children:[n.jsx("button",{onClick:e,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":r("common.close"),children:n.jsx(Z,{className:"w-5 h-5"})}),a]})}):null},bt=({isOpen:t,onClose:e,title:a,children:o})=>n.jsxs(Mr,{isOpen:t,onClose:e,className:"p-6 sm:p-8 flex flex-col gap-6",children:[n.jsx("h2",{className:"text-2xl font-bold",children:a}),o]}),Ir=({onSave:t,onClose:e})=>{const{t:a}=O(),[o,r]=d.useState(""),[s,l]=d.useState(""),[i,c]=d.useState({}),u=()=>{const h={},m=parseFloat(o),p=parseFloat(s);return o?(isNaN(m)||m<-90||m>90)&&(h.lat=a("coordInputModal.validation.latInvalid")):h.lat=a("coordInputModal.validation.latRequired"),s?(isNaN(p)||p<-180||p>180)&&(h.lon=a("coordInputModal.validation.lonInvalid")):h.lon=a("coordInputModal.validation.lonRequired"),c(h),Object.keys(h).length===0},g=h=>{h.preventDefault(),u()&&t({latitude:parseFloat(o),longitude:parseFloat(s)})};return n.jsx(bt,{isOpen:!0,onClose:e,title:a("coordInputModal.title"),children:n.jsxs("form",{onSubmit:g,className:"flex flex-col gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"latitude",className:"block text-sm font-medium text-gray-300 mb-1",children:a("coordInputModal.latitude")}),n.jsx("input",{id:"latitude",type:"number",step:"any",placeholder:a("coordInputModal.latitudePlaceholder"),value:o,onChange:h=>r(h.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i.lat?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),i.lat&&n.jsx("p",{className:"text-red-400 text-xs mt-1",children:i.lat})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"longitude",className:"block text-sm font-medium text-gray-300 mb-1",children:a("coordInputModal.longitude")}),n.jsx("input",{id:"longitude",type:"number",step:"any",placeholder:a("coordInputModal.longitudePlaceholder"),value:s,onChange:h=>l(h.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i.lon?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),i.lon&&n.jsx("p",{className:"text-red-400 text-xs mt-1",children:i.lon})]}),n.jsxs("div",{className:"flex gap-4 pt-2",children:[n.jsx("button",{type:"button",onClick:e,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:a("common.cancel")}),n.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[a("coordInputModal.next"),n.jsx(We,{className:"w-5 h-5"})]})]})]})})},_r=({onImport:t,onClose:e})=>{const{t:a}=O(),[o,r]=d.useState(""),[s,l]=d.useState(!1),[i,c]=d.useState(null),u=async()=>{if(c(null),!/^([NWR]\d+|\d+)$/i.test(o)){c("invalidId");return}l(!0);let p=o;/^\d+$/.test(o)&&(p=`N${o}`);try{const f=await fetch(`https://nominatim.openstreetmap.org/lookup?osm_ids=${p.toUpperCase()}&format=json`);if(!f.ok)throw new Error("Network response was not ok");const T=await f.json();T&&T.length>0?t({latitude:parseFloat(T[0].lat),longitude:parseFloat(T[0].lon)}):c("notFound")}catch(f){console.error("OSM Import Error:",f),c("network")}finally{l(!1)}},g=m=>{m.preventDefault(),u()},h={invalidId:a("osmImportModal.error.invalidId"),notFound:a("osmImportModal.error.notFound"),network:a("osmImportModal.error.network")};return n.jsx(bt,{isOpen:!0,onClose:e,title:a("osmImportModal.title"),children:n.jsxs("form",{onSubmit:g,className:"flex flex-col gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"osmId",className:"block text-sm font-medium text-gray-300 mb-1",children:a("osmImportModal.idLabel")}),n.jsx("input",{id:"osmId",type:"text",placeholder:a("osmImportModal.idPlaceholder"),value:o,onChange:m=>r(m.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),n.jsx("p",{className:"text-xs text-gray-400 mt-2",children:a("osmImportModal.helpText")})]}),i&&n.jsx("p",{className:"text-red-400 text-xs mt-1",children:h[i]}),n.jsxs("div",{className:"flex gap-4 pt-2",children:[n.jsx("button",{type:"button",onClick:e,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:a("common.cancel")}),n.jsx("button",{type:"submit",disabled:s||!o,className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:bg-gray-600 disabled:cursor-not-allowed",children:s?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),a("osmImportModal.importing")]}):n.jsxs(n.Fragment,{children:[n.jsx(Je,{className:"w-5 h-5"}),a("osmImportModal.import")]})})]})]})})},Pr=[{name:"Default",settings:{}},{name:"Gritty",settings:{edge_boost:5,wear_intensity:[.4,.2],noise_scale:[30,10],ink_depletion_intensity:[.5,.1],splat_density:.9}},{name:"Faded",settings:{edge_boost:1,wear_intensity:[.7,.1],noise_scale:[100,5],ink_depletion_intensity:[.8,.05],splat_density:.5,bleeding_factor:.2}},{name:"Clean",settings:{color_shape_shrink:1,shift:[.5,.2],rotation:[.2,.1],edge_width:2,edge_boost:1,wear_intensity:[.05,.01],ink_depletion_intensity:[.1,.01],splat_density:1.2,bleeding_factor:.05}}];async function zr(t,e,a,o){const r={successCount:0,totalCount:a.length,errors:[]};for(let s=0;s<a.length;s++){const l=a[s];try{const i=Pr.find(g=>g.name===l.preset),c={...mr,...i?i.settings:{}},u=await Qe({user_id:t,rally_id:e,name:l.name,thumbnail:"data:image/jpeg;base64,"+l.image,sourceImageURL:"data:image/jpeg;base64,"+l.image,settings:c},t);await ot({user_id:t,rally_id:e,stamp_id:u.id,name:l.name,description:l.description,latitude:l.coordinates[0],longitude:l.coordinates[1],radius:l.collection_radius},t),r.successCount++}catch(i){console.error(`Error processing item ${l.name}:`,i),r.errors.push({item:l,error:i.message})}o(Math.round((s+1)/a.length*100))}return r}const Ar=({isOpen:t,onClose:e,rallyId:a})=>{const{t:o}=O(),{addToast:r}=ge(),{user:s}=ye(),{refreshStamps:l}=ae(),[i,c]=d.useState(null),[u,g]=d.useState(0),[h,m]=d.useState("idle"),[p,f]=d.useState(null),T=d.useRef(null),w=k=>{if(k.target.files&&k.target.files[0]){const N=k.target.files[0];N.type==="application/json"?(c(N),m("idle"),f(null),g(0)):(c(null),m("error"),f(o("batchUpload.invalidFileType")),r(o("batchUpload.invalidFileType"),"error"))}},R=async()=>{if(!i){f(o("batchUpload.noFileSelected")),r(o("batchUpload.noFileSelected"),"error");return}if(!s){f(o("batchUpload.loginRequired")),r(o("batchUpload.loginRequired"),"error");return}m("uploading"),f(null);try{const k=new FileReader;k.onload=async N=>{var y;try{const S=(y=N.target)==null?void 0:y.result,_=JSON.parse(S);m("processing");const z=await zr(s.id,a,_,M=>{g(M)});z.errors.length>0?(m("error"),f(o("batchUpload.partialSuccess",{success:z.successCount,total:z.totalCount})),r(o("batchUpload.partialSuccess",{success:z.successCount,total:z.totalCount}),"info")):(m("success"),r(o("batchUpload.success",{count:z.successCount}),"success"),l())}catch(S){m("error"),f(o("batchUpload.invalidJson")+`: ${S.message}`),r(o("batchUpload.invalidJson"),"error")}},k.readAsText(i)}catch(k){m("error"),f(o("batchUpload.uploadFailed")+`: ${k.message}`),r(o("batchUpload.uploadFailed")+`: ${k.message}`,"error")}},P=()=>{c(null),g(0),m("idle"),f(null),T.current&&(T.current.value=""),e()};return t?n.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#1f2937",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:20,width:"90%",maxWidth:"425px",border:"1px solid #374151"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[n.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#f9fafb"},children:o("batchUpload.title")}),n.jsx("button",{onClick:P,style:{background:"none",border:"none",cursor:"pointer",color:"#9ca3af"},children:n.jsx(Z,{size:20})})]}),n.jsxs("div",{style:{marginBottom:"15px"},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"24px",border:"2px dashed #4b5563",borderRadius:"8px",color:"#9ca3af"},children:[n.jsx("input",{id:"json-upload",type:"file",accept:".json",onChange:w,style:{display:"none"},ref:T}),n.jsxs("label",{htmlFor:"json-upload",style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx(Ke,{size:48,style:{marginBottom:"8px"}}),n.jsx("p",{style:{fontSize:"0.875rem",marginBottom:"4px"},children:o("batchUpload.dragDrop")}),n.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280"},children:o("batchUpload.orClick")})]}),i&&n.jsxs("p",{style:{marginTop:"8px",fontSize:"0.875rem",color:"#f9fafb"},children:[o("batchUpload.selectedFile"),": ",i.name]})]}),h==="uploading"&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#60a5fa",marginTop:"15px"},children:[n.jsx(Oe,{size:20,style:{animation:"spin 1s linear infinite"}}),n.jsx("span",{children:o("batchUpload.readingFile")})]}),h==="processing"&&n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"15px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#60a5fa"},children:[n.jsx(Oe,{size:20,style:{animation:"spin 1s linear infinite"}}),n.jsx("span",{children:o("batchUpload.processingItems")})]}),n.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#4b5563",borderRadius:"4px",overflow:"hidden"},children:n.jsx("div",{style:{width:`${u}%`,height:"100%",backgroundColor:"#60a5fa",transition:"width 0.3s ease-in-out"}})}),n.jsxs("p",{style:{fontSize:"0.875rem",color:"#9ca3af",textAlign:"center"},children:[u,"%"]})]}),h==="success"&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#4ade80",marginTop:"15px"},children:[n.jsx(Ve,{size:20}),n.jsx("span",{children:o("batchUpload.uploadComplete")})]}),h==="error"&&p&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#ef4444",marginTop:"15px"},children:[n.jsx(so,{size:20}),n.jsx("span",{children:p})]}),n.jsx("button",{onClick:R,disabled:!i||h==="uploading"||h==="processing",style:{marginTop:"15px",width:"100%",padding:"10px 15px",backgroundColor:"#60a5fa",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",opacity:!i||h==="uploading"||h==="processing"?.5:1,transition:"opacity 0.2s ease-in-out"},children:o(h==="processing"?"common.submitting":"batchUpload.uploadButton")})]})]}):null},Dr=({editingLocation:t,newLocationCoords:e,setEditingLocation:a,setNewLocationCoords:o,coordInputOpen:r,setCoordInputOpen:s,osmImportOpen:l,setOsmImportOpen:i,isBatchUploadModalOpen:c,setIsBatchUploadModalOpen:u,managedRally:g})=>{const{addGeolocation:h,updateGeolocation:m}=ae(),{addToast:p}=ge(),{t:f}=O(),T=q.useCallback(async w=>{if(!(g!=null&&g.id)){console.error("Cannot save geolocation: managedRally.id is null."),p(f("locationModals.rallyNotSelectedError"),"error"),a(null),o(null);return}try{if("id"in w&&w.id){const{id:R,...P}=w;await m(R,P),p(f("locationModals.locationUpdatedSuccess"),"success")}else await h(w,g.id),p(f("locationModals.locationAddedSuccess"),"success")}catch(R){console.error("Error saving location:",R),p(f("locationModals.saveLocationError",{error:R instanceof Error?R.message:String(R)}),"error")}finally{a(null),o(null)}},[h,m,p,f,a,o,g]);return n.jsxs(n.Fragment,{children:[(t||e)&&!r&&!l&&n.jsx(Rr,{initialData:t||e,onSave:T,onClose:()=>{a(null),o(null)}}),r&&n.jsx(Ir,{onSave:w=>{s(!1),o(w)},onClose:()=>s(!1)}),l&&n.jsx(_r,{onImport:w=>{i(!1),o(w)},onClose:()=>i(!1)}),c&&g&&n.jsx(Ar,{isOpen:c,onClose:()=>u(!1),rallyId:g.id})]})};function Lr(){const{geolocations:t,geolocationsLoading:e,geolocationsError:a,addGeolocation:o,updateGeolocation:r,deleteGeolocation:s,refreshGeolocations:l}=ae();return d.useEffect(()=>{},[l]),{geolocations:t,loading:e,error:a,addGeolocation:o,updateGeolocation:r,deleteGeolocation:s,refreshGeolocations:()=>l()}}const Ue=q.lazy(()=>te(()=>import("./StampRally-N2-BhTqE.js"),__vite__mapDeps([4,1,0,2,3,5,6]))),Fr=q.lazy(()=>te(()=>import("./StampEditor-CcW1idC1.js"),__vite__mapDeps([7,1,0,2,3,5,6]))),Or=q.lazy(()=>te(()=>import("./JoinRallyScreen-DOjJ4RUf.js"),__vite__mapDeps([8,1,0,2,3,6]))),$r=q.lazy(()=>te(()=>import("./RallyAdminDashboard-BoVKsT4p.js"),__vite__mapDeps([9,1,0,2,3,6])));function Br(){const{user:t,loading:e,selectedRallyId:a,setSelectedRallyId:o,role:r}=ye(),[s,l]=d.useState("rally"),[i,c]=d.useState(!1),[u,g]=d.useState(null),[h,m]=d.useState(!1),[p,f]=d.useState(!1),[T,w]=d.useState(null),[R,P]=d.useState(null),[k,N]=d.useState(!1),[y,S]=d.useState(!1),[_,z]=d.useState(!1),[M,D]=d.useState(!1),{geolocations:J,deleteGeolocation:X}=Lr(),ne=W=>{switch(z(!1),W){case"map":D(!0);break;case"coords":N(!0);break;case"osm":S(!0);break;case"batch":c(!0);break}};d.useEffect(()=>{sessionStorage.getItem("splashSeen")||m(!0)},[]),d.useEffect(()=>{r&&!u&&l(r==="user"?"rally":"admin")},[r,u]);const re=()=>{m(!1),sessionStorage.setItem("splashSeen","true")},V=W=>{g(W),o(W.id),l("map")},G=()=>{g(null),l("admin")},Ee=()=>{if(r==="user")return n.jsx(q.Suspense,{fallback:n.jsx(ee,{}),children:n.jsx(Ue,{})});if(r==="admin"){const W=!!u,le=!W&&s==="admin",E=W&&s==="map",Q=W&&s==="rally",K=s==="stamp";return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`w-full h-full ${le?"block":"hidden"}`,children:n.jsx(q.Suspense,{fallback:n.jsx(ee,{}),children:n.jsx($r,{onManageRally:V})})}),E&&n.jsx(Er,{isVisible:E,isPlacingOnMap:M,setIsPlacingOnMap:D,newLocationCoords:R,setNewLocationCoords:P,setEditingLocation:w,isLocationListOpen:p,setIsLocationListOpen:f,geolocations:J,deleteGeolocation:X,adminTestingRallyId:u==null?void 0:u.id}),n.jsx("div",{className:`w-full h-full ${Q?"block":"hidden"}`,children:n.jsx(Ue,{adminTestingRallyId:u==null?void 0:u.id})}),n.jsx("div",{className:`w-full h-full ${K?"block":"hidden"}`,children:n.jsx(q.Suspense,{fallback:n.jsx(ee,{}),children:n.jsx(Fr,{})})})]})}return n.jsx(ee,{})};if(e)return n.jsx(ee,{});if(!t)return n.jsx(Rn,{});if(r==="user"&&!a)return n.jsx(q.Suspense,{fallback:n.jsx(ee,{}),children:n.jsx(Or,{})});const se=()=>{o(null),l("rally")};return n.jsxs(Bn,{mode:s,setMode:l,isAdmin:r==="admin",isManaging:!!u,managedRally:u,handleExitManagement:G,isLocationListOpen:p,setIsLocationListOpen:f,addMenuOpen:_,setAddMenuOpen:z,handleSelectAddMethod:ne,setIsPlacingOnMap:D,onJoinAnotherRally:se,children:[Ee(),h&&n.jsx(Mn,{onClose:re}),r==="admin"&&u&&n.jsx(Dr,{editingLocation:T,newLocationCoords:R,setEditingLocation:w,setNewLocationCoords:P,coordInputOpen:k,setCoordInputOpen:N,osmImportOpen:y,setOsmImportOpen:S,isBatchUploadModalOpen:i,setIsBatchUploadModalOpen:c,managedRally:u})]})}function Gr(){return n.jsx(po,{children:n.jsx(Po,{children:n.jsx(Nn,{children:n.jsx(yr,{children:n.jsx(Br,{})})})})})}const qe=document.getElementById("root");qe?lo.createRoot(qe).render(n.jsx(q.StrictMode,{children:n.jsx(Gr,{})})):console.error('Fatal error: The root element with ID "root" was not found in the DOM. React cannot be mounted.');export{Mr as B,In as C,Pn as D,Tr as L,Sr as S,Cr as T,ge as a,ye as b,be as c,gr as d,jr as e,ae as f,Yr as g,Hr as h,br as i,xr as j,Nr as k,lt as l,ct as m,dt as n,ut as o,mr as p,Pr as q,ko as r,U as s,Kr as t,O as u,tt as v,vo as w,To as x,jo as y};
