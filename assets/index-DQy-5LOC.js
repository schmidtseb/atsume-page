const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MapEditor-d2aSvmd4.js","assets/react-vendor-DJ-QoGxu.js","assets/vendor-CFJUWez9.js","assets/maplibre-gl-vendor-Csyg3Y42.js","assets/maplibre-gl-vendor-CuCRB34y.css","assets/useGeolocations-BZFd3C9v.js","assets/useGallery-BeyW6TB5.js","assets/BaseMap-BQCdfX77.js","assets/SliderControl-CLdAFiUk.js","assets/BatchUploadModal-BN2Glq3G.js","assets/presets-CtbnJzjA.js","assets/supabase-vendor-C_Ws-sQM.js","assets/StampRally-DU2E9eG-.js","assets/InteractiveCanvasView-C2H_W28k.js","assets/StampEditor-BP4-jiRX.js","assets/JoinRallyScreen-B9FpdjJD.js","assets/RallyAdminDashboard-DAeq1Qrp.js"])))=>i.map(i=>d[i]);
import{j as e,X as U,I as q,T as W,C as V,r as i,S as R,L as A,M as J,U as Y,a as X,b as M,c as O,A as Z,G as H,d as K,e as Q,f as ee,R as x,_ as P,g as te,h as oe}from"./react-vendor-DJ-QoGxu.js";import{c as ae}from"./supabase-vendor-C_Ws-sQM.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./vendor-CFJUWez9.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();const se={success:e.jsx(V,{className:"w-6 h-6 text-green-400"}),error:e.jsx(W,{className:"w-6 h-6 text-red-400"}),info:e.jsx(q,{className:"w-6 h-6 text-blue-400"})},ne=({id:t,message:o,type:a,onClose:l})=>e.jsxs("div",{role:"alert",className:"relative w-full max-w-sm mb-4 rounded-lg shadow-2xl bg-gray-800 border border-gray-700 p-4 flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:se[a]}),e.jsx("div",{className:"flex-1 text-sm font-medium text-gray-200 break-words",children:o}),e.jsx("button",{onClick:()=>l(t),"aria-label":"Close",className:"p-1 -m-1 rounded-full text-gray-500 hover:bg-gray-700 hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 transition-colors",children:e.jsx(U,{className:"h-4 w-4"})})]}),F=i.createContext(void 0),le=({children:t})=>{const[o,a]=i.useState([]),l=i.useCallback(s=>{a(u=>u.filter(c=>c.id!==s))},[]),n=i.useCallback((s,u)=>{a(c=>{const r=c.findIndex(g=>g.message===s&&g.type===u);if(r>-1){const g=[...c],w=g[r];return g.splice(r,1),[...g,{...w,id:Date.now()+Math.random()}]}else return[...c,{id:Date.now()+Math.random(),message:s,type:u}]}),setTimeout(()=>{a(c=>c.filter(r=>!(r.message===s&&r.type===u)))},3e3)},[]);return e.jsxs(F.Provider,{value:{addToast:n},children:[t,e.jsx("div",{"aria-live":"assertive",className:"pointer-events-none fixed inset-0 flex items-start justify-end p-4 sm:p-6 z-50",children:e.jsx("div",{className:"w-full max-w-sm",children:o.map(s=>e.jsx("div",{className:"pointer-events-auto",children:e.jsx(ne,{...s,onClose:l})},s.id))})})]})},re=()=>{const t=i.useContext(F);if(t===void 0)throw new Error("useToast must be used within a ToastProvider");return t},$="https://ffwekbhvkurimzfihtwt.supabase.co",z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZmd2VrYmh2a3VyaW16ZmlodHd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzMzY5MzcsImV4cCI6MjA2NzkxMjkzN30.MYqd-BVm8icPGQ0a67vaOe4bbamYa4hhahXGaVdWnEo",m=ae($,z);($.includes("YOUR_SUPABASE_URL")||z.includes("YOUR_SUPABASE_ANON_KEY"))&&console.warn("Supabase credentials are not set. Please update YOUR_SUPABASE_URL and YOUR_SUPABASE_ANON_KEY in src/lib/supabaseClient.ts");async function Dt(t){const o={user_id:t.user_id,name:t.name,thumbnail:t.thumbnail,sourceImageURL:t.sourceImageURL,settings:t.settings},{data:a,error:l}=await m.from("stamps").insert([o]).select().single();if(l)throw console.error("Error adding stamp:",l),l;return a}async function _t(){const{data:t,error:o}=await m.from("stamps").select("*").order("created_at",{ascending:!1});if(o)throw console.error("Error fetching stamps:",o),o;if(!t)return[];const a=[];for(const l of t)a.push({id:l.id,user_id:l.user_id,name:l.name,thumbnail:l.thumbnail,sourceImageURL:l.sourceImageURL,settings:l.settings});return a}async function Ut(t){const{error:o}=await m.from("stamps").delete().eq("id",t);if(o)throw console.error("Error deleting stamp:",o),o}async function Ft(t,o){const{error:a}=await m.from("stamps").update({name:o}).eq("id",t);if(a)throw console.error("Error updating stamp name:",a),a}async function $t(t){const{data:o,error:a}=await m.from("rallies").insert([t]).select().single();if(a)throw a;return o}async function zt(t){const{data:o,error:a}=await m.from("rallies").select("*").eq("admin_id",t).order("created_at",{ascending:!1});if(a)throw a;return o||[]}async function Bt(t,o){const{error:a}=await m.from("rallies").update(o).eq("id",t);if(a)throw a}async function Gt(t){const{error:o}=await m.from("rallies").delete().eq("id",t);if(o)throw o}async function qt(t){const{data:o,error:a}=await m.from("rallies").select("*").eq("access_code",t).eq("published",!0).maybeSingle();if(a)throw a;return o}async function ie(t){const{data:o,error:a}=await m.from("user_rallies").select("*").eq("user_id",t);if(a)throw a;return o||[]}async function Wt(t){const{error:o}=await m.from("user_rallies").insert([t]);if(o)throw o}async function Vt(t){const{data:o,error:a}=await m.from("geolocations").insert([t]).select().single();if(a)throw console.error("Error adding geolocation:",a),a;return o}async function Jt(t){const{data:o,error:a}=await m.from("geolocations").select("*").eq("rally_id",t).order("created_at",{ascending:!1});if(a)throw a;return o||[]}async function Yt(t,o){const{error:a}=await m.from("geolocations").update(o).eq("id",t);if(a)throw a}async function Xt(t){const{error:o}=await m.from("geolocations").delete().eq("id",t);if(o)throw o}async function Zt(t){const{data:o,error:a}=await m.from("collections").select("*").eq("rally_id",t);if(a)throw a;return o||[]}async function Ht(t){const{data:o,error:a}=await m.from("collections").insert([t]).select().single();if(a)throw a;return o}async function Kt(t,o){const{error:a}=await m.from("collections").update(o).eq("id",t);if(a)throw a}async function Qt(t){const{error:o}=await m.from("collections").delete().eq("id",t);if(o)throw o}const B=i.createContext(void 0),ce=({children:t})=>{const[o,a]=i.useState(null),[l,n]=i.useState(null),[s,u]=i.useState(null),[c,r]=i.useState(null),[g,w]=i.useState(!0),h=async f=>{var p;a(f);const d=(f==null?void 0:f.user)??null;if(n(d),d)try{const{data:y,error:S}=await m.from("profiles").select("role").eq("id",d.id).single();if(S&&S.code!=="PGRST116")throw S;const b=(y==null?void 0:y.role)||"user";if(u(b),b==="user"){const T=await ie(d.id);r(((p=T[0])==null?void 0:p.rally_id)||null)}else r(null)}catch(y){console.error("Error fetching profile or rally status:",y),u("user"),r(null)}else u(null),r(null)};i.useEffect(()=>{const d=(async()=>{w(!0);const{data:{session:p}}=await m.auth.getSession();await h(p),w(!1);const{data:{subscription:y}}=m.auth.onAuthStateChange(async(S,b)=>{await h(b)});return y})();return()=>{d.then(p=>{p==null||p.unsubscribe()})}},[]);const j={session:o,user:l,role:s,activeRallyId:c,setActiveRallyId:r,signInWithGoogle:async()=>{await m.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/atsume-page/"}})},signInWithPassword:async(f,d)=>{const{error:p}=await m.auth.signInWithPassword({email:f,password:d});return{error:p}},signUpWithEmail:async(f,d)=>{const{error:p}=await m.auth.signUp({email:f,password:d,options:{emailRedirectTo:window.location.origin+"/atsume-page/"}});return{error:p}},logout:async()=>{await m.auth.signOut()},loading:g};return e.jsx(B.Provider,{value:j,children:t})},L=()=>{const t=i.useContext(B);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},de={save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",add:"Add",close:"Close",confirm:"Confirm",submit:"Submit",submitting:"Submitting...",loading:"Loading...",error:"Error",success:"Success",info:"Info",name:"Name",description:"Description",optional:"optional"},ue={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",emailTab:"Email",signInWithGoogle:"Sign In with Google",googleDescription:"Redirects to Google to sign in securely.",signInTitle:"Sign In",createAccountTitle:"Create Account",emailPlaceholder:"your@email.com",passwordPlaceholder:"Password",confirmPasswordPlaceholder:"Confirm Password",passwordMismatchError:"Passwords do not match.",signUpSuccessToast:"Account created! Please check your email to confirm your account.",signIn:"Sign In",signUp:"Sign Up",toggle:{toSignUp:"Don't have an account? Sign Up",toSignIn:"Already have an account? Sign In"},userMenu:"Open user menu",signedInAs:"Signed in as",logout:"Log Out"},me={authenticating:"Authenticating...",pleaseWait:"Please wait a moment."},ge={title:"Atsume",subtitle:"スタンプ集め",tagline:"The interactive stamp pad.",description:"Turn any image into a work of art with a realistic stamp effect.",cta:"Get Started",version:"0.12.0",close:"Close splash screen"},pe={stamp:"Stamp Editor",map:"Map Editor",rally:"Stamp Rally",admin:"Admin"},he={title:"Stamp Parameters",close:"Close parameters panel",canvasControls:"Canvas Controls",changeImage:"Change Image",uploadImage:"Upload Image",addToGallery:"Add to Gallery",addToGalleryTooltip:"Saves the last stamp you made to the gallery",clear:"Clear",download:"Download",resetParameters:"Reset Parameters"},fe={label:"Presets"},be={posterization:{title:"Posterization & Shape",colors:"Colors",colorsTooltip:"The number of distinct color layers. 'Auto' detects prominent colors automatically.",auto:"Auto",backgroundThreshold:"Background Threshold",backgroundThresholdTooltip:"Pixels brighter than this value are treated as background and ignored.",shapeShrink:"Shape Shrink",shapeShrinkTooltip:"Shrinks each color layer to create gaps and a more distinct layered effect."},registration:{title:"Registration Errors",shift:"Shift",shiftAmountTooltip:"Average amount of horizontal/vertical misalignment between layers.",rotation:"Rotation",rotationAmountTooltip:"Average rotational misalignment between layers.",amount:"Amount",variation:"Variation",variationTooltip:"Randomness in the misalignment amount."},edge:{title:"Edge Effects",width:"Edge Width",widthTooltip:"The thickness of the border area around shapes that can be boosted.",boost:"Edge Boost",boostTooltip:"Increases ink density at the edges of shapes to simulate ink buildup."},wear:{title:"Wear & Tear",intensity:"Wear Intensity",noiseScale:"Noise Scale",inkDepletion:"Ink Depletion",inkDepletionAmountTooltip:"How faded the 'worn out' patches appear.",numPatches:"Num Patches",numPatchesAmountTooltip:"The number of 'worn out' patches.",patchSize:"Patch size",min:"Min",max:"Max"},splats:{title:"Ink Splats",density:"Splat Density",densityTooltip:"Controls the number of ink splats used to draw the image.",size:"Splat size",bleeding:"Bleeding Factor",bleedingTooltip:"Simulates ink bleeding into the paper just outside the stamp's edge."}},ye={pressureToast:"Pressure sensitivity enabled!",stampingErrorToast:"An error occurred while stamping. See console for details.",canvasClearedToast:"Canvas cleared",downloadErrorToast:"Nothing to download.",loadedStampToast:'Loaded stamp "{{name}}".',newStampToast:"Ready to create a new stamp.",generatingToast:"Generating stamp...",panMode:"Pan Mode Active",galleryToggle:"Open Stamp Gallery",settingsToggle:"Open Parameters Panel",toolbarToggle:"Open Brush Controls",stampingArea:"Stamping area"},xe={title:"Stamp Gallery",close:"Close gallery panel",createNew:"Create New Stamp",empty:"Your gallery is empty.",emptySubtext:"Create a stamp and add it from the parameters panel.",rename:"Rename {{name}}",confirmDelete:"Confirm delete {{name}}",cancelDelete:"Cancel delete"},we={title:"Stamp brush controls",hide:"Hide brush controls",size:"Size",sizeTooltip:"Controls the size of the stamp.",intensity:"Intensity",intensityTooltip:"Controls the ink density of the stamp.",pressureMessage:"Intensity is controlled by touch pressure."},Se={invalidFileToast:"Invalid file type. Please upload an image.",loadedToast:"Image loaded. Click on the paper to stamp!",loadUrlErrorToast:"Failed to load image from URL."},Te={resetToast:"Settings have been reset to default.",loadedPresetToast:'Loaded settings for "{{name}}".'},ve={loginToast:"Please log in to save stamps to your gallery.",loadErrorToast:"Could not load your stamp gallery.",addSuccessToast:'"{{name}}" added to your gallery.',addErrorToast:"Could not save stamp.",deleteSuccessToast:"Stamp deleted from gallery.",deleteErrorToast:"Could not delete stamp. Restoring...",renameSuccessToast:'Stamp renamed to "{{name}}".',renameErrorToast:'Could not rename stamp. Reverting to "{{oldName}}".'},je={loginToast:"Please log in to save locations.",loadErrorToast:"Could not load your map locations.",addSuccessToast:'Location "{{name}}" saved.',addErrorToast:"Could not save location.",updateSuccessToast:"Location updated.",updateErrorToast:"Could not update location.",deleteSuccessToast:"Location deleted.",deleteErrorToast:"Could not delete location."},Ce={loginToast:"Please log in to collect stamps.",loadErrorToast:"Could not load your collection progress.",addSuccessToast:"Stamp collected! Place it in your log-book.",addErrorToast:"Could not save collection progress.",updateSuccessToast:"Stamp placed in log-book!",updateErrorToast:"Could not save stamp placement.",placementCancelledToast:"Placement cancelled. Open the log-book to place the stamp later.",removePlacementSuccessToast:"Last placement undone. You can place the stamp again.",removePlacementErrorToast:"Could not undo placement."},Ee={addLocation:"Add Location",placeOnMap:"Place on Map",byCoordinates:"By Coordinates",fromOSM:"From OpenStreetMap",batchUpload:"Batch Upload",addLocationToast:"Click on the map to place a new location.",centeredToast:"Map centered on your location.",deleteConfirm:"Are you sure you want to delete this location?",viewLocation:"View {{name}}",noRallySelectedTitle:"No Rally Selected",noRallySelectedSubtitle:"Please select a rally from the Admin Dashboard to edit its map.",iOSLocationPrompt:"Tap the location button to center on your position",locationError:{denied:"Location access was denied. Please enable it in your browser settings to see your location on the map.",unavailable:"Your location is currently unavailable. Please check your signal and try again.",timeout:"Failed to get your location in time. Please try again.",unknown:"An unknown error occurred while trying to get your location."}},Ie={title:"Batch Upload Locations",dragDrop:"Drag & drop your JSON file here",orClick:"or click to select file",selectedFile:"Selected file",noFileSelected:"No file selected.",invalidFileType:"Invalid file type. Please upload a JSON file.",uploadButton:"Upload",readingFile:"Reading file...",processingItems:"Processing items...",uploadComplete:"Upload complete!",partialSuccess:"{{success}} of {{total}} items uploaded with some errors.",success:"Successfully uploaded {{count}} items.",invalidJson:"Invalid JSON format",uploadFailed:"Upload failed",loginRequired:"Please log in to batch upload locations."},Ne={title:"Enter Coordinates",latitude:"Latitude",longitude:"Longitude",latitudePlaceholder:"e.g., 51.5074",longitudePlaceholder:"e.g., -0.1278",validation:{latRequired:"Latitude is required.",lonRequired:"Longitude is required.",latInvalid:"Latitude must be between -90 and 90.",lonInvalid:"Longitude must be between -180 and 180."},next:"Next"},Pe={title:"Import from OpenStreetMap",idLabel:"OpenStreetMap ID",idPlaceholder:"e.g., 236578444 or R146656",helpText:"Enter an ID from OSM. For nodes, you can enter just the number (e.g., `236578444`). For ways/relations, include the prefix (e.g., `R146656`).",import:"Import",importing:"Importing...",error:{invalidId:"Invalid ID. Must be a number, or start with N, W, or R followed by numbers.",notFound:"Location not found for this ID. Please check the ID and try again.",network:"Could not connect to the OpenStreetMap API. Please check your internet connection."}},ke={titleAdd:"Add New Location",titleEdit:"Edit Location",namePlaceholder:"Location Name",validationError:"Please enter a name for the location.",radius:"Collection Radius",radiusTooltip:"The distance within which this stamp can be 'collected'.",assignStamp:"Assign a Stamp",noStamp:"No Stamp",loadingStamps:"Loading stamps..."},Re={collected:"Collected",locationStatus:"Status for {{name}}",progress:"{{collectedCount}} / {{totalCount}} Collected",logbookToggle:"Open Log-book",flyingToast:"Flying to {{name}}...",nearbyStamp:"There is a stamp nearby!",iOSLocationPrompt:"Tap the location button to center on your position",selectRallyToTestTitle:"Select a Rally to Test",selectRallyToTestSubtitle:"Please go to the Admin Dashboard to choose a rally to test.",locationError:{denied:"Location access was denied. The Stamp Rally requires location to work. Please enable it in your browser settings.",unavailable:"Your location is currently unavailable. Please check your signal and try again.",timeout:"Failed to get your location in time. Please try again.",unknown:"An unknown error occurred while trying to get your location."}},Ae={close:"Close Log-book",preparingStamp:"Preparing stamp...",pendingPlacement:"Place your newly collected stamp:",pendingPlacementSubtext:"Click to place, or click and drag to rotate.",panMode:"Pan Mode Active",clickToView:"Click to view details",stampingArea:"Log-book Stamping Area",prepareErrorToast:"Could not prepare stamp image.",placeErrorToast:"Failed to place stamp",placedToast:'Placed "{{name}}"',redo:"Redo"},Le={collected:"Stamp Collected!",noImage:"No Stamp Image"},Me={stampDesign:"Stamp Design",location:"Location",dateCollected:"Date Collected",goToLocation:"Go to {{name}} on the map"},Oe={title:"Locations",toggle:"Toggle Location List",empty:"No locations created yet.",emptySubtext:"Click the '+' button to add your first location.",selectLocation:"View {{name}} on map"},De={title:"Rally Dashboard",subtitle:"Create and manage your Stamp Rallies.",createButton:"Create New Rally",creating:"Creating...",newRallyName:"New Rally #{{count}}",loadError:"Failed to load rallies.",createSuccess:"New rally created.",createError:"Failed to create rally.",updateError:"Failed to update rally.",deleteConfirm:"Are you sure you want to delete this rally and all its locations? This cannot be undone.",deleteSuccess:"Rally deleted.",deleteError:"Failed to delete rally.",noDescription:"No description provided.",accessCode:"Access Code",status:"Status",published:"Published",draft:"Draft",manageRally:"Manage",backToDashboard:"Back to Dashboard",editing:"Editing",selectRallyPromptTitle:"Select a Rally",selectRallyPromptSubtitle:"Choose a rally from the dashboard to edit its map or test it."},_e={title:"Join a Rally",subtitle:"Enter an access code to get started.",placeholder:"ABCDEF",findButton:"Find Rally",joinButton:"Join Rally",joinSuccess:'Successfully joined "{{name}}"!',error:{notFound:"No published rally found with that code.",network:"Could not connect to the server. Please try again.",joinFailed:"Failed to join the rally.",alreadyJoined:"You have already joined this rally."}},Ue={duration:"Duration",infinite:"Infinite"},Fe={common:de,auth:ue,loadingScreen:me,splashScreen:ge,modeToggle:pe,rightSidebar:he,presetSelector:fe,settingsSections:be,stampEditor:ye,stampGallery:xe,stampToolbar:we,imageLoader:Se,stampSettings:Te,gallery:ve,geolocations:je,collections:Ce,mapEditor:Ee,batchUpload:Ie,coordInputModal:Ne,osmImportModal:Pe,locationEditModal:ke,rally:Re,logbook:Ae,stampDetailModal:Le,collectionDetailModal:Me,locationList:Oe,rallyAdmin:De,joinRally:_e,rallyJoinCard:Ue},$e={save:"保存",cancel:"キャンセル",delete:"削除",edit:"編集",add:"追加",close:"閉じる",confirm:"確認",submit:"送信",submitting:"送信中...",loading:"読み込み中...",error:"エラー",success:"成功",info:"情報",name:"名前",description:"説明",optional:"任意"},ze={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",emailTab:"メール",signInWithGoogle:"Googleでサインイン",googleDescription:"Googleにリダイレクトして安全にサインインします。",signInTitle:"サインイン",createAccountTitle:"アカウント作成",emailPlaceholder:"メールアドレス",passwordPlaceholder:"パスワード",confirmPasswordPlaceholder:"パスワード（確認）",passwordMismatchError:"パスワードが一致しません。",signUpSuccessToast:"アカウントが作成されました！メールを確認してアカウントを有効化してください。",signIn:"サインイン",signUp:"サインアップ",toggle:{toSignUp:"アカウントをお持ちでないですか？ サインアップ",toSignIn:"すでにアカウントをお持ちですか？ サインイン"},userMenu:"ユーザーメニューを開く",signedInAs:"サインイン中:",logout:"ログアウト"},Be={authenticating:"認証中...",pleaseWait:"しばらくお待ちください。"},Ge={title:"Atsume",subtitle:"スタンプ集め",tagline:"インタラクティブ・スタンプパッド",description:"どんな画像もリアルなスタンプ効果でアート作品に変身させます。",cta:"はじめる",version:"バージョン {{version}}",close:"スプラッシュスクリーンを閉じる"},qe={stamp:"スタンプエディター",map:"マップエディター",rally:"スタンプラリー",admin:"管理"},We={title:"スタンプ設定",close:"設定パネルを閉じる",canvasControls:"キャンバス操作",changeImage:"画像を変更",uploadImage:"画像をアップロード",addToGallery:"ギャラリーに追加",addToGalleryTooltip:"最後に作成したスタンプをギャラリーに保存します",clear:"クリア",download:"ダウンロード",resetParameters:"設定をリセット"},Ve={label:"プリセット"},Je={posterization:{title:"ポスタリゼーションと形状",colors:"色数",colorsTooltip:"個別のカラーレイヤーの数。「自動」は主要な色を自動的に検出します。",auto:"自動",backgroundThreshold:"背景のしきい値",backgroundThresholdTooltip:"この値より明るいピクセルは背景として無視されます。",shapeShrink:"形状の縮小",shapeShrinkTooltip:"各カラーレイヤーを縮小して隙間を作り、より明確なレイヤー効果を生み出します。"},registration:{title:"版ズレ",shift:"ずれ",shiftAmountTooltip:"レイヤー間の水平/垂直方向のずれの平均量。",rotation:"回転",rotationAmountTooltip:"レイヤー間の回転のずれの平均量。",amount:"量",variation:"ばらつき",variationTooltip:"ずれの量のランダム性。"},edge:{title:"エッジ効果",width:"エッジの幅",widthTooltip:"形状の境界線の太さ。この範囲が強調されます。",boost:"エッジの強調",boostTooltip:"形状の端のインク濃度を上げて、インクの溜まりをシミュレートします。"},wear:{title:"かすれ",intensity:"かすれの強さ",noiseScale:"ノイズのスケール",inkDepletion:"インクの枯渇",inkDepletionAmountTooltip:"「使い古された」パッチがどれだけ色褪せて見えるか。",numPatches:"パッチの数",numPatchesAmountTooltip:"「使い古された」パッチの数。",patchSize:"パッチのサイズ",min:"最小",max:"最大"},splats:{title:"インクの飛び散り",density:"インクの密度",densityTooltip:"画像の描画に使用されるインクの点の数を制御します。",size:"インクのサイズ",bleeding:"にじみ",bleedingTooltip:"スタンプの端の外側でインクが紙ににじむのをシミュレートします。"}},Ye={pressureToast:"筆圧感知が有効になりました！",stampingErrorToast:"スタンプ作成中にエラーが発生しました。詳細はコンソールを確認してください。",canvasClearedToast:"キャンバスをクリアしました",downloadErrorToast:"ダウンロードするものがありません。",loadedStampToast:"スタンプ「{{name}}」を読み込みました。",newStampToast:"新しいスタンプを作成する準備ができました。",generatingToast:"スタンプを生成中...",panMode:"パンモード有効",galleryToggle:"スタンプギャラリーを開く",settingsToggle:"設定パネルを開く",toolbarToggle:"ブラシコントロールを開く",stampingArea:"スタンプエリア"},Xe={title:"スタンプギャラリー",close:"ギャラリーパネルを閉じる",createNew:"新しいスタンプを作成",empty:"ギャラリーは空です。",emptySubtext:"スタンプを作成し、設定パネルから追加してください。",rename:"{{name}}の名前を変更",confirmDelete:"{{name}}の削除を確認",cancelDelete:"削除をキャンセル"},Ze={title:"スタンプブラシコントロール",hide:"ブラシコントロールを隠す",size:"サイズ",sizeTooltip:"スタンプのサイズを制御します。",intensity:"インク濃度",intensityTooltip:"スタンプのインク濃度を制御します。",pressureMessage:"インク濃度は筆圧で制御されます。"},He={invalidFileToast:"無効なファイルタイプです。画像をアップロードしてください。",loadedToast:"画像を読み込みました。紙の上をクリックしてスタンプしてください！",loadUrlErrorToast:"URLからの画像の読み込みに失敗しました。"},Ke={resetToast:"設定をデフォルトにリセットしました。",loadedPresetToast:"「{{name}}」の設定を読み込みました。"},Qe={loginToast:"ギャラリーにスタンプを保存するにはログインしてください。",loadErrorToast:"スタンプギャラリーの読み込みに失敗しました。",addSuccessToast:"「{{name}}」をギャラリーに追加しました。",addErrorToast:"スタンプを保存できませんでした。",deleteSuccessToast:"ギャラリーからスタンプを削除しました。",deleteErrorToast:"スタンプを削除できませんでした。元に戻しています...",renameSuccessToast:"スタンプ名を「{{name}}」に変更しました。",renameErrorToast:"スタンプ名を変更できませんでした。「{{oldName}}」に戻しています。"},et={loginToast:"場所を保存するにはログインしてください。",loadErrorToast:"マップの場所の読み込みに失敗しました。",addSuccessToast:"場所「{{name}}」を保存しました。",addErrorToast:"場所を保存できませんでした。",updateSuccessToast:"場所を更新しました。",updateErrorToast:"場所を更新できませんでした。",deleteSuccessToast:"場所を削除しました。",deleteErrorToast:"場所を削除できませんでした。"},tt={loginToast:"スタンプを収集するにはログインしてください。",loadErrorToast:"収集の進捗の読み込みに失敗しました。",addSuccessToast:"スタンプを収集しました！ログブックに配置してください。",addErrorToast:"収集の進捗を保存できませんでした。",updateSuccessToast:"スタンプをログブックに配置しました！",updateErrorToast:"スタンプの配置を保存できませんでした。",placementCancelledToast:"配置がキャンセルされました。後でログブックを開いてスタンプを配置してください。",removePlacementSuccessToast:"最後の配置を取り消しました。スタンプを再度配置できます。",removePlacementErrorToast:"配置の取り消しに失敗しました。"},ot={addLocation:"場所を追加",placeOnMap:"地図上で配置",byCoordinates:"座標で入力",fromOSM:"OpenStreetMapから",batchUpload:"一括アップロード",addLocationToast:"マップをクリックして新しい場所を配置してください。",centeredToast:"あなたの位置にマップを中央揃えしました。",deleteConfirm:"この場所を本当に削除しますか？",viewLocation:"{{name}}を表示",noRallySelectedTitle:"ラリーが選択されていません",noRallySelectedSubtitle:"管理ダッシュボードからラリーを選択して、その地図を編集してください。",iOSLocationPrompt:"位置情報ボタンをタップして現在地に中央揃えしてください",locationError:{denied:"位置情報へのアクセスが拒否されました。マップ上であなたの位置を表示するには、ブラウザの設定で有効にしてください。",unavailable:"現在、あなたの位置は利用できません。電波状況を確認して再試行してください。",timeout:"時間内にあなたの位置を取得できませんでした。再試行してください。",unknown:"位置情報の取得中に不明なエラーが発生しました。"}},at={title:"場所の一括アップロード",dragDrop:"JSONファイルをここにドラッグ＆ドロップ",orClick:"またはクリックしてファイルを選択",selectedFile:"選択されたファイル",noFileSelected:"ファイルが選択されていません。",invalidFileType:"無効なファイルタイプです。JSONファイルをアップロードしてください。",uploadButton:"アップロード",readingFile:"ファイルを読み込み中...",processingItems:"アイテムを処理中...",uploadComplete:"アップロード完了！",partialSuccess:"{{total}}件中{{success}}件のアイテムがエラーありでアップロードされました。",success:"{{count}}件のアイテムが正常にアップロードされました。",invalidJson:"無効なJSON形式",uploadFailed:"アップロードに失敗しました",loginRequired:"場所を一括アップロードするにはログインしてください。"},st={title:"座標を入力",latitude:"緯度",longitude:"経度",latitudePlaceholder:"例: 35.6895",longitudePlaceholder:"例: 139.6917",validation:{latRequired:"緯度は必須です。",lonRequired:"経度は必須です。",latInvalid:"緯度は-90から90の間でなければなりません。",lonInvalid:"経度は-180から180の間でなければなりません。"},next:"次へ"},nt={title:"OpenStreetMapからインポート",idLabel:"OpenStreetMap ID",idPlaceholder:"例: 236578444 または R146656",helpText:"OSMのIDを入力します。ノードの場合は数字のみ入力できます (例: `236578444`)。ウェイ/リレーションの場合は接頭辞を含めてください (例: `R146656`)。",import:"インポート",importing:"インポート中...",error:{invalidId:"無効なIDです。数字、またはN、W、Rで始まり数字が続く形式で入力してください。",notFound:"このIDの場所が見つかりませんでした。IDを確認して再試行してください。",network:"OpenStreetMap APIに接続できませんでした。インターネット接続を確認してください。"}},lt={titleAdd:"新しい場所を追加",titleEdit:"場所を編集",namePlaceholder:"場所の名前",validationError:"場所の名前を入力してください。",radius:"収集半径",radiusTooltip:"このスタンプを「収集」できる距離。",assignStamp:"スタンプを割り当て",noStamp:"スタンプなし",loadingStamps:"スタンプを読み込み中..."},rt={collected:"収集済み",locationStatus:"{{name}}のステータス",progress:"収集済み {{collectedCount}} / {{totalCount}}",logbookToggle:"ログブックを開く",flyingToast:"{{name}}へ移動中...",nearbyStamp:"近くにスタンプがあります！",iOSLocationPrompt:"位置情報ボタンをタップして現在地に中央揃えしてください",selectRallyToTestTitle:"テストするラリーを選択",selectRallyToTestSubtitle:"管理ダッシュボードからテストしたいラリーを選択してください。",locationError:{denied:"位置情報へのアクセスが拒否されました。スタンプラリーは位置情報が必要です。ブラウザの設定で有効にしてください。",unavailable:"現在、あなたの位置は利用できません。電波状況を確認して再試行してください。",timeout:"時間内にあなたの位置を取得できませんでした。再試行してください。",unknown:"位置情報の取得中に不明なエラーが発生しました。"}},it={close:"ログブックを閉じる",preparingStamp:"スタンプを準備中...",pendingPlacement:"新しく収集したスタンプを配置してください：",pendingPlacementSubtext:"クリックで配置、クリック＆ドラッグで回転します。",panMode:"パンモード有効",clickToView:"クリックして詳細を表示",stampingArea:"ログブックのスタンプエリア",prepareErrorToast:"スタンプ画像を準備できませんでした。",placeErrorToast:"スタンプを配置できませんでした。",placedToast:"「{{name}}」を配置しました",redo:"やり直し"},ct={collected:"スタンプ収集済み！",noImage:"スタンプ画像なし"},dt={stampDesign:"スタンプデザイン",location:"場所",dateCollected:"収集日",goToLocation:"マップで{{name}}に移動"},ut={title:"場所リスト",toggle:"場所リストの表示/非表示",empty:"まだ場所が作成されていません。",emptySubtext:"「+」ボタンをクリックして最初の場所を追加してください。",selectLocation:"マップで「{{name}}」を表示"},mt={title:"ラリー管理ダッシュボード",subtitle:"スタンプラリーを作成・管理します。",createButton:"新しいラリーを作成",creating:"作成中...",newRallyName:"新しいラリー #{{count}}",loadError:"ラリーの読み込みに失敗しました。",createSuccess:"新しいラリーが作成されました。",createError:"ラリーの作成に失敗しました。",updateError:"ラリーの更新に失敗しました。",deleteConfirm:"このラリーとそのすべての場所を本当に削除しますか？この操作は元に戻せません。",deleteSuccess:"ラリーを削除しました。",deleteError:"ラリーの削除に失敗しました。",noDescription:"説明がありません。",accessCode:"参加コード",status:"ステータス",published:"公開中",draft:"下書き",manageRally:"管理",backToDashboard:"ダッシュボードに戻る",editing:"編集中",selectRallyPromptTitle:"ラリーを選択",selectRallyPromptSubtitle:"ダッシュボードからラリーを選択して、地図を編集したりテストしたりします。"},gt={title:"ラリーに参加",subtitle:"参加コードを入力して始めましょう。",placeholder:"ABCDEF",findButton:"ラリーを探す",joinButton:"ラリーに参加",joinSuccess:"「{{name}}」に無事参加しました！",error:{notFound:"そのコードの公開ラリーが見つかりませんでした。",network:"サーバーに接続できませんでした。もう一度お試しください。",joinFailed:"ラリーへの参加に失敗しました。",alreadyJoined:"すでにこのラリーに参加しています。"}},pt={duration:"開催期間",infinite:"無期限"},ht={common:$e,auth:ze,loadingScreen:Be,splashScreen:Ge,modeToggle:qe,rightSidebar:We,presetSelector:Ve,settingsSections:Je,stampEditor:Ye,stampGallery:Xe,stampToolbar:Ze,imageLoader:He,stampSettings:Ke,gallery:Qe,geolocations:et,collections:tt,mapEditor:ot,batchUpload:at,coordInputModal:st,osmImportModal:nt,locationEditModal:lt,rally:rt,logbook:it,stampDetailModal:ct,collectionDetailModal:dt,locationList:ut,rallyAdmin:mt,joinRally:gt,rallyJoinCard:pt},ft={en:Fe,ja:ht},bt=(t,o)=>o.split(".").reduce((a,l)=>a&&a[l],t)||o,G=i.createContext(void 0),yt=()=>{if(typeof window<"u"){const t=localStorage.getItem("atsume-locale");if(t==="en"||t==="ja")return t;if(navigator.language.split(/[-_]/)[0]==="ja")return"ja"}return"en"},xt=({children:t})=>{const[o,a]=i.useState(yt()),l=s=>{a(s),typeof window<"u"&&localStorage.setItem("atsume-locale",s)},n=i.useCallback((s,u)=>{let c=bt(ft[o],s);return u&&Object.keys(u).forEach(r=>{c=c.replace(`{{${r}}}`,String(u[r]))}),c},[o]);return e.jsx(G.Provider,{value:{locale:o,setLocale:l,t:n},children:t})},E=()=>{const t=i.useContext(G);if(t===void 0)throw new Error("useLocale must be used within a LocaleProvider");return t},wt=()=>{const{signInWithGoogle:t,signInWithPassword:o,signUpWithEmail:a}=L(),[l,n]=i.useState("email"),[s,u]=i.useState("signIn"),[c,r]=i.useState(""),[g,w]=i.useState(""),[h,I]=i.useState(""),[k,v]=i.useState(null),[N,j]=i.useState(!1),{addToast:f}=re(),{t:d}=E(),p=()=>{r(""),w(""),I(""),v(null)},y=async b=>{if(b.preventDefault(),!(N||!c||!g)){if(j(!0),v(null),s==="signUp"){if(g!==h){v(d("auth.passwordMismatchError")),j(!1);return}const{error:T}=await a(c,g);T?v(T.message):(f(d("auth.signUpSuccessToast"),"success"),u("signIn"),p())}else{const{error:T}=await o(c,g);T&&v(T.message)}j(!1)}},S=({method:b,children:T})=>e.jsx("button",{onClick:()=>{n(b),p()},className:`w-full text-center text-sm font-medium py-2 px-3 rounded-md transition-colors duration-200 flex items-center justify-center gap-2 ${l===b?"bg-gray-700 text-white":"bg-transparent text-gray-400 hover:bg-gray-700/50"}`,children:T});return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("div",{className:"p-3 bg-blue-600/20 border-2 border-blue-500 rounded-full mb-4",children:e.jsx(R,{className:"w-12 h-12 text-blue-400"})}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:d("auth.title")}),e.jsx("h2",{className:"text-lg font-light text-gray-300 tracking-widest",children:d("auth.subtitle")})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 sm:p-8 border border-gray-700",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1 bg-gray-900/50 p-1 rounded-lg mb-6",children:[e.jsxs(S,{method:"google",children:[e.jsx(A,{className:"w-4 h-4"})," ",d("auth.googleTab")]}),e.jsxs(S,{method:"email",children:[e.jsx(J,{className:"w-4 h-4"})," ",d("auth.emailTab")]})]}),e.jsxs("div",{children:[l==="google"&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:t,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),d("auth.signInWithGoogle")]}),e.jsx("p",{className:"text-xs text-center text-gray-500 pt-2",children:d("auth.googleDescription")})]}),l==="email"&&e.jsxs("form",{onSubmit:y,className:"flex flex-col gap-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-center text-white",children:d(s==="signIn"?"auth.signInTitle":"auth.createAccountTitle")}),e.jsx("label",{htmlFor:"email",className:"sr-only",children:d("auth.emailTab")}),e.jsx("input",{id:"email",type:"email",value:c,onChange:b=>r(b.target.value),placeholder:d("auth.emailPlaceholder"),required:!0,className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition"}),e.jsx("label",{htmlFor:"password_1",className:"sr-only",children:d("auth.passwordPlaceholder")}),e.jsx("input",{id:"password_1",type:"password",value:g,onChange:b=>w(b.target.value),placeholder:d("auth.passwordPlaceholder"),required:!0,className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition"}),s==="signUp"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"password_2",className:"sr-only",children:d("auth.confirmPasswordPlaceholder")}),e.jsx("input",{id:"password_2",type:"password",value:h,onChange:b=>I(b.target.value),placeholder:d("auth.confirmPasswordPlaceholder"),required:!0,className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition"})]}),k&&e.jsx("p",{className:"text-red-400 text-sm text-center",children:k}),e.jsxs("button",{type:"submit",disabled:N,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[s==="signIn"?e.jsx(A,{className:"w-5 h-5"}):e.jsx(Y,{className:"w-5 h-5"}),d(N?"common.submitting":s==="signIn"?"auth.signIn":"auth.signUp")]}),e.jsx("p",{className:"text-center text-sm",children:e.jsx("button",{type:"button",onClick:()=>{u(s==="signIn"?"signUp":"signIn"),p()},className:"text-gray-400 hover:text-white underline",children:d(s==="signIn"?"auth.toggle.toSignUp":"auth.toggle.toSignIn")})})]})]})]})]})})},C=()=>{const{t}=E();return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-semibold text-white mb-2",children:t("loadingScreen.authenticating")}),e.jsx("p",{className:"text-gray-400",children:t("loadingScreen.pleaseWait")})]})})},St=({mode:t,setMode:o,isAdmin:a,isManaging:l})=>{const{t:n}=E(),s="flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg transition-colors duration-200",u="bg-blue-600 text-white",c="bg-gray-700/50 text-gray-300 hover:bg-gray-700",r=[{name:"admin",icon:X,title:n("modeToggle.admin"),disabled:!1},{name:"stamp",icon:R,title:n("modeToggle.stamp"),disabled:!1},{name:"map",icon:M,title:n("modeToggle.map"),disabled:!0},{name:"rally",icon:O,title:n("modeToggle.rally"),disabled:!0}],g=[{name:"map",icon:M,title:n("modeToggle.map"),disabled:!1},{name:"rally",icon:O,title:n("modeToggle.rally"),disabled:!1},{name:"stamp",icon:R,title:n("modeToggle.stamp"),disabled:!1}],w=l?g:r;return a?e.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 bg-gray-900/70 backdrop-blur-sm p-1 rounded-xl shadow-lg flex items-center gap-1",children:w.map(h=>e.jsx("button",{onClick:()=>o(h.name),className:`${s} ${t===h.name?u:c} ${h.disabled?"text-gray-500 hover:bg-gray-700/50 cursor-not-allowed":""}`,"aria-pressed":t===h.name,title:h.disabled?n("rallyAdmin.selectRallyPromptSubtitle"):h.title,disabled:h.disabled,children:e.jsx(h.icon,{className:"w-4 h-4"})},h.name))}):null},Tt=({onClose:t})=>{const{t:o}=E();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative w-full max-w-lg m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-8 text-center text-white transform animate-scale-in",children:[e.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":o("splashScreen.close"),children:e.jsx(U,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"p-4 bg-blue-600/20 border-2 border-blue-500 rounded-full mb-6",children:e.jsx(R,{className:"w-16 h-16 text-blue-400"})}),e.jsx("h1",{className:"text-5xl font-bold mb-1",children:o("splashScreen.title")}),e.jsx("h2",{className:"text-xl font-light text-gray-300 mb-6 tracking-widest",children:o("splashScreen.subtitle")}),e.jsxs("p",{className:"text-gray-400 mb-8",children:[o("splashScreen.tagline"),e.jsx("br",{}),o("splashScreen.description")]}),e.jsxs("button",{onClick:t,className:"w-full max-w-xs bg-blue-600 hover:bg-blue-700 font-bold py-4 px-8 rounded-xl transition-all duration-200 flex items-center justify-center gap-3 text-xl shadow-lg hover:shadow-blue-500/50 transform hover:scale-105",children:[o("splashScreen.cta"),e.jsx(Z,{className:"w-6 h-6"})]}),e.jsx("div",{className:"mt-8 text-xs text-gray-500",children:o("splashScreen.version",{version:"0.10.0"})})]})]})})},vt=()=>{const{locale:t,setLocale:o}=E(),[a,l]=i.useState(!1),n=i.useRef(null),s={en:"English",ja:"日本語"};i.useEffect(()=>{const c=r=>{n.current&&!n.current.contains(r.target)&&l(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]);const u=c=>{o(c),l(!1)};return e.jsxs("div",{ref:n,className:"relative",children:[e.jsxs("button",{onClick:()=>l(!a),className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700 rounded-md transition-colors","aria-haspopup":"true","aria-expanded":a,children:[e.jsx(H,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"flex-grow",children:s[t]}),e.jsx("svg",{className:`w-4 h-4 text-gray-400 transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&e.jsx("div",{className:"absolute right-0 bottom-full mb-2 w-40 bg-gray-800 border border-gray-700 rounded-lg shadow-lg py-1 z-10",role:"menu",children:Object.keys(s).map(c=>e.jsxs("button",{onClick:()=>u(c),className:"w-full flex items-center justify-between px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700",role:"menuitem",children:[s[c],t===c&&e.jsx(K,{className:"w-4 h-4 text-blue-400"})]},c))})]})},jt=()=>{const{user:t,logout:o}=L(),{t:a}=E(),[l,n]=i.useState(!1),s=i.useRef(null);return i.useEffect(()=>{const u=c=>{s.current&&!s.current.contains(c.target)&&n(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]),t?e.jsxs("div",{ref:s,className:"relative",children:[e.jsx("button",{onClick:()=>n(!l),className:"flex items-center justify-center w-10 h-10 bg-gray-700/50 hover:bg-gray-700 rounded-full transition-colors","aria-label":a("auth.userMenu"),title:t.email||"",children:e.jsx(Q,{className:"w-5 h-5 text-white"})}),l&&e.jsxs("div",{className:"absolute bottom-full mb-4 left-0 mt-2 w-64 bg-gray-800 border border-gray-700 rounded-xl shadow-lg z-50 p-2 flex flex-col gap-1",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-gray-700 mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:a("auth.signedInAs")}),e.jsx("p",{className:"text-xs text-gray-400 truncate",children:t.email})]}),e.jsx(vt,{}),e.jsxs("button",{onClick:o,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-red-400 hover:bg-red-500/10 hover:text-red-300 rounded-md transition-colors",children:[e.jsx(ee,{className:"w-4 h-4"}),a("auth.logout")]})]})]}):null},Ct=x.lazy(()=>P(()=>import("./MapEditor-d2aSvmd4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Et=x.lazy(()=>P(()=>import("./BatchUploadModal-BN2Glq3G.js"),__vite__mapDeps([9,1,2,3,4,10,6,5,11]))),D=x.lazy(()=>P(()=>import("./StampRally-DU2E9eG-.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,13,11]))),It=x.lazy(()=>P(()=>import("./StampEditor-BP4-jiRX.js"),__vite__mapDeps([14,1,2,3,4,13,8,6,10,11]))),Nt=x.lazy(()=>P(()=>import("./JoinRallyScreen-B9FpdjJD.js"),__vite__mapDeps([15,1,2,3,4,11]))),Pt=x.lazy(()=>P(()=>import("./RallyAdminDashboard-DAeq1Qrp.js"),__vite__mapDeps([16,1,2,3,4,11])));function kt(){const{user:t,loading:o,role:a,activeRallyId:l}=L(),[n,s]=i.useState("admin"),[u,c]=i.useState(!1),[r,g]=i.useState(null),[w,h]=i.useState(!1),{t:I}=E();i.useEffect(()=>{sessionStorage.getItem("splashSeen")||h(!0)},[]),i.useEffect(()=>{a&&!r&&s(a==="user"?"rally":"admin")},[a,r]);const k=()=>{h(!1),sessionStorage.setItem("splashSeen","true")},v=f=>{g(f),s("map")},N=()=>{g(null),s("admin")},j=()=>{if(a==="user")return e.jsx(x.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(D,{})});if(a==="admin"){const f=!!r,d=!f&&n==="admin",p=f&&n==="map",y=f&&n==="rally",S=n==="stamp";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`w-full h-full ${d?"block":"hidden"}`,children:e.jsx(x.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(Pt,{onManageRally:v})})}),e.jsx("div",{className:`w-full h-full ${p?"block":"hidden"}`,children:e.jsx(x.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(Ct,{editingRallyId:(r==null?void 0:r.id)||null,isVisible:p,setIsBatchUploadModalOpen:c})})}),e.jsx("div",{className:`w-full h-full ${y?"block":"hidden"}`,children:e.jsx(D,{adminTestingRallyId:(r==null?void 0:r.id)||null,isVisible:y})}),e.jsx("div",{className:`w-full h-full ${S?"block":"hidden"}`,children:e.jsx(x.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(It,{})})})]})}return e.jsx(C,{})};return o?e.jsx(C,{}):t?a==="user"&&!l?e.jsx(x.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(Nt,{})}):e.jsxs("div",{className:"h-screen w-screen bg-gray-900 text-white font-sans overflow-hidden",children:[e.jsxs("main",{className:"relative w-full h-full",children:[e.jsxs("div",{className:"absolute bottom-4 left-4 z-30 flex items-center gap-4",children:[e.jsx(jt,{}),a==="admin"&&r&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg bg-gray-900/70 backdrop-blur-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors",children:[e.jsx(te,{className:"w-4 h-4"}),I("rallyAdmin.backToDashboard")]}),e.jsxs("div",{className:"text-white bg-gray-900/70 backdrop-blur-sm px-3 py-2 rounded-lg hidden sm:block",children:[e.jsxs("span",{className:"text-gray-400",children:[I("rallyAdmin.editing"),":"]})," ",e.jsx("span",{className:"font-bold",children:r.name})]})]})]}),e.jsx(St,{mode:n,setMode:s,isAdmin:a==="admin",isManaging:!!r}),j()]}),w&&e.jsx(Tt,{onClose:k}),u&&r&&e.jsx(Et,{isOpen:u,onClose:()=>c(!1),rallyId:r.id})]}):e.jsx(wt,{})}function Rt(){return e.jsx(le,{children:e.jsx(ce,{children:e.jsx(xt,{children:e.jsx(kt,{})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("ServiceWorker registration successful with scope: ",t.scope)}).catch(t=>{console.log("ServiceWorker registration failed: ",t)})});const _=document.getElementById("root");_?oe.createRoot(_).render(e.jsx(x.StrictMode,{children:e.jsx(Rt,{})})):console.error('Fatal error: The root element with ID "root" was not found in the DOM. React cannot be mounted.');export{re as a,Dt as b,Vt as c,L as d,Ht as e,Kt as f,Zt as g,Qt as h,Jt as i,Yt as j,Xt as k,_t as l,Ut as m,Ft as n,qt as o,Wt as p,zt as q,$t as r,Bt as s,Gt as t,E as u};
