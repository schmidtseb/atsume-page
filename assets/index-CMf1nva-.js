const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StampRally-CIjbN7nL.js","assets/react-vendor-ZaBYvqzn.js","assets/vendor-xCeh1xEN.js","assets/maplibre-gl-vendor-Csyg3Y42.js","assets/maplibre-gl-vendor-CuCRB34y.css","assets/InteractiveCanvasView-OUx37KM3.js","assets/supabase-vendor-C5xB3bhr.js","assets/StampEditor-C2kZTFar.js","assets/JoinRallyScreen-CT_TLbxq.js","assets/RallyAdminDashboard-W86YGeQm.js"])))=>i.map(i=>d[i]);
var Nt=Object.defineProperty;var Ct=(t,e,o)=>e in t?Nt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var H=(t,e,o)=>Ct(t,typeof e!="symbol"?e+"":e,o);import{j as n,X as J,I as Ce,T as Mt,C as Be,r as d,S as we,L as Rt,A as Ue,G as It,a as Pt,b as _t,M as zt,U as At,c as Lt,d as Dt,e as Pe,f as _e,g as Me,i as Ft,k as Ge,l as qe,m as Ot,n as $t,P as Bt,o as Ut,p as Gt,q as qt,s as ze,t as Vt,u as Wt,v as Kt,w as Jt,R as G,x as Yt,y as Ht,z as Ae,B as Zt,_ as Se,D as Xt}from"./react-vendor-ZaBYvqzn.js";import{c as Qt}from"./supabase-vendor-C5xB3bhr.js";import{i as eo,j as to,k as oo}from"./vendor-xCeh1xEN.js";import{b as ao}from"./maplibre-gl-vendor-Csyg3Y42.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();const no={success:n.jsx(Be,{className:"w-6 h-6 text-green-400"}),error:n.jsx(Mt,{className:"w-6 h-6 text-red-400"}),info:n.jsx(Ce,{className:"w-6 h-6 text-blue-400"})},ro=({id:t,message:e,type:o,onClose:a})=>n.jsxs("div",{role:"alert",className:"relative w-full max-w-sm mb-4 rounded-lg shadow-2xl bg-gray-800 border border-gray-700 p-4 flex items-start gap-3",children:[n.jsx("div",{className:"flex-shrink-0 mt-0.5",children:no[o]}),n.jsx("div",{className:"flex-1 text-sm font-medium text-gray-200 break-words",children:e}),n.jsx("button",{onClick:()=>a(t),"aria-label":"Close",className:"p-1 -m-1 rounded-full text-gray-500 hover:bg-gray-700 hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 transition-colors",children:n.jsx(J,{className:"h-4 w-4"})})]}),Ve=d.createContext(void 0),so=({children:t})=>{const[e,o]=d.useState([]),a=d.useCallback(r=>{o(l=>l.filter(i=>i.id!==r))},[]),s=d.useCallback((r,l)=>{o(i=>{const c=i.findIndex(m=>m.message===r&&m.type===l);if(c>-1){const m=[...i],g=m[c];return m.splice(c,1),[...m,{...g,id:Date.now()+Math.random()}]}else return[...i,{id:Date.now()+Math.random(),message:r,type:l}]}),setTimeout(()=>{o(i=>i.filter(c=>!(c.message===r&&c.type===l)))},1500)},[]);return n.jsxs(Ve.Provider,{value:{addToast:s},children:[t,n.jsx("div",{"aria-live":"assertive",className:"pointer-events-none fixed inset-0 flex items-start justify-end p-4 sm:p-6 z-50",children:n.jsx("div",{className:"w-full max-w-sm",children:e.map(r=>n.jsx("div",{className:"pointer-events-auto",children:n.jsx(ro,{...r,onClose:a})},r.id))})})]})},me=()=>{const t=d.useContext(Ve);if(t===void 0)throw new Error("useToast must be used within a ToastProvider");return t},We="https://ffwekbhvkurimzfihtwt.supabase.co",Ke="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZmd2VrYmh2a3VyaW16ZmlodHd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzMzY5MzcsImV4cCI6MjA2NzkxMjkzN30.MYqd-BVm8icPGQ0a67vaOe4bbamYa4hhahXGaVdWnEo",V=Qt(We,Ke);(We.includes("YOUR_SUPABASE_URL")||Ke.includes("YOUR_SUPABASE_ANON_KEY"))&&console.warn("Supabase credentials are not set. Please update YOUR_SUPABASE_URL and YOUR_SUPABASE_ANON_KEY in src/lib/supabaseClient.ts");function q(t,e,o,a){const s=a?`Failed to ${e} ${a} in ${o}: ${t.message||"Unknown error"}`:`Failed to ${e} in ${o}: ${t.message||"Unknown error"}`;throw console.error(`Database Error - ${e} ${o}:`,t),new P(s,t,e)}class ve{constructor(e,o){H(this,"supabase");H(this,"tableName");this.supabase=e,this.tableName=o}async create(e,o){try{const{data:a,error:s}=await this.supabase.from(this.tableName).insert([e]).select().single();if(s&&q(s,"create",this.tableName,o),!a)throw new P(`No data returned after creating record in ${this.tableName}`);return a}catch(a){if(a instanceof P)throw a;q(a,"create",this.tableName,o)}}async readAll(e="created_at",o=!1,a){try{let s=this.supabase.from(this.tableName).select("*").order(e,{ascending:o});if(a)for(const i in a)s=s.eq(i,a[i]);let r,l;try{const i=await s;r=i.data,l=i.error}catch(i){throw console.error("CrudService.readAll: Error during query execution:",i),i}return l&&console.error("CrudService.readAll: Supabase query error:",l),l&&q(l,"read all",this.tableName),r||[]}catch(s){if(console.error("CrudService.readAll: Error in readAll:",s),s instanceof P)throw s;q(s,"read all",this.tableName)}}async readById(e,o){try{const{data:a,error:s}=await this.supabase.from(this.tableName).select("*").eq("id",e).maybeSingle();return s&&q(s,"read by id",this.tableName,o),a||null}catch(a){if(a instanceof P)throw a;q(a,"read by id",this.tableName,o)}}async update(e,o,a,s){try{let r=this.supabase.from(this.tableName).update(o).eq("id",e);if(s)for(const i in s)r=r.eq(i,s[i]);const{error:l}=await r;l&&q(l,"update",this.tableName,a)}catch(r){if(r instanceof P)throw r;q(r,"update",this.tableName,a)}}async delete(e,o,a){try{let s=this.supabase.from(this.tableName).delete().eq("id",e);if(a)for(const l in a)s=s.eq(l,a[l]);const{error:r}=await s;r&&q(r,"delete",this.tableName,o)}catch(s){if(s instanceof P)throw s;q(s,"delete",this.tableName,o)}}}function ge(...t){return eo(to(t))}function lo(t){return new Promise(e=>{const o=new Image;o.src=t,o.onload=()=>e(),o.onerror=a=>{console.error("Failed to preload image:",t,a),e()}})}function R(t,e){if(t==null||t==="")throw new Error(`${e} is required.`)}function _(t,e){if(!/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(t))throw new Error(`${e} must be a valid UUID.`)}class P extends Error{constructor(e,o,a){super(e),this.originalError=o,this.operation=a,this.name="DatabaseError"}}const Te=new ve(V,"stamps"),W=new ve(V,"rallies"),Q=new ve(V,"geolocations"),je=new ve(V,"collections");async function Je(t){R(t.user_id,"user_id"),R(t.name,"name"),_(t.user_id,"user_id");const e={user_id:t.user_id,name:t.name.trim(),thumbnail:t.thumbnail,sourceImageURL:t.sourceImageURL,settings:t.settings};return await Te.create(e,"stamp")}async function io(t){R(t,"userId"),_(t,"userId");try{return await Te.readAll("created_at",!1,{user_id:t})}catch(e){throw console.error("getUserStamps: Error during stampCrud.readAll:",e),e}}async function co(t,e){R(t,"id"),R(e,"userId"),_(t,"id"),_(e,"userId"),await Te.delete(t,"stamp",{user_id:e})}async function uo(t,e,o){R(t,"id"),R(e,"newName"),R(o,"userId"),_(t,"id"),_(o,"userId"),await Te.update(t,{name:e.trim()},"stamp name",{user_id:o})}async function mo(t){return R(t.admin_id,"admin_id"),R(t.name,"name"),_(t.admin_id,"admin_id"),await W.create(t,"rally")}async function go(t){return R(t,"adminId"),_(t,"adminId"),await W.readAll("created_at",!1,{admin_id:t})}async function ho(t,e,o){R(t,"id"),R(o,"adminId"),_(t,"id"),_(o,"adminId"),await W.update(t,e,"rally",{admin_id:o})}async function po(t,e){R(t,"id"),R(e,"adminId"),_(t,"id"),_(e,"adminId"),await W.delete(t,"rally",{admin_id:e})}async function fo(t){R(t,"accessCode");const e=await W.readAll("created_at",!1,{access_code:t.trim(),published:!0});return e.length>0?e[0]:null}async function bo(t){return R(t,"userId"),_(t,"userId"),await W.readAll("created_at",!1,{user_id:t})}async function Pr(t){var e;R(t.user_id,"user_id"),R(t.rally_id,"rally_id"),_(t.user_id,"user_id"),_(t.rally_id,"rally_id");try{await W.create(t,"user rally")}catch(o){throw o instanceof P&&((e=o.originalError)==null?void 0:e.code)==="23505"?new P("User is already joined to this rally"):o}}async function Ye(t,e){R(t.rally_id,"rally_id"),R(t.name,"name"),R(e,"adminId"),_(t.rally_id,"rally_id"),_(e,"adminId");const o=await W.readById(t.rally_id);if(!o||o.admin_id!==e)throw new P("Unauthorized to add geolocation to this rally");return await Q.create(t,"geolocation")}async function yo(t){return R(t,"rallyId"),_(t,"rallyId"),await Q.readAll("created_at",!1,{rally_id:t})}async function xo(t,e,o){R(t,"id"),R(o,"adminId"),_(t,"id"),_(o,"adminId");const a=await Q.readById(t);if(!a)throw new P("Geolocation not found");const s=await W.readById(a.rally_id);if(!s||s.admin_id!==o)throw new P("Unauthorized to update this geolocation");await Q.update(t,e,"geolocation")}async function wo(t,e){R(t,"id"),R(e,"adminId"),_(t,"id"),_(e,"adminId");const o=await Q.readById(t);if(!o)throw new P("Geolocation not found");const a=await W.readById(o.rally_id);if(!a||a.admin_id!==e)throw new P("Unauthorized to delete this geolocation");await Q.delete(t,"geolocation")}async function So(t,e){return R(t,"userId"),R(e,"rallyId"),_(t,"userId"),_(e,"rallyId"),await je.readAll("collected_at",!1,{user_id:t,rally_id:e})}async function Le(t){return R(t.user_id,"user_id"),R(t.rally_id,"rally_id"),R(t.geolocation_id,"geolocation_id"),_(t.user_id,"user_id"),_(t.rally_id,"rally_id"),_(t.geolocation_id,"geolocation_id"),await je.create(t,"collection")}async function vo(t,e,o){R(t,"id"),R(o,"userId"),_(t,"id"),_(o,"userId"),await je.update(t,e,"collection",{user_id:o})}async function To(t,e){R(t,"id"),R(e,"userId"),_(t,"id"),_(e,"userId"),await je.delete(t,"collection",{user_id:e})}const He=d.createContext(void 0),jo=({children:t})=>{const[e,o]=d.useState(null),[a,s]=d.useState(null),[r,l]=d.useState(null),[i,c]=d.useState(null),[m,g]=d.useState(!0),[p,u]=d.useState(null),h=d.useRef(!0),f=d.useCallback(b=>{h.current&&b()},[]),w=d.useCallback(async b=>{try{f(()=>{o(b),u(null)});const C=(b==null?void 0:b.user)??null;if(f(()=>s(C)),C)try{const{data:y,error:k}=await V.from("profiles").select("role").eq("id",C.id).single();if(k&&k.code!=="PGRST116")throw console.error("Error fetching user profile:",k),new Error("Failed to fetch user profile");const z=(y==null?void 0:y.role)||"user";if(f(()=>l(z)),z==="user"){const D=await bo(C.id);f(()=>{var F;c(((F=D[0])==null?void 0:F.rally_id)||null)})}else f(()=>c(null))}catch(y){console.error("Error processing user profile:",y),f(()=>{l(null),c(null),u(y instanceof Error?y.message:"Failed to load user profile")})}else f(()=>{l(null),c(null)})}catch(C){console.error("Error processing session:",C),f(()=>{u(C instanceof Error?C.message:"Authentication error")})}},[f]);d.useEffect(()=>{let b=null;const C=async()=>{try{f(()=>g(!0));const{data:{session:k},error:z}=await V.auth.getSession();if(z){console.error("Error getting session:",z),f(()=>u("Failed to initialize session"));return}await w(k);const{data:{subscription:D}}=V.auth.onAuthStateChange((F,B)=>{setTimeout(()=>{w(B)},0)});b=D}catch(k){console.error("Error initializing session:",k),f(()=>{u(k instanceof Error?k.message:"Failed to initialize authentication")})}finally{f(()=>g(!1))}},y=async()=>{if(document.visibilityState==="visible")try{const{data:{session:k},error:z}=await V.auth.getSession();if(z){console.error("Error refreshing session on visibility change:",z),f(()=>u("Failed to refresh session"));return}await w(k)}catch(k){console.error("Caught error during session refresh:",k),f(()=>u(k instanceof Error?k.message:"Failed to refresh session"))}};return C(),document.addEventListener("visibilitychange",y),()=>{h.current=!1,b&&b.unsubscribe(),document.removeEventListener("visibilitychange",y)}},[w,f]);const N=d.useCallback(async()=>{try{f(()=>u(null));const{error:b}=await V.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/atsume-page/`}});if(b)throw console.error("Google sign-in error:",b),f(()=>u("Failed to sign in with Google")),b}catch(b){throw console.error("Sign in error:",b),f(()=>{u(b instanceof Error?b.message:"Sign in failed")}),b}},[f]),E=d.useCallback(async()=>{try{f(()=>u(null));const{error:b}=await V.auth.signOut();if(b)throw console.error("Logout error:",b),f(()=>u("Failed to log out")),b}catch(b){throw console.error("Logout error:",b),f(()=>{u(b instanceof Error?b.message:"Logout failed")}),b}},[f]),M={session:e,user:a,role:r,activeRallyId:i,setActiveRallyId:c,signInWithGoogle:N,logout:E,loading:m,error:p};return n.jsx(He.Provider,{value:M,children:t})},he=()=>{const t=d.useContext(He);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},ko={save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",add:"Add",close:"Close",confirm:"Confirm",submit:"Submit",submitting:"Submitting...",loading:"Loading...",error:"Error",success:"Success",info:"Info",name:"Name",description:"Description",optional:"optional"},Eo={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Sign In with Google",googleDescription:"Redirects to Google to sign in securely.",signInTitle:"Sign In",createAccountTitle:"Create Account",passwordPlaceholder:"Password",confirmPasswordPlaceholder:"Confirm Password",passwordMismatchError:"Passwords do not match.",signIn:"Sign In",signUp:"Sign Up",toggle:{toSignUp:"Don't have an account? Sign Up",toSignIn:"Already have an account? Sign In"},userMenu:"Open user menu",signedInAs:"Signed in as",logout:"Log Out"},No={title:"Disclaimer"},Co={authenticating:"Authenticating...",pleaseWait:"Please wait a moment."},Mo={title:"Atsume",subtitle:"スタンプ集め",tagline:"The interactive stamp pad.",description:"Turn any image into a work of art with a realistic stamp effect.",cta:"Get Started",version:"0.12.0",close:"Close splash screen",impressumTitle:"Imprint",impressumContent:`Responsible according to 5 TMG / 18 MStV: 
Sebastian Schmidt
Private person
Germany
E-Mail: schm.seb@gmail.com`},Ro={stamp:"Stamp Editor",map:"Map Editor",rally:"Stamp Rally",admin:"Admin"},Io={title:"Stamp Parameters",close:"Close parameters panel",canvasControls:"Canvas Controls",changeImage:"Change Image",uploadImage:"Upload Image",addToGallery:"Add to Gallery",addToGalleryTooltip:"Saves the last stamp you made to the gallery",clear:"Clear",download:"Download",resetParameters:"Reset Parameters"},Po={label:"Presets",savePresetLabel:"Save Current Settings as New Preset",newPresetNamePlaceholder:"New preset name",saveButton:"Save",managePresets:"Manage Presets",savePresetSuccess:'Preset "{{name}}" saved successfully!',savePresetError:"Failed to save preset.",deletePresetSuccess:'Preset "{{name}}" deleted successfully!',deletePresetError:"Failed to delete preset."},_o={posterization:{title:"Posterization & Shape",colors:"Colors",colorsTooltip:"The number of distinct color layers. 'Auto' detects prominent colors automatically.",auto:"Auto",backgroundThreshold:"Background Threshold",backgroundThresholdTooltip:"Pixels brighter than this value are treated as background and ignored.",shapeShrink:"Shape Shrink",shapeShrinkTooltip:"Shrinks each color layer to create gaps and a more distinct layered effect."},registration:{title:"Registration Errors",shift:"Shift",shiftAmountTooltip:"Average amount of horizontal/vertical misalignment between layers.",rotation:"Rotation",rotationAmountTooltip:"Average rotational misalignment between layers.",amount:"Amount",variation:"Variation",variationTooltip:"Randomness in the misalignment amount."},edge:{title:"Edge Effects",width:"Edge Width",widthTooltip:"The thickness of the border area around shapes that can be boosted.",boost:"Edge Boost",boostTooltip:"Increases ink density at the edges of shapes to simulate ink buildup."},wear:{title:"Wear & Tear",intensity:"Wear Intensity",noiseScale:"Noise Scale",inkDepletion:"Ink Depletion",inkDepletionAmountTooltip:"How faded the 'worn out' patches appear.",numPatches:"Num Patches",numPatchesAmountTooltip:"The number of 'worn out' patches.",patchSize:"Patch size",min:"Min",max:"Max"},splats:{title:"Ink Splats",density:"Splat Density",densityTooltip:"Controls the number of ink splats used to draw the image.",size:"Splat size",bleeding:"Bleeding Factor",bleedingTooltip:"Simulates ink bleeding into the paper just outside the stamp's edge."}},zo={pressureToast:"Pressure sensitivity enabled!",stampingErrorToast:"An error occurred while stamping. See console for details.",canvasClearedToast:"Canvas cleared",downloadErrorToast:"Nothing to download.",loadedStampToast:'Loaded stamp "{{name}}".',newStampToast:"Ready to create a new stamp.",generatingToast:"Generating stamp...",panMode:"Pan Mode Active",galleryToggle:"Open Stamp Gallery",settingsToggle:"Open Parameters Panel",toolbarToggle:"Open Brush Controls",stampingArea:"Stamping area"},Ao={title:"Stamp Gallery",close:"Close gallery panel",createNew:"Create New Stamp",empty:"Your gallery is empty.",emptySubtext:"Create a stamp and add it from the parameters panel.",rename:"Rename {{name}}",confirmDelete:"Confirm delete {{name}}",cancelDelete:"Cancel delete"},Lo={title:"Stamp brush controls",hide:"Hide brush controls",size:"Size",sizeTooltip:"Controls the size of the stamp.",intensity:"Intensity",intensityTooltip:"Controls the ink density of the stamp.",pressureMessage:"Intensity is controlled by touch pressure."},Do={invalidFileToast:"Invalid file type. Please upload an image.",loadedToast:"Image loaded. Click on the paper to stamp!",loadUrlErrorToast:"Failed to load image from URL."},Fo={resetToast:"Settings have been reset to default.",loadedPresetToast:'Loaded settings for "{{name}}".'},Oo={loginToast:"Please log in to save stamps to your gallery.",loadErrorToast:"Could not load your stamp gallery.",addSuccessToast:'"{{name}}" added to your gallery.',addErrorToast:"Could not save stamp.",deleteSuccessToast:"Stamp deleted from gallery.",deleteErrorToast:"Could not delete stamp. Restoring...",renameSuccessToast:'Stamp renamed to "{{name}}".',renameErrorToast:'Could not rename stamp. Reverting to "{{oldName}}".'},$o={loginToast:"Please log in to save locations.",loadErrorToast:"Could not load your map locations.",addSuccessToast:'Location "{{name}}" saved.',addErrorToast:"Could not save location.",updateSuccessToast:"Location updated.",updateErrorToast:"Could not update location.",deleteSuccessToast:"Location deleted.",deleteErrorToast:"Could not delete location."},Bo={loginToast:"Please log in to collect stamps.",loadErrorToast:"Could not load your collection progress.",addSuccessToast:"Stamp collected! Place it in your log-book.",addErrorToast:"Could not save collection progress.",updateSuccessToast:"Stamp placed in log-book!",updateErrorToast:"Could not save stamp placement.",placementCancelledToast:"Placement was cancelled. Please collect the stamp again.",removePlacementSuccessToast:"Last placement undone. You can place the stamp again.",removePlacementErrorToast:"Could not undo placement."},Uo={addLocation:"Add Location",placeOnMap:"Place on Map",byCoordinates:"By Coordinates",fromOSM:"From OpenStreetMap",batchUpload:"Batch Upload",addLocationToast:"Click on the map to place a new location.",centeredToast:"Map centered on your location.",deleteConfirm:"Are you sure you want to delete this location?",deleteLocationSuccess:"Location deleted successfully!",viewLocation:"View {{name}}",noRallySelectedTitle:"No Rally Selected",noRallySelectedSubtitle:"Please select a rally from the Admin Dashboard to edit its map.",iOSLocationPrompt:"Tap the location button to center on your position",locationError:{denied:"Location access was denied. Please enable it in your browser settings to see your location on the map.",unavailable:"Your location is currently unavailable. Please check your signal and try again.",timeout:"Failed to get your location in time. Please try again.",unknown:"An unknown error occurred while trying to get your location."}},Go={title:"Batch Upload Locations",dragDrop:"Drag & drop your JSON file here",orClick:"or click to select file",selectedFile:"Selected file",noFileSelected:"No file selected.",invalidFileType:"Invalid file type. Please upload a JSON file.",uploadButton:"Upload",readingFile:"Reading file...",processingItems:"Processing items...",uploadComplete:"Upload complete!",partialSuccess:"{{success}} of {{total}} items uploaded with some errors.",success:"Successfully uploaded {{count}} items.",invalidJson:"Invalid JSON format",uploadFailed:"Upload failed",loginRequired:"Please log in to batch upload locations."},qo={title:"Enter Coordinates",latitude:"Latitude",longitude:"Longitude",latitudePlaceholder:"e.g., 51.5074",longitudePlaceholder:"e.g., -0.1278",validation:{latRequired:"Latitude is required.",lonRequired:"Longitude is required.",latInvalid:"Latitude must be between -90 and 90.",lonInvalid:"Longitude must be between -180 and 180."},next:"Next"},Vo={title:"Import from OpenStreetMap",idLabel:"OpenStreetMap ID",idPlaceholder:"e.g., 236578444 or R146656",helpText:"Enter an ID from OSM. For nodes, you can enter just the number (e.g., `236578444`). For ways/relations, include the prefix (e.g., `R146656`).",import:"Import",importing:"Importing...",error:{invalidId:"Invalid ID. Must be a number, or start with N, W, or R followed by numbers.",notFound:"Location not found for this ID. Please check the ID and try again.",network:"Could not connect to the OpenStreetMap API. Please check your internet connection."}},Wo={rallyNotSelectedError:"Error: Rally not selected. Cannot save location.",locationUpdatedSuccess:"Location updated successfully!",locationAddedSuccess:"Location added successfully!",saveLocationError:"Error saving location: {{error}}"},Ko={titleAdd:"Add New Location",titleEdit:"Edit Location",namePlaceholder:"Location Name",validationError:"Please enter a name for the location.",radius:"Collection Radius",radiusTooltip:"The distance within which this stamp can be 'collected'.",assignStamp:"Assign a Stamp",noStamp:"No Stamp",loadingStamps:"Loading stamps..."},Jo={collected:"Collected",locationStatus:"Status for {{name}}",progress:"{{collectedCount}} / {{totalCount}} Collected",logbookToggle:"Open Log-book",flyingToast:"Flying to {{name}}...",nearbyStamp:"There is a stamp nearby!",iOSLocationPrompt:"Tap the location button to center on your position",collectedStampsToggle:"Open Collected Stamps List",selectRallyToTestTitle:"Select a Rally to Test",selectRallyToTestSubtitle:"Please go to the Admin Dashboard to choose a rally to test.",locationError:{denied:"Location access was denied. The Stamp Rally requires location to work. Please enable it in your browser settings.",unavailable:"Your location is currently unavailable. Please check your signal and try again.",timeout:"Failed to get your location in time. Please try again.",unknown:"An unknown error occurred while trying to get your location."}},Yo={title:"Collected Stamps",empty:"You haven't collected any stamps yet.",emptySubtext:"Explore the map to find and collect stamps!",selectStamp:"View {{name}} on map"},Ho={close:"Close Log-book",preparingStamp:"Preparing stamp...",pendingPlacement:"Place your newly collected stamp:",pendingPlacementSubtext:"Click to place, or click and drag to rotate.",panMode:"Pan Mode Active",clickToView:"Click to view details",stampingArea:"Log-book Stamping Area",prepareErrorToast:"Could not prepare stamp image.",placeErrorToast:"Failed to place stamp",placedToast:'Placed "{{name}}"',redo:"Redo"},Zo={collected:"Stamp Collected!",noImage:"No Stamp Image"},Xo={stampDesign:"Stamp Design",location:"Location",dateCollected:"Date Collected",goToLocation:"Go to {{name}} on the map"},Qo={title:"Locations",toggle:"Toggle Location List",empty:"No locations created yet.",emptySubtext:"Click the '+' button to add your first location.",selectLocation:"View {{name}} on map"},ea={title:"Rally Dashboard",subtitle:"Create and manage your Stamp Rallies.",createButton:"Create New Rally",creating:"Creating...",newRallyName:"New Rally #{{count}}",loadError:"Failed to load rallies.",createSuccess:"New rally created.",createError:"Failed to create rally.",updateSuccess:"Rally updated successfully.",updateError:"Failed to update rally.",deleteConfirm:"Are you sure you want to delete this rally and all its locations? This cannot be undone.",deleteSuccess:"Rally deleted.",deleteError:"Failed to delete rally.",noDescription:"No description provided.",accessCode:"Access Code",status:"Status",published:"Published",draft:"Draft",manageRally:"Manage",backToDashboard:"Back to Dashboard",editing:"Editing",selectRallyPromptTitle:"Select a Rally",selectRallyPromptSubtitle:"Choose a rally from the dashboard to edit its map or test it."},ta={title:"Join a Rally",subtitle:"Enter an access code to get started.",placeholder:"ABCDEF",findButton:"Find Rally",joinButton:"Join Rally",joinSuccess:'Successfully joined "{{name}}"!',error:{notFound:"No published rally found with that code.",network:"Could not connect to the server. Please try again.",joinFailed:"Failed to join the rally.",alreadyJoined:"You have already joined this rally."}},oa={duration:"Duration",infinite:"Infinite"},aa={common:ko,auth:Eo,disclaimer:No,loadingScreen:Co,splashScreen:Mo,modeToggle:Ro,rightSidebar:Io,presetSelector:Po,settingsSections:_o,stampEditor:zo,stampGallery:Ao,stampToolbar:Lo,imageLoader:Do,stampSettings:Fo,gallery:Oo,geolocations:$o,collections:Bo,mapEditor:Uo,batchUpload:Go,coordInputModal:qo,osmImportModal:Vo,locationModals:Wo,locationEditModal:Ko,rally:Jo,collectedStampsList:Yo,logbook:Ho,stampDetailModal:Zo,collectionDetailModal:Xo,locationList:Qo,rallyAdmin:ea,joinRally:ta,rallyJoinCard:oa},na={save:"保存",cancel:"キャンセル",delete:"削除",edit:"編集",add:"追加",close:"閉じる",confirm:"確認",submit:"送信",submitting:"送信中...",loading:"読み込み中...",error:"エラー",success:"成功",info:"情報",name:"名前",description:"説明",optional:"任意"},ra={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Googleでサインイン",googleDescription:"Googleにリダイレクトして安全にサインインします。",signInTitle:"サインイン",createAccountTitle:"アカウント作成",passwordPlaceholder:"パスワード",confirmPasswordPlaceholder:"パスワード（確認）",passwordMismatchError:"パスワードが一致しません。",signIn:"サインイン",signUp:"サインアップ",toggle:{toSignUp:"アカウントをお持ちでないですか？ サインアップ",toSignIn:"すでにアカウントをお持ちですか？ サインイン"},userMenu:"ユーザーメニューを開く",signedInAs:"サインイン中:",logout:"ログアウト"},sa={title:"免責事項"},la={authenticating:"認証中...",pleaseWait:"しばらくお待ちください。"},ia={title:"Atsume",subtitle:"スタンプ集め",tagline:"インタラクティブ・スタンプパッド",description:"どんな画像もリアルなスタンプ効果でアート作品に変身させます。",cta:"はじめる",version:"バージョン {{version}}",close:"スプラッシュスクリーンを閉じる",impressumTitle:"インプリント",impressumContent:`責任者（§ 5 TMG / § 18 MStVによる）：
Sebastian Schmidt
個人事業主
ドイツ
Eメール：schm.seb@gmail.com`},ca={stamp:"スタンプエディター",map:"マップエディター",rally:"スタンプラリー",admin:"管理"},da={title:"スタンプ設定",close:"設定パネルを閉じる",canvasControls:"キャンバス操作",changeImage:"画像を変更",uploadImage:"画像をアップロード",addToGallery:"ギャラリーに追加",addToGalleryTooltip:"最後に作成したスタンプをギャラリーに保存します",clear:"クリア",download:"ダウンロード",resetParameters:"設定をリセット"},ua={label:"プリセット",savePresetLabel:"現在の設定を新しいプリセットとして保存",newPresetNamePlaceholder:"新しいプリセット名",saveButton:"保存",managePresets:"プリセットを管理",savePresetSuccess:"プリセット「{{name}}」が正常に保存されました！",savePresetError:"プリセットの保存に失敗しました。",deletePresetSuccess:"プリセット「{{name}}」が正常に削除されました！",deletePresetError:"プリセットの削除に失敗しました。"},ma={posterization:{title:"ポスタリゼーションと形状",colors:"色数",colorsTooltip:"個別のカラーレイヤーの数。「自動」は主要な色を自動的に検出します。",auto:"自動",backgroundThreshold:"背景のしきい値",backgroundThresholdTooltip:"この値より明るいピクセルは背景として無視されます。",shapeShrink:"形状の縮小",shapeShrinkTooltip:"各カラーレイヤーを縮小して隙間を作り、より明確なレイヤー効果を生み出します。"},registration:{title:"版ズレ",shift:"ずれ",shiftAmountTooltip:"レイヤー間の水平/垂直方向のずれの平均量。",rotation:"回転",rotationAmountTooltip:"レイヤー間の回転のずれの平均量。",amount:"量",variation:"ばらつき",variationTooltip:"ずれの量のランダム性。"},edge:{title:"エッジ効果",width:"エッジの幅",widthTooltip:"形状の境界線の太さ。この範囲が強調されます。",boost:"エッジの強調",boostTooltip:"形状の端のインク濃度を上げて、インクの溜まりをシミュレートします。"},wear:{title:"かすれ",intensity:"かすれの強さ",noiseScale:"ノイズのスケール",inkDepletion:"インクの枯渇",inkDepletionAmountTooltip:"「使い古された」パッチがどれだけ色褪せて見えるか。",numPatches:"パッチの数",numPatchesAmountTooltip:"「使い古された」パッチの数。",patchSize:"パッチのサイズ",min:"最小",max:"最大"},splats:{title:"インクの飛び散り",density:"インクの密度",densityTooltip:"画像の描画に使用されるインクの点の数を制御します。",size:"インクのサイズ",bleeding:"にじみ",bleedingTooltip:"スタンプの端の外側でインクが紙ににじむのをシミュレートします。"}},ga={pressureToast:"筆圧感知が有効になりました！",stampingErrorToast:"スタンプ作成中にエラーが発生しました。詳細はコンソールを確認してください。",canvasClearedToast:"キャンバスをクリアしました",downloadErrorToast:"ダウンロードするものがありません。",loadedStampToast:"スタンプ「{{name}}」を読み込みました。",newStampToast:"新しいスタンプを作成する準備ができました。",generatingToast:"スタンプを生成中...",panMode:"パンモード有効",galleryToggle:"スタンプギャラリーを開く",settingsToggle:"設定パネルを開く",toolbarToggle:"ブラシコントロールを開く",stampingArea:"スタンプエリア"},ha={title:"スタンプギャラリー",close:"ギャラリーパネルを閉じる",createNew:"新しいスタンプを作成",empty:"ギャラリーは空です。",emptySubtext:"スタンプを作成し、設定パネルから追加してください。",rename:"{{name}}の名前を変更",confirmDelete:"{{name}}の削除を確認",cancelDelete:"削除をキャンセル"},pa={title:"スタンプブラシコントロール",hide:"ブラシコントロールを隠す",size:"サイズ",sizeTooltip:"スタンプのサイズを制御します。",intensity:"インク濃度",intensityTooltip:"スタンプのインク濃度を制御します。",pressureMessage:"インク濃度は筆圧で制御されます。"},fa={invalidFileToast:"無効なファイルタイプです。画像をアップロードしてください。",loadedToast:"画像を読み込みました。紙の上をクリックしてスタンプしてください！",loadUrlErrorToast:"URLからの画像の読み込みに失敗しました。"},ba={resetToast:"設定をデフォルトにリセットしました。",loadedPresetToast:"「{{name}}」の設定を読み込みました。"},ya={loginToast:"ギャラリーにスタンプを保存するにはログインしてください。",loadErrorToast:"スタンプギャラリーの読み込みに失敗しました。",addSuccessToast:"「{{name}}」をギャラリーに追加しました。",addErrorToast:"スタンプを保存できませんでした。",deleteSuccessToast:"ギャラリーからスタンプを削除しました。",deleteErrorToast:"スタンプを削除できませんでした。元に戻しています...",renameSuccessToast:"スタンプ名を「{{name}}」に変更しました。",renameErrorToast:"スタンプ名を変更できませんでした。「{{oldName}}」に戻しています。"},xa={loginToast:"場所を保存するにはログインしてください。",loadErrorToast:"マップの場所の読み込みに失敗しました。",addSuccessToast:"場所「{{name}}」を保存しました。",addErrorToast:"場所を保存できませんでした。",updateSuccessToast:"場所を更新しました。",updateErrorToast:"場所を更新できませんでした。",deleteSuccessToast:"場所を削除しました。",deleteErrorToast:"場所を削除できませんでした。"},wa={loginToast:"スタンプを収集するにはログインしてください。",loadErrorToast:"収集の進捗の読み込みに失敗しました。",addSuccessToast:"スタンプを収集しました！ログブックに配置してください。",addErrorToast:"収集の進捗を保存できませんでした。",updateSuccessToast:"スタンプをログブックに配置しました！",updateErrorToast:"スタンプの配置を保存できませんでした。",placementCancelledToast:"配置がキャンセルされました。スタンプを再度収集してください。",removePlacementSuccessToast:"最後の配置を取り消しました。スタンプを再度配置できます。",removePlacementErrorToast:"配置の取り消しに失敗しました。"},Sa={addLocation:"場所を追加",placeOnMap:"地図上で配置",byCoordinates:"座標で入力",fromOSM:"OpenStreetMapから",batchUpload:"一括アップロード",addLocationToast:"マップをクリックして新しい場所を配置してください。",centeredToast:"あなたの位置にマップを中央揃えしました。",deleteConfirm:"この場所を本当に削除しますか？",deleteLocationSuccess:"場所が正常に削除されました！",viewLocation:"{{name}}を表示",noRallySelectedTitle:"ラリーが選択されていません",noRallySelectedSubtitle:"管理ダッシュボードからラリーを選択して、その地図を編集してください。",iOSLocationPrompt:"位置情報ボタンをタップして現在地に中央揃えしてください",locationError:{denied:"位置情報へのアクセスが拒否されました。マップ上であなたの位置を表示するには、ブラウザの設定で有効にしてください。",unavailable:"現在、あなたの位置は利用できません。電波状況を確認して再試行してください。",timeout:"時間内にあなたの位置を取得できませんでした。再試行してください。",unknown:"位置情報の取得中に不明なエラーが発生しました。"}},va={title:"場所の一括アップロード",dragDrop:"JSONファイルをここにドラッグ＆ドロップ",orClick:"またはクリックしてファイルを選択",selectedFile:"選択されたファイル",noFileSelected:"ファイルが選択されていません。",invalidFileType:"無効なファイルタイプです。JSONファイルをアップロードしてください。",uploadButton:"アップロード",readingFile:"ファイルを読み込み中...",processingItems:"アイテムを処理中...",uploadComplete:"アップロード完了！",partialSuccess:"{{total}}件中{{success}}件のアイテムがエラーありでアップロードされました。",success:"{{count}}件のアイテムが正常にアップロードされました。",invalidJson:"無効なJSON形式",uploadFailed:"アップロードに失敗しました",loginRequired:"場所を一括アップロードするにはログインしてください。"},Ta={title:"座標を入力",latitude:"緯度",longitude:"経度",latitudePlaceholder:"例: 35.6895",longitudePlaceholder:"例: 139.6917",validation:{latRequired:"緯度は必須です。",lonRequired:"経度は必須です。",latInvalid:"緯度は-90から90の間でなければなりません。",lonInvalid:"経度は-180から180の間でなければなりません。"},next:"次へ"},ja={title:"OpenStreetMapからインポート",idLabel:"OpenStreetMap ID",idPlaceholder:"例: 236578444 または R146656",helpText:"OSMのIDを入力します。ノードの場合は数字のみ入力できます (例: `236578444`)。ウェイ/リレーションの場合は接頭辞を含めてください (例: `R146656`)。",import:"インポート",importing:"インポート中...",error:{invalidId:"無効なIDです。数字、またはN、W、Rで始まり数字が続く形式で入力してください。",notFound:"このIDの場所が見つかりませんでした。IDを確認して再試行してください。",network:"OpenStreetMap APIに接続できませんでした。インターネット接続を確認してください。"}},ka={rallyNotSelectedError:"エラー：ラリーが選択されていません。場所を保存できません。",locationUpdatedSuccess:"場所が正常に更新されました！",locationAddedSuccess:"場所が正常に追加されました！",saveLocationError:"場所の保存中にエラーが発生しました：{{error}}"},Ea={titleAdd:"新しい場所を追加",titleEdit:"場所を編集",namePlaceholder:"場所の名前",validationError:"場所の名前を入力してください。",radius:"収集半径",radiusTooltip:"このスタンプを「収集」できる距離。",assignStamp:"スタンプを割り当て",noStamp:"スタンプなし",loadingStamps:"スタンプを読み込み中..."},Na={collected:"収集済み",locationStatus:"{{name}}のステータス",progress:"収集済み {{collectedCount}} / {{totalCount}}",logbookToggle:"ログブックを開く",flyingToast:"{{name}}へ移動中...",nearbyStamp:"近くにスタンプがあります！",iOSLocationPrompt:"位置情報ボタンをタップして現在地に中央揃えしてください",selectRallyToTestTitle:"テストするラリーを選択",selectRallyToTestSubtitle:"管理ダッシュボードからテストしたいラリーを選択してください。",locationError:{denied:"位置情報へのアクセスが拒否されました。スタンプラリーは位置情報が必要です。ブラウザの設定で有効にしてください。",unavailable:"現在、あなたの位置は利用できません。電波状況を確認して再試行してください。",timeout:"時間内にあなたの位置を取得できませんでした。再試行してください。",unknown:"位置情報の取得中に不明なエラーが発生しました。"}},Ca={close:"ログブックを閉じる",preparingStamp:"スタンプを準備中...",pendingPlacement:"新しく収集したスタンプを配置してください：",pendingPlacementSubtext:"クリックで配置、クリック＆ドラッグで回転します。",panMode:"パンモード有効",clickToView:"クリックして詳細を表示",stampingArea:"ログブックのスタンプエリア",prepareErrorToast:"スタンプ画像を準備できませんでした。",placeErrorToast:"スタンプを配置できませんでした。",placedToast:"「{{name}}」を配置しました",redo:"やり直し"},Ma={collected:"スタンプ収集済み！",noImage:"スタンプ画像なし"},Ra={stampDesign:"スタンプデザイン",location:"場所",dateCollected:"収集日",goToLocation:"マップで{{name}}に移動"},Ia={title:"場所リスト",toggle:"場所リストの表示/非表示",empty:"まだ場所が作成されていません。",emptySubtext:"「+」ボタンをクリックして最初の場所を追加してください。",selectLocation:"マップで「{{name}}」を表示"},Pa={title:"ラリー管理ダッシュボード",subtitle:"スタンプラリーを作成・管理します。",createButton:"新しいラリーを作成",creating:"作成中...",newRallyName:"新しいラリー #{{count}}",loadError:"ラリーの読み込みに失敗しました。",createSuccess:"新しいラリーが作成されました。",createError:"ラリーの作成に失敗しました。",updateSuccess:"ラリーを正常に更新しました。",updateError:"ラリーの更新に失敗しました。",deleteConfirm:"このラリーとそのすべての場所を本当に削除しますか？この操作は元に戻せません。",deleteSuccess:"ラリーを削除しました。",deleteError:"ラリーの削除に失敗しました。",noDescription:"説明がありません。",accessCode:"参加コード",status:"ステータス",published:"公開中",draft:"下書き",manageRally:"管理",backToDashboard:"ダッシュボードに戻る",editing:"編集中",selectRallyPromptTitle:"ラリーを選択",selectRallyPromptSubtitle:"ダッシュボードからラリーを選択して、地図を編集したりテストしたりします。"},_a={title:"ラリーに参加",subtitle:"参加コードを入力して始めましょう。",placeholder:"ABCDEF",findButton:"ラリーを探す",joinButton:"ラリーに参加",joinSuccess:"「{{name}}」に無事参加しました！",error:{notFound:"そのコードの公開ラリーが見つかりませんでした。",network:"サーバーに接続できませんでした。もう一度お試しください。",joinFailed:"ラリーへの参加に失敗しました。",alreadyJoined:"すでにこのラリーに参加しています。"}},za={duration:"開催期間",infinite:"無期限"},Aa={common:na,auth:ra,disclaimer:sa,loadingScreen:la,splashScreen:ia,modeToggle:ca,rightSidebar:da,presetSelector:ua,settingsSections:ma,stampEditor:ga,stampGallery:ha,stampToolbar:pa,imageLoader:fa,stampSettings:ba,gallery:ya,geolocations:xa,collections:wa,mapEditor:Sa,batchUpload:va,coordInputModal:Ta,osmImportModal:ja,locationModals:ka,locationEditModal:Ea,rally:Na,logbook:Ca,stampDetailModal:Ma,collectionDetailModal:Ra,locationList:Ia,rallyAdmin:Pa,joinRally:_a,rallyJoinCard:za},La={save:"Speichern",cancel:"Abbrechen",delete:"Löschen",edit:"Bearbeiten",add:"Hinzufügen",close:"Schließen",confirm:"Bestätigen",submit:"Senden",submitting:"Wird gesendet...",loading:"Lädt...",error:"Fehler",success:"Erfolg",info:"Info",name:"Name",description:"Beschreibung",optional:"optional"},Da={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Mit Google anmelden",googleDescription:"Leitet zu Google weiter, um sich sicher anzumelden.",signInTitle:"Anmelden",createAccountTitle:"Konto erstellen",passwordPlaceholder:"Passwort",confirmPasswordPlaceholder:"Passwort bestätigen",passwordMismatchError:"Passwörter stimmen nicht überein.",signIn:"Anmelden",signUp:"Registrieren",toggle:{toSignUp:"Noch kein Konto? Registrieren",toSignIn:"Bereits ein Konto? Anmelden"},userMenu:"Benutzermenü öffnen",signedInAs:"Angemeldet als",logout:"Abmelden"},Fa={title:"Haftungsausschluss"},Oa={authenticating:"Authentifiziere...",pleaseWait:"Bitte warten Sie einen Moment."},$a={title:"Atsume",subtitle:"スタンプ集め",tagline:"Das interaktive Stempelkissen.",description:"Verwandeln Sie jedes Bild in ein Kunstwerk mit einem realistischen Stempel-Effekt.",cta:"Los geht's",version:"0.12.0",close:"Splash-Screen schließen",impressumTitle:"Impressum",impressumContent:`Verantwortlich gemäß § 5 TMG / § 18 MStV: 
Sebastian Schmidt
Privatperson
Deutschland
E-Mail: schm.seb@gmail.com`},Ba={stamp:"Stempel-Editor",map:"Karten-Editor",rally:"Stempel-Rallye",admin:"Admin"},Ua={title:"Stempel-Parameter",close:"Parameter-Panel schließen",canvasControls:"Leinwand-Steuerung",changeImage:"Bild ändern",uploadImage:"Bild hochladen",addToGallery:"Zur Galerie hinzufügen",addToGalleryTooltip:"Speichert den zuletzt erstellten Stempel in der Galerie",clear:"Löschen",download:"Herunterladen",resetParameters:"Parameter zurücksetzen"},Ga={label:"Voreinstellungen",savePresetLabel:"Aktuelle Einstellungen als neue Voreinstellung speichern",newPresetNamePlaceholder:"Name der neuen Voreinstellung",saveButton:"Speichern",managePresets:"Voreinstellungen verwalten",savePresetSuccess:'Voreinstellung "{{name}}" erfolgreich gespeichert!',savePresetError:"Fehler beim Speichern der Voreinstellung.",deletePresetSuccess:'Voreinstellung "{{name}}" erfolgreich gelöscht!',deletePresetError:"Fehler beim Löschen der Voreinstellung."},qa={posterization:{title:"Posterisierung & Form",colors:"Farben",colorsTooltip:"Die Anzahl der verschiedenen Farbschichten. 'Auto' erkennt prominente Farben automatisch.",auto:"Auto",backgroundThreshold:"Hintergrund-Schwellenwert",backgroundThresholdTooltip:"Pixel, die heller als dieser Wert sind, werden als Hintergrund behandelt und ignoriert.",shapeShrink:"Form verkleinern",shapeShrinkTooltip:"Verkleinert jede Farbschicht, um Lücken und einen deutlicheren Schichteffekt zu erzeugen."},registration:{title:"Registrierungsfehler",shift:"Verschiebung",shiftAmountTooltip:"Durchschnittliche horizontale/vertikale Fehlausrichtung zwischen den Schichten.",rotation:"Rotation",rotationAmountTooltip:"Durchschnittliche rotatorische Fehlausrichtung zwischen den Schichten.",amount:"Betrag",variation:"Variation",variationTooltip:"Zufälligkeit im Fehlausrichtungsbetrag."},edge:{title:"Randeffekte",width:"Randbreite",widthTooltip:"Die Dicke des Randbereichs um Formen, der verstärkt werden kann.",boost:"Randverstärkung",boostTooltip:"Erhöht die Farbdichte an den Rändern von Formen, um Tintenansammlungen zu simulieren."},wear:{title:"Abnutzung",intensity:"Abnutzungsintensität",noiseScale:"Rauschskala",inkDepletion:"Tintenverlust",inkDepletionAmountTooltip:"Wie verblasst die 'abgenutzten' Stellen erscheinen.",numPatches:"Anzahl der Flecken",numPatchesAmountTooltip:"Die Anzahl der 'abgenutzten' Flecken.",patchSize:"Fleckengröße",min:"Min",max:"Max"},splats:{title:"Tintenspritzer",density:"Spritzerdichte",densityTooltip:"Steuert die Anzahl der Tintenkleckse, die zum Zeichnen des Bildes verwendet werden.",size:"Spritzergröße",bleeding:"Ausblutungsfaktor",bleedingTooltip:"Simuliert das Ausbluten von Tinte in das Papier direkt außerhalb des Stempelrandes."}},Va={pressureToast:"Druckempfindlichkeit aktiviert!",stampingErrorToast:"Beim Stempeln ist ein Fehler aufgetreten. Details in der Konsole.",canvasClearedToast:"Leinwand geleert",downloadErrorToast:"Nichts zum Herunterladen.",loadedStampToast:'Stempel "{{name}}" geladen.',newStampToast:"Bereit, einen neuen Stempel zu erstellen.",generatingToast:"Stempel wird generiert...",panMode:"Schwenkmodus aktiv",galleryToggle:"Stempelgalerie öffnen",settingsToggle:"Parameter-Panel öffnen",toolbarToggle:"Pinsel-Steuerung öffnen",stampingArea:"Stempelbereich"},Wa={title:"Stempelgalerie",close:"Galerie-Panel schließen",createNew:"Neuen Stempel erstellen",empty:"Deine Galerie ist leer.",emptySubtext:"Erstelle einen Stempel und füge ihn über das Parameter-Panel hinzu.",rename:"{{name}} umbenennen",confirmDelete:"{{name}} wirklich löschen?",cancelDelete:"Löschen abbrechen"},Ka={title:"Stempel-Pinsel-Steuerung",hide:"Pinsel-Steuerung ausblenden",size:"Größe",sizeTooltip:"Steuert die Größe des Stempels.",intensity:"Intensität",intensityTooltip:"Steuert die Farbdichte des Stempels.",pressureMessage:"Intensität wird durch den Druck gesteuert."},Ja={invalidFileToast:"Ungültiger Dateityp. Bitte lade ein Bild hoch.",loadedToast:"Bild geladen. Klicke auf das Papier, um zu stempeln!",loadUrlErrorToast:"Fehler beim Laden des Bildes von der URL."},Ya={resetToast:"Einstellungen wurden auf Standard zurückgesetzt.",loadedPresetToast:'Einstellungen für "{{name}}" geladen.'},Ha={loginToast:"Bitte melde dich an, um Stempel in deiner Galerie zu speichern.",loadErrorToast:"Deine Stempelgalerie konnte nicht geladen werden.",addSuccessToast:'"{{name}}" wurde deiner Galerie hinzugefügt.',addErrorToast:"Stempel konnte nicht gespeichert werden.",deleteSuccessToast:"Stempel aus Galerie gelöscht.",deleteErrorToast:"Stempel konnte nicht gelöscht werden. Wiederherstellung...",renameSuccessToast:'Stempel umbenannt zu "{{name}}".',renameErrorToast:'Stempel konnte nicht umbenannt werden. Zurücksetzen auf "{{oldName}}".'},Za={loginToast:"Bitte melde dich an, um Orte zu speichern.",loadErrorToast:"Deine Kartenorte konnten nicht geladen werden.",addSuccessToast:'Ort "{{name}}" gespeichert.',addErrorToast:"Ort konnte nicht gespeichert werden.",updateSuccessToast:"Ort aktualisiert.",updateErrorToast:"Ort konnte nicht aktualisiert werden.",deleteSuccessToast:"Ort gelöscht.",deleteErrorToast:"Ort konnte nicht gelöscht werden."},Xa={loginToast:"Bitte melde dich an, um Stempel zu sammeln.",loadErrorToast:"Dein Sammlungsfortschritt konnte nicht geladen werden.",addSuccessToast:"Stempel gesammelt! Platziere ihn in deinem Logbuch.",addErrorToast:"Sammlungsfortschritt konnte nicht gespeichert werden.",updateSuccessToast:"Stempel im Logbuch platziert!",updateErrorToast:"Stempelplatzierung konnte nicht gespeichert werden.",placementCancelledToast:"Platzierung wurde abgebrochen. Bitte sammle den Stempel erneut.",removePlacementSuccessToast:"Letzte Platzierung rückgängig gemacht. Du kannst den Stempel erneut platzieren.",removePlacementErrorToast:"Platzierung konnte nicht rückgängig gemacht werden."},Qa={addLocation:"Ort hinzufügen",placeOnMap:"Auf Karte platzieren",byCoordinates:"Nach Koordinaten",fromOSM:"Von OpenStreetMap",batchUpload:"Massen-Upload",addLocationToast:"Klicke auf die Karte, um einen neuen Ort zu platzieren.",centeredToast:"Karte auf deinen Standort zentriert.",deleteConfirm:"Möchtest du diesen Ort wirklich löschen?",deleteLocationSuccess:"Ort erfolgreich gelöscht!",viewLocation:"{{name}} ansehen",noRallySelectedTitle:"Keine Rallye ausgewählt",noRallySelectedSubtitle:"Bitte wähle eine Rallye aus dem Admin-Dashboard, um deren Karte zu bearbeiten.",iOSLocationPrompt:"Tippe auf den Standort-Button, um dich auf deiner Position zu zentrieren",locationError:{denied:"Standortzugriff wurde verweigert. Bitte aktiviere ihn in deinen Browser-Einstellungen, um deinen Standort auf der Karte zu sehen.",unavailable:"Dein Standort ist derzeit nicht verfügbar. Bitte überprüfe dein Signal und versuche es erneut.",timeout:"Dein Standort konnte nicht rechtzeitig ermittelt werden. Bitte versuche es erneut.",unknown:"Ein unbekannter Fehler ist beim Versuch, deinen Standort zu ermitteln, aufgetreten."}},en={title:"Orte im Stapel hochladen",dragDrop:"JSON-Datei hierher ziehen & ablegen",orClick:"oder klicken, um Datei auszuwählen",selectedFile:"Ausgewählte Datei",noFileSelected:"Keine Datei ausgewählt.",invalidFileType:"Ungültiger Dateityp. Bitte lade eine JSON-Datei hoch.",uploadButton:"Hochladen",readingFile:"Datei wird gelesen...",processingItems:"Elemente werden verarbeitet...",uploadComplete:"Upload abgeschlossen!",partialSuccess:"{{success}} von {{total}} Elementen mit Fehlern hochgeladen.",success:"Erfolgreich {{count}} Elemente hochgeladen.",invalidJson:"Ungültiges JSON-Format",uploadFailed:"Upload fehlgeschlagen",loginRequired:"Bitte melde dich an, um Orte im Stapel hochzuladen."},tn={title:"Koordinaten eingeben",latitude:"Breitengrad",longitude:"Längengrad",latitudePlaceholder:"z.B. 51.5074",longitudePlaceholder:"z.B. -0.1278",validation:{latRequired:"Breitengrad ist erforderlich.",lonRequired:"Längengrad ist erforderlich.",latInvalid:"Breitengrad muss zwischen -90 und 90 liegen.",lonInvalid:"Längengrad muss zwischen -180 und 180 liegen."},next:"Weiter"},on={title:"Aus OpenStreetMap importieren",idLabel:"OpenStreetMap ID",idPlaceholder:"z.B. 236578444 oder R146656",helpText:"Geben Sie eine ID von OSM ein. Für Knoten können Sie nur die Nummer eingeben (z.B. `236578444`). Für Wege/Relationen fügen Sie das Präfix hinzu (z.B. `R146656`).",import:"Importieren",importing:"Importiere...",error:{invalidId:"Ungültige ID. Muss eine Zahl sein oder mit N, W oder R gefolgt von Zahlen beginnen.",notFound:"Ort für diese ID nicht gefunden. Bitte überprüfen Sie die ID und versuchen Sie es erneut.",network:"Verbindung zur OpenStreetMap API konnte nicht hergestellt werden. Bitte überprüfen Sie Ihre Internetverbindung."}},an={rallyNotSelectedError:"Fehler: Rallye nicht ausgewählt. Ort kann nicht gespeichert werden.",locationUpdatedSuccess:"Ort erfolgreich aktualisiert!",locationAddedSuccess:"Ort erfolgreich hinzugefügt!",saveLocationError:"Fehler beim Speichern des Ortes: {{error}}"},nn={titleAdd:"Neuen Ort hinzufügen",titleEdit:"Ort bearbeiten",namePlaceholder:"Ortsname",validationError:"Bitte geben Sie einen Namen für den Ort ein.",radius:"Sammelradius",radiusTooltip:"Die Entfernung, innerhalb der dieser Stempel 'gesammelt' werden kann.",assignStamp:"Stempel zuweisen",noStamp:"Kein Stempel",loadingStamps:"Stempel werden geladen..."},rn={collected:"Gesammelt",locationStatus:"Status für {{name}}",progress:"{{collectedCount}} / {{totalCount}} Gesammelt",logbookToggle:"Logbuch öffnen",flyingToast:"Fliege zu {{name}}...",nearbyStamp:"Ein Stempel ist in der Nähe!",iOSLocationPrompt:"Tippe auf den Standort-Button, um dich auf deiner Position zu zentrieren",collectedStampsToggle:"Gesammelte Stempel-Liste öffnen",selectRallyToTestTitle:"Wähle eine Rallye zum Testen",selectRallyToTestSubtitle:"Bitte gehe zum Admin-Dashboard, um eine Rallye zum Testen auszuwählen.",locationError:{denied:"Standortzugriff wurde verweigert. Die Stempel-Rallye benötigt den Standort, um zu funktionieren. Bitte aktiviere ihn in deinen Browser-Einstellungen.",unavailable:"Dein Standort ist derzeit nicht verfügbar. Bitte überprüfe dein Signal und versuche es erneut.",timeout:"Dein Standort konnte nicht rechtzeitig ermittelt werden. Bitte versuche es erneut.",unknown:"Ein unbekannter Fehler ist beim Versuch, deinen Standort zu ermitteln, aufgetreten."}},sn={title:"Gesammelte Stempel",empty:"Du hast noch keine Stempel gesammelt.",emptySubtext:"Erkunde die Karte, um Stempel zu finden und zu sammeln!",selectStamp:"{{name}} auf Karte ansehen"},ln={close:"Logbuch schließen",preparingStamp:"Stempel wird vorbereitet...",pendingPlacement:"Platziere deinen neu gesammelten Stempel:",pendingPlacementSubtext:"Klicken zum Platzieren, oder klicken und ziehen zum Drehen.",panMode:"Schwenkmodus aktiv",clickToView:"Klicken zum Anzeigen der Details",stampingArea:"Logbuch-Stempelbereich",prepareErrorToast:"Stempelbild konnte nicht vorbereitet werden.",placeErrorToast:"Stempel konnte nicht platziert werden",placedToast:'Platziert "{{name}}"',redo:"Wiederholen"},cn={collected:"Stempel gesammelt!",noImage:"Kein Stempelbild"},dn={stampDesign:"Stempeldesign",location:"Ort",dateCollected:"Datum gesammelt",goToLocation:"Gehe zu {{name}} auf der Karte"},un={title:"Orte",toggle:"Ortsliste umschalten",empty:"Noch keine Orte erstellt.",emptySubtext:"Klicke auf den '+' Button, um deinen ersten Ort hinzuzufügen.",selectLocation:"{{name}} auf Karte ansehen"},mn={title:"Rallye-Dashboard",subtitle:"Erstelle und verwalte deine Stempel-Rallyes.",createButton:"Neue Rallye erstellen",creating:"Wird erstellt...",newRallyName:"Neue Rallye #{{count}}",loadError:"Rallyes konnten nicht geladen werden.",createSuccess:"Neue Rallye erstellt.",createError:"Rallye konnte nicht erstellt werden.",updateSuccess:"Rallye erfolgreich aktualisiert.",updateError:"Rallye konnte nicht aktualisiert werden.",deleteConfirm:"Möchtest du diese Rallye und alle ihre Orte wirklich löschen? Dies kann nicht rückgängig gemacht werden.",deleteSuccess:"Rallye gelöscht.",deleteError:"Rallye konnte nicht gelöscht werden.",noDescription:"Keine Beschreibung vorhanden.",accessCode:"Zugangscode",status:"Status",published:"Veröffentlicht",draft:"Entwurf",manageRally:"Verwalten",backToDashboard:"Zurück zum Dashboard",editing:"Bearbeiten",selectRallyPromptTitle:"Wähle eine Rallye",selectRallyPromptSubtitle:"Wähle eine Rallye aus dem Dashboard, um deren Karte zu bearbeiten oder sie zu testen."},gn={title:"Einer Rallye beitreten",subtitle:"Geben Sie einen Zugangscode ein, um zu beginnen.",placeholder:"ABCDEF",findButton:"Rallye finden",joinButton:"Rallye beitreten",joinSuccess:'Erfolgreich "{{name}}" beigetreten!',error:{notFound:"Keine veröffentlichte Rallye mit diesem Code gefunden.",network:"Verbindung zum Server konnte nicht hergestellt werden. Bitte versuchen Sie es erneut.",joinFailed:"Beitritt zur Rallye fehlgeschlagen.",alreadyJoined:"Du bist dieser Rallye bereits beigetreten."}},hn={duration:"Dauer",infinite:"Unendlich"},pn={common:La,auth:Da,disclaimer:Fa,loadingScreen:Oa,splashScreen:$a,modeToggle:Ba,rightSidebar:Ua,presetSelector:Ga,settingsSections:qa,stampEditor:Va,stampGallery:Wa,stampToolbar:Ka,imageLoader:Ja,stampSettings:Ya,gallery:Ha,geolocations:Za,collections:Xa,mapEditor:Qa,batchUpload:en,coordInputModal:tn,osmImportModal:on,locationModals:an,locationEditModal:nn,rally:rn,collectedStampsList:sn,logbook:ln,stampDetailModal:cn,collectionDetailModal:dn,locationList:un,rallyAdmin:mn,joinRally:gn,rallyJoinCard:hn},fn={en:aa,ja:Aa,de:pn},bn=(t,e)=>e.split(".").reduce((o,a)=>o&&o[a],t)||e,Ze=d.createContext(void 0),yn=()=>{if(typeof window<"u"){const t=localStorage.getItem("atsume-locale");if(t==="en"||t==="ja"||t==="de")return t;const e=navigator.language.split(/[-_]/)[0];if(e==="ja")return"ja";if(e==="de")return"de"}return"en"},xn=({children:t})=>{const[e,o]=d.useState(yn()),a=r=>{o(r),typeof window<"u"&&localStorage.setItem("atsume-locale",r)},s=d.useCallback((r,l)=>{let i=bn(fn[e],r);return l&&Object.keys(l).forEach(c=>{i=i.replace(`{{${c}}}`,String(l[c]))}),i},[e]);return n.jsx(Ze.Provider,{value:{locale:e,setLocale:a,t:s},children:t})},A=()=>{const t=d.useContext(Ze);if(t===void 0)throw new Error("useLocale must be used within a LocaleProvider");return t},wn=()=>{const{signInWithGoogle:t}=he(),{t:e}=A();return n.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"flex flex-col items-center mb-8",children:[n.jsx("div",{className:"p-3 bg-blue-600/20 border-2 border-blue-500 rounded-full mb-4",children:n.jsx(we,{className:"w-12 h-12 text-blue-400"})}),n.jsx("h1",{className:"text-4xl font-bold text-white",children:e("auth.title")}),n.jsx("h2",{className:"text-lg font-light text-gray-300 tracking-widest",children:e("auth.subtitle")})]}),n.jsx("div",{className:"bg-gray-800 rounded-xl p-6 sm:p-8 border border-gray-700",children:n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("button",{onClick:t,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[n.jsx(Rt,{className:"w-5 h-5"}),e("auth.signInWithGoogle")]}),n.jsx("p",{className:"text-xs text-center text-gray-500 pt-2",children:e("auth.googleDescription")})]})})]})})},Z=()=>{const{t}=A();return n.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),n.jsx("h1",{className:"text-2xl font-semibold text-white mb-2",children:t("loadingScreen.authenticating")}),n.jsx("p",{className:"text-gray-400",children:t("loadingScreen.pleaseWait")})]})})},Sn=({onClose:t})=>{const{t:e}=A();return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",children:n.jsxs("div",{className:"relative w-full max-w-lg m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-8 text-center text-white transform animate-scale-in",children:[n.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":e("splashScreen.close"),children:n.jsx(J,{className:"w-6 h-6"})}),n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:"p-4 bg-blue-600/20 border-2 border-blue-500 rounded-full mb-6",children:n.jsx(we,{className:"w-16 h-16 text-blue-400"})}),n.jsx("h1",{className:"text-5xl font-bold mb-1",children:e("splashScreen.title")}),n.jsx("h2",{className:"text-xl font-light text-gray-300 mb-6 tracking-widest",children:e("splashScreen.subtitle")}),n.jsxs("p",{className:"text-gray-400 mb-8",children:[e("splashScreen.tagline"),n.jsx("br",{}),e("splashScreen.description")]}),n.jsxs("button",{onClick:t,className:"w-full max-w-xs bg-blue-600 hover:bg-blue-700 font-bold py-4 px-8 rounded-xl transition-all duration-200 flex items-center justify-center gap-3 text-xl shadow-lg hover:shadow-blue-500/50 transform hover:scale-105",children:[e("splashScreen.cta"),n.jsx(Ue,{className:"w-6 h-6"})]}),n.jsx("div",{className:"mt-8 text-xs text-gray-500",children:e("splashScreen.version",{version:"0.10.0"})}),n.jsx("div",{className:"mt-4 text-xs text-gray-500 text-center whitespace-pre-line",children:e("splashScreen.impressumContent")})]})]})})},vn=()=>{const{locale:t,setLocale:e}=A(),[o,a]=d.useState(!1),s=d.useRef(null),r={en:"English",ja:"日本語",de:"Deutsch"};d.useEffect(()=>{const i=c=>{s.current&&!s.current.contains(c.target)&&a(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const l=i=>{e(i),a(!1)};return n.jsxs("div",{ref:s,className:"relative",children:[n.jsxs("button",{onClick:()=>a(!o),className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700 rounded-md transition-colors","aria-haspopup":"true","aria-expanded":o,children:[n.jsx(It,{className:"w-4 h-4 text-gray-400"}),n.jsx("span",{className:"flex-grow",children:r[t]}),n.jsx("svg",{className:`w-4 h-4 text-gray-400 transition-transform duration-200 ${o?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&n.jsx("div",{className:"absolute right-0 bottom-full mb-2 w-40 bg-gray-800 border border-gray-700 rounded-lg shadow-lg py-1 z-10",role:"menu",children:Object.keys(r).map(i=>n.jsxs("button",{onClick:()=>l(i),className:"w-full flex items-center justify-between px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700",role:"menuitem",children:[r[i],t===i&&n.jsx(Pt,{className:"w-4 h-4 text-blue-400"})]},i))})]})},Xe=d.createContext(void 0),Tn=({children:t,open:e,onOpenChange:o})=>{const[a,s]=d.useState(!1),r=e!==void 0?e:a,l=d.useCallback(c=>{e===void 0&&s(c),o==null||o(c)},[e,o]),i=d.useMemo(()=>({open:r,setOpen:l}),[r,l]);return n.jsx(Xe.Provider,{value:i,children:t})},Re=()=>{const t=d.useContext(Xe);if(t===void 0)throw new Error("useDialog must be used within a DialogProvider");return t},Qe=d.forwardRef(({onClick:t,asChild:e,...o},a)=>{const{setOpen:s}=Re(),r=e?_t:"button",l=d.useCallback(i=>{s(!0),t==null||t(i)},[s,t]);return n.jsx(r,{ref:a,onClick:l,...o})});Qe.displayName="DialogTrigger";const jn=({children:t})=>n.jsx(n.Fragment,{children:t}),et=d.forwardRef(({className:t,...e},o)=>n.jsx("div",{ref:o,className:ge("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));et.displayName="DialogOverlay";const tt=d.forwardRef(({className:t,children:e,...o},a)=>{const{open:s,setOpen:r}=Re();return s?n.jsxs(jn,{children:[n.jsx(et,{}),n.jsxs("div",{ref:a,className:ge("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-800 bg-gray-900 p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...o,children:[e,n.jsxs("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-gray-900 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-800 data-[state=open]:text-gray-400",onClick:()=>r(!1),children:[n.jsx(J,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]}):null});tt.displayName="DialogContent";const kn=d.forwardRef(({onClick:t,...e},o)=>{const{setOpen:a}=Re(),s=d.useCallback(r=>{a(!1),t==null||t(r)},[a,t]);return n.jsx("button",{ref:o,onClick:s,...e})});kn.displayName="DialogClose";const ot=({className:t,...e})=>n.jsx("div",{className:ge("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});ot.displayName="DialogHeader";const at=d.forwardRef(({className:t,...e},o)=>n.jsx("h2",{ref:o,className:ge("text-lg font-semibold leading-none tracking-tight text-white",t),...e}));at.displayName="DialogTitle";const En=d.forwardRef(({className:t,...e},o)=>n.jsx("p",{ref:o,className:ge("text-sm text-gray-400",t),...e}));En.displayName="DialogDescription";const Nn=()=>{const{locale:t}=A(),[e,o]=d.useState("");return d.useEffect(()=>{(async()=>{try{const s=await fetch(`/atsume-page/disclaimers/${t}.md`);if(!s.ok)throw new Error(`Failed to load disclaimer for locale: ${t}`);const r=await s.text();o(r)}catch(s){console.error("Error loading disclaimer markdown:",s),o("Failed to load disclaimer content.")}})()},[t]),n.jsx("div",{className:"p-4 text-gray-200 overflow-y-auto max-h-[70vh]",children:n.jsx(zt,{className:"prose prose-invert max-w-none",remarkPlugins:[oo],components:{h1:({node:a,...s})=>n.jsx("h1",{className:"text-2xl font-bold mb-4",...s}),h2:({node:a,...s})=>n.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",...s}),h3:({node:a,...s})=>n.jsx("h3",{className:"text-lg font-medium mt-4 mb-2",...s}),p:({node:a,...s})=>n.jsx("p",{className:"mb-4",...s}),ul:({node:a,...s})=>n.jsx("ul",{className:"list-disc list-inside ml-4 mb-4",...s}),li:({node:a,...s})=>n.jsx("li",{className:"mb-2",...s}),hr:({node:a,...s})=>n.jsx("hr",{className:"my-6 border-gray-700",...s}),a:({node:a,...s})=>n.jsx("a",{className:"text-blue-400 hover:underline",...s})},children:e})})},Cn=()=>{const{user:t,logout:e}=he(),{t:o}=A(),[a,s]=d.useState(!1),r=d.useRef(null);return d.useEffect(()=>{const l=i=>{r.current&&!r.current.contains(i.target)&&s(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),t?n.jsxs("div",{ref:r,className:"relative",children:[n.jsx("button",{onClick:()=>s(!a),className:"flex items-center justify-center w-10 h-10 bg-gray-700/50 hover:bg-gray-700 rounded-full transition-colors","aria-label":o("auth.userMenu"),title:t.email||"",children:n.jsx(At,{className:"w-5 h-5 text-white"})}),a&&n.jsxs("div",{className:"absolute bottom-full mb-4 left-0 mt-2 w-64 bg-gray-800 border border-gray-700 rounded-xl shadow-lg z-50 p-2 flex flex-col gap-1",children:[n.jsxs("div",{className:"px-3 py-2 border-b border-gray-700 mb-1",children:[n.jsx("p",{className:"text-sm font-medium text-white truncate",children:o("auth.signedInAs")}),n.jsx("p",{className:"text-xs text-gray-400 truncate",children:t.email})]}),n.jsx(vn,{}),n.jsxs(Tn,{children:[n.jsxs(Qe,{className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700 rounded-md transition-colors",children:[n.jsx(Ce,{className:"w-4 h-4"}),o("disclaimer.title")]}),n.jsxs(tt,{children:[n.jsx(ot,{children:n.jsx(at,{children:o("disclaimer.title")})}),n.jsx(Nn,{})]})]}),n.jsxs("button",{onClick:e,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-red-400 hover:bg-red-500/10 hover:text-red-300 rounded-md transition-colors",children:[n.jsx(Lt,{className:"w-4 h-4"}),o("auth.logout")]})]})]}):null},Mn=({mode:t,setMode:e,isAdmin:o,isManaging:a})=>{const{t:s}=A(),r="flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg transition-colors duration-200",l="bg-blue-600 text-white",i="bg-gray-700/50 text-gray-300 hover:bg-gray-700",c=[{name:"admin",icon:Dt,title:s("modeToggle.admin"),disabled:!1},{name:"stamp",icon:we,title:s("modeToggle.stamp"),disabled:!1},{name:"map",icon:Pe,title:s("modeToggle.map"),disabled:!0},{name:"rally",icon:_e,title:s("modeToggle.rally"),disabled:!0}],m=[{name:"map",icon:Pe,title:s("modeToggle.map"),disabled:!1},{name:"rally",icon:_e,title:s("modeToggle.rally"),disabled:!1},{name:"stamp",icon:we,title:s("modeToggle.stamp"),disabled:!1}],g=a?m:c;return o?n.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 bg-gray-900/70 backdrop-blur-sm p-1 rounded-xl shadow-lg flex items-center gap-1",children:g.map(p=>n.jsx("button",{onClick:()=>e(p.name),className:`${r} ${t===p.name?l:i} ${p.disabled?"text-gray-500 hover:bg-gray-700/50 cursor-not-allowed":""}`,"aria-pressed":t===p.name,title:p.disabled?s("rallyAdmin.selectRallyPromptSubtitle"):p.title,disabled:p.disabled,children:n.jsx(p.icon,{className:"w-4 h-4"})},p.name))}):null},Rn=({onSelect:t})=>{const{t:e}=A(),o=[{method:"map",icon:Me,label:e("mapEditor.placeOnMap")},{method:"coords",icon:Ft,label:e("mapEditor.byCoordinates")},{method:"osm",icon:Ge,label:e("mapEditor.fromOSM")},{method:"batch",icon:qe,label:e("mapEditor.batchUpload")}];return n.jsx("div",{className:"flex flex-col items-stretch gap-1 bg-gray-900/80 backdrop-blur-sm p-2 rounded-xl shadow-lg w-48 animate-fade-in",children:o.map(a=>n.jsxs("button",{onClick:()=>t(a.method),className:"flex items-center gap-3 w-full text-left p-2 rounded-lg text-white hover:bg-blue-600 transition-colors",title:a.label,children:[n.jsx(a.icon,{className:"w-5 h-5 flex-shrink-0"}),n.jsx("span",{className:"text-sm font-medium",children:a.label})]},a.method))})},In=({mode:t,setMode:e,isAdmin:o,isManaging:a,managedRally:s,handleExitManagement:r,isLocationListOpen:l,setIsLocationListOpen:i,addMenuOpen:c,setAddMenuOpen:m,handleSelectAddMethod:g,setIsPlacingOnMap:p,children:u})=>{const{t:h}=A();return n.jsx("div",{className:"h-screen w-screen bg-gray-900 text-white font-sans overflow-hidden",children:n.jsxs("main",{className:"relative w-full h-full",children:[n.jsx("div",{className:"absolute bottom-4 left-4 z-30 flex items-center gap-4",children:n.jsx(Cn,{})}),n.jsxs("div",{className:"absolute top-4 left-4 z-30 flex flex-col gap-4",children:[o&&a&&s&&n.jsx(n.Fragment,{children:n.jsx("button",{onClick:r,className:"p-2 rounded-full bg-gray-900/70 backdrop-blur-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors shadow-lg","aria-label":h("rallyAdmin.backToDashboard"),children:n.jsx(Ot,{className:"w-6 h-6"})})}),t==="map"&&!l&&n.jsx("button",{onClick:()=>i(!0),className:"fixed top-1/2 -translate-y-1/2 left-0 z-30 py-4 px-2 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-r-lg shadow-lg transition-colors location-list-toggle-button","aria-label":h("locationList.toggle"),title:h("locationList.toggle"),children:n.jsx($t,{className:"w-5 h-5"})})]}),n.jsx(Mn,{mode:t,setMode:e,isAdmin:o,isManaging:a}),u,t==="map"&&n.jsx("div",{className:"absolute bottom-6 right-6 z-10",children:n.jsxs("div",{className:"relative",children:[c&&n.jsx("div",{className:"absolute bottom-full right-0 mb-3",children:n.jsx(Rn,{onSelect:g})}),n.jsx("button",{onClick:()=>{m(f=>!f),p(!1)},className:"bg-blue-600 text-white rounded-full p-4 shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800 transition-transform hover:scale-110","aria-label":h("mapEditor.addLocation"),"aria-expanded":c,children:n.jsx(Bt,{className:`w-6 h-6 transition-transform duration-300 ${c?"rotate-45":""}`})})]})})]})})},Y=(t=0,e=1)=>{const o=Math.random(),a=Math.random();return Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*a)*e+t};class ${constructor(e,o,a){H(this,"data");H(this,"width");H(this,"height");this.width=o,this.height=e;const s=o*e;if(a instanceof Float32Array){if(a.length!==s)throw new Error("Data array does not match matrix dimensions");this.data=a}else this.data=new Float32Array(s),typeof a=="number"&&this.data.fill(a)}static ones(e,o){return new $(e,o,1)}static zeros(e,o){return new $(e,o,0)}get(e,o){return e<0||e>=this.height||o<0||o>=this.width?0:this.data[e*this.width+o]}set(e,o,a){e>=0&&e<this.height&&o>=0&&o<this.width&&(this.data[e*this.width+o]=a)}clone(){return new $(this.height,this.width,new Float32Array(this.data))}getBilinear(e,o){const a=Math.floor(e),s=Math.floor(o),r=Math.ceil(e),l=Math.ceil(o);if(a<0||r>=this.height||s<0||l>=this.width)return 0;const i=this.get(a,s),c=this.get(a,l),m=this.get(r,s),g=this.get(r,l),p=e-a,u=o-s,h=i*(1-u)+c*u,f=m*(1-u)+g*u;return h*(1-p)+f*p}}function nt(t,e){const o=$.zeros(t.height,t.width);for(let a=0;a<t.data.length;a++)o.data[a]=t.data[a]*e.data[a];return o}function Pn(t,e,o,a,s){const r=$.zeros(t.height,t.width);for(let l=0;l<t.data.length;l++)r.data[l]=t.data[l]*e+o.data[l]*a+s;return r}function rt(t){const e=t.clone();let o=1/0,a=-1/0;for(let r=0;r<e.data.length;r++)e.data[r]<o&&(o=e.data[r]),e.data[r]>a&&(a=e.data[r]);const s=a-o;if(s>0)for(let r=0;r<e.data.length;r++)e.data[r]=(e.data[r]-o)/s;return e}function _n(t){let e=0;for(let o=0;o<t.data.length;o++)t.data[o]!==0&&e++;return e}const X=240,zn=10,An=1;function Ln(t,e){const o=[];for(let a=0;a<t.length;a+=3){const s=t[a],r=t[a+1],l=t[a+2],i=(s+r+l)/3,c=s>X&&r>X&&l>X;i>e&&!c&&o.push(s,r,l)}return new Float32Array(o)}function De(t,e){return Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2)}function Dn(t,e){if(t.length===0||e===0)return{colors:[],labels:new Int32Array(0)};const o=t.length/3,a=[];for(let c=0;c<t.length;c+=3)a.push([t[c],t[c+1],t[c+2]]);o<e&&(e=o);let s=[];const r=new Set;for(;s.length<e;){const c=Math.floor(Math.random()*o);r.has(c)||(s.push([...a[c]]),r.add(c))}const l=new Int32Array(o);for(let c=0;c<zn;c++){for(let u=0;u<o;u++){let h=1/0,f=0;for(let w=0;w<s.length;w++){const N=De(a[u],s[w]);N<h&&(h=N,f=w)}l[u]=f}const m=Array(s.length).fill(0).map(()=>[0,0,0]),g=new Array(s.length).fill(0);for(let u=0;u<o;u++){const h=l[u];m[h][0]+=a[u][0],m[h][1]+=a[u][1],m[h][2]+=a[u][2],g[h]++}let p=!0;for(let u=0;u<s.length;u++){if(g[u]>0)m[u][0]/=g[u],m[u][1]/=g[u],m[u][2]/=g[u];else{const h=Math.floor(Math.random()*o);m[u]=[...a[h]]}De(m[u],s[u])>An&&(p=!1)}if(s=m,p)break}return{colors:s.map(c=>c.map(Math.round)),labels:l}}function Fn(t,e){const o=$.zeros(t.height,t.width),a=Math.floor(e/2);for(let s=0;s<t.height;s++)for(let r=0;r<t.width;r++){let l=255;for(let i=-a;i<=a;i++)for(let c=-a;c<=a;c++)l=Math.min(l,t.get(s+i,r+c));o.set(s,r,l)}return o}function On(t,e,o,a,s,r){const l=new Array(a*s).fill(-1);let i=0;for(let m=0;m<t.length;m+=3){const g=t[m],p=t[m+1],u=t[m+2],h=(g+p+u)/3,f=g>X&&p>X&&u>X;h>r.background_threshold&&!f&&(l[m/3]=o[i],i++)}const c=[];for(let m=0;m<e.length;m++){const g=new Float32Array(a*s);for(let u=0;u<l.length;u++)g[u]=l[u]===m?255:0;let p=new $(s,a,g);r.color_shape_shrink>0&&(p=Fn(p,r.color_shape_shrink)),c.push(p)}return c}function $n(t,e,o){const a=e*Math.PI/180,s=o*Math.cos(a),r=o*Math.sin(a);return[s,r,(1-s)*t.x-r*t.y,-r,s,r*t.x+(1-s)*t.y]}function Bn(t,e,o,a){const s=$.zeros(a,o),[r,l,i,c,m,g]=e,p=r*m-l*c;if(Math.abs(p)<1e-6)return s;const u=1/p,h=m*u,f=-l*u,w=(l*g-m*i)*u,N=-c*u,E=r*u,M=(c*i-r*g)*u;for(let b=0;b<a;b++)for(let C=0;C<o;C++){const y=h*C+f*b+w,k=N*C+E*b+M,z=t.getBilinear(k,y);s.set(b,C,z)}return s}function Un(t,e,o,a,s){return t.map(r=>{const l=Y(...a),i=Y(...a),c=Y(...s),m=$n({x:e/2,y:o/2},c,1);return m[2]+=l,m[5]+=i,Bn(r,m,e,o)})}function st(t){var c;const e=t.length,o=((c=t[0])==null?void 0:c.length)||0,a=Array(e).fill(null).map(()=>Array(o));for(let m=0;m<e;m++)for(let g=0;g<o;g++)a[m][g]=t[m][g]>127;const s=Array(e).fill(null).map(()=>Array(o));for(let m=0;m<e;m++)Gn(a[m],s[m]);const r=Array(e).fill(null).map(()=>Array(o)),l=Array(e),i=Array(e);for(let m=0;m<o;m++){for(let g=0;g<e;g++)l[g]=s[g][m];qn(l,i);for(let g=0;g<e;g++)r[g][m]=Math.sqrt(i[g])}return r}function Gn(t,e){const o=t.length;let a=1/0;for(let s=0;s<o;s++)t[s]?a++:a=0,e[s]=a*a;a=1/0;for(let s=o-1;s>=0;s--)t[s]?a++:a=0,e[s]=Math.min(e[s],a*a)}function qn(t,e){const o=t.length;if(o===0)return;const a=Array(o),s=Array(o+1);let r=0;a[0]=0,s[0]=-1/0,s[1]=1/0;for(let l=1;l<o;l++){let i=(t[l]+l*l-(t[a[r]]+a[r]*a[r]))/(2*l-2*a[r]);for(;i<=s[r];)r--,i=(t[l]+l*l-(t[a[r]]+a[r]*a[r]))/(2*l-2*a[r]);r++,a[r]=l,s[r]=i,s[r+1]=1/0}r=0;for(let l=0;l<o;l++){for(;s[r+1]<l;)r++;e[l]=(l-a[r])*(l-a[r])+t[a[r]]}}function Vn(t,e,o){const a=Array(o).fill(null).map(()=>Array(e));for(let s=0;s<o;s++)for(let r=0;r<e;r++)a[s][r]=t.get(s,r);return st(a)}function Wn(t,e,o,a,s){return t.map(r=>{const l=Array(o).fill(0).map(()=>Array(e).fill(0));for(let m=0;m<o;m++)for(let g=0;g<e;g++)l[m][g]=r.get(m,g);const i=st(l),c=$.ones(o,e);for(let m=0;m<o;m++)for(let g=0;g<e;g++){const p=i[m][g];for(let u=1;u<=a;u++)if(p>u-1&&p<=u){const h=s*(a-u+1)/a;c.set(m,g,h);break}}return c})}function Kn(t,e,o){const a=$.zeros(e,t);for(let s=0;s<3;s++){const r=2**s,l=1/r,i=1/r;for(let c=0;c<e;c++)for(let m=0;m<t;m++){const g=i*Math.sin(m*l*2*Math.PI/o)*Math.sin(c*l*2*Math.PI/o),p=a.get(c,m);a.set(c,m,p+g)}}return rt(a)}function Jn(t,e,o,a,s){const r=$.ones(e,t);if(s<=0||o<=0)return r;for(let l=0;l<o;l++){const i=Math.random()*(a[1]-a[0])+a[0],c=Math.random()*t,m=Math.random()*e,g=Math.max(0,Math.floor(c-i)),p=Math.min(t,Math.ceil(c+i)),u=Math.max(0,Math.floor(m-i)),h=Math.min(e,Math.ceil(m+i));for(let f=u;f<h;f++)for(let w=g;w<p;w++){const N=Math.sqrt((w-c)**2+(f-m)**2);if(N<i){const M=1-(N/i)**2,b=1-s*M;r.get(f,w)>b&&r.set(f,w,b)}}}return r}function Yn(t,e,o,a){const s=[];for(let r=0;r<t;r++){const l=Y(...a.noise_scale),i=Kn(e,o,l),c=Math.round(Y(...a.num_patches)),m=Y(...a.ink_depletion_intensity),g=Jn(e,o,c,a.patch_size_range,m),p=Y(...a.wear_intensity),u=$.ones(o,e);let h=Pn(i,p,u,1-p,0);h=nt(h,g),h=rt(h),s.push(h)}return s}function Hn(t,e){const o=[];let a=0;for(let s=0;s<t.length;s++){const r=e>0?t[s].density/e:1/t.length;a+=r,o.push(a)}return o.length>0&&(o[o.length-1]=1),o}function Zn(t){const e=Math.random();let o=0,a=t.length-1;if(t.length===0)return-1;if(e<=t[0])return 0;if(e>=t[t.length-1])return t.length-1;for(;o<a;){const s=Math.floor((o+a)/2);t[s]<e?o=s+1:a=s}return o}function Xn(t,e,o,a,s,r){const l=nt(e,o);let i=null;r.bleeding_factor>0&&(i=Vn(t,a,s));const c=[];let m=0;for(let h=0;h<s;h++)for(let f=0;f<a;f++)if(t.get(h,f)>127){const w=l.get(h,f);c.push({x:f,y:h,density:w}),m+=w}if(c.length===0)return[];const g=Hn(c,m),p=Math.floor(r.splat_density*c.length),u=[];for(let h=0;h<p;h++){const f=Zn(g);if(f<0)continue;const w=c[f],{x:N,y:E,density:M}=w,C=(Math.random()*(r.splat_size_range[1]-r.splat_size_range[0])+r.splat_size_range[0])*(.5+.5*M);let y=0;r.bleeding_factor>0&&i&&i[E][N]<5&&(y=-Math.log(Math.random())*r.bleeding_factor);const k=C+y,z=Math.min(255,Math.floor(100+155*M));u.push({x:N,y:E,size:k,opacity:z})}return u}function Qn(t,e,o,a,s,r=!1){const l=document.createElement("canvas");l.width=o,l.height=a;const i=l.getContext("2d");if(!r){const[c,m,g]=s;i.fillStyle=`rgb(${c}, ${m}, ${g})`,i.fillRect(0,0,o,a)}return t.forEach((c,m)=>{const[g,p,u]=e[m],h=c.sort((f,w)=>w.size-f.size);for(const f of h)i.fillStyle=`rgba(${g}, ${p}, ${u}, ${f.opacity/255})`,i.beginPath(),i.ellipse(f.x,f.y,f.size/2,f.size/2,0,0,2*Math.PI),i.fill()}),i.getImageData(0,0,o,a)}function er(t,e){const{data:o,width:a,height:s}=t,r=new Uint8ClampedArray(a*s*3);for(let y=0,k=0;y<o.length;y+=4,k+=3)r[k]=o[y],r[k+1]=o[y+1],r[k+2]=o[y+2];const l=Ln(r,e.background_threshold),i=e.num_colors==="auto"?15:e.num_colors,{colors:c,labels:m}=Dn(l,i),g=On(r,c,m,a,s,e),p=240,u=y=>y[0]>p&&y[1]>p&&y[2]>p,h=g.map((y,k)=>({mask:y,color:c[k],size:_n(y)})).filter(y=>!u(y.color)).sort((y,k)=>k.size-y.size);if(h.length===0){const y=document.createElement("canvas");return y.width=a,y.height=s,y.getContext("2d").getImageData(0,0,a,s)}const f=h.map(y=>y.mask),w=h.map(y=>y.color),N=Un(f,a,s,e.shift,e.rotation),E=Wn(N,a,s,e.edge_width,e.edge_boost),M=Yn(w.length,a,s,e),b=[];for(let y=0;y<N.length;y++){const k=Xn(N[y],E[y],M[y],a,s,e);b.push(k)}return Qn(b,w,a,s,e.background_color,!0)}const tr={stamp_size:512,num_colors:"auto",background_threshold:5,color_shape_shrink:5,shift:[0,1],rotation:[0,1],edge_width:4,edge_boost:3,wear_intensity:[.1,.05],noise_scale:[50,5],rotation_angle:[0,0],ink_depletion_intensity:[.3,.05],num_patches:[2,1],patch_size_range:[20,100],splat_density:.75,splat_size_range:[1,2],bleeding_factor:.1,background_color:[255,255,255]};function or(t,e){const o=document.createElement("canvas"),a=o.getContext("2d");if(!a)throw new Error("Could not create canvas context");const s=t.width/t.height,r=s>=1?e:e*s,l=s<1?e:e/s;return o.width=Math.ceil(r),o.height=Math.ceil(l),a.drawImage(t,0,0,o.width,o.height),o}async function _r(t,e){return new Promise((o,a)=>{setTimeout(()=>{try{const s=er(t,e);o(s)}catch(s){a(s)}},0)})}const Fe=128,ar=3,nr=1e3;async function rr(t){const e=document.createElement("canvas"),o=t.width/t.height;e.width=Fe,e.height=Fe/o;const a=e.getContext("2d");if(!a)throw new Error("Failed to get canvas context for thumbnail creation");return a.drawImage(t,0,0,e.width,e.height),e.toDataURL("image/jpeg",.7)}async function ue(t,e=ar,o=nr,a=15e3){let s;for(let r=1;r<=e;r++)try{const l=new Promise((i,c)=>setTimeout(()=>c(new Error("Operation timed out")),a));return await Promise.race([t(),l])}catch(l){if(s=l,r===e)throw s;const i=o*Math.pow(2,r-1);await new Promise(c=>setTimeout(c,i))}throw s}const lt=d.createContext(void 0),sr=({children:t})=>{const{user:e,loading:o,role:a,activeRallyId:s}=he(),{addToast:r}=me(),{t:l}=A(),i=d.useRef(!0),c=d.useRef(!1),m=d.useRef(!1),g=d.useRef(!1),p=d.useRef(!1),[u,h]=d.useState([]),[f,w]=d.useState(!1),[N,E]=d.useState(null),[M,b]=d.useState([]),[C,y]=d.useState(null),[k,z]=d.useState(!1),[D,F]=d.useState(null),[B,K]=d.useState([]),[ke,te]=d.useState(!1),[Ee,oe]=d.useState(null),[U,L]=d.useState([]),[ae,ne]=d.useState(null),[pe,re]=d.useState(!1),[it,Ne]=d.useState(null),j=d.useCallback(x=>{i.current&&x()},[]),fe=d.useCallback(async(x,S=!1)=>{if(!(c.current||!x)&&!(u.length>0&&!S)){c.current=!0,j(()=>{w(!0),E(null)});try{const v=await ue(()=>io(x));if(!i.current)return;Promise.all(v.flatMap(T=>[T.sourceImageURL,T.thumbnail]).map(T=>lo(T).catch(()=>{}))),j(()=>h(v))}catch(v){console.error("Failed to load stamps:",v),j(()=>{E(v instanceof P?v.message:l("gallery.loadErrorToast")),h([])}),r(l("gallery.loadErrorToast"),"error")}finally{c.current=!1,j(()=>w(!1))}}},[r,l,j,u.length]),se=d.useCallback(async()=>{e!=null&&e.id&&await fe(e.id,!0)},[e==null?void 0:e.id,fe]),ct=d.useCallback(async(x,S,v)=>{if(!e){r(l("gallery.loginToast"),"info");return}if(!v.trim()){r(l("gallery.nameRequiredToast"),"error");return}try{const T=or(x,S.stamp_size),I=T.toDataURL("image/jpeg",.7),O=await rr(T),kt=await Je({user_id:e.id,name:v.trim(),thumbnail:O,sourceImageURL:I,settings:S});j(()=>h(Et=>[kt,...Et])),r(l("gallery.addSuccessToast",{name:v.trim()}),"success")}catch(T){console.error("Failed to add stamp:",T),r(T instanceof P?T.message:l("gallery.addErrorToast"),"error")}},[r,e,l,j]),dt=d.useCallback(async x=>{if(!e){r(l("gallery.loginToast"),"info");return}if(!u.find(v=>v.id===x)){r(l("gallery.stampNotFoundToast"),"error");return}j(()=>h(v=>v.filter(T=>T.id!==x)));try{await co(x,e.id),r(l("gallery.deleteSuccessToast"),"info")}catch(v){console.error("Failed to delete stamp:",v),r(v instanceof P?v.message:l("gallery.deleteErrorToast"),"error"),se()}},[r,e,l,u,se,j]),ut=d.useCallback(async(x,S)=>{if(!e){r(l("gallery.loginToast"),"info");return}if(!S.trim()){r(l("gallery.nameRequiredToast"),"error");return}const v=u.find(I=>I.id===x);if(!v){r(l("gallery.stampNotFoundToast"),"error");return}const T=S.trim();if(v.name!==T){j(()=>h(I=>I.map(O=>O.id===x?{...O,name:T}:O)));try{await uo(x,T,e.id),r(l("gallery.renameSuccessToast",{name:T}),"success")}catch(I){console.error("Failed to rename stamp:",I),r(I instanceof P?I.message:l("gallery.renameErrorToast",{oldName:v.name}),"error"),se()}}},[r,e,u,l,se,j]),be=d.useCallback(async(x,S=!1)=>{if(!x){j(()=>{b([]),y(null)});return}if(!m.current&&!(!S&&C===x&&M.length>0)){m.current=!0,j(()=>{z(!0),F(null),C!==x&&b([])});try{const v=await ue(()=>yo(x));if(!i.current)return;j(()=>{b(v),y(x)})}catch(v){console.error("Failed to load geolocations:",v),j(()=>{F(v instanceof P?v.message:l("mapEditor.loadGeolocationsError")),b([]),y(null)}),r(l("mapEditor.loadGeolocationsError"),"error")}finally{m.current=!1,j(()=>z(!1))}}},[r,l,j,C,M.length]),le=d.useCallback(async x=>{x&&await be(x,!0)},[be]),mt=d.useCallback(async(x,S)=>{if(!e){r(l("common.loginRequired"),"info");return}try{const v=await Ye({...x,rally_id:S,user_id:e.id},e.id);j(()=>b(T=>[...T,v]))}catch(v){console.error("Failed to add geolocation:",v),r(v instanceof P?v.message:l("mapEditor.addLocationError"),"error")}},[r,e,l,j]),gt=d.useCallback(async(x,S,v)=>{if(!e){r(l("common.loginRequired"),"info");return}if(!M.find(I=>I.id===x)){r(l("mapEditor.locationNotFound"),"error");return}j(()=>b(I=>I.map(O=>O.id===x?{...O,...S}:O)));try{await xo(x,S,e.id)}catch(I){console.error("Failed to update geolocation:",I),r(I instanceof P?I.message:l("mapEditor.updateLocationError"),"error"),le(v)}},[r,e,M,l,le,j]),ht=d.useCallback(async x=>{if(!e){r(l("common.loginRequired"),"info");return}if(!M.find(v=>v.id===x)){r(l("mapEditor.locationNotFound"),"error");return}j(()=>b(v=>v.filter(T=>T.id!==x)));try{await wo(x,e.id),r(l("mapEditor.deleteLocationSuccess"),"info")}catch(v){console.error("Failed to delete geolocation:",v),r(v instanceof P?v.message:l("mapEditor.deleteLocationError"),"error"),le(s)}},[r,e,M,s,l,le,j]),ye=d.useCallback(async(x=!1)=>{if(!g.current&&!(B.length>0&&!x)){g.current=!0,j(()=>{te(!0),oe(null)});try{let S=[];if(e!=null&&e.id&&a==="admin"&&(S=await ue(()=>go(e.id))),!i.current)return;j(()=>K(S))}catch(S){console.error("Failed to load rallies:",S),j(()=>{oe(S instanceof P?S.message:l("admin.loadRalliesError")),K([])}),r(l("admin.loadRalliesError"),"error")}finally{g.current=!1,j(()=>te(!1))}}},[r,l,j,B.length,e==null?void 0:e.id,a]),ie=d.useCallback(async()=>{await ye(!0)},[ye]),pt=d.useCallback(async x=>{if(!e||a!=="admin"){r(l("common.adminRequired"),"info");return}try{const S=await mo({...x,admin_id:e.id});j(()=>K(v=>[...v,S]))}catch(S){console.error("Failed to add rally:",S),r(S instanceof P?S.message:l("admin.addRallyError"),"error")}},[r,e,a,l,j]),ft=d.useCallback(async(x,S)=>{if(!e||a!=="admin"){r(l("common.adminRequired"),"info");return}if(!B.find(T=>T.id===x)){r(l("admin.rallyNotFound"),"error");return}j(()=>K(T=>T.map(I=>I.id===x?{...I,...S}:I)));try{await ho(x,S,e.id)}catch(T){console.error("Failed to update rally:",T),r(T instanceof P?T.message:l("admin.updateRallyError"),"error"),ie()}},[r,e,a,B,l,ie,j]),bt=d.useCallback(async x=>{if(!e||a!=="admin"){r(l("common.adminRequired"),"info");return}if(!B.find(v=>v.id===x)){r(l("admin.rallyNotFound"),"error");return}j(()=>K(v=>v.filter(T=>T.id!==x)));try{await po(x,e.id)}catch(v){console.error("Failed to delete rally:",v),r(v instanceof P?v.message:l("admin.deleteRallyError"),"error"),ie()}},[r,e,a,B,l,ie,j]),yt=d.useCallback(async x=>{try{return await ue(()=>fo(x))}catch(S){return console.error("Failed to get rally by code:",S),r(l("joinRally.fetchError"),"error"),null}},[r,l]),xe=d.useCallback(async(x,S,v=!1)=>{if(!x||!S){j(()=>{L([]),ne(null)});return}if(!p.current&&!(!v&&ae===S&&U.length>0)){p.current=!0,j(()=>{re(!0),Ne(null),ae!==S&&L([])});try{const T=await ue(()=>So(x,S));if(!i.current)return;j(()=>{L(T),ne(S)})}catch(T){console.error("Failed to load collections:",T),j(()=>{Ne(T instanceof P?T.message:l("logbook.loadCollectionsError")),L([]),ne(null)}),r(l("logbook.loadCollectionsError"),"error")}finally{p.current=!1,j(()=>re(!1))}}},[r,l,j,ae,U.length]),ce=d.useCallback(async(x,S)=>{await xe(x,S,!0)},[xe]),Ie=d.useCallback(x=>U.some(S=>S.geolocation_id===x),[U]),xt=d.useCallback(async(x,S)=>{if(!e)return r(l("common.loginRequired"),"info"),null;if(Ie(x))return r(l("collections.alreadyCollected"),"info"),null;const v={user_id:e.id,rally_id:S,geolocation_id:x,is_collected:!0,logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null};try{const T=await Le(v);return j(()=>L(I=>[...I,T])),r(l("collections.collectSuccess"),"success"),T}catch(T){return console.error("Failed to collect stamp:",T),r(T instanceof P?T.message:l("collections.collectError"),"error"),null}},[e,s,r,l,j]),wt=d.useCallback(async x=>{if(!e){r(l("common.loginRequired"),"info");return}try{const S=await Le({...x,user_id:e.id});j(()=>L(v=>[...v,S]))}catch(S){console.error("Failed to add collection:",S),r(S instanceof P?S.message:l("logbook.addCollectionError"),"error")}},[r,e,l,j]),de=d.useCallback(async(x,S,v)=>{if(!e){r(l("common.loginRequired"),"info");return}if(!U.find(I=>I.id===x)){r(l("collections.collectionNotFound"),"error");return}j(()=>L(I=>I.map(O=>O.id===x?{...O,...S}:O)));try{await vo(x,S,v)}catch(I){console.error("Failed to update collection:",I),r(I instanceof P?I.message:l("collections.updateError"),"error"),ce(e.id,s)}},[r,e,U,l,ce,s,j]),St=d.useCallback(async(x,S)=>{if(!e){r(l("common.loginRequired"),"info");return}if(!U.find(T=>T.id===x)){r(l("collections.collectionNotFound"),"error");return}j(()=>L(T=>T.filter(I=>I.id!==x)));try{await To(x,S),r(l("collections.deleteSuccess"),"info")}catch(T){console.error("Failed to delete collection:",T),r(T instanceof P?T.message:l("collections.deleteError"),"error"),ce(e.id,s)}},[r,e,U,l,ce,s,j]),vt=d.useCallback(async(x,S,v)=>{if(!(e!=null&&e.id)){r(l("common.loginRequired"),"info");return}try{await de(x,{logbook_x:S.x,logbook_y:S.y,logbook_rotation:S.rotation,stamp_image_data:v},e.id)}catch(T){console.error("Failed to update collection placement:",T),r(T instanceof P?T.message:l("collections.placementError"),"error")}},[e==null?void 0:e.id,de,r,l]),Tt=d.useCallback(async x=>{if(!(e!=null&&e.id)){r(l("common.loginRequired"),"info");return}try{await de(x,{logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null},e.id),r(l("collections.revertSuccess"),"info")}catch(S){console.error("Failed to revert collection placement:",S),r(S instanceof P?S.message:l("collections.revertError"),"error")}},[e==null?void 0:e.id,de,r,l]);d.useEffect(()=>{o||(e!=null&&e.id?(fe(e.id),a==="admin"&&ye(),s&&(be(s),xe(e.id,s))):j(()=>{h([]),E(null),w(!1),b([]),F(null),z(!1),K([]),oe(null),te(!1),L([]),Ne(null),re(!1)}))},[e==null?void 0:e.id,o,a,s,fe,ye,be,xe,j]),d.useEffect(()=>()=>{i.current=!1},[]);const jt={stamps:u,stampsLoading:f||o,stampsError:N,addStampToGallery:ct,deleteStampFromGallery:dt,renameStampInGallery:ut,refreshStamps:se,geolocations:M,geolocationsLoading:k||o,geolocationsError:D,addGeolocation:mt,updateGeolocation:gt,deleteGeolocation:ht,refreshGeolocations:le,rallies:B,ralliesLoading:ke||o,ralliesError:Ee,addRally:pt,updateRally:ft,deleteRally:bt,getRallyByCode:yt,refreshRallies:ie,collections:U,collectionsLoading:pe||o,collectionsError:it,addCollection:wt,updateCollection:de,deleteCollection:St,isCollected:Ie,collectStamp:xt,updateCollectionPlacement:vt,revertCollectionPlacement:Tt,refreshCollections:ce};return n.jsx(lt.Provider,{value:jt,children:t})},ee=()=>{const t=d.useContext(lt);if(t===void 0)throw new Error("useDatabase must be used within a DatabaseProvider");return t};function zr(t,e,o,a){const r=t*Math.PI/180,l=o*Math.PI/180,i=(o-t)*Math.PI/180,c=(a-e)*Math.PI/180,m=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(l)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function lr(t,e,o=64){const[a,s]=t,r={latitude:s,longitude:a},l=e/1e3,i=[],c=l/(111.32*Math.cos(r.latitude*Math.PI/180)),m=l/110.574;let g,p,u;for(let h=0;h<o;h++)g=h/o*(2*Math.PI),p=c*Math.cos(g),u=m*Math.sin(g),i.push([r.longitude+p,r.latitude+u]);return i.push(i[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[i]},properties:{}}}const ir=({isVisible:t,onMapLoad:e,onGeolocate:o,onMapClick:a,children:s,className:r="",cursor:l="",mapRef:i})=>{const{addToast:c}=me(),{t:m}=A(),[g,p]=d.useState({longitude:-.09,latitude:51.505,zoom:3}),[u,h]=d.useState(!1),f=d.useRef(null),w=i||f,N=d.useRef(null),E=d.useRef(!1),M=y=>{let k=m("mapEditor.locationError.unknown");switch(y.code){case y.PERMISSION_DENIED:k=m("mapEditor.locationError.denied");break;case y.POSITION_UNAVAILABLE:k=m("mapEditor.locationError.unavailable");break;case y.TIMEOUT:k=m("mapEditor.locationError.timeout");break}c(k,"error")},b=d.useCallback(y=>{E.current||(E.current=!0,c(m("mapEditor.centeredToast"),"success")),o==null||o({latitude:y.coords.latitude,longitude:y.coords.longitude})},[c,m,o]),C=d.useCallback(()=>{u||setTimeout(()=>{if(N.current)try{N.current.trigger(),h(!0)}catch(y){console.warn("Failed to trigger geolocation on load:",y)}},500),e==null||e()},[u,e]);return d.useEffect(()=>{if(t&&w.current){const y=setTimeout(()=>{var k;return(k=w.current)==null?void 0:k.getMap().resize()},1);return()=>clearTimeout(y)}},[t,w]),d.useEffect(()=>{if(!u){const y=setTimeout(()=>{if(N.current)try{N.current.trigger(),h(!0)}catch(k){console.warn("Failed to trigger geolocation on mount:",k),(navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad"))&&c(m("mapEditor.iOSLocationPrompt")||"Tap the location button to center on your position","info")}},1e3);return()=>clearTimeout(y)}},[u,c,m]),n.jsx("div",{className:`relative w-full h-full bg-gray-700 ${l} ${r}`,children:n.jsxs(Ut,{ref:w,mapLib:ao,...g,onMove:y=>p(y.viewState),onClick:a,onLoad:C,mapStyle:"https://tiles.openfreemap.org/styles/positron",style:{width:"100%",height:"100%"},children:[n.jsx(Gt,{ref:N,positionOptions:{enableHighAccuracy:!0,timeout:1e4,maximumAge:0},trackUserLocation:!0,showUserLocation:!0,showAccuracyCircle:!0,fitBoundsOptions:{maxZoom:15},onError:M,onGeolocate:b}),s]})})},cr=({isVisible:t,selectedLocation:e,setSelectedLocation:o,geolocations:a,setEditingLocation:s,newLocationCoords:r,setNewLocationCoords:l,isPlacingOnMap:i,setIsPlacingOnMap:c,deleteGeolocation:m,onLocationSelectedAndFocus:g})=>{const{stamps:p}=ee(),{t:u}=A(),h=d.useRef(null),f=d.useMemo(()=>({type:"FeatureCollection",features:a.map(E=>{const M=lr([E.longitude,E.latitude],E.radius);return M.properties={id:E.id},M})}),[a]),w=E=>{if(i){const{lng:M,lat:b}=E.lngLat;l({latitude:b,longitude:M}),c(!1)}e&&o(null)};d.useEffect(()=>{e&&h.current&&h.current.flyTo({center:[e.longitude,e.latitude],zoom:14,duration:2e3})},[e,g]);const N=d.useMemo(()=>e!=null&&e.stamp_id&&p.find(E=>E.id===e.stamp_id)||null,[e,p]);return d.useEffect(()=>{r&&(s(null),o(null))},[r,o,s]),n.jsx(n.Fragment,{children:n.jsxs(ir,{isVisible:t,onMapClick:w,cursor:i?"cursor-add":"",mapRef:h,children:[n.jsxs(qt,{id:"radius-circles",type:"geojson",data:f,children:[n.jsx(ze,{id:"radius-circles-fill",type:"fill",paint:{"fill-color":"#ef4444","fill-opacity":.25}}),n.jsx(ze,{id:"radius-circles-stroke",type:"line",paint:{"line-color":"#ef4444","line-width":1.5,"line-dasharray":[2,2]}})]}),a.map(E=>n.jsx(Vt,{longitude:E.longitude,latitude:E.latitude,style:{zIndex:20},children:n.jsx("button",{onClick:M=>{M.stopPropagation(),o(E)},"aria-label":u("mapEditor.viewLocation",{name:E.name}),children:n.jsx(Me,{className:"text-red-500 w-8 h-8 drop-shadow-lg",strokeWidth:1.5})})},E.id)),e&&n.jsx(Wt,{longitude:e.longitude,latitude:e.latitude,onClose:()=>o(null),closeOnClick:!1,anchor:"bottom",offset:35,style:{zIndex:20},children:n.jsxs("div",{className:"flex flex-col",children:[N&&n.jsx("img",{src:N.thumbnail,alt:N.name,className:"w-full h-32 object-contain bg-gray-900/50 rounded-t-md"}),n.jsxs("div",{className:"p-3",children:[n.jsx("h3",{className:"font-bold text-lg text-white mb-1",children:e.name}),n.jsx("p",{className:"text-sm text-gray-300 mb-3",children:e.description}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>{s(e),o(null)},className:"flex-1 bg-blue-600 text-white px-2 py-1.5 text-xs rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-1.5",children:[n.jsx(Kt,{className:"w-3 h-3"})," ",u("common.edit")]}),n.jsxs("button",{onClick:()=>m(e.id),className:"flex-1 bg-red-600 text-white px-2 py-1.5 text-xs rounded-md hover:bg-red-700 transition-colors flex items-center justify-center gap-1.5",children:[n.jsx(Jt,{className:"w-3 h-3"})," ",u("common.delete")]})]})]})]})})]})})},dr=({isOpen:t,onClose:e,locations:o,selectedLocationId:a,onSelectLocation:s,onLocationSelectedAndFocus:r})=>{const{t:l}=A(),i=c=>{s(c),r(c),e()};return n.jsx("aside",{className:`fixed top-0 left-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-r-2 border-gray-700 shadow-2xl ${t?"translate-x-0":"-translate-x-full"}`,"aria-hidden":!t,children:n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[n.jsx("h1",{className:"text-xl font-bold",children:l("locationList.title")}),n.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-700","aria-label":l("common.close"),children:n.jsx(J,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-2 no-scrollbar",children:o.length===0?n.jsxs("div",{className:"text-center text-gray-400 mt-8 px-4",children:[n.jsx("p",{children:l("locationList.empty")}),n.jsx("p",{className:"text-sm mt-1",children:l("locationList.emptySubtext")})]}):n.jsx("ul",{className:"flex flex-col gap-2",children:o.map(c=>n.jsx("li",{children:n.jsxs("button",{onClick:()=>i(c),className:`w-full flex items-center gap-3 text-left p-2 rounded-lg transition-colors duration-200 ${a===c.id?"bg-blue-600 text-white":"text-gray-200 hover:bg-gray-700"}`,"aria-label":l("locationList.selectLocation",{name:c.name}),"aria-current":a===c.id,children:[n.jsx("div",{className:"w-10 h-10 flex-shrink-0 bg-gray-900/50 rounded-md flex items-center justify-center",children:c.stamp?n.jsx("img",{src:c.stamp.thumbnail,alt:c.stamp.name,className:"w-full h-full object-contain"}):n.jsx(Me,{className:"w-6 h-6 text-gray-500"})}),n.jsx("span",{className:"flex-grow font-medium truncate",children:c.name})]})},c.id))})})]})})},ur=G.memo(({isVisible:t,isPlacingOnMap:e,setIsPlacingOnMap:o,newLocationCoords:a,setNewLocationCoords:s,setEditingLocation:r,isLocationListOpen:l,setIsLocationListOpen:i,geolocations:c,deleteGeolocation:m})=>{const[g,p]=d.useState(null),{addToast:u}=me(),{stamps:h}=ee(),{t:f}=A();d.useEffect(()=>{e&&u(f("mapEditor.addLocationToast"),"info")},[e,u,f]);const w=d.useMemo(()=>c.map(b=>({...b,stamp:h.find(C=>C.id===b.stamp_id)||null})).sort((b,C)=>b.created_at&&C.created_at?new Date(C.created_at).getTime()-new Date(b.created_at).getTime():0),[c,h]),N=async b=>{window.confirm(f("mapEditor.deleteConfirm"))&&(await m(b),p(null))},E=b=>{p(b)},M=b=>{p(b)};return d.useEffect(()=>{a&&(r(null),p(null))},[a,p,r]),n.jsxs("div",{className:`w-full h-full ${t?"block":"hidden"}`,children:[n.jsx(cr,{isVisible:t,selectedLocation:g,setSelectedLocation:p,geolocations:c,setEditingLocation:r,setNewLocationCoords:s,isPlacingOnMap:e,setIsPlacingOnMap:o,deleteGeolocation:N,newLocationCoords:a,onLocationSelectedAndFocus:M}),n.jsx(dr,{isOpen:l,onClose:()=>i(!1),locations:w,selectedLocationId:(g==null?void 0:g.id)||null,onSelectLocation:E,onLocationSelectedAndFocus:M})]})}),mr=({text:t})=>n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx(Ce,{className:"w-4 h-4 text-gray-500 cursor-help"}),n.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 w-max max-w-xs p-2 text-xs text-white bg-gray-900 border border-gray-600 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10",children:t})]});function gr({label:t,name:e,value:o,min:a,max:s,step:r,unit:l="",tooltip:i,disabled:c=!1,onChange:m}){const g=u=>{var h;return r<1?u.toFixed(((h=r.toString().split(".")[1])==null?void 0:h.length)||2):u.toString()},p=(o-a)/(s-a)*100;return n.jsxs("div",{className:"pt-3 flex-1",children:[t&&n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{htmlFor:e,className:`text-sm font-medium ${c?"text-gray-500":"text-gray-300"}`,children:t}),i&&n.jsx(mr,{text:i})]}),n.jsxs("span",{className:`text-sm font-mono ${c?"text-gray-500":"text-blue-400"}`,children:[g(o),l]})]}),n.jsx("input",{type:"range",id:e,name:e,min:a,max:s,step:r,value:o,onChange:m,disabled:c,className:"w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer slider disabled:cursor-not-allowed",style:{background:c?"#4b5563":`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${p}%, #4b5563 ${p}%, #4b5563 100%)`}})]})}const hr=({initialData:t,onSave:e,onClose:o})=>{const[a,s]=d.useState(t.name||""),[r,l]=d.useState(t.description||""),[i,c]=d.useState(t.radius||100),[m,g]=d.useState(t.stamp_id||null),{stamps:p,stampsLoading:u}=ee(),{t:h}=A(),f=()=>{if(!a.trim()){alert(h("locationEditModal.validationError"));return}e({...t.id&&{id:t.id},name:a,description:r,radius:i,latitude:t.latitude,longitude:t.longitude,stamp_id:m})};return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:o,children:n.jsxs("div",{className:"relative w-full max-w-lg m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 sm:p-8 text-white transform animate-scale-in flex flex-col gap-6",onClick:w=>w.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h2",{className:"text-2xl font-bold",children:t.id?h("locationEditModal.titleEdit"):h("locationEditModal.titleAdd")}),n.jsx("button",{onClick:o,className:"p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":h("common.close"),children:n.jsx(J,{className:"w-6 h-6"})})]}),n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsx("input",{type:"text",placeholder:h("locationEditModal.namePlaceholder"),value:a,onChange:w=>s(w.target.value),className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:outline-none transition"}),n.jsx("textarea",{placeholder:`${h("common.description")} (${h("common.optional")})`,value:r||"",onChange:w=>l(w.target.value),rows:3,className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:outline-none transition resize-none"}),n.jsx(gr,{label:h("locationEditModal.radius"),name:"radius",value:i,min:10,max:1e3,step:10,unit:"m",onChange:w=>c(parseInt(w.target.value,10)),tooltip:h("locationEditModal.radiusTooltip")})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-3",children:h("locationEditModal.assignStamp")}),n.jsx("div",{className:"h-48 bg-gray-900/50 rounded-lg p-3 overflow-y-auto no-scrollbar border border-gray-700",children:u?n.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:h("locationEditModal.loadingStamps")}):n.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-3",children:[n.jsxs("button",{onClick:()=>g(null),className:`w-full aspect-square rounded-lg flex flex-col items-center justify-center text-gray-400 transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${m===null?"ring-2 ring-blue-500 bg-blue-500/10":"ring-1 ring-gray-600 hover:ring-blue-500 bg-gray-700"}`,children:[n.jsx(Yt,{className:"w-8 h-8"}),n.jsx("span",{className:"text-xs mt-1",children:h("locationEditModal.noStamp")})]}),p.map(w=>n.jsx("button",{onClick:()=>g(w.id),className:`w-full aspect-square rounded-lg overflow-hidden transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${m===w.id?"ring-2 ring-blue-500":"ring-1 ring-gray-700 hover:ring-blue-500"}`,children:n.jsx("img",{src:w.thumbnail,alt:w.name,className:"w-full h-full object-contain bg-gray-900/50"})},w.id))]})})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("button",{onClick:o,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:h("common.cancel")}),n.jsxs("button",{onClick:f,className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[n.jsx(Ht,{className:"w-5 h-5"}),h("common.save")]})]})]})})},pr=({onSave:t,onClose:e})=>{const{t:o}=A(),[a,s]=d.useState(""),[r,l]=d.useState(""),[i,c]=d.useState({}),m=()=>{const p={},u=parseFloat(a),h=parseFloat(r);return a?(isNaN(u)||u<-90||u>90)&&(p.lat=o("coordInputModal.validation.latInvalid")):p.lat=o("coordInputModal.validation.latRequired"),r?(isNaN(h)||h<-180||h>180)&&(p.lon=o("coordInputModal.validation.lonInvalid")):p.lon=o("coordInputModal.validation.lonRequired"),c(p),Object.keys(p).length===0},g=p=>{p.preventDefault(),m()&&t({latitude:parseFloat(a),longitude:parseFloat(r)})};return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:e,children:n.jsxs("div",{className:"relative w-full max-w-md m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 sm:p-8 text-white transform animate-scale-in flex flex-col gap-6",onClick:p=>p.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h2",{className:"text-2xl font-bold",children:o("coordInputModal.title")}),n.jsx("button",{onClick:e,className:"p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":o("common.close"),children:n.jsx(J,{className:"w-6 h-6"})})]}),n.jsxs("form",{onSubmit:g,className:"flex flex-col gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"latitude",className:"block text-sm font-medium text-gray-300 mb-1",children:o("coordInputModal.latitude")}),n.jsx("input",{id:"latitude",type:"number",step:"any",placeholder:o("coordInputModal.latitudePlaceholder"),value:a,onChange:p=>s(p.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i.lat?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),i.lat&&n.jsx("p",{className:"text-red-400 text-xs mt-1",children:i.lat})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"longitude",className:"block text-sm font-medium text-gray-300 mb-1",children:o("coordInputModal.longitude")}),n.jsx("input",{id:"longitude",type:"number",step:"any",placeholder:o("coordInputModal.longitudePlaceholder"),value:r,onChange:p=>l(p.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i.lon?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),i.lon&&n.jsx("p",{className:"text-red-400 text-xs mt-1",children:i.lon})]}),n.jsxs("div",{className:"flex gap-4 pt-2",children:[n.jsx("button",{type:"button",onClick:e,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:o("common.cancel")}),n.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[o("coordInputModal.next"),n.jsx(Ue,{className:"w-5 h-5"})]})]})]})]})})},fr=({onImport:t,onClose:e})=>{const{t:o}=A(),[a,s]=d.useState(""),[r,l]=d.useState(!1),[i,c]=d.useState(null),m=async()=>{if(c(null),!/^([NWR]\d+|\d+)$/i.test(a)){c("invalidId");return}l(!0);let h=a;/^\d+$/.test(a)&&(h=`N${a}`);try{const f=await fetch(`https://nominatim.openstreetmap.org/lookup?osm_ids=${h.toUpperCase()}&format=json`);if(!f.ok)throw new Error("Network response was not ok");const w=await f.json();w&&w.length>0?t({latitude:parseFloat(w[0].lat),longitude:parseFloat(w[0].lon)}):c("notFound")}catch(f){console.error("OSM Import Error:",f),c("network")}finally{l(!1)}},g=u=>{u.preventDefault(),m()},p={invalidId:o("osmImportModal.error.invalidId"),notFound:o("osmImportModal.error.notFound"),network:o("osmImportModal.error.network")};return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:e,children:n.jsxs("div",{className:"relative w-full max-w-md m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 sm:p-8 text-white transform animate-scale-in flex flex-col gap-6",onClick:u=>u.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h2",{className:"text-2xl font-bold",children:o("osmImportModal.title")}),n.jsx("button",{onClick:e,className:"p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":o("common.close"),children:n.jsx(J,{className:"w-6 h-6"})})]}),n.jsxs("form",{onSubmit:g,className:"flex flex-col gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"osmId",className:"block text-sm font-medium text-gray-300 mb-1",children:o("osmImportModal.idLabel")}),n.jsx("input",{id:"osmId",type:"text",placeholder:o("osmImportModal.idPlaceholder"),value:a,onChange:u=>s(u.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),n.jsx("p",{className:"text-xs text-gray-400 mt-2",children:o("osmImportModal.helpText")})]}),i&&n.jsx("p",{className:"text-red-400 text-xs mt-1",children:p[i]}),n.jsxs("div",{className:"flex gap-4 pt-2",children:[n.jsx("button",{type:"button",onClick:e,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:o("common.cancel")}),n.jsx("button",{type:"submit",disabled:r||!a,className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:bg-gray-600 disabled:cursor-not-allowed",children:r?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),o("osmImportModal.importing")]}):n.jsxs(n.Fragment,{children:[n.jsx(Ge,{className:"w-5 h-5"}),o("osmImportModal.import")]})})]})]})]})})},br=[{name:"Default",settings:{}},{name:"Gritty",settings:{edge_boost:5,wear_intensity:[.4,.2],noise_scale:[30,10],ink_depletion_intensity:[.5,.1],splat_density:.9}},{name:"Faded",settings:{edge_boost:1,wear_intensity:[.7,.1],noise_scale:[100,5],ink_depletion_intensity:[.8,.05],splat_density:.5,bleeding_factor:.2}},{name:"Clean",settings:{color_shape_shrink:1,shift:[.5,.2],rotation:[.2,.1],edge_width:2,edge_boost:1,wear_intensity:[.05,.01],ink_depletion_intensity:[.1,.01],splat_density:1.2,bleeding_factor:.05}}];async function yr(t,e,o,a){const s={successCount:0,totalCount:o.length,errors:[]};for(let r=0;r<o.length;r++){const l=o[r];try{const i=br.find(g=>g.name===l.preset),c={...tr,...i?i.settings:{}},m=await Je({user_id:t,name:l.name,thumbnail:"data:image/jpeg;base64,"+l.image,sourceImageURL:"data:image/jpeg;base64,"+l.image,settings:c});await Ye({user_id:t,rally_id:e,stamp_id:m.id,name:l.name,description:l.description,latitude:l.coordinates[0],longitude:l.coordinates[1],radius:l.collection_radius},t),s.successCount++}catch(i){console.error(`Error processing item ${l.name}:`,i),s.errors.push({item:l,error:i.message})}a(Math.round((r+1)/o.length*100))}return s}const xr=({isOpen:t,onClose:e,rallyId:o})=>{const{t:a}=A(),{addToast:s}=me(),{user:r}=he(),{refreshStamps:l}=ee(),[i,c]=d.useState(null),[m,g]=d.useState(0),[p,u]=d.useState("idle"),[h,f]=d.useState(null),w=d.useRef(null),N=b=>{if(b.target.files&&b.target.files[0]){const C=b.target.files[0];C.type==="application/json"?(c(C),u("idle"),f(null),g(0)):(c(null),u("error"),f(a("batchUpload.invalidFileType")),s(a("batchUpload.invalidFileType"),"error"))}},E=async()=>{if(!i){f(a("batchUpload.noFileSelected")),s(a("batchUpload.noFileSelected"),"error");return}if(!r){f(a("batchUpload.loginRequired")),s(a("batchUpload.loginRequired"),"error");return}u("uploading"),f(null);try{const b=new FileReader;b.onload=async C=>{var y;try{const k=(y=C.target)==null?void 0:y.result,z=JSON.parse(k);u("processing");const D=await yr(r.id,o,z,F=>{g(F)});D.errors.length>0?(u("error"),f(a("batchUpload.partialSuccess",{success:D.successCount,total:D.totalCount})),s(a("batchUpload.partialSuccess",{success:D.successCount,total:D.totalCount}),"info")):(u("success"),s(a("batchUpload.success",{count:D.successCount}),"success"),l())}catch(k){u("error"),f(a("batchUpload.invalidJson")+`: ${k.message}`),s(a("batchUpload.invalidJson"),"error")}},b.readAsText(i)}catch(b){u("error"),f(a("batchUpload.uploadFailed")+`: ${b.message}`),s(a("batchUpload.uploadFailed")+`: ${b.message}`,"error")}},M=()=>{c(null),g(0),u("idle"),f(null),w.current&&(w.current.value=""),e()};return t?n.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#1f2937",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:20,width:"90%",maxWidth:"425px",border:"1px solid #374151"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[n.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#f9fafb"},children:a("batchUpload.title")}),n.jsx("button",{onClick:M,style:{background:"none",border:"none",cursor:"pointer",color:"#9ca3af"},children:n.jsx(J,{size:20})})]}),n.jsxs("div",{style:{marginBottom:"15px"},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"24px",border:"2px dashed #4b5563",borderRadius:"8px",color:"#9ca3af"},children:[n.jsx("input",{id:"json-upload",type:"file",accept:".json",onChange:N,style:{display:"none"},ref:w}),n.jsxs("label",{htmlFor:"json-upload",style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx(qe,{size:48,style:{marginBottom:"8px"}}),n.jsx("p",{style:{fontSize:"0.875rem",marginBottom:"4px"},children:a("batchUpload.dragDrop")}),n.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280"},children:a("batchUpload.orClick")})]}),i&&n.jsxs("p",{style:{marginTop:"8px",fontSize:"0.875rem",color:"#f9fafb"},children:[a("batchUpload.selectedFile"),": ",i.name]})]}),p==="uploading"&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#60a5fa",marginTop:"15px"},children:[n.jsx(Ae,{size:20,style:{animation:"spin 1s linear infinite"}}),n.jsx("span",{children:a("batchUpload.readingFile")})]}),p==="processing"&&n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"15px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#60a5fa"},children:[n.jsx(Ae,{size:20,style:{animation:"spin 1s linear infinite"}}),n.jsx("span",{children:a("batchUpload.processingItems")})]}),n.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#4b5563",borderRadius:"4px",overflow:"hidden"},children:n.jsx("div",{style:{width:`${m}%`,height:"100%",backgroundColor:"#60a5fa",transition:"width 0.3s ease-in-out"}})}),n.jsxs("p",{style:{fontSize:"0.875rem",color:"#9ca3af",textAlign:"center"},children:[m,"%"]})]}),p==="success"&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#4ade80",marginTop:"15px"},children:[n.jsx(Be,{size:20}),n.jsx("span",{children:a("batchUpload.uploadComplete")})]}),p==="error"&&h&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#ef4444",marginTop:"15px"},children:[n.jsx(Zt,{size:20}),n.jsx("span",{children:h})]}),n.jsx("button",{onClick:E,disabled:!i||p==="uploading"||p==="processing",style:{marginTop:"15px",width:"100%",padding:"10px 15px",backgroundColor:"#60a5fa",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",opacity:!i||p==="uploading"||p==="processing"?.5:1,transition:"opacity 0.2s ease-in-out"},children:a(p==="processing"?"common.submitting":"batchUpload.uploadButton")})]})]}):null},wr=({editingLocation:t,newLocationCoords:e,setEditingLocation:o,setNewLocationCoords:a,coordInputOpen:s,setCoordInputOpen:r,osmImportOpen:l,setOsmImportOpen:i,isBatchUploadModalOpen:c,setIsBatchUploadModalOpen:m,managedRally:g})=>{const{addGeolocation:p,updateGeolocation:u}=ee(),{addToast:h}=me(),{t:f}=A(),w=G.useCallback(async N=>{if(!(g!=null&&g.id)){console.error("Cannot save geolocation: managedRally.id is null."),h(f("locationModals.rallyNotSelectedError"),"error"),o(null),a(null);return}try{if("id"in N&&N.id){const{id:E,...M}=N;await u(E,M,g.id),h(f("locationModals.locationUpdatedSuccess"),"success")}else await p(N,g.id),h(f("locationModals.locationAddedSuccess"),"success")}catch(E){console.error("Error saving location:",E),h(f("locationModals.saveLocationError",{error:E instanceof Error?E.message:String(E)}),"error")}finally{o(null),a(null)}},[p,u,h,f,o,a,g]);return n.jsxs(n.Fragment,{children:[(t||e)&&!s&&!l&&n.jsx(hr,{initialData:t||e,onSave:w,onClose:()=>{o(null),a(null)}}),s&&n.jsx(pr,{onSave:N=>{r(!1),a(N)},onClose:()=>r(!1)}),l&&n.jsx(fr,{onImport:N=>{i(!1),a(N)},onClose:()=>i(!1)}),c&&g&&n.jsx(xr,{isOpen:c,onClose:()=>m(!1),rallyId:g.id})]})};function Sr(t){const{geolocations:e,geolocationsLoading:o,geolocationsError:a,addGeolocation:s,updateGeolocation:r,deleteGeolocation:l,refreshGeolocations:i}=ee();return d.useEffect(()=>{t&&i(t)},[t,i]),{geolocations:e,loading:o,error:a,addGeolocation:s,updateGeolocation:r,deleteGeolocation:l,refreshGeolocations:()=>i(t)}}const Oe=G.lazy(()=>Se(()=>import("./StampRally-CIjbN7nL.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),vr=G.lazy(()=>Se(()=>import("./StampEditor-C2kZTFar.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),Tr=G.lazy(()=>Se(()=>import("./JoinRallyScreen-CT_TLbxq.js"),__vite__mapDeps([8,1,2,3,4,6]))),jr=G.lazy(()=>Se(()=>import("./RallyAdminDashboard-W86YGeQm.js"),__vite__mapDeps([9,1,2,3,4,6])));function kr(){const{user:t,loading:e,role:o,activeRallyId:a}=he(),[s,r]=d.useState("admin"),[l,i]=d.useState(!1),[c,m]=d.useState(null),[g,p]=d.useState(!1),[u,h]=d.useState(!1),[f,w]=d.useState(null),[N,E]=d.useState(null),[M,b]=d.useState(!1),[C,y]=d.useState(!1),[k,z]=d.useState(!1),[D,F]=d.useState(!1),{geolocations:B,deleteGeolocation:K}=Sr((c==null?void 0:c.id)||null),ke=L=>{switch(z(!1),L){case"map":F(!0);break;case"coords":b(!0);break;case"osm":y(!0);break;case"batch":i(!0);break}};d.useEffect(()=>{sessionStorage.getItem("splashSeen")||p(!0)},[]),d.useEffect(()=>{o&&!c&&s==="admin"&&r(o==="user"?"rally":"admin")},[o]);const te=()=>{p(!1),sessionStorage.setItem("splashSeen","true")},Ee=L=>{m(L),r("map")},oe=()=>{m(null),r("admin")},U=()=>{if(o==="user")return n.jsx(G.Suspense,{fallback:n.jsx(Z,{}),children:n.jsx(Oe,{})});if(o==="admin"){const L=!!c,ae=!L&&s==="admin",ne=L&&s==="map",pe=L&&s==="rally",re=s==="stamp";return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`w-full h-full ${ae?"block":"hidden"}`,children:n.jsx(G.Suspense,{fallback:n.jsx(Z,{}),children:n.jsx(jr,{onManageRally:Ee})})}),n.jsx(ur,{isVisible:ne,isPlacingOnMap:D,setIsPlacingOnMap:F,newLocationCoords:N,setNewLocationCoords:E,setEditingLocation:w,isLocationListOpen:u,setIsLocationListOpen:h,geolocations:B,deleteGeolocation:K}),n.jsx("div",{className:`w-full h-full ${pe?"block":"hidden"}`,children:n.jsx(Oe,{adminTestingRallyId:(c==null?void 0:c.id)||null,isVisible:pe})}),n.jsx("div",{className:`w-full h-full ${re?"block":"hidden"}`,children:n.jsx(G.Suspense,{fallback:n.jsx(Z,{}),children:n.jsx(vr,{})})})]})}return n.jsx(Z,{})};return e?n.jsx(Z,{}):t?o==="user"&&!a?n.jsx(G.Suspense,{fallback:n.jsx(Z,{}),children:n.jsx(Tr,{})}):n.jsxs(In,{mode:s,setMode:r,isAdmin:o==="admin",isManaging:!!c,managedRally:c,handleExitManagement:oe,isLocationListOpen:u,setIsLocationListOpen:h,addMenuOpen:k,setAddMenuOpen:z,handleSelectAddMethod:ke,setIsPlacingOnMap:F,children:[U(),g&&n.jsx(Sn,{onClose:te}),n.jsx(wr,{editingLocation:f,newLocationCoords:N,setEditingLocation:w,setNewLocationCoords:E,coordInputOpen:M,setCoordInputOpen:b,osmImportOpen:C,setOsmImportOpen:y,isBatchUploadModalOpen:l,setIsBatchUploadModalOpen:i,managedRally:c})]}):n.jsx(wn,{})}function Er(){return n.jsx(so,{children:n.jsx(jo,{children:n.jsx(xn,{children:n.jsx(sr,{children:n.jsx(kr,{})})})})})}const $e=document.getElementById("root");$e?Xt.createRoot($e).render(n.jsx(G.StrictMode,{children:n.jsx(Er,{})})):console.error('Fatal error: The root element with ID "root" was not found in the DOM. React cannot be mounted.');export{ir as B,Tn as D,gr as S,mr as T,me as a,he as b,or as c,ee as d,zr as e,lr as f,_r as g,ge as h,Qe as i,tt as j,ot as k,at as l,tr as m,fo as n,Pr as o,br as p,go as q,mo as r,V as s,ho as t,A as u,po as v};
