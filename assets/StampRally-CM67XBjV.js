import{r as s,j as e,X as pe,C as _e,g as de,E as Ne,I as Se,F as Me,H as Te,J as Ie,K as Re,N as De,q as Pe,s as we,t as Ee,f as ze,O as Le}from"./react-vendor-ZaBYvqzn.js";import{u as ke,a as he,b as ae,g as Fe,p as Ae,c as Ue,d as je,e as Ge,f as Be,h as Xe,i as Ye,j as $e,k as xe,l as Oe,B as qe}from"./index-MOIT9_wX.js";import{u as He,I as Ke}from"./InteractiveCanvasView-Drw-fWWh.js";import"./vendor-xCeh1xEN.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-C5xB3bhr.js";function Je(n){const{user:h}=ke(),[x,d]=s.useState([]),[c,P]=s.useState(!0),{addToast:j}=he(),{t:v}=ae();s.useEffect(()=>{h!=null&&h.id&&n?(P(!0),Fe(n).then(async u=>{const m=u.filter(b=>b.stamp_image_data).map(b=>b.stamp_image_data);try{await Promise.all(m.map(Ae))}catch(b){console.warn("Failed to preload some images, proceeding without them:",b)}d(u)}).catch(u=>{console.error("Failed to load collections from DB",u),j(v("collections.loadErrorToast"),"error")}).finally(()=>P(!1))):(d([]),P(!1))},[h==null?void 0:h.id,n,j,v]);const L=s.useCallback(u=>x.some(m=>m.geolocation_id===u&&m.is_collected),[x]),K=s.useCallback(async u=>{if(!h||!n)return j(v("collections.loginToast"),"info"),null;const m=x.find(f=>f.geolocation_id===u&&!f.is_collected);if(m)return m;const b=x.find(f=>f.geolocation_id===u&&f.is_collected);if(b)return b;const w={user_id:h.id,rally_id:n,geolocation_id:u,logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null},g=`temp-${Date.now()}`;d(f=>[...f,{...w,id:g,collected_at:new Date().toISOString(),is_collected:!1}]);try{const f=await Ue({user_id:h.id,rally_id:n,geolocation_id:u,is_collected:!1});return j(v("collections.addSuccessToast"),"success"),d(S=>S.map(E=>E.id===g?f:E)),f}catch(f){return console.error("Failed to save collection:",f),j(v("collections.addErrorToast"),"error"),d(S=>S.filter(E=>E.id!==g)),null}},[h,n,j,x,v]),F=s.useCallback(async(u,m,b)=>{const w=[...x],g={logbook_x:m.x,logbook_y:m.y,logbook_rotation:m.rotation,stamp_image_data:b,is_collected:!0};d(f=>f.map(S=>S.id===u?{...S,...g}:S));try{await je(u,g),j(v("collections.updateSuccessToast"),"success")}catch(f){console.error("Failed to update collection placement:",f),j(v("collections.updateErrorToast"),"error"),d(w)}},[x,j,v]),J=s.useCallback(async u=>{const m=[...x];d(b=>b.filter(w=>w.id!==u));try{await Ge(u),j(v("collections.removePlacementSuccessToast"),"info")}catch(b){console.error("Failed to remove collection:",b),j(v("collections.removePlacementErrorToast"),"error"),d(m)}},[x,j,v]),I=s.useCallback(async u=>{const m=[...x],b={logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null,is_collected:!1};d(w=>w.map(g=>g.id===u?{...g,...b}:g));try{await je(u,b)}catch(w){console.error("Failed to revert collection placement:",w),d(m)}},[x]);return{collections:x,loading:c,isCollected:L,collectStamp:K,updateCollectionPlacement:F,deleteCollection:J,revertCollectionPlacement:I}}const We=({location:n,onClose:h})=>{var d;const{t:x}=ae();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:h,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:c=>c.stopPropagation(),children:[e.jsx("button",{onClick:h,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":x("common.close"),children:e.jsx(pe,{className:"w-5 h-5"})}),n.stamp?e.jsx("img",{src:n.stamp.thumbnail,alt:n.stamp.name||"",className:"w-full h-40 object-contain bg-gray-900/50 rounded-t-2xl"}):e.jsx("div",{className:"w-full h-40 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:x("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400 mb-4",children:[e.jsx(_e,{className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold",children:x("stampDetailModal.collected")})]}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:n.name}),e.jsx("p",{className:"text-gray-400 mb-2 text-sm",children:(d=n.stamp)==null?void 0:d.name}),n.description&&e.jsx("p",{className:"text-gray-300 text-sm mt-4",children:n.description})]})]})})},Ze=({stamp:n,onClose:h,onGoToLocation:x})=>{const{t:d,locale:c}=ae(),P=new Date(n.collected_at).toLocaleDateString(c,{year:"numeric",month:"long",day:"numeric"});return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:h,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:j=>j.stopPropagation(),children:[e.jsx("button",{onClick:h,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":d("common.close"),children:e.jsx(pe,{className:"w-5 h-5"})}),n.stamp_image_data?e.jsx("div",{className:"w-full h-48 bg-white rounded-t-2xl flex items-center justify-center p-2",children:e.jsx("img",{src:n.stamp_image_data,alt:n.stamp.name||"",className:"max-w-full max-h-full object-contain"})}):e.jsx("div",{className:"w-full h-48 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:d("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:n.stamp.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:d("collectionDetailModal.stampDesign")})]}),e.jsx("div",{className:"border-t border-gray-700 -mx-6"}),e.jsxs("button",{onClick:()=>x(n.geolocation),className:"text-left flex flex-col gap-3 p-3 -m-3 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer group",title:d("collectionDetailModal.goToLocation",{name:n.geolocation.name}),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-white flex items-center gap-1.5",children:[n.geolocation.name,e.jsx(Ne,{className:"w-4 h-4 text-gray-500 group-hover:text-white transition-colors"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:d("collectionDetailModal.location")})]})]}),n.geolocation.description&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-gray-300",children:n.geolocation.description})})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Me,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:P}),e.jsx("p",{className:"text-sm text-gray-400",children:d("collectionDetailModal.dateCollected")})]})]})]})]})]})})},Ve=({isOpen:n,onClose:h,collections:x,geolocationsWithStamps:d,pendingPlacement:c,onPlace:P,onRemovePlacement:j,onCancelPlacement:v,stampImageCache:L,onGoToLocation:K})=>{const[F,J]=s.useState(!1),[I,u]=s.useState(!1),[m,b]=s.useState(null),[w,g]=s.useState(null),[f,S]=s.useState(null),{addToast:E}=he(),{t:M}=ae(),[R,O]=s.useState(null),X=s.useRef(null),W=s.useRef(null),z=s.useRef(null),ue=5,A=s.useMemo(()=>x.filter(t=>t.logbook_x!==null&&t.logbook_y!==null&&t.logbook_rotation!==null).map(t=>{const r=d.find(l=>l.id===t.geolocation_id);return!r||!r.stamp?null:{...t,stamp:r.stamp,geolocation:r}}).filter(t=>t!==null),[x,d]),Q=s.useCallback((t,r,l)=>{var a;(a=W.current)==null||a.call(W,t,r,l)},[]),{viewTransform:k,viewTransformRef:se,viewportSize:le,isPanMode:Z,isPanning:Y,containerProps:T,stampPreview:C,containerRef:me,canvasRef:ge,canvasNode:D}=He({onPlaceRequest:Q,isPlacementDisabled:!c||I||!R}),ee=s.useCallback((t,r)=>({x:(t-k.x)/k.scale,y:(r-k.y)/k.scale}),[k]),o=s.useCallback((t,r)=>{for(let l=A.length-1;l>=0;l--){const a=A[l],p=L.get(a.id);if(!p||!a.logbook_x||!a.logbook_y)continue;const{width:_,height:q}=p,{logbook_x:ne,logbook_y:fe,logbook_rotation:te}=a,oe=t-ne,B=r-fe,H=-(te||0)*(Math.PI/180),re=Math.cos(H),ie=Math.sin(H),ce=oe*re-B*ie,ye=oe*ie+B*re;if(ce>=-_/2&&ce<=_/2&&ye>=-q/2&&ye<=q/2)return a}return null},[A,L]),i=s.useCallback((t,r)=>{t.clearRect(0,0,r.width,r.height);for(const l of A){const a=L.get(l.id);a&&l.logbook_x!=null&&l.logbook_y!=null&&(t.save(),t.translate(l.logbook_x,l.logbook_y),t.rotate((l.logbook_rotation||0)*(Math.PI/180)),t.drawImage(a,-a.width/2,-a.height/2),t.restore())}},[A,L,k,le]),y=s.useCallback((t,r)=>{if(i(t,r),C&&R){const l=Math.atan2(C.current.y-C.start.y,C.current.x-C.start.x)*180/Math.PI,a=Math.hypot(C.current.y-C.start.y,C.current.x-C.start.x),{bitmap:p}=R;t.save(),t.globalAlpha=.7,t.translate(C.start.x,C.start.y),a>5&&t.rotate(l*Math.PI/180),t.drawImage(p,-p.width/2,-p.height/2),t.restore()}if(m&&!Y&&!C){const l=A.find(p=>p.id===m),a=l?L.get(l.id):null;l&&a&&l.logbook_x&&l.logbook_y&&(t.save(),t.translate(l.logbook_x,l.logbook_y),t.rotate((l.logbook_rotation||0)*(Math.PI/180)),t.strokeStyle="rgba(59, 130, 246, 0.9)",t.lineWidth=4/k.scale,t.setLineDash([8/k.scale,4/k.scale]),t.strokeRect(-a.width/2,-a.height/2,a.width,a.height),t.restore())}},[i,C,R,m,A,L,k.scale,Y]),N=s.useCallback(async(t,r,l)=>{if(!(!c||!R))try{if(X.current&&(X.current.currentTime=0,X.current.play().catch(console.warn)),D){const a=D.getContext("2d");if(a){const{bitmap:p}=R;a.save(),a.translate(t,r),a.rotate((l||0)*Math.PI/180),a.drawImage(p,-p.width/2,-p.height/2),a.restore()}}P(c.collection.id,{x:t,y:r,rotation:l},R.dataUrl),S({collectionId:c.collection.id,name:c.stamp.name}),O(null)}catch(a){console.error("Error placing stamp:",a),E(M("logbook.placeErrorToast"),"error")}},[c,R,P,E,D,M]);s.useEffect(()=>{W.current=N},[N]),s.useEffect(()=>{if(!X.current){const t=new Audio("/atsume-page/stamp-sound.mp3");t.preload="auto",X.current=t}},[]),s.useEffect(()=>{if(c&&n){S(null);let t=!1;return(async()=>{u(!0),O(null);try{const{stamp:a}=c,p={...a.settings,stamp_size:Math.min(a.settings.stamp_size,500)},_=new Image;_.crossOrigin="anonymous",_.src=a.sourceImageURL,await new Promise((ie,ce)=>{_.onload=()=>ie(),_.onerror=()=>ce()});const q=Be(_,p.stamp_size),ne=q.getContext("2d",{willReadFrequently:!0});if(!ne)throw new Error("No context");const fe=ne.getImageData(0,0,q.width,q.height),te=await Xe(fe,p),oe=await createImageBitmap(te),B=document.createElement("canvas");B.width=te.width,B.height=te.height;const H=B.getContext("2d");if(!H)throw new Error("No context for data URL");H.fillStyle="#FFFFFF",H.fillRect(0,0,B.width,B.height),H.drawImage(oe,0,0);const re=B.toDataURL("image/jpeg",.8);t||O({bitmap:oe,dataUrl:re})}catch(l){console.error("Failed to generate pending stamp",l),t||E(M("logbook.prepareErrorToast"),"error")}finally{t||u(!1)}})(),()=>{t=!0}}else n||O(null)},[c,n,E,M]),s.useEffect(()=>{if(!D||!n)return;const t=D.getContext("2d");if(!t)return;const r=requestAnimationFrame(()=>{y(t,D)});return()=>cancelAnimationFrame(r)},[D,n,y,k.scale]),s.useEffect(()=>{if(!n)return;const t=setTimeout(()=>{if(D){const r=D.getContext("2d");r&&y(r,D)}},50);return()=>clearTimeout(t)},[n,D,y]);const $=s.useCallback(()=>{J(!0),setTimeout(()=>{h(),J(!1),S(null),c&&v(c.collection.id)},300)},[h,c,v]),U=()=>{f&&(j(f.collectionId),S(null))},Ce={...T,onMouseDown:t=>{var p,_;if(Y||C||I||c){(p=T.onMouseDown)==null||p.call(T,t);return}const r=t.currentTarget.getBoundingClientRect(),l=ee(t.clientX-r.left,t.clientY-r.top),a=o(l.x,l.y);z.current={clientX:t.clientX,clientY:t.clientY,isPotentialClick:!!a},(_=T.onMouseDown)==null||_.call(T,t)},onMouseMove:t=>{var p,_;if((p=z.current)!=null&&p.isPotentialClick&&Math.hypot(t.clientX-z.current.clientX,t.clientY-z.current.clientY)>ue&&(z.current.isPotentialClick=!1),(_=T.onMouseMove)==null||_.call(T,t),Y||C||I||c){m&&b(null);return}const r=t.currentTarget.getBoundingClientRect(),l=ee(t.clientX-r.left,t.clientY-r.top),a=o(l.x,l.y);(a==null?void 0:a.id)!==m&&b(a?a.id:null)},onMouseUp:t=>{var r,l;if((r=z.current)!=null&&r.isPotentialClick){const a=t.currentTarget.getBoundingClientRect(),p=ee(t.clientX-a.left,t.clientY-a.top),_=o(p.x,p.y);_&&g(_)}(l=T.onMouseUp)==null||l.call(T,t),z.current=null}};if(!n&&!F)return null;const ve=Z?"cursor-grab":c?"cursor-crosshair":m&&!Y&&!C?"cursor-pointer":"cursor-default";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed inset-0 z-40 bg-gray-900/50 backdrop-blur-sm transition-opacity duration-300 ${n&&!F?"opacity-100":"opacity-0"}`,children:[e.jsx(Ke,{canvasRef:ge,containerRef:me,canvasNode:D,containerProps:Ce,viewTransform:k,viewTransformRef:se,viewportSize:le,isPanning:Y,isPanMode:Z,stampPreview:C,cursorClass:ve,ariaLabel:M("logbook.stampingArea")}),e.jsx("button",{onClick:$,className:"absolute top-4 right-4 z-50 p-2 text-white bg-gray-900/50 rounded-full hover:bg-gray-700 transition-colors","aria-label":M("logbook.close"),children:e.jsx(pe,{className:"w-6 h-6"})}),(I||c&&!R)&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-lg z-50 pointer-events-none",children:[e.jsx(Te,{className:"w-6 h-6 mr-3 animate-pulse"}),M("logbook.preparingStamp")]}),c&&!I&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 pointer-events-none text-center",children:e.jsxs("div",{children:[M("logbook.pendingPlacement")," ",e.jsx("strong",{children:c.stamp.name}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-300",children:M("logbook.pendingPlacementSubtext")})]})}),f&&!c&&!I&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-4 shadow-lg animate-fade-in",children:[e.jsx("span",{className:"text-gray-300",children:M("logbook.placedToast",{name:f.name})}),e.jsxs("button",{onClick:U,className:"flex items-center gap-1.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 px-3 rounded-full transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4"}),M("logbook.redo")]})]}),Z&&!c&&!f&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Re,{className:"w-4 h-4"})," ",M("logbook.panMode")]}),m&&!Z&&!c&&!f&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(De,{className:"w-4 h-4"})," ",M("logbook.clickToView")]})]}),w&&e.jsx(Ze,{stamp:w,onClose:()=>g(null),onGoToLocation:K})]})},lt=({adminTestingRallyId:n=null,isVisible:h=!0})=>{const{addToast:x}=he(),{activeRallyId:d,role:c}=ke(),P=c==="admin"?n:d,{geolocations:j,loading:v,fetchGeolocations:L}=Ye(P);s.useEffect(()=>{h&&P&&L()},[h,P,L]);const{stamps:K}=$e(),{collections:F,loading:J,isCollected:I,collectStamp:u,updateCollectionPlacement:m,revertCollectionPlacement:b}=Je(P),{t:w}=ae(),[g,f]=s.useState(null),[S,E]=s.useState(null),[M,R]=s.useState(!1),[O,X]=s.useState(!1),[W,z]=s.useState(null),[ue,A]=s.useState(new Map),Q=s.useRef(null),k=s.useMemo(()=>j.map(o=>({...o,stamp:K.find(i=>i.id===o.stamp_id)||null})),[j,K]),se=s.useMemo(()=>g?k.some(o=>I(o.id)?!1:xe(g.latitude,g.longitude,o.latitude,o.longitude)<=o.radius):!1,[g,k,I]),le=s.useMemo(()=>({type:"FeatureCollection",features:k.map(i=>{const y=I(i.id);let N=!1;!y&&g&&(N=xe(g.latitude,g.longitude,i.latitude,i.longitude)<=i.radius);const $=y?"collected":N?"collectable":"locked",U=Oe([i.longitude,i.latitude],i.radius);return U.properties={id:i.id,state:$},U})}),[k,I,g]);s.useEffect(()=>{const o=F.filter(N=>N.logbook_x!=null&&N.stamp_image_data);let i=!1;const y=async()=>{const N=o.map(async G=>{try{const V=new Image;V.src=G.stamp_image_data,await V.decode();const be=await createImageBitmap(V);return[G.id,be]}catch(V){return console.error(`Failed to preload image for collection ${G.id}`,V),null}}),$=await Promise.all(N);if(i)return;const U=new Map;for(const G of $)G&&U.set(G[0],G[1]);A(U)};return o.length>0?y():A(new Map),()=>{i=!0}},[F]);const Z=async o=>{if(!(O||!o.stamp)){X(!0);try{const i=await u(o.id);i&&(z({collection:i,stamp:o.stamp}),R(!0))}finally{X(!1)}}},Y=(o,i,y)=>{m(o,i,y),z(null)},T=async o=>{await b(o);const i=F.find(y=>y.id===o);if(i){const y=k.find(N=>N.id===i.geolocation_id);y&&y.stamp&&z({collection:i,stamp:y.stamp})}},C=async o=>{await b(o),z(null),x(w("collections.placementCancelledToast"),"info")},me=o=>{R(!1),Q.current&&(Q.current.flyTo({center:[o.longitude,o.latitude],zoom:15,speed:1.2}),x(w("rally.flyingToast",{name:o.name}),"info"))},ge=o=>{f(o)},D=F.filter(o=>o.geolocation_id).length,ee=j.length;return e.jsxs(e.Fragment,{children:[e.jsxs(qe,{isVisible:h,onGeolocate:ge,mapRef:Q,children:[e.jsxs(Pe,{id:"rally-radius-circles",type:"geojson",data:le,children:[e.jsx(we,{id:"rally-radius-fill",type:"fill",paint:{"fill-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#737373"],"fill-opacity":["match",["get","state"],"collectable",.3,"collected",.2,.1]}}),e.jsx(we,{id:"rally-radius-stroke",type:"line",paint:{"line-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#a3a3a3"],"line-width":2,"line-dasharray":[2,2]}})]}),k.map(o=>{const i=I(o.id);let y=!1;!i&&g&&(y=xe(g.latitude,g.longitude,o.latitude,o.longitude)<=o.radius);let N="text-gray-500",$="";return i?N="text-yellow-400":y&&(N="text-blue-500",$="animate-pulse-marker"),e.jsx(Ee,{longitude:o.longitude,latitude:o.latitude,style:{zIndex:20},children:e.jsx("button",{disabled:!y&&!i||O,onClick:U=>{U.stopPropagation(),y?Z(o):i&&E(o)},"aria-label":w("rally.locationStatus",{name:o.name}),className:`${y||i?"cursor-pointer":"cursor-default"}`,children:e.jsx(de,{className:`${N} ${$} w-8 h-8 drop-shadow-lg`,strokeWidth:1.5})})},o.id)})]}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-25 transition-all duration-500 ease-in-out
          ${se?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(de,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:w("rally.nearbyStamp")})]})}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-25 transition-all duration-500 ease-in-out
          ${se?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(de,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:w("rally.nearbyStamp")})]})}),!(v||J)&&e.jsxs("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-25 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm font-semibold flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:w("rally.progress",{collectedCount:D,totalCount:ee})})]}),e.jsxs("button",{onClick:()=>R(!0),className:"fixed top-1/2 -translate-y-1/2 right-0 z-30 py-4 px-2 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-l-lg shadow-lg transition-colors logbook-toggle-button","aria-label":w("rally.logbookToggle"),title:w("rally.logbookToggle"),children:[e.jsx(Le,{className:"w-5 h-5"}),w("rally.logbookToggle")]}),S&&e.jsx(We,{location:S,onClose:()=>E(null)}),e.jsx(Ve,{isOpen:M,onClose:()=>{R(!1)},collections:F,geolocationsWithStamps:k,pendingPlacement:W,onPlace:Y,onRemovePlacement:T,onCancelPlacement:C,stampImageCache:ue,onGoToLocation:me})]})};export{lt as default};
