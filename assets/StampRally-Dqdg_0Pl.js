import{r as n,j as e,X as fe,C as je,l as ie,z as ke,I as Ce,B as ve,D as Ne,E as _e,F as Se,H as Me,p as Te,q as pe,s as Ie,c as De,J as Re}from"./react-vendor-DJ-QoGxu.js";import{d as be,a as xe,u as se,g as ze,e as Pe,f as Ee,h as Le}from"./index-CHHc0UA1.js";import{u as Ae,g as ge,c as Fe,B as Be}from"./BaseMap-BPQICjiI.js";import{u as Ge}from"./useGallery-DI1ZCefi.js";import{u as Ue,I as Xe}from"./InteractiveCanvasView-C2H_W28k.js";import{c as Ye,g as $e}from"./stamp-D6e6GvNL.js";import"./vendor-CFJUWez9.js";import"./maplibre-gl-vendor-Csyg3Y42.js";import"./supabase-vendor-C_Ws-sQM.js";function Oe(r){const{user:h}=be(),[p,m]=n.useState([]),[d,D]=n.useState(!0),{addToast:b}=xe(),{t:k}=se();n.useEffect(()=>{h!=null&&h.id&&r?(D(!0),ze(r).then(m).catch(f=>{console.error("Failed to load collections from DB",f),b(k("collections.loadErrorToast"),"error")}).finally(()=>D(!1))):(m([]),D(!1))},[h==null?void 0:h.id,r,b,k]);const M=n.useCallback(f=>p.some(g=>g.geolocation_id===f&&g.is_collected),[p]),F=n.useCallback(async f=>{if(!h||!r)return b(k("collections.loginToast"),"info"),null;const g=p.find(C=>C.geolocation_id===f);if(g)return g;const u={user_id:h.id,rally_id:r,geolocation_id:f,logbook_x:null,logbook_y:null,logbook_rotation:null,stamp_image_data:null},I=`temp-${Date.now()}`;m(C=>[...C,{...u,id:I,collected_at:new Date().toISOString(),is_collected:!1}]);try{const C=await Pe({user_id:h.id,rally_id:r,geolocation_id:f,is_collected:!1});return b(k("collections.addSuccessToast"),"success"),m(T=>T.map(v=>v.id===I?C:v)),C}catch(C){return console.error("Failed to save collection:",C),b(k("collections.addErrorToast"),"error"),m(T=>T.filter(v=>v.id!==I)),null}},[h,r,b,p,k]),Z=n.useCallback(async(f,g,u)=>{const I=[...p],C={logbook_x:g.x,logbook_y:g.y,logbook_rotation:g.rotation,stamp_image_data:u,is_collected:!0};m(T=>T.map(v=>v.id===f?{...v,...C}:v));try{await Ee(f,C),b(k("collections.updateSuccessToast"),"success")}catch(T){console.error("Failed to update collection placement:",T),b(k("collections.updateErrorToast"),"error"),m(I)}},[p,b,k]),Q=n.useCallback(async f=>{const g=[...p];m(u=>u.filter(I=>I.id!==f));try{await Le(f),b(k("collections.removePlacementSuccessToast"),"info")}catch(u){console.error("Failed to remove collection:",u),b(k("collections.removePlacementErrorToast"),"error"),m(g)}},[p,b,k]);return{collections:p,loading:d,isCollected:M,collectStamp:F,updateCollectionPlacement:Z,removeCollectionPlacement:Q}}const qe=({location:r,onClose:h})=>{var m;const{t:p}=se();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:h,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:d=>d.stopPropagation(),children:[e.jsx("button",{onClick:h,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":p("common.close"),children:e.jsx(fe,{className:"w-5 h-5"})}),r.stamp?e.jsx("img",{src:r.stamp.thumbnail,alt:r.stamp.name||"",className:"w-full h-40 object-contain bg-gray-900/50 rounded-t-2xl"}):e.jsx("div",{className:"w-full h-40 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:p("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400 mb-4",children:[e.jsx(je,{className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold",children:p("stampDetailModal.collected")})]}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:r.name}),e.jsx("p",{className:"text-gray-400 mb-2 text-sm",children:(m=r.stamp)==null?void 0:m.name}),r.description&&e.jsx("p",{className:"text-gray-300 text-sm mt-4",children:r.description})]})]})})},He=({stamp:r,onClose:h,onGoToLocation:p})=>{const{t:m,locale:d}=se(),D=new Date(r.collected_at).toLocaleDateString(d,{year:"numeric",month:"long",day:"numeric"});return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:h,children:e.jsxs("div",{className:"relative w-full max-w-sm m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl text-white transform animate-scale-in flex flex-col",onClick:b=>b.stopPropagation(),children:[e.jsx("button",{onClick:h,className:"absolute top-3 right-3 z-10 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":m("common.close"),children:e.jsx(fe,{className:"w-5 h-5"})}),r.stamp_image_data?e.jsx("div",{className:"w-full h-48 bg-white rounded-t-2xl flex items-center justify-center p-2",children:e.jsx("img",{src:r.stamp_image_data,alt:r.stamp.name||"",className:"max-w-full max-h-full object-contain"})}):e.jsx("div",{className:"w-full h-48 flex items-center justify-center bg-gray-900/50 rounded-t-2xl text-gray-500",children:m("stampDetailModal.noImage")}),e.jsxs("div",{className:"p-6 flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:r.stamp.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:m("collectionDetailModal.stampDesign")})]}),e.jsx("div",{className:"border-t border-gray-700 -mx-6"}),e.jsxs("button",{onClick:()=>p(r.geolocation),className:"text-left flex flex-col gap-3 p-3 -m-3 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer group",title:m("collectionDetailModal.goToLocation",{name:r.geolocation.name}),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-white flex items-center gap-1.5",children:[r.geolocation.name,e.jsx(ke,{className:"w-4 h-4 text-gray-500 group-hover:text-white transition-colors"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:m("collectionDetailModal.location")})]})]}),r.geolocation.description&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-gray-300",children:r.geolocation.description})})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-5 h-5 mt-0.5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:D}),e.jsx("p",{className:"text-sm text-gray-400",children:m("collectionDetailModal.dateCollected")})]})]})]})]})]})})},Je=({isOpen:r,onClose:h,collections:p,geolocationsWithStamps:m,pendingPlacement:d,onPlace:D,onRemovePlacement:b,onCancelPlacement:k,stampImageCache:M,onGoToLocation:F})=>{const[Z,Q]=n.useState(!1),[f,g]=n.useState(!1),[u,I]=n.useState(null),[C,T]=n.useState(null),[v,B]=n.useState(null),{addToast:q}=xe(),{t:_}=se(),[R,G]=n.useState(null),H=n.useRef(null),J=n.useRef(null),z=n.useRef(null),U=5,A=n.useMemo(()=>p.filter(t=>t.logbook_x!==null&&t.logbook_y!==null&&t.logbook_rotation!==null).map(t=>{const i=m.find(l=>l.id===t.geolocation_id);return!i||!i.stamp?null:{...t,stamp:i.stamp,geolocation:i}}).filter(t=>t!==null),[p,m]),ce=n.useCallback((t,i,l,o)=>{var c;(c=J.current)==null||c.call(J,t,i,l,o)},[]),{viewTransform:y,viewTransformRef:de,viewportSize:ee,isPanMode:te,isPanning:O,containerProps:S,stampPreview:w,containerRef:ue,canvasRef:a,canvasNode:s}=Ue({onPlaceRequest:ce,isPlacementDisabled:!d||f||!R}),x=n.useCallback((t,i)=>({x:(t-y.x)/y.scale,y:(i-y.y)/y.scale}),[y]),N=n.useCallback((t,i)=>{for(let l=A.length-1;l>=0;l--){const o=A[l],c=M.get(o.id);if(!c||!o.logbook_x||!o.logbook_y)continue;const{width:j,height:Y}=c,{logbook_x:V,logbook_y:oe,logbook_rotation:L}=o,$=t-V,W=i-oe,ae=-(L||0)*(Math.PI/180),le=Math.cos(ae),ne=Math.sin(ae),re=$*le-W*ne,he=$*ne+W*le;if(re>=-j/2&&re<=j/2&&he>=-Y/2&&he<=Y/2)return o}return null},[A,M]),X=n.useCallback((t,i)=>{t.clearRect(0,0,i.width,i.height);const l={x:(0-y.x)/y.scale,y:(0-y.y)/y.scale,width:ee.width/y.scale,height:ee.height/y.scale};for(const o of A){const c=M.get(o.id);if(c&&o.logbook_x!=null&&o.logbook_y!=null){const{width:j,height:Y}=c,{logbook_x:V,logbook_y:oe}=o,L=Math.hypot(j,Y)/2,$={left:V-L,right:V+L,top:oe-L,bottom:oe+L};if($.right<l.x||$.left>l.x+l.width||$.bottom<l.y||$.top>l.y+l.height)continue;t.save(),t.translate(o.logbook_x,o.logbook_y),t.rotate((o.logbook_rotation||0)*(Math.PI/180)),t.drawImage(c,-c.width/2,-c.height/2),t.restore()}}},[A,M,y,ee]),P=n.useCallback((t,i)=>{if(X(t,i),w&&R){const l=Math.atan2(w.current.y-w.start.y,w.current.x-w.start.x)*180/Math.PI,o=Math.hypot(w.current.y-w.start.y,w.current.x-w.start.x),{bitmap:c}=R;t.save(),t.globalAlpha=.7,t.translate(w.start.x,w.start.y),o>5&&t.rotate(l*Math.PI/180),t.drawImage(c,-c.width/2,-c.height/2),t.restore()}if(u&&!O&&!w){const l=A.find(c=>c.id===u),o=l?M.get(l.id):null;l&&o&&l.logbook_x&&l.logbook_y&&(t.save(),t.translate(l.logbook_x,l.logbook_y),t.rotate((l.logbook_rotation||0)*(Math.PI/180)),t.strokeStyle="rgba(59, 130, 246, 0.9)",t.lineWidth=4/y.scale,t.setLineDash([8/y.scale,4/y.scale]),t.strokeRect(-o.width/2,-o.height/2,o.width,o.height),t.restore())}},[X,w,R,u,A,M,y.scale,O]),E=n.useCallback(async(t,i,l)=>{if(!(!d||!R))try{if(H.current&&(H.current.currentTime=0,H.current.play().catch(console.warn)),s){const o=s.getContext("2d");if(o){const{bitmap:c}=R;o.save(),o.translate(t,i),o.rotate((l||0)*Math.PI/180),o.drawImage(c,-c.width/2,-c.height/2),o.restore()}}D(d.collection.id,{x:t,y:i,rotation:l},R.dataUrl),B({collectionId:d.collection.id,name:d.stamp.name}),G(null)}catch(o){console.error("Error placing stamp:",o),q(_("logbook.placeErrorToast"),"error")}},[d,R,D,q,s,_]);n.useEffect(()=>{J.current=E},[E]),n.useEffect(()=>{if(!H.current){const t=new Audio("/atsume-page/stamp-sound.mp3");t.preload="auto",H.current=t}},[]),n.useEffect(()=>{if(d&&r){B(null);let t=!1;return(async()=>{g(!0),G(null);try{const{stamp:o}=d,c={...o.settings,stamp_size:Math.min(o.settings.stamp_size,500)},j=new Image;j.crossOrigin="anonymous",j.src=o.sourceImageURL,await new Promise((ne,re)=>{j.onload=()=>ne(),j.onerror=()=>re()});const Y=Ye(j,c.stamp_size),V=Y.getContext("2d",{willReadFrequently:!0});if(!V)throw new Error("No context");const oe=V.getImageData(0,0,Y.width,Y.height),L=await $e(oe,c),$=await createImageBitmap(L),W=document.createElement("canvas");W.width=L.width,W.height=L.height;const ae=W.getContext("2d");if(!ae)throw new Error("No context for data URL");ae.putImageData(L,0,0);const le=W.toDataURL("image/png");t||G({bitmap:$,dataUrl:le})}catch(l){console.error("Failed to generate pending stamp",l),t||q(_("logbook.prepareErrorToast"),"error")}finally{t||g(!1)}})(),()=>{t=!0}}else r||G(null)},[d,r,q,_]),n.useEffect(()=>{if(!s||!r)return;const t=s.getContext("2d");if(!t)return;const i=requestAnimationFrame(()=>{P(t,s)});return()=>cancelAnimationFrame(i)},[s,r,P,y.scale]),n.useEffect(()=>{if(!r)return;const t=setTimeout(()=>{if(s){const i=s.getContext("2d");i&&P(i,s)}},50);return()=>clearTimeout(t)},[r,s,P]);const K=n.useCallback(()=>{Q(!0),setTimeout(()=>{h(),Q(!1),B(null),d&&k(d.collection.id)},300)},[h,d,k]),me=()=>{v&&(b(v.collectionId),B(null))},ye={...S,onMouseDown:t=>{var c,j;if(O||w||f||d){(c=S.onMouseDown)==null||c.call(S,t);return}const i=t.currentTarget.getBoundingClientRect(),l=x(t.clientX-i.left,t.clientY-i.top),o=N(l.x,l.y);z.current={clientX:t.clientX,clientY:t.clientY,isPotentialClick:!!o},(j=S.onMouseDown)==null||j.call(S,t)},onMouseMove:t=>{var c,j;if((c=z.current)!=null&&c.isPotentialClick&&Math.hypot(t.clientX-z.current.clientX,t.clientY-z.current.clientY)>U&&(z.current.isPotentialClick=!1),(j=S.onMouseMove)==null||j.call(S,t),O||w||f||d){u&&I(null);return}const i=t.currentTarget.getBoundingClientRect(),l=x(t.clientX-i.left,t.clientY-i.top),o=N(l.x,l.y);(o==null?void 0:o.id)!==u&&I(o?o.id:null)},onMouseUp:t=>{var i,l;if((i=z.current)!=null&&i.isPotentialClick){const o=t.currentTarget.getBoundingClientRect(),c=x(t.clientX-o.left,t.clientY-o.top),j=N(c.x,c.y);j&&T(j)}(l=S.onMouseUp)==null||l.call(S,t),z.current=null}};if(!r&&!Z)return null;const we=te?"cursor-grab":d?"cursor-crosshair":u&&!O&&!w?"cursor-pointer":"cursor-default";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed inset-0 z-40 bg-gray-900/50 backdrop-blur-sm transition-opacity duration-300 ${r&&!Z?"opacity-100":"opacity-0"}`,children:[e.jsx(Xe,{canvasRef:a,containerRef:ue,canvasNode:s,containerProps:ye,viewTransform:y,viewTransformRef:de,viewportSize:ee,isPanning:O,isPanMode:te,stampPreview:w,cursorClass:we,ariaLabel:_("logbook.stampingArea")}),e.jsx("button",{onClick:K,className:"absolute top-4 right-4 z-50 p-2 text-white bg-gray-900/50 rounded-full hover:bg-gray-700 transition-colors","aria-label":_("logbook.close"),children:e.jsx(fe,{className:"w-6 h-6"})}),(f||d&&!R)&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white text-lg z-50 pointer-events-none",children:[e.jsx(Ne,{className:"w-6 h-6 mr-3 animate-pulse"}),_("logbook.preparingStamp")]}),d&&!f&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 pointer-events-none text-center",children:e.jsxs("div",{children:[_("logbook.pendingPlacement")," ",e.jsx("strong",{children:d.stamp.name}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-300",children:_("logbook.pendingPlacementSubtext")})]})}),v&&!d&&!f&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-4 shadow-lg animate-fade-in",children:[e.jsx("span",{className:"text-gray-300",children:_("logbook.placedToast",{name:v.name})}),e.jsxs("button",{onClick:me,className:"flex items-center gap-1.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 px-3 rounded-full transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),_("logbook.redo")]})]}),te&&!d&&!v&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Se,{className:"w-4 h-4"})," ",_("logbook.panMode")]}),u&&!te&&!d&&!v&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 pointer-events-none",children:[e.jsx(Me,{className:"w-4 h-4"})," ",_("logbook.clickToView")]})]}),C&&e.jsx(He,{stamp:C,onClose:()=>T(null),onGoToLocation:F})]})},rt=({adminTestingRallyId:r=null,isVisible:h=!0})=>{const{addToast:p}=xe(),{activeRallyId:m,role:d}=be(),D=d==="admin"?r:m,{geolocations:b}=Ae(D),{stamps:k}=Ge(),{collections:M,isCollected:F,collectStamp:Z,updateCollectionPlacement:Q,removeCollectionPlacement:f}=Oe(D),{t:g}=se(),[u,I]=n.useState(null),[C,T]=n.useState(null),[v,B]=n.useState(!1),[q,_]=n.useState(!1),[R,G]=n.useState(null),[H,J]=n.useState(new Map),z=n.useRef(null),U=n.useMemo(()=>b.map(a=>({...a,stamp:k.find(s=>s.id===a.stamp_id)||null})),[b,k]),A=n.useMemo(()=>u?U.some(a=>F(a.id)?!1:ge(u.latitude,u.longitude,a.latitude,a.longitude)<=a.radius):!1,[u,U,F]),ce=n.useMemo(()=>({type:"FeatureCollection",features:U.map(s=>{const x=F(s.id);let N=!1;!x&&u&&(N=ge(u.latitude,u.longitude,s.latitude,s.longitude)<=s.radius);const X=x?"collected":N?"collectable":"locked",P=Fe([s.longitude,s.latitude],s.radius);return P.properties={id:s.id,state:X},P})}),[U,F,u]);n.useEffect(()=>{const a=M.filter(N=>N.logbook_x!=null&&N.stamp_image_data);let s=!1;const x=async()=>{const N=a.map(async E=>{try{const K=new Image;K.src=E.stamp_image_data,await K.decode();const me=await createImageBitmap(K);return[E.id,me]}catch(K){return console.error(`Failed to preload image for collection ${E.id}`,K),null}}),X=await Promise.all(N);if(s)return;const P=new Map;for(const E of X)E&&P.set(E[0],E[1]);J(P)};return a.length>0?x():J(new Map),()=>{s=!0}},[M]);const y=async a=>{if(!(q||!a.stamp)){_(!0);try{const s=await Z(a.id);s&&(G({collection:s,stamp:a.stamp}),B(!0))}finally{_(!1)}}},de=(a,s,x)=>{Q(a,s,x),G(null)},ee=a=>{f(a);const s=M.find(x=>x.id===a);if(s){const x=U.find(N=>N.id===s.geolocation_id);x&&x.stamp&&G({collection:s,stamp:x.stamp})}},te=a=>{f(a),G(null),p(g("collections.placementCancelledToast"),"info")},O=a=>{B(!1),z.current&&(z.current.flyTo({center:[a.longitude,a.latitude],zoom:15,speed:1.2}),p(g("rally.flyingToast",{name:a.name}),"info"))},S=a=>{I(a)},w=M.filter(a=>a.geolocation_id).length,ue=b.length;return e.jsxs(e.Fragment,{children:[e.jsxs(Be,{isVisible:h,onGeolocate:S,mapRef:z,children:[e.jsxs(Te,{id:"rally-radius-circles",type:"geojson",data:ce,children:[e.jsx(pe,{id:"rally-radius-fill",type:"fill",paint:{"fill-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#737373"],"fill-opacity":["match",["get","state"],"collectable",.3,"collected",.2,.1]}}),e.jsx(pe,{id:"rally-radius-stroke",type:"line",paint:{"line-color":["match",["get","state"],"collectable","#3b82f6","collected","#eab308","#a3a3a3"],"line-width":2,"line-dasharray":[2,2]}})]}),U.map(a=>{const s=F(a.id);let x=!1;!s&&u&&(x=ge(u.latitude,u.longitude,a.latitude,a.longitude)<=a.radius);let N="text-gray-500",X="";return s?N="text-yellow-400":x&&(N="text-blue-500",X="animate-pulse-marker"),e.jsx(Ie,{longitude:a.longitude,latitude:a.latitude,style:{zIndex:x?999:s?998:997},children:e.jsx("button",{disabled:!x&&!s||q,onClick:()=>{x?y(a):s&&T(a)},"aria-label":g("rally.locationStatus",{name:a.name}),className:`${x||s?"cursor-pointer":"cursor-default"}`,children:e.jsx(ie,{className:`${N} ${X} w-8 h-8 drop-shadow-lg`,strokeWidth:1.5})})},a.id)})]}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-10 transition-all duration-500 ease-in-out
          ${A?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(ie,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:g("rally.nearbyStamp")})]})}),e.jsx("div",{className:`absolute top-32 left-1/2 -translate-x-1/2 z-10 transition-all duration-500 ease-in-out
          ${A?"opacity-100 translate-y-0":"opacity-0 -translate-y-full pointer-events-none"}`,children:e.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-sm text-white px-5 py-3 rounded-full text-base font-semibold flex items-center gap-3 shadow-lg ring-2 ring-white/20",children:[e.jsx(ie,{className:"w-5 h-5 animate-pulse-marker"}),e.jsx("span",{children:g("rally.nearbyStamp")})]})}),e.jsxs("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-10 bg-gray-900/80 text-white px-4 py-2 rounded-full text-sm font-semibold flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:g("rally.progress",{collectedCount:w,totalCount:ue})})]}),e.jsxs("button",{onClick:()=>B(!0),className:"fixed top-1/2 -translate-y-1/2 right-0 z-30 py-4 px-2 bg-gray-900/70 hover:bg-gray-800/90 backdrop-blur-sm rounded-l-lg shadow-lg transition-colors logbook-toggle-button","aria-label":g("rally.logbookToggle"),title:g("rally.logbookToggle"),children:[e.jsx(Re,{className:"w-5 h-5"}),g("rally.logbookToggle")]}),C&&e.jsx(qe,{location:C,onClose:()=>T(null)}),e.jsx(Je,{isOpen:v,onClose:()=>{B(!1)},collections:M,geolocationsWithStamps:U,pendingPlacement:R,onPlace:de,onRemovePlacement:ee,onCancelPlacement:te,stampImageCache:H,onGoToLocation:O})]})};export{rt as default};
