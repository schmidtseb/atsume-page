const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StampRally-CM67XBjV.js","assets/react-vendor-ZaBYvqzn.js","assets/vendor-xCeh1xEN.js","assets/maplibre-gl-vendor-Csyg3Y42.js","assets/maplibre-gl-vendor-CuCRB34y.css","assets/InteractiveCanvasView-Drw-fWWh.js","assets/supabase-vendor-C5xB3bhr.js","assets/StampEditor-Dr5wZaQH.js","assets/JoinRallyScreen-BiZDetae.js","assets/RallyAdminDashboard-BMduJv4i.js"])))=>i.map(i=>d[i]);
var Le=Object.defineProperty;var Fe=(t,e,a)=>e in t?Le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var $=(t,e,a)=>Fe(t,typeof e!="symbol"?e+"":e,a);import{j as o,X as z,I as V,T as Oe,C as ne,r as h,S as B,L as $e,A as se,G as Be,a as Ue,b as Ge,M as Ve,U as qe,c as We,d as Ke,e as J,f as H,g as q,i as Je,k as re,l as le,m as He,n as Ye,P as Ze,o as Xe,p as Qe,q as et,s as Y,t as tt,u as at,v as ot,w as nt,R as C,x as st,y as rt,z as Z,B as lt,_ as U,D as it}from"./react-vendor-ZaBYvqzn.js";import{c as ct}from"./supabase-vendor-C5xB3bhr.js";import{i as dt,j as ut,k as mt}from"./vendor-xCeh1xEN.js";import{b as gt}from"./maplibre-gl-vendor-Csyg3Y42.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}})();const pt={success:o.jsx(ne,{className:"w-6 h-6 text-green-400"}),error:o.jsx(Oe,{className:"w-6 h-6 text-red-400"}),info:o.jsx(V,{className:"w-6 h-6 text-blue-400"})},ht=({id:t,message:e,type:a,onClose:n})=>o.jsxs("div",{role:"alert",className:"relative w-full max-w-sm mb-4 rounded-lg shadow-2xl bg-gray-800 border border-gray-700 p-4 flex items-start gap-3",children:[o.jsx("div",{className:"flex-shrink-0 mt-0.5",children:pt[a]}),o.jsx("div",{className:"flex-1 text-sm font-medium text-gray-200 break-words",children:e}),o.jsx("button",{onClick:()=>n(t),"aria-label":"Close",className:"p-1 -m-1 rounded-full text-gray-500 hover:bg-gray-700 hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 transition-colors",children:o.jsx(z,{className:"h-4 w-4"})})]}),ie=h.createContext(void 0),ft=({children:t})=>{const[e,a]=h.useState([]),n=h.useCallback(r=>{a(l=>l.filter(i=>i.id!==r))},[]),s=h.useCallback((r,l)=>{a(i=>{const c=i.findIndex(d=>d.message===r&&d.type===l);if(c>-1){const d=[...i],p=d[c];return d.splice(c,1),[...d,{...p,id:Date.now()+Math.random()}]}else return[...i,{id:Date.now()+Math.random(),message:r,type:l}]}),setTimeout(()=>{a(i=>i.filter(c=>!(c.message===r&&c.type===l)))},1500)},[]);return o.jsxs(ie.Provider,{value:{addToast:s},children:[t,o.jsx("div",{"aria-live":"assertive",className:"pointer-events-none fixed inset-0 flex items-start justify-end p-4 sm:p-6 z-50",children:o.jsx("div",{className:"w-full max-w-sm",children:e.map(r=>o.jsx("div",{className:"pointer-events-auto",children:o.jsx(ht,{...r,onClose:n})},r.id))})})]})},F=()=>{const t=h.useContext(ie);if(t===void 0)throw new Error("useToast must be used within a ToastProvider");return t},ce="https://ffwekbhvkurimzfihtwt.supabase.co",de="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZmd2VrYmh2a3VyaW16ZmlodHd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzMzY5MzcsImV4cCI6MjA2NzkxMjkzN30.MYqd-BVm8icPGQ0a67vaOe4bbamYa4hhahXGaVdWnEo",j=ct(ce,de);(ce.includes("YOUR_SUPABASE_URL")||de.includes("YOUR_SUPABASE_ANON_KEY"))&&console.warn("Supabase credentials are not set. Please update YOUR_SUPABASE_URL and YOUR_SUPABASE_ANON_KEY in src/lib/supabaseClient.ts");async function ue(t){const e={user_id:t.user_id,name:t.name,thumbnail:t.thumbnail,sourceImageURL:t.sourceImageURL,settings:t.settings},{data:a,error:n}=await j.from("stamps").insert([e]).select().single();if(n)throw console.error("Error adding stamp:",n),n;return a}async function X(){const{data:t,error:e}=await j.from("stamps").select("*").order("created_at",{ascending:!1});if(e)throw console.error("Error fetching stamps:",e),e;if(!t)return[];const a=[];for(const n of t)a.push({id:n.id,user_id:n.user_id,name:n.name,thumbnail:n.thumbnail,sourceImageURL:n.sourceImageURL,settings:n.settings});return a}async function bt(t){const{error:e}=await j.from("stamps").delete().eq("id",t);if(e)throw console.error("Error deleting stamp:",e),e}async function xt(t,e){const{error:a}=await j.from("stamps").update({name:e}).eq("id",t);if(a)throw console.error("Error updating stamp name:",a),a}async function jn(t){const{data:e,error:a}=await j.from("rallies").insert([t]).select().single();if(a)throw a;return e}async function kn(t){const{data:e,error:a}=await j.from("rallies").select("*").eq("admin_id",t).order("created_at",{ascending:!1});if(a)throw a;return e||[]}async function Nn(t,e){const{error:a}=await j.from("rallies").update(e).eq("id",t);if(a)throw a}async function En(t){const{error:e}=await j.from("rallies").delete().eq("id",t);if(e)throw e}async function Mn(t){const{data:e,error:a}=await j.from("rallies").select("*").eq("access_code",t).eq("published",!0).maybeSingle();if(a)throw a;return e}async function yt(t){const{data:e,error:a}=await j.from("user_rallies").select("*").eq("user_id",t);if(a)throw a;return e||[]}async function Cn(t){const{error:e}=await j.from("user_rallies").insert([t]);if(e)throw e}async function me(t){const{data:e,error:a}=await j.from("geolocations").insert([t]).select().single();if(a)throw console.error("Error adding geolocation:",a),a;return e}async function wt(t){const{data:e,error:a}=await j.from("geolocations").select("*").eq("rally_id",t).order("created_at",{ascending:!1});if(a)throw a;return e||[]}async function St(t,e){const{error:a}=await j.from("geolocations").update(e).eq("id",t);if(a)throw a}async function vt(t){const{error:e}=await j.from("geolocations").delete().eq("id",t);if(e)throw e}async function In(t){const{data:e,error:a}=await j.from("collections").select("*").eq("rally_id",t);if(a)throw a;return e||[]}async function Pn(t){const{data:e,error:a}=await j.from("collections").insert([t]).select().single();if(a)throw a;return e}async function zn(t,e){const{error:a}=await j.from("collections").update(e).eq("id",t);if(a)throw a}async function Rn(t){const{error:e}=await j.from("collections").delete().eq("id",t);if(e)throw e}const ge=h.createContext(void 0),Tt=({children:t})=>{const[e,a]=h.useState(null),[n,s]=h.useState(null),[r,l]=h.useState(null),[i,c]=h.useState(null),[d,p]=h.useState(!0),g=async f=>{var S;a(f);const x=(f==null?void 0:f.user)??null;if(s(x),x)try{const{data:w,error:v}=await j.from("profiles").select("role").eq("id",x.id).single();if(v&&v.code!=="PGRST116")throw v;const k=(w==null?void 0:w.role)||"user";if(l(k),k==="user"){const y=await yt(x.id);c(((S=y[0])==null?void 0:S.rally_id)||null)}else c(null)}catch{l(null),c(null)}else l(null),c(null)};h.useEffect(()=>{(async()=>{p(!0);try{const{data:{session:S}}=await j.auth.getSession();await g(S)}catch{}finally{p(!1)}const{data:{subscription:x}}=j.auth.onAuthStateChange(async(S,w)=>{await g(w)});return()=>{x.unsubscribe()}})()},[]);const b={session:e,user:n,role:r,activeRallyId:i,setActiveRallyId:c,signInWithGoogle:async()=>{await j.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/atsume-page/"}})},logout:async()=>{await j.auth.signOut()},loading:d};return o.jsx(ge.Provider,{value:b,children:t})},L=()=>{const t=h.useContext(ge);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},jt={save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",add:"Add",close:"Close",confirm:"Confirm",submit:"Submit",submitting:"Submitting...",loading:"Loading...",error:"Error",success:"Success",info:"Info",name:"Name",description:"Description",optional:"optional"},kt={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Sign In with Google",googleDescription:"Redirects to Google to sign in securely.",signInTitle:"Sign In",createAccountTitle:"Create Account",passwordPlaceholder:"Password",confirmPasswordPlaceholder:"Confirm Password",passwordMismatchError:"Passwords do not match.",signIn:"Sign In",signUp:"Sign Up",toggle:{toSignUp:"Don't have an account? Sign Up",toSignIn:"Already have an account? Sign In"},userMenu:"Open user menu",signedInAs:"Signed in as",logout:"Log Out"},Nt={title:"Disclaimer"},Et={authenticating:"Authenticating...",pleaseWait:"Please wait a moment."},Mt={title:"Atsume",subtitle:"スタンプ集め",tagline:"The interactive stamp pad.",description:"Turn any image into a work of art with a realistic stamp effect.",cta:"Get Started",version:"0.12.0",close:"Close splash screen",impressumTitle:"Imprint",impressumContent:`Responsible according to 5 TMG / 18 MStV: 
Sebastian Schmidt
Private person
Germany
E-Mail: schm.seb@gmail.com`},Ct={stamp:"Stamp Editor",map:"Map Editor",rally:"Stamp Rally",admin:"Admin"},It={title:"Stamp Parameters",close:"Close parameters panel",canvasControls:"Canvas Controls",changeImage:"Change Image",uploadImage:"Upload Image",addToGallery:"Add to Gallery",addToGalleryTooltip:"Saves the last stamp you made to the gallery",clear:"Clear",download:"Download",resetParameters:"Reset Parameters"},Pt={label:"Presets",savePresetLabel:"Save Current Settings as New Preset",newPresetNamePlaceholder:"New preset name",saveButton:"Save",managePresets:"Manage Presets",savePresetSuccess:'Preset "{{name}}" saved successfully!',savePresetError:"Failed to save preset.",deletePresetSuccess:'Preset "{{name}}" deleted successfully!',deletePresetError:"Failed to delete preset."},zt={posterization:{title:"Posterization & Shape",colors:"Colors",colorsTooltip:"The number of distinct color layers. 'Auto' detects prominent colors automatically.",auto:"Auto",backgroundThreshold:"Background Threshold",backgroundThresholdTooltip:"Pixels brighter than this value are treated as background and ignored.",shapeShrink:"Shape Shrink",shapeShrinkTooltip:"Shrinks each color layer to create gaps and a more distinct layered effect."},registration:{title:"Registration Errors",shift:"Shift",shiftAmountTooltip:"Average amount of horizontal/vertical misalignment between layers.",rotation:"Rotation",rotationAmountTooltip:"Average rotational misalignment between layers.",amount:"Amount",variation:"Variation",variationTooltip:"Randomness in the misalignment amount."},edge:{title:"Edge Effects",width:"Edge Width",widthTooltip:"The thickness of the border area around shapes that can be boosted.",boost:"Edge Boost",boostTooltip:"Increases ink density at the edges of shapes to simulate ink buildup."},wear:{title:"Wear & Tear",intensity:"Wear Intensity",noiseScale:"Noise Scale",inkDepletion:"Ink Depletion",inkDepletionAmountTooltip:"How faded the 'worn out' patches appear.",numPatches:"Num Patches",numPatchesAmountTooltip:"The number of 'worn out' patches.",patchSize:"Patch size",min:"Min",max:"Max"},splats:{title:"Ink Splats",density:"Splat Density",densityTooltip:"Controls the number of ink splats used to draw the image.",size:"Splat size",bleeding:"Bleeding Factor",bleedingTooltip:"Simulates ink bleeding into the paper just outside the stamp's edge."}},Rt={pressureToast:"Pressure sensitivity enabled!",stampingErrorToast:"An error occurred while stamping. See console for details.",canvasClearedToast:"Canvas cleared",downloadErrorToast:"Nothing to download.",loadedStampToast:'Loaded stamp "{{name}}".',newStampToast:"Ready to create a new stamp.",generatingToast:"Generating stamp...",panMode:"Pan Mode Active",galleryToggle:"Open Stamp Gallery",settingsToggle:"Open Parameters Panel",toolbarToggle:"Open Brush Controls",stampingArea:"Stamping area"},At={title:"Stamp Gallery",close:"Close gallery panel",createNew:"Create New Stamp",empty:"Your gallery is empty.",emptySubtext:"Create a stamp and add it from the parameters panel.",rename:"Rename {{name}}",confirmDelete:"Confirm delete {{name}}",cancelDelete:"Cancel delete"},Dt={title:"Stamp brush controls",hide:"Hide brush controls",size:"Size",sizeTooltip:"Controls the size of the stamp.",intensity:"Intensity",intensityTooltip:"Controls the ink density of the stamp.",pressureMessage:"Intensity is controlled by touch pressure."},_t={invalidFileToast:"Invalid file type. Please upload an image.",loadedToast:"Image loaded. Click on the paper to stamp!",loadUrlErrorToast:"Failed to load image from URL."},Lt={resetToast:"Settings have been reset to default.",loadedPresetToast:'Loaded settings for "{{name}}".'},Ft={loginToast:"Please log in to save stamps to your gallery.",loadErrorToast:"Could not load your stamp gallery.",addSuccessToast:'"{{name}}" added to your gallery.',addErrorToast:"Could not save stamp.",deleteSuccessToast:"Stamp deleted from gallery.",deleteErrorToast:"Could not delete stamp. Restoring...",renameSuccessToast:'Stamp renamed to "{{name}}".',renameErrorToast:'Could not rename stamp. Reverting to "{{oldName}}".'},Ot={loginToast:"Please log in to save locations.",loadErrorToast:"Could not load your map locations.",addSuccessToast:'Location "{{name}}" saved.',addErrorToast:"Could not save location.",updateSuccessToast:"Location updated.",updateErrorToast:"Could not update location.",deleteSuccessToast:"Location deleted.",deleteErrorToast:"Could not delete location."},$t={loginToast:"Please log in to collect stamps.",loadErrorToast:"Could not load your collection progress.",addSuccessToast:"Stamp collected! Place it in your log-book.",addErrorToast:"Could not save collection progress.",updateSuccessToast:"Stamp placed in log-book!",updateErrorToast:"Could not save stamp placement.",placementCancelledToast:"Placement was cancelled. Please collect the stamp again.",removePlacementSuccessToast:"Last placement undone. You can place the stamp again.",removePlacementErrorToast:"Could not undo placement."},Bt={addLocation:"Add Location",placeOnMap:"Place on Map",byCoordinates:"By Coordinates",fromOSM:"From OpenStreetMap",batchUpload:"Batch Upload",addLocationToast:"Click on the map to place a new location.",centeredToast:"Map centered on your location.",deleteConfirm:"Are you sure you want to delete this location?",viewLocation:"View {{name}}",noRallySelectedTitle:"No Rally Selected",noRallySelectedSubtitle:"Please select a rally from the Admin Dashboard to edit its map.",iOSLocationPrompt:"Tap the location button to center on your position",locationError:{denied:"Location access was denied. Please enable it in your browser settings to see your location on the map.",unavailable:"Your location is currently unavailable. Please check your signal and try again.",timeout:"Failed to get your location in time. Please try again.",unknown:"An unknown error occurred while trying to get your location."}},Ut={title:"Batch Upload Locations",dragDrop:"Drag & drop your JSON file here",orClick:"or click to select file",selectedFile:"Selected file",noFileSelected:"No file selected.",invalidFileType:"Invalid file type. Please upload a JSON file.",uploadButton:"Upload",readingFile:"Reading file...",processingItems:"Processing items...",uploadComplete:"Upload complete!",partialSuccess:"{{success}} of {{total}} items uploaded with some errors.",success:"Successfully uploaded {{count}} items.",invalidJson:"Invalid JSON format",uploadFailed:"Upload failed",loginRequired:"Please log in to batch upload locations."},Gt={title:"Enter Coordinates",latitude:"Latitude",longitude:"Longitude",latitudePlaceholder:"e.g., 51.5074",longitudePlaceholder:"e.g., -0.1278",validation:{latRequired:"Latitude is required.",lonRequired:"Longitude is required.",latInvalid:"Latitude must be between -90 and 90.",lonInvalid:"Longitude must be between -180 and 180."},next:"Next"},Vt={title:"Import from OpenStreetMap",idLabel:"OpenStreetMap ID",idPlaceholder:"e.g., 236578444 or R146656",helpText:"Enter an ID from OSM. For nodes, you can enter just the number (e.g., `236578444`). For ways/relations, include the prefix (e.g., `R146656`).",import:"Import",importing:"Importing...",error:{invalidId:"Invalid ID. Must be a number, or start with N, W, or R followed by numbers.",notFound:"Location not found for this ID. Please check the ID and try again.",network:"Could not connect to the OpenStreetMap API. Please check your internet connection."}},qt={titleAdd:"Add New Location",titleEdit:"Edit Location",namePlaceholder:"Location Name",validationError:"Please enter a name for the location.",radius:"Collection Radius",radiusTooltip:"The distance within which this stamp can be 'collected'.",assignStamp:"Assign a Stamp",noStamp:"No Stamp",loadingStamps:"Loading stamps..."},Wt={collected:"Collected",locationStatus:"Status for {{name}}",progress:"{{collectedCount}} / {{totalCount}} Collected",logbookToggle:"Open Log-book",flyingToast:"Flying to {{name}}...",nearbyStamp:"There is a stamp nearby!",iOSLocationPrompt:"Tap the location button to center on your position",selectRallyToTestTitle:"Select a Rally to Test",selectRallyToTestSubtitle:"Please go to the Admin Dashboard to choose a rally to test.",locationError:{denied:"Location access was denied. The Stamp Rally requires location to work. Please enable it in your browser settings.",unavailable:"Your location is currently unavailable. Please check your signal and try again.",timeout:"Failed to get your location in time. Please try again.",unknown:"An unknown error occurred while trying to get your location."}},Kt={close:"Close Log-book",preparingStamp:"Preparing stamp...",pendingPlacement:"Place your newly collected stamp:",pendingPlacementSubtext:"Click to place, or click and drag to rotate.",panMode:"Pan Mode Active",clickToView:"Click to view details",stampingArea:"Log-book Stamping Area",prepareErrorToast:"Could not prepare stamp image.",placeErrorToast:"Failed to place stamp",placedToast:'Placed "{{name}}"',redo:"Redo"},Jt={collected:"Stamp Collected!",noImage:"No Stamp Image"},Ht={stampDesign:"Stamp Design",location:"Location",dateCollected:"Date Collected",goToLocation:"Go to {{name}} on the map"},Yt={title:"Locations",toggle:"Toggle Location List",empty:"No locations created yet.",emptySubtext:"Click the '+' button to add your first location.",selectLocation:"View {{name}} on map"},Zt={title:"Rally Dashboard",subtitle:"Create and manage your Stamp Rallies.",createButton:"Create New Rally",creating:"Creating...",newRallyName:"New Rally #{{count}}",loadError:"Failed to load rallies.",createSuccess:"New rally created.",createError:"Failed to create rally.",updateSuccess:"Rally updated successfully.",updateError:"Failed to update rally.",deleteConfirm:"Are you sure you want to delete this rally and all its locations? This cannot be undone.",deleteSuccess:"Rally deleted.",deleteError:"Failed to delete rally.",noDescription:"No description provided.",accessCode:"Access Code",status:"Status",published:"Published",draft:"Draft",manageRally:"Manage",backToDashboard:"Back to Dashboard",editing:"Editing",selectRallyPromptTitle:"Select a Rally",selectRallyPromptSubtitle:"Choose a rally from the dashboard to edit its map or test it."},Xt={title:"Join a Rally",subtitle:"Enter an access code to get started.",placeholder:"ABCDEF",findButton:"Find Rally",joinButton:"Join Rally",joinSuccess:'Successfully joined "{{name}}"!',error:{notFound:"No published rally found with that code.",network:"Could not connect to the server. Please try again.",joinFailed:"Failed to join the rally.",alreadyJoined:"You have already joined this rally."}},Qt={duration:"Duration",infinite:"Infinite"},ea={common:jt,auth:kt,disclaimer:Nt,loadingScreen:Et,splashScreen:Mt,modeToggle:Ct,rightSidebar:It,presetSelector:Pt,settingsSections:zt,stampEditor:Rt,stampGallery:At,stampToolbar:Dt,imageLoader:_t,stampSettings:Lt,gallery:Ft,geolocations:Ot,collections:$t,mapEditor:Bt,batchUpload:Ut,coordInputModal:Gt,osmImportModal:Vt,locationEditModal:qt,rally:Wt,logbook:Kt,stampDetailModal:Jt,collectionDetailModal:Ht,locationList:Yt,rallyAdmin:Zt,joinRally:Xt,rallyJoinCard:Qt},ta={save:"保存",cancel:"キャンセル",delete:"削除",edit:"編集",add:"追加",close:"閉じる",confirm:"確認",submit:"送信",submitting:"送信中...",loading:"読み込み中...",error:"エラー",success:"成功",info:"情報",name:"名前",description:"説明",optional:"任意"},aa={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Googleでサインイン",googleDescription:"Googleにリダイレクトして安全にサインインします。",signInTitle:"サインイン",createAccountTitle:"アカウント作成",passwordPlaceholder:"パスワード",confirmPasswordPlaceholder:"パスワード（確認）",passwordMismatchError:"パスワードが一致しません。",signIn:"サインイン",signUp:"サインアップ",toggle:{toSignUp:"アカウントをお持ちでないですか？ サインアップ",toSignIn:"すでにアカウントをお持ちですか？ サインイン"},userMenu:"ユーザーメニューを開く",signedInAs:"サインイン中:",logout:"ログアウト"},oa={title:"免責事項"},na={authenticating:"認証中...",pleaseWait:"しばらくお待ちください。"},sa={title:"Atsume",subtitle:"スタンプ集め",tagline:"インタラクティブ・スタンプパッド",description:"どんな画像もリアルなスタンプ効果でアート作品に変身させます。",cta:"はじめる",version:"バージョン {{version}}",close:"スプラッシュスクリーンを閉じる",impressumTitle:"インプリント",impressumContent:`責任者（§ 5 TMG / § 18 MStVによる）：
Sebastian Schmidt
個人事業主
ドイツ
Eメール：schm.seb@gmail.com`},ra={stamp:"スタンプエディター",map:"マップエディター",rally:"スタンプラリー",admin:"管理"},la={title:"スタンプ設定",close:"設定パネルを閉じる",canvasControls:"キャンバス操作",changeImage:"画像を変更",uploadImage:"画像をアップロード",addToGallery:"ギャラリーに追加",addToGalleryTooltip:"最後に作成したスタンプをギャラリーに保存します",clear:"クリア",download:"ダウンロード",resetParameters:"設定をリセット"},ia={label:"プリセット",savePresetLabel:"現在の設定を新しいプリセットとして保存",newPresetNamePlaceholder:"新しいプリセット名",saveButton:"保存",managePresets:"プリセットを管理",savePresetSuccess:"プリセット「{{name}}」が正常に保存されました！",savePresetError:"プリセットの保存に失敗しました。",deletePresetSuccess:"プリセット「{{name}}」が正常に削除されました！",deletePresetError:"プリセットの削除に失敗しました。"},ca={posterization:{title:"ポスタリゼーションと形状",colors:"色数",colorsTooltip:"個別のカラーレイヤーの数。「自動」は主要な色を自動的に検出します。",auto:"自動",backgroundThreshold:"背景のしきい値",backgroundThresholdTooltip:"この値より明るいピクセルは背景として無視されます。",shapeShrink:"形状の縮小",shapeShrinkTooltip:"各カラーレイヤーを縮小して隙間を作り、より明確なレイヤー効果を生み出します。"},registration:{title:"版ズレ",shift:"ずれ",shiftAmountTooltip:"レイヤー間の水平/垂直方向のずれの平均量。",rotation:"回転",rotationAmountTooltip:"レイヤー間の回転のずれの平均量。",amount:"量",variation:"ばらつき",variationTooltip:"ずれの量のランダム性。"},edge:{title:"エッジ効果",width:"エッジの幅",widthTooltip:"形状の境界線の太さ。この範囲が強調されます。",boost:"エッジの強調",boostTooltip:"形状の端のインク濃度を上げて、インクの溜まりをシミュレートします。"},wear:{title:"かすれ",intensity:"かすれの強さ",noiseScale:"ノイズのスケール",inkDepletion:"インクの枯渇",inkDepletionAmountTooltip:"「使い古された」パッチがどれだけ色褪せて見えるか。",numPatches:"パッチの数",numPatchesAmountTooltip:"「使い古された」パッチの数。",patchSize:"パッチのサイズ",min:"最小",max:"最大"},splats:{title:"インクの飛び散り",density:"インクの密度",densityTooltip:"画像の描画に使用されるインクの点の数を制御します。",size:"インクのサイズ",bleeding:"にじみ",bleedingTooltip:"スタンプの端の外側でインクが紙ににじむのをシミュレートします。"}},da={pressureToast:"筆圧感知が有効になりました！",stampingErrorToast:"スタンプ作成中にエラーが発生しました。詳細はコンソールを確認してください。",canvasClearedToast:"キャンバスをクリアしました",downloadErrorToast:"ダウンロードするものがありません。",loadedStampToast:"スタンプ「{{name}}」を読み込みました。",newStampToast:"新しいスタンプを作成する準備ができました。",generatingToast:"スタンプを生成中...",panMode:"パンモード有効",galleryToggle:"スタンプギャラリーを開く",settingsToggle:"設定パネルを開く",toolbarToggle:"ブラシコントロールを開く",stampingArea:"スタンプエリア"},ua={title:"スタンプギャラリー",close:"ギャラリーパネルを閉じる",createNew:"新しいスタンプを作成",empty:"ギャラリーは空です。",emptySubtext:"スタンプを作成し、設定パネルから追加してください。",rename:"{{name}}の名前を変更",confirmDelete:"{{name}}の削除を確認",cancelDelete:"削除をキャンセル"},ma={title:"スタンプブラシコントロール",hide:"ブラシコントロールを隠す",size:"サイズ",sizeTooltip:"スタンプのサイズを制御します。",intensity:"インク濃度",intensityTooltip:"スタンプのインク濃度を制御します。",pressureMessage:"インク濃度は筆圧で制御されます。"},ga={invalidFileToast:"無効なファイルタイプです。画像をアップロードしてください。",loadedToast:"画像を読み込みました。紙の上をクリックしてスタンプしてください！",loadUrlErrorToast:"URLからの画像の読み込みに失敗しました。"},pa={resetToast:"設定をデフォルトにリセットしました。",loadedPresetToast:"「{{name}}」の設定を読み込みました。"},ha={loginToast:"ギャラリーにスタンプを保存するにはログインしてください。",loadErrorToast:"スタンプギャラリーの読み込みに失敗しました。",addSuccessToast:"「{{name}}」をギャラリーに追加しました。",addErrorToast:"スタンプを保存できませんでした。",deleteSuccessToast:"ギャラリーからスタンプを削除しました。",deleteErrorToast:"スタンプを削除できませんでした。元に戻しています...",renameSuccessToast:"スタンプ名を「{{name}}」に変更しました。",renameErrorToast:"スタンプ名を変更できませんでした。「{{oldName}}」に戻しています。"},fa={loginToast:"場所を保存するにはログインしてください。",loadErrorToast:"マップの場所の読み込みに失敗しました。",addSuccessToast:"場所「{{name}}」を保存しました。",addErrorToast:"場所を保存できませんでした。",updateSuccessToast:"場所を更新しました。",updateErrorToast:"場所を更新できませんでした。",deleteSuccessToast:"場所を削除しました。",deleteErrorToast:"場所を削除できませんでした。"},ba={loginToast:"スタンプを収集するにはログインしてください。",loadErrorToast:"収集の進捗の読み込みに失敗しました。",addSuccessToast:"スタンプを収集しました！ログブックに配置してください。",addErrorToast:"収集の進捗を保存できませんでした。",updateSuccessToast:"スタンプをログブックに配置しました！",updateErrorToast:"スタンプの配置を保存できませんでした。",placementCancelledToast:"配置がキャンセルされました。スタンプを再度収集してください。",removePlacementSuccessToast:"最後の配置を取り消しました。スタンプを再度配置できます。",removePlacementErrorToast:"配置の取り消しに失敗しました。"},xa={addLocation:"場所を追加",placeOnMap:"地図上で配置",byCoordinates:"座標で入力",fromOSM:"OpenStreetMapから",batchUpload:"一括アップロード",addLocationToast:"マップをクリックして新しい場所を配置してください。",centeredToast:"あなたの位置にマップを中央揃えしました。",deleteConfirm:"この場所を本当に削除しますか？",viewLocation:"{{name}}を表示",noRallySelectedTitle:"ラリーが選択されていません",noRallySelectedSubtitle:"管理ダッシュボードからラリーを選択して、その地図を編集してください。",iOSLocationPrompt:"位置情報ボタンをタップして現在地に中央揃えしてください",locationError:{denied:"位置情報へのアクセスが拒否されました。マップ上であなたの位置を表示するには、ブラウザの設定で有効にしてください。",unavailable:"現在、あなたの位置は利用できません。電波状況を確認して再試行してください。",timeout:"時間内にあなたの位置を取得できませんでした。再試行してください。",unknown:"位置情報の取得中に不明なエラーが発生しました。"}},ya={title:"場所の一括アップロード",dragDrop:"JSONファイルをここにドラッグ＆ドロップ",orClick:"またはクリックしてファイルを選択",selectedFile:"選択されたファイル",noFileSelected:"ファイルが選択されていません。",invalidFileType:"無効なファイルタイプです。JSONファイルをアップロードしてください。",uploadButton:"アップロード",readingFile:"ファイルを読み込み中...",processingItems:"アイテムを処理中...",uploadComplete:"アップロード完了！",partialSuccess:"{{total}}件中{{success}}件のアイテムがエラーありでアップロードされました。",success:"{{count}}件のアイテムが正常にアップロードされました。",invalidJson:"無効なJSON形式",uploadFailed:"アップロードに失敗しました",loginRequired:"場所を一括アップロードするにはログインしてください。"},wa={title:"座標を入力",latitude:"緯度",longitude:"経度",latitudePlaceholder:"例: 35.6895",longitudePlaceholder:"例: 139.6917",validation:{latRequired:"緯度は必須です。",lonRequired:"経度は必須です。",latInvalid:"緯度は-90から90の間でなければなりません。",lonInvalid:"経度は-180から180の間でなければなりません。"},next:"次へ"},Sa={title:"OpenStreetMapからインポート",idLabel:"OpenStreetMap ID",idPlaceholder:"例: 236578444 または R146656",helpText:"OSMのIDを入力します。ノードの場合は数字のみ入力できます (例: `236578444`)。ウェイ/リレーションの場合は接頭辞を含めてください (例: `R146656`)。",import:"インポート",importing:"インポート中...",error:{invalidId:"無効なIDです。数字、またはN、W、Rで始まり数字が続く形式で入力してください。",notFound:"このIDの場所が見つかりませんでした。IDを確認して再試行してください。",network:"OpenStreetMap APIに接続できませんでした。インターネット接続を確認してください。"}},va={titleAdd:"新しい場所を追加",titleEdit:"場所を編集",namePlaceholder:"場所の名前",validationError:"場所の名前を入力してください。",radius:"収集半径",radiusTooltip:"このスタンプを「収集」できる距離。",assignStamp:"スタンプを割り当て",noStamp:"スタンプなし",loadingStamps:"スタンプを読み込み中..."},Ta={collected:"収集済み",locationStatus:"{{name}}のステータス",progress:"収集済み {{collectedCount}} / {{totalCount}}",logbookToggle:"ログブックを開く",flyingToast:"{{name}}へ移動中...",nearbyStamp:"近くにスタンプがあります！",iOSLocationPrompt:"位置情報ボタンをタップして現在地に中央揃えしてください",selectRallyToTestTitle:"テストするラリーを選択",selectRallyToTestSubtitle:"管理ダッシュボードからテストしたいラリーを選択してください。",locationError:{denied:"位置情報へのアクセスが拒否されました。スタンプラリーは位置情報が必要です。ブラウザの設定で有効にしてください。",unavailable:"現在、あなたの位置は利用できません。電波状況を確認して再試行してください。",timeout:"時間内にあなたの位置を取得できませんでした。再試行してください。",unknown:"位置情報の取得中に不明なエラーが発生しました。"}},ja={close:"ログブックを閉じる",preparingStamp:"スタンプを準備中...",pendingPlacement:"新しく収集したスタンプを配置してください：",pendingPlacementSubtext:"クリックで配置、クリック＆ドラッグで回転します。",panMode:"パンモード有効",clickToView:"クリックして詳細を表示",stampingArea:"ログブックのスタンプエリア",prepareErrorToast:"スタンプ画像を準備できませんでした。",placeErrorToast:"スタンプを配置できませんでした。",placedToast:"「{{name}}」を配置しました",redo:"やり直し"},ka={collected:"スタンプ収集済み！",noImage:"スタンプ画像なし"},Na={stampDesign:"スタンプデザイン",location:"場所",dateCollected:"収集日",goToLocation:"マップで{{name}}に移動"},Ea={title:"場所リスト",toggle:"場所リストの表示/非表示",empty:"まだ場所が作成されていません。",emptySubtext:"「+」ボタンをクリックして最初の場所を追加してください。",selectLocation:"マップで「{{name}}」を表示"},Ma={title:"ラリー管理ダッシュボード",subtitle:"スタンプラリーを作成・管理します。",createButton:"新しいラリーを作成",creating:"作成中...",newRallyName:"新しいラリー #{{count}}",loadError:"ラリーの読み込みに失敗しました。",createSuccess:"新しいラリーが作成されました。",createError:"ラリーの作成に失敗しました。",updateSuccess:"ラリーを正常に更新しました。",updateError:"ラリーの更新に失敗しました。",deleteConfirm:"このラリーとそのすべての場所を本当に削除しますか？この操作は元に戻せません。",deleteSuccess:"ラリーを削除しました。",deleteError:"ラリーの削除に失敗しました。",noDescription:"説明がありません。",accessCode:"参加コード",status:"ステータス",published:"公開中",draft:"下書き",manageRally:"管理",backToDashboard:"ダッシュボードに戻る",editing:"編集中",selectRallyPromptTitle:"ラリーを選択",selectRallyPromptSubtitle:"ダッシュボードからラリーを選択して、地図を編集したりテストしたりします。"},Ca={title:"ラリーに参加",subtitle:"参加コードを入力して始めましょう。",placeholder:"ABCDEF",findButton:"ラリーを探す",joinButton:"ラリーに参加",joinSuccess:"「{{name}}」に無事参加しました！",error:{notFound:"そのコードの公開ラリーが見つかりませんでした。",network:"サーバーに接続できませんでした。もう一度お試しください。",joinFailed:"ラリーへの参加に失敗しました。",alreadyJoined:"すでにこのラリーに参加しています。"}},Ia={duration:"開催期間",infinite:"無期限"},Pa={common:ta,auth:aa,disclaimer:oa,loadingScreen:na,splashScreen:sa,modeToggle:ra,rightSidebar:la,presetSelector:ia,settingsSections:ca,stampEditor:da,stampGallery:ua,stampToolbar:ma,imageLoader:ga,stampSettings:pa,gallery:ha,geolocations:fa,collections:ba,mapEditor:xa,batchUpload:ya,coordInputModal:wa,osmImportModal:Sa,locationEditModal:va,rally:Ta,logbook:ja,stampDetailModal:ka,collectionDetailModal:Na,locationList:Ea,rallyAdmin:Ma,joinRally:Ca,rallyJoinCard:Ia},za={save:"Speichern",cancel:"Abbrechen",delete:"Löschen",edit:"Bearbeiten",add:"Hinzufügen",close:"Schließen",confirm:"Bestätigen",submit:"Senden",submitting:"Wird gesendet...",loading:"Lädt...",error:"Fehler",success:"Erfolg",info:"Info",name:"Name",description:"Beschreibung",optional:"optional"},Ra={title:"Atsume",subtitle:"スタンプ集め",googleTab:"Google",signInWithGoogle:"Mit Google anmelden",googleDescription:"Leitet zu Google weiter, um sich sicher anzumelden.",signInTitle:"Anmelden",createAccountTitle:"Konto erstellen",passwordPlaceholder:"Passwort",confirmPasswordPlaceholder:"Passwort bestätigen",passwordMismatchError:"Passwörter stimmen nicht überein.",signIn:"Anmelden",signUp:"Registrieren",toggle:{toSignUp:"Noch kein Konto? Registrieren",toSignIn:"Bereits ein Konto? Anmelden"},userMenu:"Benutzermenü öffnen",signedInAs:"Angemeldet als",logout:"Abmelden"},Aa={title:"Haftungsausschluss"},Da={authenticating:"Authentifiziere...",pleaseWait:"Bitte warten Sie einen Moment."},_a={title:"Atsume",subtitle:"スタンプ集め",tagline:"Das interaktive Stempelkissen.",description:"Verwandeln Sie jedes Bild in ein Kunstwerk mit einem realistischen Stempel-Effekt.",cta:"Los geht's",version:"0.12.0",close:"Splash-Screen schließen",impressumTitle:"Impressum",impressumContent:`Verantwortlich gemäß § 5 TMG / § 18 MStV: 
Sebastian Schmidt
Privatperson
Deutschland
E-Mail: schm.seb@gmail.com`},La={stamp:"Stempel-Editor",map:"Karten-Editor",rally:"Stempel-Rallye",admin:"Admin"},Fa={title:"Stempel-Parameter",close:"Parameter-Panel schließen",canvasControls:"Leinwand-Steuerung",changeImage:"Bild ändern",uploadImage:"Bild hochladen",addToGallery:"Zur Galerie hinzufügen",addToGalleryTooltip:"Speichert den zuletzt erstellten Stempel in der Galerie",clear:"Löschen",download:"Herunterladen",resetParameters:"Parameter zurücksetzen"},Oa={label:"Voreinstellungen",savePresetLabel:"Aktuelle Einstellungen als neue Voreinstellung speichern",newPresetNamePlaceholder:"Name der neuen Voreinstellung",saveButton:"Speichern",managePresets:"Voreinstellungen verwalten",savePresetSuccess:'Voreinstellung "{{name}}" erfolgreich gespeichert!',savePresetError:"Fehler beim Speichern der Voreinstellung.",deletePresetSuccess:'Voreinstellung "{{name}}" erfolgreich gelöscht!',deletePresetError:"Fehler beim Löschen der Voreinstellung."},$a={posterization:{title:"Posterisierung & Form",colors:"Farben",colorsTooltip:"Die Anzahl der verschiedenen Farbschichten. 'Auto' erkennt prominente Farben automatisch.",auto:"Auto",backgroundThreshold:"Hintergrund-Schwellenwert",backgroundThresholdTooltip:"Pixel, die heller als dieser Wert sind, werden als Hintergrund behandelt und ignoriert.",shapeShrink:"Form verkleinern",shapeShrinkTooltip:"Verkleinert jede Farbschicht, um Lücken und einen deutlicheren Schichteffekt zu erzeugen."},registration:{title:"Registrierungsfehler",shift:"Verschiebung",shiftAmountTooltip:"Durchschnittliche horizontale/vertikale Fehlausrichtung zwischen den Schichten.",rotation:"Rotation",rotationAmountTooltip:"Durchschnittliche rotatorische Fehlausrichtung zwischen den Schichten.",amount:"Betrag",variation:"Variation",variationTooltip:"Zufälligkeit im Fehlausrichtungsbetrag."},edge:{title:"Randeffekte",width:"Randbreite",widthTooltip:"Die Dicke des Randbereichs um Formen, der verstärkt werden kann.",boost:"Randverstärkung",boostTooltip:"Erhöht die Farbdichte an den Rändern von Formen, um Tintenansammlungen zu simulieren."},wear:{title:"Abnutzung",intensity:"Abnutzungsintensität",noiseScale:"Rauschskala",inkDepletion:"Tintenverlust",inkDepletionAmountTooltip:"Wie verblasst die 'abgenutzten' Stellen erscheinen.",numPatches:"Anzahl der Flecken",numPatchesAmountTooltip:"Die Anzahl der 'abgenutzten' Flecken.",patchSize:"Fleckengröße",min:"Min",max:"Max"},splats:{title:"Tintenspritzer",density:"Spritzerdichte",densityTooltip:"Steuert die Anzahl der Tintenkleckse, die zum Zeichnen des Bildes verwendet werden.",size:"Spritzergröße",bleeding:"Ausblutungsfaktor",bleedingTooltip:"Simuliert das Ausbluten von Tinte in das Papier direkt außerhalb des Stempelrandes."}},Ba={pressureToast:"Druckempfindlichkeit aktiviert!",stampingErrorToast:"Beim Stempeln ist ein Fehler aufgetreten. Details in der Konsole.",canvasClearedToast:"Leinwand geleert",downloadErrorToast:"Nichts zum Herunterladen.",loadedStampToast:'Stempel "{{name}}" geladen.',newStampToast:"Bereit, einen neuen Stempel zu erstellen.",generatingToast:"Stempel wird generiert...",panMode:"Schwenkmodus aktiv",galleryToggle:"Stempelgalerie öffnen",settingsToggle:"Parameter-Panel öffnen",toolbarToggle:"Pinsel-Steuerung öffnen",stampingArea:"Stempelbereich"},Ua={title:"Stempelgalerie",close:"Galerie-Panel schließen",createNew:"Neuen Stempel erstellen",empty:"Deine Galerie ist leer.",emptySubtext:"Erstelle einen Stempel und füge ihn über das Parameter-Panel hinzu.",rename:"{{name}} umbenennen",confirmDelete:"{{name}} wirklich löschen?",cancelDelete:"Löschen abbrechen"},Ga={title:"Stempel-Pinsel-Steuerung",hide:"Pinsel-Steuerung ausblenden",size:"Größe",sizeTooltip:"Steuert die Größe des Stempels.",intensity:"Intensität",intensityTooltip:"Steuert die Farbdichte des Stempels.",pressureMessage:"Intensität wird durch den Druck gesteuert."},Va={invalidFileToast:"Ungültiger Dateityp. Bitte lade ein Bild hoch.",loadedToast:"Bild geladen. Klicke auf das Papier, um zu stempeln!",loadUrlErrorToast:"Fehler beim Laden des Bildes von der URL."},qa={resetToast:"Einstellungen wurden auf Standard zurückgesetzt.",loadedPresetToast:'Einstellungen für "{{name}}" geladen.'},Wa={loginToast:"Bitte melde dich an, um Stempel in deiner Galerie zu speichern.",loadErrorToast:"Deine Stempelgalerie konnte nicht geladen werden.",addSuccessToast:'"{{name}}" wurde deiner Galerie hinzugefügt.',addErrorToast:"Stempel konnte nicht gespeichert werden.",deleteSuccessToast:"Stempel aus Galerie gelöscht.",deleteErrorToast:"Stempel konnte nicht gelöscht werden. Wiederherstellung...",renameSuccessToast:'Stempel umbenannt zu "{{name}}".',renameErrorToast:'Stempel konnte nicht umbenannt werden. Zurücksetzen auf "{{oldName}}".'},Ka={loginToast:"Bitte melde dich an, um Orte zu speichern.",loadErrorToast:"Deine Kartenorte konnten nicht geladen werden.",addSuccessToast:'Ort "{{name}}" gespeichert.',addErrorToast:"Ort konnte nicht gespeichert werden.",updateSuccessToast:"Ort aktualisiert.",updateErrorToast:"Ort konnte nicht aktualisiert werden.",deleteSuccessToast:"Ort gelöscht.",deleteErrorToast:"Ort konnte nicht gelöscht werden."},Ja={loginToast:"Bitte melde dich an, um Stempel zu sammeln.",loadErrorToast:"Dein Sammlungsfortschritt konnte nicht geladen werden.",addSuccessToast:"Stempel gesammelt! Platziere ihn in deinem Logbuch.",addErrorToast:"Sammlungsfortschritt konnte nicht gespeichert werden.",updateSuccessToast:"Stempel im Logbuch platziert!",updateErrorToast:"Stempelplatzierung konnte nicht gespeichert werden.",placementCancelledToast:"Platzierung wurde abgebrochen. Bitte sammle den Stempel erneut.",removePlacementSuccessToast:"Letzte Platzierung rückgängig gemacht. Du kannst den Stempel erneut platzieren.",removePlacementErrorToast:"Platzierung konnte nicht rückgängig gemacht werden."},Ha={addLocation:"Ort hinzufügen",placeOnMap:"Auf Karte platzieren",byCoordinates:"Nach Koordinaten",fromOSM:"Von OpenStreetMap",batchUpload:"Massen-Upload",addLocationToast:"Klicke auf die Karte, um einen neuen Ort zu platzieren.",centeredToast:"Karte auf deinen Standort zentriert.",deleteConfirm:"Möchtest du diesen Ort wirklich löschen?",viewLocation:"{{name}} ansehen",noRallySelectedTitle:"Keine Rallye ausgewählt",noRallySelectedSubtitle:"Bitte wähle eine Rallye aus dem Admin-Dashboard, um deren Karte zu bearbeiten.",iOSLocationPrompt:"Tippe auf den Standort-Button, um dich auf deiner Position zu zentrieren",locationError:{denied:"Standortzugriff wurde verweigert. Bitte aktiviere ihn in deinen Browser-Einstellungen, um deinen Standort auf der Karte zu sehen.",unavailable:"Dein Standort ist derzeit nicht verfügbar. Bitte überprüfe dein Signal und versuche es erneut.",timeout:"Dein Standort konnte nicht rechtzeitig ermittelt werden. Bitte versuche es erneut.",unknown:"Ein unbekannter Fehler ist beim Versuch, deinen Standort zu ermitteln, aufgetreten."}},Ya={title:"Orte im Stapel hochladen",dragDrop:"JSON-Datei hierher ziehen & ablegen",orClick:"oder klicken, um Datei auszuwählen",selectedFile:"Ausgewählte Datei",noFileSelected:"Keine Datei ausgewählt.",invalidFileType:"Ungültiger Dateityp. Bitte lade eine JSON-Datei hoch.",uploadButton:"Hochladen",readingFile:"Datei wird gelesen...",processingItems:"Elemente werden verarbeitet...",uploadComplete:"Upload abgeschlossen!",partialSuccess:"{{success}} von {{total}} Elementen mit Fehlern hochgeladen.",success:"Erfolgreich {{count}} Elemente hochgeladen.",invalidJson:"Ungültiges JSON-Format",uploadFailed:"Upload fehlgeschlagen",loginRequired:"Bitte melde dich an, um Orte im Stapel hochzuladen."},Za={title:"Koordinaten eingeben",latitude:"Breitengrad",longitude:"Längengrad",latitudePlaceholder:"z.B. 51.5074",longitudePlaceholder:"z.B. -0.1278",validation:{latRequired:"Breitengrad ist erforderlich.",lonRequired:"Längengrad ist erforderlich.",latInvalid:"Breitengrad muss zwischen -90 und 90 liegen.",lonInvalid:"Längengrad muss zwischen -180 und 180 liegen."},next:"Weiter"},Xa={title:"Aus OpenStreetMap importieren",idLabel:"OpenStreetMap ID",idPlaceholder:"z.B. 236578444 oder R146656",helpText:"Geben Sie eine ID von OSM ein. Für Knoten können Sie nur die Nummer eingeben (z.B. `236578444`). Für Wege/Relationen fügen Sie das Präfix hinzu (z.B. `R146656`).",import:"Importieren",importing:"Importiere...",error:{invalidId:"Ungültige ID. Muss eine Zahl sein oder mit N, W oder R gefolgt von Zahlen beginnen.",notFound:"Ort für diese ID nicht gefunden. Bitte überprüfen Sie die ID und versuchen Sie es erneut.",network:"Verbindung zur OpenStreetMap API konnte nicht hergestellt werden. Bitte überprüfen Sie Ihre Internetverbindung."}},Qa={titleAdd:"Neuen Ort hinzufügen",titleEdit:"Ort bearbeiten",namePlaceholder:"Ortsname",validationError:"Bitte geben Sie einen Namen für den Ort ein.",radius:"Sammelradius",radiusTooltip:"Die Entfernung, innerhalb der dieser Stempel 'gesammelt' werden kann.",assignStamp:"Stempel zuweisen",noStamp:"Kein Stempel",loadingStamps:"Stempel werden geladen..."},eo={collected:"Gesammelt",locationStatus:"Status für {{name}}",progress:"{{collectedCount}} / {{totalCount}} Gesammelt",logbookToggle:"Logbuch öffnen",flyingToast:"Fliege zu {{name}}...",nearbyStamp:"Ein Stempel ist in der Nähe!",iOSLocationPrompt:"Tippe auf den Standort-Button, um dich auf deiner Position zu zentrieren",selectRallyToTestTitle:"Wähle eine Rallye zum Testen",selectRallyToTestSubtitle:"Bitte gehe zum Admin-Dashboard, um eine Rallye zum Testen auszuwählen.",locationError:{denied:"Standortzugriff wurde verweigert. Die Stempel-Rallye benötigt den Standort, um zu funktionieren. Bitte aktiviere ihn in deinen Browser-Einstellungen.",unavailable:"Dein Standort ist derzeit nicht verfügbar. Bitte überprüfe dein Signal und versuche es erneut.",timeout:"Dein Standort konnte nicht rechtzeitig ermittelt werden. Bitte versuche es erneut.",unknown:"Ein unbekannter Fehler ist beim Versuch, deinen Standort zu ermitteln, aufgetreten."}},to={close:"Logbuch schließen",preparingStamp:"Stempel wird vorbereitet...",pendingPlacement:"Platziere deinen neu gesammelten Stempel:",pendingPlacementSubtext:"Klicken zum Platzieren, oder klicken und ziehen zum Drehen.",panMode:"Schwenkmodus aktiv",clickToView:"Klicken zum Anzeigen der Details",stampingArea:"Logbuch-Stempelbereich",prepareErrorToast:"Stempelbild konnte nicht vorbereitet werden.",placeErrorToast:"Stempel konnte nicht platziert werden",placedToast:'Platziert "{{name}}"',redo:"Wiederholen"},ao={collected:"Stempel gesammelt!",noImage:"Kein Stempelbild"},oo={stampDesign:"Stempeldesign",location:"Ort",dateCollected:"Datum gesammelt",goToLocation:"Gehe zu {{name}} auf der Karte"},no={title:"Orte",toggle:"Ortsliste umschalten",empty:"Noch keine Orte erstellt.",emptySubtext:"Klicke auf den '+' Button, um deinen ersten Ort hinzuzufügen.",selectLocation:"{{name}} auf Karte ansehen"},so={title:"Rallye-Dashboard",subtitle:"Erstelle und verwalte deine Stempel-Rallyes.",createButton:"Neue Rallye erstellen",creating:"Wird erstellt...",newRallyName:"Neue Rallye #{{count}}",loadError:"Rallyes konnten nicht geladen werden.",createSuccess:"Neue Rallye erstellt.",createError:"Rallye konnte nicht erstellt werden.",updateSuccess:"Rallye erfolgreich aktualisiert.",updateError:"Rallye konnte nicht aktualisiert werden.",deleteConfirm:"Möchtest du diese Rallye und alle ihre Orte wirklich löschen? Dies kann nicht rückgängig gemacht werden.",deleteSuccess:"Rallye gelöscht.",deleteError:"Rallye konnte nicht gelöscht werden.",noDescription:"Keine Beschreibung vorhanden.",accessCode:"Zugangscode",status:"Status",published:"Veröffentlicht",draft:"Entwurf",manageRally:"Verwalten",backToDashboard:"Zurück zum Dashboard",editing:"Bearbeiten",selectRallyPromptTitle:"Wähle eine Rallye",selectRallyPromptSubtitle:"Wähle eine Rallye aus dem Dashboard, um deren Karte zu bearbeiten oder sie zu testen."},ro={title:"Einer Rallye beitreten",subtitle:"Geben Sie einen Zugangscode ein, um zu beginnen.",placeholder:"ABCDEF",findButton:"Rallye finden",joinButton:"Rallye beitreten",joinSuccess:'Erfolgreich "{{name}}" beigetreten!',error:{notFound:"Keine veröffentlichte Rallye mit diesem Code gefunden.",network:"Verbindung zum Server konnte nicht hergestellt werden. Bitte versuchen Sie es erneut.",joinFailed:"Beitritt zur Rallye fehlgeschlagen.",alreadyJoined:"Du bist dieser Rallye bereits beigetreten."}},lo={duration:"Dauer",infinite:"Unendlich"},io={common:za,auth:Ra,disclaimer:Aa,loadingScreen:Da,splashScreen:_a,modeToggle:La,rightSidebar:Fa,presetSelector:Oa,settingsSections:$a,stampEditor:Ba,stampGallery:Ua,stampToolbar:Ga,imageLoader:Va,stampSettings:qa,gallery:Wa,geolocations:Ka,collections:Ja,mapEditor:Ha,batchUpload:Ya,coordInputModal:Za,osmImportModal:Xa,locationEditModal:Qa,rally:eo,logbook:to,stampDetailModal:ao,collectionDetailModal:oo,locationList:no,rallyAdmin:so,joinRally:ro,rallyJoinCard:lo},co={en:ea,ja:Pa,de:io},uo=(t,e)=>e.split(".").reduce((a,n)=>a&&a[n],t)||e,pe=h.createContext(void 0),mo=()=>{if(typeof window<"u"){const t=localStorage.getItem("atsume-locale");if(t==="en"||t==="ja"||t==="de")return t;const e=navigator.language.split(/[-_]/)[0];if(e==="ja")return"ja";if(e==="de")return"de"}return"en"},go=({children:t})=>{const[e,a]=h.useState(mo()),n=r=>{a(r),typeof window<"u"&&localStorage.setItem("atsume-locale",r)},s=h.useCallback((r,l)=>{let i=uo(co[e],r);return l&&Object.keys(l).forEach(c=>{i=i.replace(`{{${c}}}`,String(l[c]))}),i},[e]);return o.jsx(pe.Provider,{value:{locale:e,setLocale:n,t:s},children:t})},N=()=>{const t=h.useContext(pe);if(t===void 0)throw new Error("useLocale must be used within a LocaleProvider");return t},po=()=>{const{signInWithGoogle:t}=L(),{t:e}=N();return o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:o.jsxs("div",{className:"w-full max-w-md",children:[o.jsxs("div",{className:"flex flex-col items-center mb-8",children:[o.jsx("div",{className:"p-3 bg-blue-600/20 border-2 border-blue-500 rounded-full mb-4",children:o.jsx(B,{className:"w-12 h-12 text-blue-400"})}),o.jsx("h1",{className:"text-4xl font-bold text-white",children:e("auth.title")}),o.jsx("h2",{className:"text-lg font-light text-gray-300 tracking-widest",children:e("auth.subtitle")})]}),o.jsx("div",{className:"bg-gray-800 rounded-xl p-6 sm:p-8 border border-gray-700",children:o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("button",{onClick:t,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:[o.jsx($e,{className:"w-5 h-5"}),e("auth.signInWithGoogle")]}),o.jsx("p",{className:"text-xs text-center text-gray-500 pt-2",children:e("auth.googleDescription")})]})})]})})},D=()=>{const{t}=N();return o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),o.jsx("h1",{className:"text-2xl font-semibold text-white mb-2",children:t("loadingScreen.authenticating")}),o.jsx("p",{className:"text-gray-400",children:t("loadingScreen.pleaseWait")})]})})},ho=({onClose:t})=>{const{t:e}=N();return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",children:o.jsxs("div",{className:"relative w-full max-w-lg m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-8 text-center text-white transform animate-scale-in",children:[o.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":e("splashScreen.close"),children:o.jsx(z,{className:"w-6 h-6"})}),o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("div",{className:"p-4 bg-blue-600/20 border-2 border-blue-500 rounded-full mb-6",children:o.jsx(B,{className:"w-16 h-16 text-blue-400"})}),o.jsx("h1",{className:"text-5xl font-bold mb-1",children:e("splashScreen.title")}),o.jsx("h2",{className:"text-xl font-light text-gray-300 mb-6 tracking-widest",children:e("splashScreen.subtitle")}),o.jsxs("p",{className:"text-gray-400 mb-8",children:[e("splashScreen.tagline"),o.jsx("br",{}),e("splashScreen.description")]}),o.jsxs("button",{onClick:t,className:"w-full max-w-xs bg-blue-600 hover:bg-blue-700 font-bold py-4 px-8 rounded-xl transition-all duration-200 flex items-center justify-center gap-3 text-xl shadow-lg hover:shadow-blue-500/50 transform hover:scale-105",children:[e("splashScreen.cta"),o.jsx(se,{className:"w-6 h-6"})]}),o.jsx("div",{className:"mt-8 text-xs text-gray-500",children:e("splashScreen.version",{version:"0.10.0"})}),o.jsx("div",{className:"mt-4 text-xs text-gray-500 text-center whitespace-pre-line",children:e("splashScreen.impressumContent")})]})]})})},fo=()=>{const{locale:t,setLocale:e}=N(),[a,n]=h.useState(!1),s=h.useRef(null),r={en:"English",ja:"日本語",de:"Deutsch"};h.useEffect(()=>{const i=c=>{s.current&&!s.current.contains(c.target)&&n(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const l=i=>{e(i),n(!1)};return o.jsxs("div",{ref:s,className:"relative",children:[o.jsxs("button",{onClick:()=>n(!a),className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700 rounded-md transition-colors","aria-haspopup":"true","aria-expanded":a,children:[o.jsx(Be,{className:"w-4 h-4 text-gray-400"}),o.jsx("span",{className:"flex-grow",children:r[t]}),o.jsx("svg",{className:`w-4 h-4 text-gray-400 transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&o.jsx("div",{className:"absolute right-0 bottom-full mb-2 w-40 bg-gray-800 border border-gray-700 rounded-lg shadow-lg py-1 z-10",role:"menu",children:Object.keys(r).map(i=>o.jsxs("button",{onClick:()=>l(i),className:"w-full flex items-center justify-between px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700",role:"menuitem",children:[r[i],t===i&&o.jsx(Ue,{className:"w-4 h-4 text-blue-400"})]},i))})]})};function O(...t){return dt(ut(t))}function Q(t){return new Promise(e=>{const a=new Image;a.src=t,a.onload=()=>e(),a.onerror=n=>{console.error("Failed to preload image:",t,n),e()}})}const he=h.createContext(void 0),bo=({children:t,open:e,onOpenChange:a})=>{const[n,s]=h.useState(!1),r=e!==void 0?e:n,l=h.useCallback(c=>{e===void 0&&s(c),a==null||a(c)},[e,a]),i=h.useMemo(()=>({open:r,setOpen:l}),[r,l]);return o.jsx(he.Provider,{value:i,children:t})},W=()=>{const t=h.useContext(he);if(t===void 0)throw new Error("useDialog must be used within a DialogProvider");return t},fe=h.forwardRef(({onClick:t,asChild:e,...a},n)=>{const{setOpen:s}=W(),r=e?Ge:"button",l=h.useCallback(i=>{s(!0),t==null||t(i)},[s,t]);return o.jsx(r,{ref:n,onClick:l,...a})});fe.displayName="DialogTrigger";const xo=({children:t})=>o.jsx(o.Fragment,{children:t}),be=h.forwardRef(({className:t,...e},a)=>o.jsx("div",{ref:a,className:O("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));be.displayName="DialogOverlay";const xe=h.forwardRef(({className:t,children:e,...a},n)=>{const{open:s,setOpen:r}=W();return s?o.jsxs(xo,{children:[o.jsx(be,{}),o.jsxs("div",{ref:n,className:O("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-800 bg-gray-900 p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[e,o.jsxs("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-gray-900 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-800 data-[state=open]:text-gray-400",onClick:()=>r(!1),children:[o.jsx(z,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:"Close"})]})]})]}):null});xe.displayName="DialogContent";const yo=h.forwardRef(({onClick:t,...e},a)=>{const{setOpen:n}=W(),s=h.useCallback(r=>{n(!1),t==null||t(r)},[n,t]);return o.jsx("button",{ref:a,onClick:s,...e})});yo.displayName="DialogClose";const ye=({className:t,...e})=>o.jsx("div",{className:O("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});ye.displayName="DialogHeader";const we=h.forwardRef(({className:t,...e},a)=>o.jsx("h2",{ref:a,className:O("text-lg font-semibold leading-none tracking-tight text-white",t),...e}));we.displayName="DialogTitle";const wo=h.forwardRef(({className:t,...e},a)=>o.jsx("p",{ref:a,className:O("text-sm text-gray-400",t),...e}));wo.displayName="DialogDescription";const So=()=>{const{locale:t}=N(),[e,a]=h.useState("");return h.useEffect(()=>{(async()=>{try{const s=await fetch(`/atsume-page/disclaimers/${t}.md`);if(!s.ok)throw new Error(`Failed to load disclaimer for locale: ${t}`);const r=await s.text();a(r)}catch(s){console.error("Error loading disclaimer markdown:",s),a("Failed to load disclaimer content.")}})()},[t]),o.jsx("div",{className:"p-4 text-gray-200 overflow-y-auto max-h-[70vh]",children:o.jsx(Ve,{className:"prose prose-invert max-w-none",remarkPlugins:[mt],components:{h1:({node:n,...s})=>o.jsx("h1",{className:"text-2xl font-bold mb-4",...s}),h2:({node:n,...s})=>o.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",...s}),h3:({node:n,...s})=>o.jsx("h3",{className:"text-lg font-medium mt-4 mb-2",...s}),p:({node:n,...s})=>o.jsx("p",{className:"mb-4",...s}),ul:({node:n,...s})=>o.jsx("ul",{className:"list-disc list-inside ml-4 mb-4",...s}),li:({node:n,...s})=>o.jsx("li",{className:"mb-2",...s}),hr:({node:n,...s})=>o.jsx("hr",{className:"my-6 border-gray-700",...s}),a:({node:n,...s})=>o.jsx("a",{className:"text-blue-400 hover:underline",...s})},children:e})})},vo=()=>{const{user:t,logout:e}=L(),{t:a}=N(),[n,s]=h.useState(!1),r=h.useRef(null);return h.useEffect(()=>{const l=i=>{r.current&&!r.current.contains(i.target)&&s(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),t?o.jsxs("div",{ref:r,className:"relative",children:[o.jsx("button",{onClick:()=>s(!n),className:"flex items-center justify-center w-10 h-10 bg-gray-700/50 hover:bg-gray-700 rounded-full transition-colors","aria-label":a("auth.userMenu"),title:t.email||"",children:o.jsx(qe,{className:"w-5 h-5 text-white"})}),n&&o.jsxs("div",{className:"absolute bottom-full mb-4 left-0 mt-2 w-64 bg-gray-800 border border-gray-700 rounded-xl shadow-lg z-50 p-2 flex flex-col gap-1",children:[o.jsxs("div",{className:"px-3 py-2 border-b border-gray-700 mb-1",children:[o.jsx("p",{className:"text-sm font-medium text-white truncate",children:a("auth.signedInAs")}),o.jsx("p",{className:"text-xs text-gray-400 truncate",children:t.email})]}),o.jsx(fo,{}),o.jsxs(bo,{children:[o.jsxs(fe,{className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-gray-200 hover:bg-gray-700 rounded-md transition-colors",children:[o.jsx(V,{className:"w-4 h-4"}),a("disclaimer.title")]}),o.jsxs(xe,{children:[o.jsx(ye,{children:o.jsx(we,{children:a("disclaimer.title")})}),o.jsx(So,{})]})]}),o.jsxs("button",{onClick:e,className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-red-400 hover:bg-red-500/10 hover:text-red-300 rounded-md transition-colors",children:[o.jsx(We,{className:"w-4 h-4"}),a("auth.logout")]})]})]}):null},To=({mode:t,setMode:e,isAdmin:a,isManaging:n})=>{const{t:s}=N(),r="flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg transition-colors duration-200",l="bg-blue-600 text-white",i="bg-gray-700/50 text-gray-300 hover:bg-gray-700",c=[{name:"admin",icon:Ke,title:s("modeToggle.admin"),disabled:!1},{name:"stamp",icon:B,title:s("modeToggle.stamp"),disabled:!1},{name:"map",icon:J,title:s("modeToggle.map"),disabled:!0},{name:"rally",icon:H,title:s("modeToggle.rally"),disabled:!0}],d=[{name:"map",icon:J,title:s("modeToggle.map"),disabled:!1},{name:"rally",icon:H,title:s("modeToggle.rally"),disabled:!1},{name:"stamp",icon:B,title:s("modeToggle.stamp"),disabled:!1}],p=n?d:c;return a?o.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 bg-gray-900/70 backdrop-blur-sm p-1 rounded-xl shadow-lg flex items-center gap-1",children:p.map(g=>o.jsx("button",{onClick:()=>e(g.name),className:`${r} ${t===g.name?l:i} ${g.disabled?"text-gray-500 hover:bg-gray-700/50 cursor-not-allowed":""}`,"aria-pressed":t===g.name,title:g.disabled?s("rallyAdmin.selectRallyPromptSubtitle"):g.title,disabled:g.disabled,children:o.jsx(g.icon,{className:"w-4 h-4"})},g.name))}):null},jo=({onSelect:t})=>{const{t:e}=N(),a=[{method:"map",icon:q,label:e("mapEditor.placeOnMap")},{method:"coords",icon:Je,label:e("mapEditor.byCoordinates")},{method:"osm",icon:re,label:e("mapEditor.fromOSM")},{method:"batch",icon:le,label:e("mapEditor.batchUpload")}];return o.jsx("div",{className:"flex flex-col items-stretch gap-1 bg-gray-900/80 backdrop-blur-sm p-2 rounded-xl shadow-lg w-48 animate-fade-in",children:a.map(n=>o.jsxs("button",{onClick:()=>t(n.method),className:"flex items-center gap-3 w-full text-left p-2 rounded-lg text-white hover:bg-blue-600 transition-colors",title:n.label,children:[o.jsx(n.icon,{className:"w-5 h-5 flex-shrink-0"}),o.jsx("span",{className:"text-sm font-medium",children:n.label})]},n.method))})},ko=({mode:t,setMode:e,isAdmin:a,isManaging:n,managedRally:s,handleExitManagement:r,isLocationListOpen:l,setIsLocationListOpen:i,addMenuOpen:c,setAddMenuOpen:d,handleSelectAddMethod:p,setIsPlacingOnMap:g,children:u})=>{const{t:m}=N();return o.jsx("div",{className:"h-screen w-screen bg-gray-900 text-white font-sans overflow-hidden",children:o.jsxs("main",{className:"relative w-full h-full",children:[o.jsxs("div",{className:"absolute bottom-4 left-4 z-30 flex items-center gap-4",children:[o.jsx(vo,{}),a&&n&&s&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg bg-gray-900/70 backdrop-blur-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors",children:[o.jsx(He,{className:"w-4 h-4"}),m("rallyAdmin.backToDashboard")]}),o.jsxs("div",{className:"text-white bg-gray-900/70 backdrop-blur-sm px-3 py-2 rounded-lg hidden sm:block",children:[o.jsxs("span",{className:"text-gray-400",children:[m("rallyAdmin.editing"),":"]})," ",o.jsx("span",{className:"font-bold",children:s.name})]})]})]}),t==="map"&&!l&&o.jsx("div",{className:"absolute top-4 left-4 z-30",children:o.jsx("button",{onClick:()=>i(!0),className:"p-2 rounded-full bg-gray-900/70 backdrop-blur-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors shadow-lg","aria-label":m("locationList.open"),children:o.jsx(Ye,{className:"w-6 h-6"})})}),o.jsx(To,{mode:t,setMode:e,isAdmin:a,isManaging:n}),u,t==="map"&&o.jsx("div",{className:"absolute bottom-6 right-6 z-10",children:o.jsxs("div",{className:"relative",children:[c&&o.jsx("div",{className:"absolute bottom-full right-0 mb-3",children:o.jsx(jo,{onSelect:p})}),o.jsx("button",{onClick:()=>{d(b=>!b),g(!1)},className:"bg-blue-600 text-white rounded-full p-4 shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800 transition-transform hover:scale-110","aria-label":m("mapEditor.addLocation"),"aria-expanded":c,children:o.jsx(Ze,{className:`w-6 h-6 transition-transform duration-300 ${c?"rotate-45":""}`})})]})})]})})},R=(t=0,e=1)=>{const a=Math.random(),n=Math.random();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*n)*e+t};class M{constructor(e,a,n){$(this,"data");$(this,"width");$(this,"height");this.width=a,this.height=e;const s=a*e;if(n instanceof Float32Array){if(n.length!==s)throw new Error("Data array does not match matrix dimensions");this.data=n}else this.data=new Float32Array(s),typeof n=="number"&&this.data.fill(n)}static ones(e,a){return new M(e,a,1)}static zeros(e,a){return new M(e,a,0)}get(e,a){return e<0||e>=this.height||a<0||a>=this.width?0:this.data[e*this.width+a]}set(e,a,n){e>=0&&e<this.height&&a>=0&&a<this.width&&(this.data[e*this.width+a]=n)}clone(){return new M(this.height,this.width,new Float32Array(this.data))}getBilinear(e,a){const n=Math.floor(e),s=Math.floor(a),r=Math.ceil(e),l=Math.ceil(a);if(n<0||r>=this.height||s<0||l>=this.width)return 0;const i=this.get(n,s),c=this.get(n,l),d=this.get(r,s),p=this.get(r,l),g=e-n,u=a-s,m=i*(1-u)+c*u,b=d*(1-u)+p*u;return m*(1-g)+b*g}}function Se(t,e){const a=M.zeros(t.height,t.width);for(let n=0;n<t.data.length;n++)a.data[n]=t.data[n]*e.data[n];return a}function No(t,e,a,n,s){const r=M.zeros(t.height,t.width);for(let l=0;l<t.data.length;l++)r.data[l]=t.data[l]*e+a.data[l]*n+s;return r}function ve(t){const e=t.clone();let a=1/0,n=-1/0;for(let r=0;r<e.data.length;r++)e.data[r]<a&&(a=e.data[r]),e.data[r]>n&&(n=e.data[r]);const s=n-a;if(s>0)for(let r=0;r<e.data.length;r++)e.data[r]=(e.data[r]-a)/s;return e}function Eo(t){let e=0;for(let a=0;a<t.data.length;a++)t.data[a]!==0&&e++;return e}const _=240,Mo=10,Co=1;function Io(t,e){const a=[];for(let n=0;n<t.length;n+=3){const s=t[n],r=t[n+1],l=t[n+2],i=(s+r+l)/3,c=s>_&&r>_&&l>_;i>e&&!c&&a.push(s,r,l)}return new Float32Array(a)}function ee(t,e){return Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2)}function Po(t,e){if(t.length===0||e===0)return{colors:[],labels:new Int32Array(0)};const a=t.length/3,n=[];for(let c=0;c<t.length;c+=3)n.push([t[c],t[c+1],t[c+2]]);a<e&&(e=a);let s=[];const r=new Set;for(;s.length<e;){const c=Math.floor(Math.random()*a);r.has(c)||(s.push([...n[c]]),r.add(c))}const l=new Int32Array(a);for(let c=0;c<Mo;c++){for(let u=0;u<a;u++){let m=1/0,b=0;for(let f=0;f<s.length;f++){const x=ee(n[u],s[f]);x<m&&(m=x,b=f)}l[u]=b}const d=Array(s.length).fill(0).map(()=>[0,0,0]),p=new Array(s.length).fill(0);for(let u=0;u<a;u++){const m=l[u];d[m][0]+=n[u][0],d[m][1]+=n[u][1],d[m][2]+=n[u][2],p[m]++}let g=!0;for(let u=0;u<s.length;u++){if(p[u]>0)d[u][0]/=p[u],d[u][1]/=p[u],d[u][2]/=p[u];else{const m=Math.floor(Math.random()*a);d[u]=[...n[m]]}ee(d[u],s[u])>Co&&(g=!1)}if(s=d,g)break}return{colors:s.map(c=>c.map(Math.round)),labels:l}}function zo(t,e){const a=M.zeros(t.height,t.width),n=Math.floor(e/2);for(let s=0;s<t.height;s++)for(let r=0;r<t.width;r++){let l=255;for(let i=-n;i<=n;i++)for(let c=-n;c<=n;c++)l=Math.min(l,t.get(s+i,r+c));a.set(s,r,l)}return a}function Ro(t,e,a,n,s,r){const l=new Array(n*s).fill(-1);let i=0;for(let d=0;d<t.length;d+=3){const p=t[d],g=t[d+1],u=t[d+2],m=(p+g+u)/3,b=p>_&&g>_&&u>_;m>r.background_threshold&&!b&&(l[d/3]=a[i],i++)}const c=[];for(let d=0;d<e.length;d++){const p=new Float32Array(n*s);for(let u=0;u<l.length;u++)p[u]=l[u]===d?255:0;let g=new M(s,n,p);r.color_shape_shrink>0&&(g=zo(g,r.color_shape_shrink)),c.push(g)}return c}function Ao(t,e,a){const n=e*Math.PI/180,s=a*Math.cos(n),r=a*Math.sin(n);return[s,r,(1-s)*t.x-r*t.y,-r,s,r*t.x+(1-s)*t.y]}function Do(t,e,a,n){const s=M.zeros(n,a),[r,l,i,c,d,p]=e,g=r*d-l*c;if(Math.abs(g)<1e-6)return s;const u=1/g,m=d*u,b=-l*u,f=(l*p-d*i)*u,x=-c*u,S=r*u,w=(c*i-r*p)*u;for(let v=0;v<n;v++)for(let k=0;k<a;k++){const y=m*k+b*v+f,T=x*k+S*v+w,P=t.getBilinear(T,y);s.set(v,k,P)}return s}function _o(t,e,a,n,s){return t.map(r=>{const l=R(...n),i=R(...n),c=R(...s),d=Ao({x:e/2,y:a/2},c,1);return d[2]+=l,d[5]+=i,Do(r,d,e,a)})}function Te(t){var c;const e=t.length,a=((c=t[0])==null?void 0:c.length)||0,n=Array(e).fill(null).map(()=>Array(a));for(let d=0;d<e;d++)for(let p=0;p<a;p++)n[d][p]=t[d][p]>127;const s=Array(e).fill(null).map(()=>Array(a));for(let d=0;d<e;d++)Lo(n[d],s[d]);const r=Array(e).fill(null).map(()=>Array(a)),l=Array(e),i=Array(e);for(let d=0;d<a;d++){for(let p=0;p<e;p++)l[p]=s[p][d];Fo(l,i);for(let p=0;p<e;p++)r[p][d]=Math.sqrt(i[p])}return r}function Lo(t,e){const a=t.length;let n=1/0;for(let s=0;s<a;s++)t[s]?n++:n=0,e[s]=n*n;n=1/0;for(let s=a-1;s>=0;s--)t[s]?n++:n=0,e[s]=Math.min(e[s],n*n)}function Fo(t,e){const a=t.length;if(a===0)return;const n=Array(a),s=Array(a+1);let r=0;n[0]=0,s[0]=-1/0,s[1]=1/0;for(let l=1;l<a;l++){let i=(t[l]+l*l-(t[n[r]]+n[r]*n[r]))/(2*l-2*n[r]);for(;i<=s[r];)r--,i=(t[l]+l*l-(t[n[r]]+n[r]*n[r]))/(2*l-2*n[r]);r++,n[r]=l,s[r]=i,s[r+1]=1/0}r=0;for(let l=0;l<a;l++){for(;s[r+1]<l;)r++;e[l]=(l-n[r])*(l-n[r])+t[n[r]]}}function Oo(t,e,a){const n=Array(a).fill(null).map(()=>Array(e));for(let s=0;s<a;s++)for(let r=0;r<e;r++)n[s][r]=t.get(s,r);return Te(n)}function $o(t,e,a,n,s){return t.map(r=>{const l=Array(a).fill(0).map(()=>Array(e).fill(0));for(let d=0;d<a;d++)for(let p=0;p<e;p++)l[d][p]=r.get(d,p);const i=Te(l),c=M.ones(a,e);for(let d=0;d<a;d++)for(let p=0;p<e;p++){const g=i[d][p];for(let u=1;u<=n;u++)if(g>u-1&&g<=u){const m=s*(n-u+1)/n;c.set(d,p,m);break}}return c})}function Bo(t,e,a){const n=M.zeros(e,t);for(let s=0;s<3;s++){const r=2**s,l=1/r,i=1/r;for(let c=0;c<e;c++)for(let d=0;d<t;d++){const p=i*Math.sin(d*l*2*Math.PI/a)*Math.sin(c*l*2*Math.PI/a),g=n.get(c,d);n.set(c,d,g+p)}}return ve(n)}function Uo(t,e,a,n,s){const r=M.ones(e,t);if(s<=0||a<=0)return r;for(let l=0;l<a;l++){const i=Math.random()*(n[1]-n[0])+n[0],c=Math.random()*t,d=Math.random()*e,p=Math.max(0,Math.floor(c-i)),g=Math.min(t,Math.ceil(c+i)),u=Math.max(0,Math.floor(d-i)),m=Math.min(e,Math.ceil(d+i));for(let b=u;b<m;b++)for(let f=p;f<g;f++){const x=Math.sqrt((f-c)**2+(b-d)**2);if(x<i){const w=1-(x/i)**2,v=1-s*w;r.get(b,f)>v&&r.set(b,f,v)}}}return r}function Go(t,e,a,n){const s=[];for(let r=0;r<t;r++){const l=R(...n.noise_scale),i=Bo(e,a,l),c=Math.round(R(...n.num_patches)),d=R(...n.ink_depletion_intensity),p=Uo(e,a,c,n.patch_size_range,d),g=R(...n.wear_intensity),u=M.ones(a,e);let m=No(i,g,u,1-g,0);m=Se(m,p),m=ve(m),s.push(m)}return s}function Vo(t,e){const a=[];let n=0;for(let s=0;s<t.length;s++){const r=e>0?t[s].density/e:1/t.length;n+=r,a.push(n)}return a.length>0&&(a[a.length-1]=1),a}function qo(t){const e=Math.random();let a=0,n=t.length-1;if(t.length===0)return-1;if(e<=t[0])return 0;if(e>=t[t.length-1])return t.length-1;for(;a<n;){const s=Math.floor((a+n)/2);t[s]<e?a=s+1:n=s}return a}function Wo(t,e,a,n,s,r){const l=Se(e,a);let i=null;r.bleeding_factor>0&&(i=Oo(t,n,s));const c=[];let d=0;for(let m=0;m<s;m++)for(let b=0;b<n;b++)if(t.get(m,b)>127){const f=l.get(m,b);c.push({x:b,y:m,density:f}),d+=f}if(c.length===0)return[];const p=Vo(c,d),g=Math.floor(r.splat_density*c.length),u=[];for(let m=0;m<g;m++){const b=qo(p);if(b<0)continue;const f=c[b],{x,y:S,density:w}=f,k=(Math.random()*(r.splat_size_range[1]-r.splat_size_range[0])+r.splat_size_range[0])*(.5+.5*w);let y=0;r.bleeding_factor>0&&i&&i[S][x]<5&&(y=-Math.log(Math.random())*r.bleeding_factor);const T=k+y,P=Math.min(255,Math.floor(100+155*w));u.push({x,y:S,size:T,opacity:P})}return u}function Ko(t,e,a,n,s,r=!1){const l=document.createElement("canvas");l.width=a,l.height=n;const i=l.getContext("2d");if(!r){const[c,d,p]=s;i.fillStyle=`rgb(${c}, ${d}, ${p})`,i.fillRect(0,0,a,n)}return t.forEach((c,d)=>{const[p,g,u]=e[d],m=c.sort((b,f)=>f.size-b.size);for(const b of m)i.fillStyle=`rgba(${p}, ${g}, ${u}, ${b.opacity/255})`,i.beginPath(),i.ellipse(b.x,b.y,b.size/2,b.size/2,0,0,2*Math.PI),i.fill()}),i.getImageData(0,0,a,n)}function Jo(t,e){const{data:a,width:n,height:s}=t,r=new Uint8ClampedArray(n*s*3);for(let y=0,T=0;y<a.length;y+=4,T+=3)r[T]=a[y],r[T+1]=a[y+1],r[T+2]=a[y+2];const l=Io(r,e.background_threshold),i=e.num_colors==="auto"?15:e.num_colors,{colors:c,labels:d}=Po(l,i),p=Ro(r,c,d,n,s,e),g=240,u=y=>y[0]>g&&y[1]>g&&y[2]>g,m=p.map((y,T)=>({mask:y,color:c[T],size:Eo(y)})).filter(y=>!u(y.color)).sort((y,T)=>T.size-y.size);if(m.length===0){const y=document.createElement("canvas");return y.width=n,y.height=s,y.getContext("2d").getImageData(0,0,n,s)}const b=m.map(y=>y.mask),f=m.map(y=>y.color),x=_o(b,n,s,e.shift,e.rotation),S=$o(x,n,s,e.edge_width,e.edge_boost),w=Go(f.length,n,s,e),v=[];for(let y=0;y<x.length;y++){const T=Wo(x[y],S[y],w[y],n,s,e);v.push(T)}return Ko(v,f,n,s,e.background_color,!0)}const Ho={stamp_size:512,num_colors:"auto",background_threshold:5,color_shape_shrink:5,shift:[0,1],rotation:[0,1],edge_width:4,edge_boost:3,wear_intensity:[.1,.05],noise_scale:[50,5],rotation_angle:[0,0],ink_depletion_intensity:[.3,.05],num_patches:[2,1],patch_size_range:[20,100],splat_density:.75,splat_size_range:[1,2],bleeding_factor:.1,background_color:[255,255,255]};function Yo(t,e){const a=document.createElement("canvas"),n=a.getContext("2d");if(!n)throw new Error("Could not create canvas context");const s=t.width/t.height,r=s>=1?e:e*s,l=s<1?e:e/s;return a.width=Math.ceil(r),a.height=Math.ceil(l),n.drawImage(t,0,0,a.width,a.height),a}async function An(t,e){return new Promise((a,n)=>{setTimeout(()=>{try{const s=Jo(t,e);a(s)}catch(s){n(s)}},0)})}const te=128;async function Zo(t){const e=document.createElement("canvas"),a=t.width/t.height;e.width=te,e.height=te/a;const n=e.getContext("2d");return n?(n.drawImage(t,0,0,e.width,e.height),e.toDataURL("image/jpeg",.7)):""}function G(){const{user:t}=L(),[e,a]=h.useState([]),[n,s]=h.useState(!0),{addToast:r}=F(),{t:l}=N();h.useEffect(()=>{t!=null&&t.id?(s(!0),X().then(async g=>{const u=g.flatMap(m=>[m.sourceImageURL,m.thumbnail]);await Promise.all(u.map(Q)),a(g)}).catch(g=>{console.error("Failed to load stamps from DB",g),r(l("gallery.loadErrorToast"),"error")}).finally(()=>{s(!1)})):(a([]),s(!1))},[t==null?void 0:t.id,r,l]);const i=h.useCallback(()=>{t!=null&&t.id&&(s(!0),X().then(async g=>{const u=g.flatMap(m=>[m.sourceImageURL,m.thumbnail]);await Promise.all(u.map(Q)),a(g)}).catch(g=>{console.error("Failed to load stamps from DB",g),r(l("gallery.loadErrorToast"),"error")}).finally(()=>{s(!1)}))},[t==null?void 0:t.id,r,l]),c=h.useCallback(async(g,u,m)=>{if(!t){r(l("gallery.loginToast"),"info");return}try{const b=Yo(g,u.stamp_size),f=b.toDataURL("image/jpeg",.7),x=await Zo(b),S={user_id:t.id,name:m,thumbnail:x,settings:u,sourceImageURL:f},w=await ue(S);a(v=>[w,...v]),r(l("gallery.addSuccessToast",{name:m}),"success")}catch(b){console.error("Failed to add stamp to gallery:",b),r(l("gallery.addErrorToast"),"error")}},[r,t,l]),d=h.useCallback(async g=>{a(u=>u.filter(m=>m.id!==g));try{await bt(g),r(l("gallery.deleteSuccessToast"),"info")}catch(u){console.error("Failed to delete stamp:",u),r(l("gallery.deleteErrorToast"),"error"),i()}},[r,l,i]),p=h.useCallback(async(g,u)=>{const m=e.find(f=>f.id===g);if(!m)return;const b=m.name;a(f=>f.map(x=>x.id===g?{...x,name:u}:x));try{await xt(g,u),r(l("gallery.renameSuccessToast",{name:u}),"success")}catch(f){console.error("Failed to rename stamp:",f),r(l("gallery.renameErrorToast",{oldName:b}),"error"),i()}},[r,e,l,i]);return{stamps:e,loading:n,addStampToGallery:c,deleteStampFromGallery:d,renameStampInGallery:p,refreshStamps:i}}function Dn(t,e,a,n){const r=t*Math.PI/180,l=a*Math.PI/180,i=(a-t)*Math.PI/180,c=(n-e)*Math.PI/180,d=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(l)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}function Xo(t,e,a=64){const[n,s]=t,r={latitude:s,longitude:n},l=e/1e3,i=[],c=l/(111.32*Math.cos(r.latitude*Math.PI/180)),d=l/110.574;let p,g,u;for(let m=0;m<a;m++)p=m/a*(2*Math.PI),g=c*Math.cos(p),u=d*Math.sin(p),i.push([r.longitude+g,r.latitude+u]);return i.push(i[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[i]},properties:{}}}const Qo=({isVisible:t,onMapLoad:e,onGeolocate:a,onMapClick:n,children:s,className:r="",cursor:l="",mapRef:i})=>{const{addToast:c}=F(),{t:d}=N(),[p,g]=h.useState({longitude:-.09,latitude:51.505,zoom:3}),[u,m]=h.useState(!1),b=h.useRef(null),f=i||b,x=h.useRef(null),S=h.useRef(!1),w=y=>{let T=d("mapEditor.locationError.unknown");switch(y.code){case y.PERMISSION_DENIED:T=d("mapEditor.locationError.denied");break;case y.POSITION_UNAVAILABLE:T=d("mapEditor.locationError.unavailable");break;case y.TIMEOUT:T=d("mapEditor.locationError.timeout");break}c(T,"error")},v=h.useCallback(y=>{S.current||(S.current=!0,c(d("mapEditor.centeredToast"),"success")),a==null||a({latitude:y.coords.latitude,longitude:y.coords.longitude})},[c,d,a]),k=h.useCallback(()=>{u||setTimeout(()=>{if(x.current)try{x.current.trigger(),m(!0)}catch(y){console.warn("Failed to trigger geolocation on load:",y)}},500),e==null||e()},[u,e]);return h.useEffect(()=>{if(t&&f.current){const y=setTimeout(()=>{var T;return(T=f.current)==null?void 0:T.getMap().resize()},1);return()=>clearTimeout(y)}},[t,f]),h.useEffect(()=>{if(!u){const y=setTimeout(()=>{if(x.current)try{x.current.trigger(),m(!0)}catch(T){console.warn("Failed to trigger geolocation on mount:",T),(navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad"))&&c(d("mapEditor.iOSLocationPrompt")||"Tap the location button to center on your position","info")}},1e3);return()=>clearTimeout(y)}},[u,c,d]),o.jsx("div",{className:`relative w-full h-full bg-gray-700 ${l} ${r}`,children:o.jsxs(Xe,{ref:f,mapLib:gt,...p,onMove:y=>g(y.viewState),onClick:n,onLoad:k,mapStyle:"https://tiles.openfreemap.org/styles/positron",style:{width:"100%",height:"100%"},children:[o.jsx(Qe,{ref:x,positionOptions:{enableHighAccuracy:!0,timeout:1e4,maximumAge:0},trackUserLocation:!0,showUserLocation:!0,showAccuracyCircle:!0,fitBoundsOptions:{maxZoom:15},onError:w,onGeolocate:v}),s]})})},en=({isVisible:t,selectedLocation:e,setSelectedLocation:a,geolocations:n,setEditingLocation:s,newLocationCoords:r,setNewLocationCoords:l,isPlacingOnMap:i,setIsPlacingOnMap:c,deleteGeolocation:d})=>{const{stamps:p}=G(),{t:g}=N(),u=h.useRef(null),m=h.useMemo(()=>({type:"FeatureCollection",features:n.map(x=>{const S=Xo([x.longitude,x.latitude],x.radius);return S.properties={id:x.id},S})}),[n]),b=x=>{if(i){const{lng:S,lat:w}=x.lngLat;l({latitude:w,longitude:S}),c(!1)}e&&a(null)},f=h.useMemo(()=>e!=null&&e.stamp_id&&p.find(x=>x.id===e.stamp_id)||null,[e,p]);return h.useEffect(()=>{r&&(s(null),a(null))},[r,a,s]),o.jsx(o.Fragment,{children:o.jsxs(Qo,{isVisible:t,onMapClick:b,cursor:i?"cursor-add":"",mapRef:u,children:[o.jsxs(et,{id:"radius-circles",type:"geojson",data:m,children:[o.jsx(Y,{id:"radius-circles-fill",type:"fill",paint:{"fill-color":"#ef4444","fill-opacity":.25}}),o.jsx(Y,{id:"radius-circles-stroke",type:"line",paint:{"line-color":"#ef4444","line-width":1.5,"line-dasharray":[2,2]}})]}),n.map(x=>o.jsx(tt,{longitude:x.longitude,latitude:x.latitude,style:{zIndex:20},children:o.jsx("button",{onClick:S=>{S.stopPropagation(),a(x)},"aria-label":g("mapEditor.viewLocation",{name:x.name}),children:o.jsx(q,{className:"text-red-500 w-8 h-8 drop-shadow-lg",strokeWidth:1.5})})},x.id)),e&&o.jsx(at,{longitude:e.longitude,latitude:e.latitude,onClose:()=>a(null),closeOnClick:!1,anchor:"bottom",offset:35,style:{zIndex:20},children:o.jsxs("div",{className:"flex flex-col",children:[f&&o.jsx("img",{src:f.thumbnail,alt:f.name,className:"w-full h-32 object-contain bg-gray-900/50 rounded-t-md"}),o.jsxs("div",{className:"p-3",children:[o.jsx("h3",{className:"font-bold text-lg text-white mb-1",children:e.name}),o.jsx("p",{className:"text-sm text-gray-300 mb-3",children:e.description}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:()=>{s(e),a(null)},className:"flex-1 bg-blue-600 text-white px-2 py-1.5 text-xs rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-1.5",children:[o.jsx(ot,{className:"w-3 h-3"})," ",g("common.edit")]}),o.jsxs("button",{onClick:()=>d(e.id),className:"flex-1 bg-red-600 text-white px-2 py-1.5 text-xs rounded-md hover:bg-red-700 transition-colors flex items-center justify-center gap-1.5",children:[o.jsx(nt,{className:"w-3 h-3"})," ",g("common.delete")]})]})]})]})})]})})},tn=({isOpen:t,onClose:e,locations:a,selectedLocationId:n,onSelectLocation:s})=>{const{t:r}=N(),l=i=>{s(i),e()};return o.jsx("aside",{className:`fixed top-0 left-0 h-full bg-gray-800 flex-shrink-0 transition-transform duration-300 ease-in-out z-40 w-full max-w-sm border-r-2 border-gray-700 shadow-2xl ${t?"translate-x-0":"-translate-x-full"}`,"aria-hidden":!t,children:o.jsxs("div",{className:"h-full flex flex-col",children:[o.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[o.jsx("h1",{className:"text-xl font-bold",children:r("locationList.title")}),o.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-700","aria-label":r("common.close"),children:o.jsx(z,{className:"w-5 h-5"})})]}),o.jsx("div",{className:"flex-grow overflow-y-auto p-2 no-scrollbar",children:a.length===0?o.jsxs("div",{className:"text-center text-gray-400 mt-8 px-4",children:[o.jsx("p",{children:r("locationList.empty")}),o.jsx("p",{className:"text-sm mt-1",children:r("locationList.emptySubtext")})]}):o.jsx("ul",{className:"flex flex-col gap-2",children:a.map(i=>o.jsx("li",{children:o.jsxs("button",{onClick:()=>l(i),className:`w-full flex items-center gap-3 text-left p-2 rounded-lg transition-colors duration-200 ${n===i.id?"bg-blue-600 text-white":"text-gray-200 hover:bg-gray-700"}`,"aria-label":r("locationList.selectLocation",{name:i.name}),"aria-current":n===i.id,children:[o.jsx("div",{className:"w-10 h-10 flex-shrink-0 bg-gray-900/50 rounded-md flex items-center justify-center",children:i.stamp?o.jsx("img",{src:i.stamp.thumbnail,alt:i.stamp.name,className:"w-full h-full object-contain"}):o.jsx(q,{className:"w-6 h-6 text-gray-500"})}),o.jsx("span",{className:"flex-grow font-medium truncate",children:i.name})]})},i.id))})})]})})},an=C.memo(({isVisible:t,isPlacingOnMap:e,setIsPlacingOnMap:a,newLocationCoords:n,setNewLocationCoords:s,setEditingLocation:r,isLocationListOpen:l,setIsLocationListOpen:i,geolocations:c,deleteGeolocation:d})=>{const[p,g]=h.useState(null),{addToast:u}=F(),{stamps:m}=G(),{t:b}=N();h.useEffect(()=>{e&&u(b("mapEditor.addLocationToast"),"info")},[e,u,b]);const f=h.useMemo(()=>c.map(w=>({...w,stamp:m.find(v=>v.id===w.stamp_id)||null})).sort((w,v)=>w.created_at&&v.created_at?new Date(v.created_at).getTime()-new Date(w.created_at).getTime():0),[c,m]),x=async w=>{window.confirm(b("mapEditor.deleteConfirm"))&&(await d(w),g(null))},S=w=>{g(w)};return h.useEffect(()=>{n&&(r(null),g(null))},[n,g,r]),o.jsxs("div",{className:`w-full h-full ${t?"block":"hidden"}`,children:[o.jsx(en,{isVisible:t,selectedLocation:p,setSelectedLocation:g,geolocations:c,setEditingLocation:r,setNewLocationCoords:s,isPlacingOnMap:e,setIsPlacingOnMap:a,deleteGeolocation:x,newLocationCoords:n}),o.jsx(tn,{isOpen:l,onClose:()=>i(!1),locations:f,selectedLocationId:(p==null?void 0:p.id)||null,onSelectLocation:S})]})}),on=({text:t})=>o.jsxs("div",{className:"relative group flex items-center",children:[o.jsx(V,{className:"w-4 h-4 text-gray-500 cursor-help"}),o.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 w-max max-w-xs p-2 text-xs text-white bg-gray-900 border border-gray-600 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10",children:t})]});function nn({label:t,name:e,value:a,min:n,max:s,step:r,unit:l="",tooltip:i,disabled:c=!1,onChange:d}){const p=u=>{var m;return r<1?u.toFixed(((m=r.toString().split(".")[1])==null?void 0:m.length)||2):u.toString()},g=(a-n)/(s-n)*100;return o.jsxs("div",{className:"pt-3 flex-1",children:[t&&o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{htmlFor:e,className:`text-sm font-medium ${c?"text-gray-500":"text-gray-300"}`,children:t}),i&&o.jsx(on,{text:i})]}),o.jsxs("span",{className:`text-sm font-mono ${c?"text-gray-500":"text-blue-400"}`,children:[p(a),l]})]}),o.jsx("input",{type:"range",id:e,name:e,min:n,max:s,step:r,value:a,onChange:d,disabled:c,className:"w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer slider disabled:cursor-not-allowed",style:{background:c?"#4b5563":`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${g}%, #4b5563 ${g}%, #4b5563 100%)`}})]})}const sn=({initialData:t,onSave:e,onClose:a})=>{const[n,s]=h.useState(t.name||""),[r,l]=h.useState(t.description||""),[i,c]=h.useState(t.radius||100),[d,p]=h.useState(t.stamp_id||null),{stamps:g,loading:u}=G(),{t:m}=N(),b=()=>{if(!n.trim()){alert(m("locationEditModal.validationError"));return}e({...t.id&&{id:t.id},name:n,description:r,radius:i,latitude:t.latitude,longitude:t.longitude,stamp_id:d})};return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:a,children:o.jsxs("div",{className:"relative w-full max-w-lg m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 sm:p-8 text-white transform animate-scale-in flex flex-col gap-6",onClick:f=>f.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold",children:t.id?m("locationEditModal.titleEdit"):m("locationEditModal.titleAdd")}),o.jsx("button",{onClick:a,className:"p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":m("common.close"),children:o.jsx(z,{className:"w-6 h-6"})})]}),o.jsxs("div",{className:"flex flex-col gap-4",children:[o.jsx("input",{type:"text",placeholder:m("locationEditModal.namePlaceholder"),value:n,onChange:f=>s(f.target.value),className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:outline-none transition"}),o.jsx("textarea",{placeholder:`${m("common.description")} (${m("common.optional")})`,value:r||"",onChange:f=>l(f.target.value),rows:3,className:"w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:outline-none transition resize-none"}),o.jsx(nn,{label:m("locationEditModal.radius"),name:"radius",value:i,min:10,max:1e3,step:10,unit:"m",onChange:f=>c(parseInt(f.target.value,10)),tooltip:m("locationEditModal.radiusTooltip")})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:m("locationEditModal.assignStamp")}),o.jsx("div",{className:"h-48 bg-gray-900/50 rounded-lg p-3 overflow-y-auto no-scrollbar border border-gray-700",children:u?o.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:m("locationEditModal.loadingStamps")}):o.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-3",children:[o.jsxs("button",{onClick:()=>p(null),className:`w-full aspect-square rounded-lg flex flex-col items-center justify-center text-gray-400 transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${d===null?"ring-2 ring-blue-500 bg-blue-500/10":"ring-1 ring-gray-600 hover:ring-blue-500 bg-gray-700"}`,children:[o.jsx(st,{className:"w-8 h-8"}),o.jsx("span",{className:"text-xs mt-1",children:m("locationEditModal.noStamp")})]}),g.map(f=>o.jsx("button",{onClick:()=>p(f.id),className:`w-full aspect-square rounded-lg overflow-hidden transition-all duration-200 focus:outline-none ring-offset-2 ring-offset-gray-800 focus:ring-2 ${d===f.id?"ring-2 ring-blue-500":"ring-1 ring-gray-700 hover:ring-blue-500"}`,children:o.jsx("img",{src:f.thumbnail,alt:f.name,className:"w-full h-full object-contain bg-gray-900/50"})},f.id))]})})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx("button",{onClick:a,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:m("common.cancel")}),o.jsxs("button",{onClick:b,className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[o.jsx(rt,{className:"w-5 h-5"}),m("common.save")]})]})]})})},rn=({onSave:t,onClose:e})=>{const{t:a}=N(),[n,s]=h.useState(""),[r,l]=h.useState(""),[i,c]=h.useState({}),d=()=>{const g={},u=parseFloat(n),m=parseFloat(r);return n?(isNaN(u)||u<-90||u>90)&&(g.lat=a("coordInputModal.validation.latInvalid")):g.lat=a("coordInputModal.validation.latRequired"),r?(isNaN(m)||m<-180||m>180)&&(g.lon=a("coordInputModal.validation.lonInvalid")):g.lon=a("coordInputModal.validation.lonRequired"),c(g),Object.keys(g).length===0},p=g=>{g.preventDefault(),d()&&t({latitude:parseFloat(n),longitude:parseFloat(r)})};return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:e,children:o.jsxs("div",{className:"relative w-full max-w-md m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 sm:p-8 text-white transform animate-scale-in flex flex-col gap-6",onClick:g=>g.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold",children:a("coordInputModal.title")}),o.jsx("button",{onClick:e,className:"p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":a("common.close"),children:o.jsx(z,{className:"w-6 h-6"})})]}),o.jsxs("form",{onSubmit:p,className:"flex flex-col gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"latitude",className:"block text-sm font-medium text-gray-300 mb-1",children:a("coordInputModal.latitude")}),o.jsx("input",{id:"latitude",type:"number",step:"any",placeholder:a("coordInputModal.latitudePlaceholder"),value:n,onChange:g=>s(g.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i.lat?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),i.lat&&o.jsx("p",{className:"text-red-400 text-xs mt-1",children:i.lat})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"longitude",className:"block text-sm font-medium text-gray-300 mb-1",children:a("coordInputModal.longitude")}),o.jsx("input",{id:"longitude",type:"number",step:"any",placeholder:a("coordInputModal.longitudePlaceholder"),value:r,onChange:g=>l(g.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i.lon?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),i.lon&&o.jsx("p",{className:"text-red-400 text-xs mt-1",children:i.lon})]}),o.jsxs("div",{className:"flex gap-4 pt-2",children:[o.jsx("button",{type:"button",onClick:e,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:a("common.cancel")}),o.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[a("coordInputModal.next"),o.jsx(se,{className:"w-5 h-5"})]})]})]})]})})},ln=({onImport:t,onClose:e})=>{const{t:a}=N(),[n,s]=h.useState(""),[r,l]=h.useState(!1),[i,c]=h.useState(null),d=async()=>{if(c(null),!/^([NWR]\d+|\d+)$/i.test(n)){c("invalidId");return}l(!0);let m=n;/^\d+$/.test(n)&&(m=`N${n}`);try{const b=await fetch(`https://nominatim.openstreetmap.org/lookup?osm_ids=${m.toUpperCase()}&format=json`);if(!b.ok)throw new Error("Network response was not ok");const f=await b.json();f&&f.length>0?t({latitude:parseFloat(f[0].lat),longitude:parseFloat(f[0].lon)}):c("notFound")}catch(b){console.error("OSM Import Error:",b),c("network")}finally{l(!1)}},p=u=>{u.preventDefault(),d()},g={invalidId:a("osmImportModal.error.invalidId"),notFound:a("osmImportModal.error.notFound"),network:a("osmImportModal.error.network")};return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm animate-fade-in","aria-modal":"true",role:"dialog",onClick:e,children:o.jsxs("div",{className:"relative w-full max-w-md m-4 bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 sm:p-8 text-white transform animate-scale-in flex flex-col gap-6",onClick:u=>u.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold",children:a("osmImportModal.title")}),o.jsx("button",{onClick:e,className:"p-2 text-gray-400 rounded-full hover:bg-gray-700 hover:text-white transition-colors","aria-label":a("common.close"),children:o.jsx(z,{className:"w-6 h-6"})})]}),o.jsxs("form",{onSubmit:p,className:"flex flex-col gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"osmId",className:"block text-sm font-medium text-gray-300 mb-1",children:a("osmImportModal.idLabel")}),o.jsx("input",{id:"osmId",type:"text",placeholder:a("osmImportModal.idPlaceholder"),value:n,onChange:u=>s(u.target.value),className:`w-full bg-gray-900 text-white placeholder-gray-500 px-4 py-2.5 rounded-lg border ${i?"border-red-500":"border-gray-600"} focus:ring-2 focus:ring-blue-500 focus:outline-none transition`}),o.jsx("p",{className:"text-xs text-gray-400 mt-2",children:a("osmImportModal.helpText")})]}),i&&o.jsx("p",{className:"text-red-400 text-xs mt-1",children:g[i]}),o.jsxs("div",{className:"flex gap-4 pt-2",children:[o.jsx("button",{type:"button",onClick:e,className:"w-full bg-gray-600 hover:bg-gray-500 font-medium py-3 px-4 rounded-lg transition-colors",children:a("common.cancel")}),o.jsx("button",{type:"submit",disabled:r||!n,className:"w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:bg-gray-600 disabled:cursor-not-allowed",children:r?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),a("osmImportModal.importing")]}):o.jsxs(o.Fragment,{children:[o.jsx(re,{className:"w-5 h-5"}),a("osmImportModal.import")]})})]})]})]})})},cn=[{name:"Default",settings:{}},{name:"Gritty",settings:{edge_boost:5,wear_intensity:[.4,.2],noise_scale:[30,10],ink_depletion_intensity:[.5,.1],splat_density:.9}},{name:"Faded",settings:{edge_boost:1,wear_intensity:[.7,.1],noise_scale:[100,5],ink_depletion_intensity:[.8,.05],splat_density:.5,bleeding_factor:.2}},{name:"Clean",settings:{color_shape_shrink:1,shift:[.5,.2],rotation:[.2,.1],edge_width:2,edge_boost:1,wear_intensity:[.05,.01],ink_depletion_intensity:[.1,.01],splat_density:1.2,bleeding_factor:.05}}];async function dn(t,e,a,n){const s={successCount:0,totalCount:a.length,errors:[]};for(let r=0;r<a.length;r++){const l=a[r];try{const i=cn.find(p=>p.name===l.preset),c={...Ho,...i?i.settings:{}},d=await ue({user_id:t,name:l.name,thumbnail:"data:image/jpeg;base64,"+l.image,sourceImageURL:"data:image/jpeg;base64,"+l.image,settings:c});await me({user_id:t,rally_id:e,stamp_id:d.id,name:l.name,description:l.description,latitude:l.coordinates[0],longitude:l.coordinates[1],radius:l.collection_radius}),s.successCount++}catch(i){console.error(`Error processing item ${l.name}:`,i),s.errors.push({item:l,error:i.message})}n(Math.round((r+1)/a.length*100))}return s}const un=({isOpen:t,onClose:e,rallyId:a})=>{const{t:n}=N(),{addToast:s}=F(),{user:r}=L(),{refreshStamps:l}=G(),[i,c]=h.useState(null),[d,p]=h.useState(0),[g,u]=h.useState("idle"),[m,b]=h.useState(null),f=h.useRef(null),x=v=>{if(v.target.files&&v.target.files[0]){const k=v.target.files[0];k.type==="application/json"?(c(k),u("idle"),b(null),p(0)):(c(null),u("error"),b(n("batchUpload.invalidFileType")),s(n("batchUpload.invalidFileType"),"error"))}},S=async()=>{if(!i){b(n("batchUpload.noFileSelected")),s(n("batchUpload.noFileSelected"),"error");return}if(!r){b(n("batchUpload.loginRequired")),s(n("batchUpload.loginRequired"),"error");return}u("uploading"),b(null);try{const v=new FileReader;v.onload=async k=>{var y;try{const T=(y=k.target)==null?void 0:y.result,P=JSON.parse(T);u("processing");const I=await dn(r.id,a,P,A=>{p(A)});I.errors.length>0?(u("error"),b(n("batchUpload.partialSuccess",{success:I.successCount,total:I.totalCount})),s(n("batchUpload.partialSuccess",{success:I.successCount,total:I.totalCount}),"info")):(u("success"),s(n("batchUpload.success",{count:I.successCount}),"success"),l())}catch(T){u("error"),b(n("batchUpload.invalidJson")+`: ${T.message}`),s(n("batchUpload.invalidJson"),"error")}},v.readAsText(i)}catch(v){u("error"),b(n("batchUpload.uploadFailed")+`: ${v.message}`),s(n("batchUpload.uploadFailed")+`: ${v.message}`,"error")}},w=()=>{c(null),p(0),u("idle"),b(null),f.current&&(f.current.value=""),e()};return t?o.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#1f2937",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:20,width:"90%",maxWidth:"425px",border:"1px solid #374151"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[o.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#f9fafb"},children:n("batchUpload.title")}),o.jsx("button",{onClick:w,style:{background:"none",border:"none",cursor:"pointer",color:"#9ca3af"},children:o.jsx(z,{size:20})})]}),o.jsxs("div",{style:{marginBottom:"15px"},children:[o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"24px",border:"2px dashed #4b5563",borderRadius:"8px",color:"#9ca3af"},children:[o.jsx("input",{id:"json-upload",type:"file",accept:".json",onChange:x,style:{display:"none"},ref:f}),o.jsxs("label",{htmlFor:"json-upload",style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center"},children:[o.jsx(le,{size:48,style:{marginBottom:"8px"}}),o.jsx("p",{style:{fontSize:"0.875rem",marginBottom:"4px"},children:n("batchUpload.dragDrop")}),o.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280"},children:n("batchUpload.orClick")})]}),i&&o.jsxs("p",{style:{marginTop:"8px",fontSize:"0.875rem",color:"#f9fafb"},children:[n("batchUpload.selectedFile"),": ",i.name]})]}),g==="uploading"&&o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#60a5fa",marginTop:"15px"},children:[o.jsx(Z,{size:20,style:{animation:"spin 1s linear infinite"}}),o.jsx("span",{children:n("batchUpload.readingFile")})]}),g==="processing"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"15px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#60a5fa"},children:[o.jsx(Z,{size:20,style:{animation:"spin 1s linear infinite"}}),o.jsx("span",{children:n("batchUpload.processingItems")})]}),o.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#4b5563",borderRadius:"4px",overflow:"hidden"},children:o.jsx("div",{style:{width:`${d}%`,height:"100%",backgroundColor:"#60a5fa",transition:"width 0.3s ease-in-out"}})}),o.jsxs("p",{style:{fontSize:"0.875rem",color:"#9ca3af",textAlign:"center"},children:[d,"%"]})]}),g==="success"&&o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#4ade80",marginTop:"15px"},children:[o.jsx(ne,{size:20}),o.jsx("span",{children:n("batchUpload.uploadComplete")})]}),g==="error"&&m&&o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#ef4444",marginTop:"15px"},children:[o.jsx(lt,{size:20}),o.jsx("span",{children:m})]}),o.jsx("button",{onClick:S,disabled:!i||g==="uploading"||g==="processing",style:{marginTop:"15px",width:"100%",padding:"10px 15px",backgroundColor:"#60a5fa",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",opacity:!i||g==="uploading"||g==="processing"?.5:1,transition:"opacity 0.2s ease-in-out"},children:n(g==="processing"?"common.submitting":"batchUpload.uploadButton")})]})]}):null},mn=({editingLocation:t,newLocationCoords:e,setEditingLocation:a,setNewLocationCoords:n,coordInputOpen:s,setCoordInputOpen:r,osmImportOpen:l,setOsmImportOpen:i,isBatchUploadModalOpen:c,setIsBatchUploadModalOpen:d,managedRally:p,handleSaveLocation:g})=>o.jsxs(o.Fragment,{children:[(t||e)&&!s&&!l&&o.jsx(sn,{initialData:t||e,onSave:g,onClose:()=>{a(null),n(null)}}),s&&o.jsx(rn,{onSave:u=>{r(!1),n(u)},onClose:()=>r(!1)}),l&&o.jsx(ln,{onImport:u=>{i(!1),n(u)},onClose:()=>i(!1)}),c&&p&&o.jsx(un,{isOpen:c,onClose:()=>d(!1),rallyId:p.id})]});function gn(t){const{user:e}=L(),[a,n]=h.useState([]),[s,r]=h.useState(!0),{addToast:l}=F(),{t:i}=N(),c=h.useCallback(async()=>{if(!(e!=null&&e.id)||!t){n([]),r(!1);return}r(!0);try{const m=await wt(t);n(m)}catch(m){console.error("Failed to load geolocations from DB",m),l(i("geolocations.loadErrorToast"),"error")}finally{r(!1)}},[e==null?void 0:e.id,t,l,i]),d=h.useCallback(()=>{document.visibilityState==="visible"&&c()},[c]);h.useEffect(()=>(document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}),[d]),h.useEffect(()=>{e!=null&&e.id&&t&&c()},[e==null?void 0:e.id,t,c]);const p=h.useCallback(async m=>{if(!e||!t){l(i("geolocations.loginToast"),"info");return}const b={user_id:e.id,rally_id:t,name:m.name,latitude:m.latitude,longitude:m.longitude,radius:m.radius,description:m.description??null,stamp_id:m.stamp_id??null},f=`temp-${Date.now()}`;n(x=>[...x,{...b,id:f,created_at:new Date().toISOString()}]);try{const x=await me({user_id:e.id,rally_id:t,name:m.name,latitude:m.latitude,longitude:m.longitude,radius:m.radius,description:m.description??null,stamp_id:m.stamp_id??null});l(i("geolocations.addSuccessToast",{name:x.name}),"success"),n(S=>S.map(w=>w.id===f?x:w))}catch(x){console.error("Failed to add geolocation:",x),l(i("geolocations.addErrorToast"),"error"),n(S=>S.filter(w=>w.id!==f))}},[e,t,l,i]),g=h.useCallback(async(m,b)=>{n(f=>f.map(x=>x.id===m?{...x,...b}:x));try{await St(m,b),l(i("geolocations.updateSuccessToast"),"success")}catch(f){console.error("Failed to update geolocation:",f),l(i("geolocations.updateErrorToast"),"error"),await c()}},[l,i,c]),u=h.useCallback(async m=>{n(b=>b.filter(f=>f.id!==m));try{await vt(m),l(i("geolocations.deleteSuccessToast"),"info")}catch(b){console.error("Failed to delete geolocation:",b),l(i("geolocations.deleteErrorToast"),"error"),await c()}},[l,i,c]);return{geolocations:a,loading:s,addGeolocation:p,updateGeolocation:g,deleteGeolocation:u,fetchGeolocations:c}}const ae=C.lazy(()=>U(()=>import("./StampRally-CM67XBjV.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),pn=C.lazy(()=>U(()=>import("./StampEditor-Dr5wZaQH.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),hn=C.lazy(()=>U(()=>import("./JoinRallyScreen-BiZDetae.js"),__vite__mapDeps([8,1,2,3,4,6]))),fn=C.lazy(()=>U(()=>import("./RallyAdminDashboard-BMduJv4i.js"),__vite__mapDeps([9,1,2,3,4,6])));function bn(){const{user:t,loading:e,role:a,activeRallyId:n}=L(),[s,r]=h.useState("admin"),[l,i]=h.useState(!1),[c,d]=h.useState(null),[p,g]=h.useState(!1),[u,m]=h.useState(!1),[b,f]=h.useState(null),[x,S]=h.useState(null),[w,v]=h.useState(!1),[k,y]=h.useState(!1),[T,P]=h.useState(!1),[I,A]=h.useState(!1),{addGeolocation:je,updateGeolocation:ke,geolocations:Ne,deleteGeolocation:Ee}=gn((c==null?void 0:c.id)||null),Me=async E=>{"id"in E&&E.id?await ke(E.id,E):await je(E),f(null),S(null)},Ce=E=>{switch(P(!1),E){case"map":A(!0);break;case"coords":v(!0);break;case"osm":y(!0);break;case"batch":i(!0);break}};h.useEffect(()=>{sessionStorage.getItem("splashSeen")||g(!0)},[]),h.useEffect(()=>{a&&!c&&r(a==="user"?"rally":"admin")},[a,c]);const Ie=()=>{g(!1),sessionStorage.setItem("splashSeen","true")},Pe=E=>{d(E),r("map")},ze=()=>{d(null),r("admin")},Re=()=>{if(a==="user")return o.jsx(C.Suspense,{fallback:o.jsx(D,{}),children:o.jsx(ae,{})});if(a==="admin"){const E=!!c,Ae=!E&&s==="admin",De=E&&s==="map",K=E&&s==="rally",_e=s==="stamp";return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:`w-full h-full ${Ae?"block":"hidden"}`,children:o.jsx(C.Suspense,{fallback:o.jsx(D,{}),children:o.jsx(fn,{onManageRally:Pe})})}),o.jsx(an,{isVisible:De,isPlacingOnMap:I,setIsPlacingOnMap:A,newLocationCoords:x,setNewLocationCoords:S,setEditingLocation:f,isLocationListOpen:u,setIsLocationListOpen:m,geolocations:Ne,deleteGeolocation:Ee}),o.jsx("div",{className:`w-full h-full ${K?"block":"hidden"}`,children:o.jsx(ae,{adminTestingRallyId:(c==null?void 0:c.id)||null,isVisible:K})}),o.jsx("div",{className:`w-full h-full ${_e?"block":"hidden"}`,children:o.jsx(C.Suspense,{fallback:o.jsx(D,{}),children:o.jsx(pn,{})})})]})}return o.jsx(D,{})};return e?o.jsx(D,{}):t?a==="user"&&!n?o.jsx(C.Suspense,{fallback:o.jsx(D,{}),children:o.jsx(hn,{})}):o.jsxs(ko,{mode:s,setMode:r,isAdmin:a==="admin",isManaging:!!c,managedRally:c,handleExitManagement:ze,isLocationListOpen:u,setIsLocationListOpen:m,addMenuOpen:T,setAddMenuOpen:P,handleSelectAddMethod:Ce,setIsPlacingOnMap:A,children:[Re(),p&&o.jsx(ho,{onClose:Ie}),o.jsx(mn,{editingLocation:b,newLocationCoords:x,setEditingLocation:f,setNewLocationCoords:S,coordInputOpen:w,setCoordInputOpen:v,osmImportOpen:k,setOsmImportOpen:y,isBatchUploadModalOpen:l,setIsBatchUploadModalOpen:i,managedRally:c,handleSaveLocation:Me})]}):o.jsx(po,{})}function xn(){return o.jsx(ft,{children:o.jsx(Tt,{children:o.jsx(go,{children:o.jsx(bn,{})})})})}const oe=document.getElementById("root");oe?it.createRoot(oe).render(o.jsx(C.StrictMode,{children:o.jsx(xn,{})})):console.error('Fatal error: The root element with ID "root" was not found in the DOM. React cannot be mounted.');export{Nn as A,Qo as B,En as C,bo as D,nn as S,on as T,F as a,N as b,Pn as c,zn as d,Rn as e,Yo as f,In as g,An as h,gn as i,G as j,Dn as k,Xo as l,O as m,fe as n,xe as o,Q as p,ye as q,we as r,j as s,Ho as t,L as u,cn as v,Mn as w,Cn as x,kn as y,jn as z};
